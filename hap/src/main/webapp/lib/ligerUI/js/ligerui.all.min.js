$.isEmpty=function(b,a){return b===null||b===undefined||(($.isArray(b)&&!b.length))||(!a?b==="":false)};$.isString=function(a){return typeof a==="string"};$.escapeHtml=function(a){if($.isEmpty(a)||!$.isString(a)){return a}return String(a).replace(/&/gm,"&amp;").replace(/\'/gm,"&#39;").replace(/\"/gm,"&quot;").replace(/\(/gm,"&#40;").replace(/\)/gm,"&#41;").replace(/\+/gm,"&#43;").replace(/\%/gm,"&#37;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;")};$.unescapeHtml=function(a){if($.isEmpty(a)||!$.isString(a)){return a}return String(a).replace(/&amp;/gm,"&").replace(/&#39;/gm,"'").replace(/&quot;/gm,'"').replace(/&#40;/gm,"(").replace(/&#41;/gm,")").replace(/&#43;/gm,"+").replace(/&#37;/gm,"%").replace(/&lt;/gm,"<").replace(/&gt;/gm,">")}(function($){Function.prototype.ligerExtend=function(parent,overrides){if(typeof parent!="function"){return this}this.base=parent.prototype;this.base.constructor=parent;var f=function(){};f.prototype=parent.prototype;this.prototype=new f();this.prototype.constructor=this;if(overrides){$.extend(this.prototype,overrides)}};Function.prototype.ligerDefer=function(o,defer,args){var fn=this;return setTimeout(function(){fn.apply(o,args||[])},defer)};window.liger=$.ligerui={version:"V1.3.2",managerCount:0,managers:{},managerIdPrev:"ligerui",autoNewId:true,error:{managerIsExist:"管理器id已经存在"},pluginPrev:"liger",attrPrev:"data",getId:function(prev){prev=prev||this.managerIdPrev;var id=prev+(1000+this.managerCount);this.managerCount++;return id},add:function(manager){if(arguments.length==2){var m=arguments[1];m.id=m.id||m.options.id||arguments[0].id;this.addManager(m);return}if(!manager.id){manager.id=this.getId(manager.__idPrev())}this.managers[manager.id]=manager},remove:function(arg){if(typeof arg=="string"||typeof arg=="number"){delete liger.managers[arg]}else{if(typeof arg=="object"){if(arg instanceof liger.core.Component){delete liger.managers[arg.id]}else{if(!$(arg).attr(this.idAttrName)){return false}delete liger.managers[$(arg).attr(this.idAttrName)]}}}},get:function(arg,idAttrName){idAttrName=idAttrName||"ligeruiid";if(typeof arg=="string"||typeof arg=="number"){return liger.managers[arg]}else{if(typeof arg=="object"){var domObj=arg.length?arg[0]:arg;var id=domObj[idAttrName]||$(domObj).attr(idAttrName);if(!id){return null}return liger.managers[id]}}return null},find:function(type){var arr=[];for(var id in this.managers){var manager=this.managers[id];if(type instanceof Function){if(manager instanceof type){arr.push(manager)}}else{if(type instanceof Array){if($.inArray(manager.__getType(),type)!=-1){arr.push(manager)}}else{if(manager.__getType()==type){arr.push(manager)}}}}return arr},run:function(plugin,args,ext){if(!plugin){return}ext=$.extend({defaultsNamespace:"ligerDefaults",methodsNamespace:"ligerMethods",controlNamespace:"controls",idAttrName:"ligeruiid",isStatic:false,hasElement:true,propertyToElemnt:null},ext||{});plugin=plugin.replace(/^ligerGet/,"");plugin=plugin.replace(/^liger/,"");if(this==null||this==window||ext.isStatic){if(!liger.plugins[plugin]){liger.plugins[plugin]={fn:$[liger.pluginPrev+plugin],isStatic:true}}return new $.ligerui[ext.controlNamespace][plugin]($.extend({},$[ext.defaultsNamespace][plugin]||{},$[ext.defaultsNamespace][plugin+"String"]||{},args.length>0?args[0]:{}))}if(!liger.plugins[plugin]){liger.plugins[plugin]={fn:$.fn[liger.pluginPrev+plugin],isStatic:false}}if(/Manager$/.test(plugin)){return liger.get(this,ext.idAttrName)}this.each(function(){if(this[ext.idAttrName]||$(this).attr(ext.idAttrName)){var manager=liger.get(this[ext.idAttrName]||$(this).attr(ext.idAttrName));if(manager&&args.length>0){manager.set(args[0])}return}if(args.length>=1&&typeof args[0]=="string"){return}var options=args.length>0?args[0]:null;var p=$.extend({},$[ext.defaultsNamespace][plugin],$[ext.defaultsNamespace][plugin+"String"],options);if(ext.propertyToElemnt){p[ext.propertyToElemnt]=this}if(ext.hasElement){new $.ligerui[ext.controlNamespace][plugin](this,p)}else{new $.ligerui[ext.controlNamespace][plugin](p)}});if(this.length==0){return null}if(args.length==0){return liger.get(this,ext.idAttrName)}if(typeof args[0]=="object"){return liger.get(this,ext.idAttrName)}if(typeof args[0]=="string"){var manager=liger.get(this,ext.idAttrName);if(manager==null){return}if(args[0]=="option"){if(args.length==2){return manager.get(args[1])}else{if(args.length>=3){return manager.set(args[1],args[2])}}}else{var method=args[0];if(!manager[method]){return}var parms=Array.apply(null,args);parms.shift();return manager[method].apply(manager,parms)}}return null},defaults:{},methods:{},core:{},controls:{},plugins:{}};$.ligerDefaults={};$.ligerMethos={};liger.defaults=$.ligerDefaults;liger.methods=$.ligerMethos;$.fn.liger=function(plugin){if(plugin){return liger.run.call(this,plugin,arguments)}else{return liger.get(this)}};liger.core.Component=function(options){this.events=this.events||{};this.options=options||{};this.children={}};$.extend(liger.core.Component.prototype,{__getType:function(){return"liger.core.Component"},__idPrev:function(){return"ligerui"},set:function(arg,value,value2){if(!arg){return}if(typeof arg=="object"){var tmp;if(this.options!=arg){$.extend(this.options,arg);tmp=arg}else{tmp=$.extend({},arg)}if(value==undefined||value==true){for(var p in tmp){if(p.indexOf("on")==0){this.set(p,tmp[p])}}}if(value==undefined||value==false){for(var p in tmp){if(p.indexOf("on")!=0){this.set(p,tmp[p],value2)}}}return}var name=arg;if(name.indexOf("on")==0){if(typeof value=="string"){eval("value="+value)}if(typeof value=="function"){this.bind(name.substr(2),value)}return}if(!this.options){this.options={}}if(this.trigger("propertychange",[arg,value])==false){return}this.options[name]=value;var pn="_set"+name.substr(0,1).toUpperCase()+name.substr(1);if(this[pn]){this[pn].call(this,value,value2)}this.trigger("propertychanged",[arg,value])},get:function(name){var pn="_get"+name.substr(0,1).toUpperCase()+name.substr(1);if(this[pn]){return this[pn].call(this,name)}return this.options[name]},hasBind:function(arg){var name=arg.toLowerCase();var event=this.events[name];if(event&&event.length){return true}return false},trigger:function(arg,data){if(!arg){return}var name=arg.toLowerCase();var event=this.events[name];if(!event){return}data=data||[];if((data instanceof Array)==false){data=[data]}for(var i=0;i<event.length;i++){var ev=event[i];if(ev.handler.apply(ev.context,data)==false){return false}}},bind:function(arg,handler,context){if(typeof arg=="object"){for(var p in arg){this.bind(p,arg[p])}return}if(typeof handler!="function"){return false}var name=arg.toLowerCase();var event=this.events[name]||[];context=context||this;event.push({handler:handler,context:context});this.events[name]=event},unbind:function(arg,handler){if(!arg){this.events={};return}var name=arg.toLowerCase();var event=this.events[name];if(!event||!event.length){return}if(!handler){delete this.events[name]}else{for(var i=0,l=event.length;i<l;i++){if(event[i].handler==handler){event.splice(i,1);break}}}},destroy:function(){liger.remove(this)}});liger.core.UIComponent=function(element,options){liger.core.UIComponent.base.constructor.call(this,options);var extendMethods=this._extendMethods();if(extendMethods){$.extend(this,extendMethods)}this.element=element;this._init();this._preRender();this.trigger("render");this._render();this.trigger("rendered");this._rendered()};liger.core.UIComponent.ligerExtend(liger.core.Component,{__getType:function(){return"liger.core.UIComponent"},_extendMethods:function(){},_init:function(){this.type=this.__getType();if(!this.element){this.id=this.options.id||liger.getId(this.__idPrev())}else{this.id=this.options.id||this.element.id||liger.getId(this.__idPrev())}liger.add(this);if(!this.element){return}var attributes=this.attr();if(attributes&&attributes instanceof Array){for(var i=0;i<attributes.length;i++){var name=attributes[i];if($(this.element).attr(name)){this.options[name]=$(this.element).attr(name)}}}var p=this.options;if($(this.element).attr("ligerui")){try{var attroptions=$(this.element).attr("ligerui");eval("attroptions = "+attroptions+";");if(attroptions){$.extend(p,attroptions)}}catch(e){}}function loadDataOp(control,jelement){var op={};if(!control||control.indexOf(".")!=-1){return op}var defaultOp=liger.defaults[control];if(!defaultOp){return op}for(var name in defaultOp){if(jelement.attr(liger.attrPrev+"-"+name)){var value=jelement.attr(liger.attrPrev+"-"+name);if(typeof(defaultOp[name])=="boolean"){op[name]=value=="true"||value=="1"}else{op[name]=value}}}return op}$.extend(p,loadDataOp(this.__getType(),$(this.element)));if($(this.element).attr("validate")){var validate;eval("validate="+$(this.element).attr("validate"));if(validate&&validate.required){p.required=true}}},_preRender:function(){},_render:function(){},_rendered:function(){if(this.element){$(this.element).attr("ligeruiid",this.id)}},_setCls:function(value){if(this.element&&value){$(this.element).addClass(value)}},attr:function(){return[]},destroy:function(){if(this.element){$(this.element).remove()}this.options=null;liger.remove(this)}});liger.controls.Input=function(element,options){liger.controls.Input.base.constructor.call(this,element,options)};liger.controls.Input.ligerExtend(liger.core.UIComponent,{__getType:function(){return"liger.controls.Input"},attr:function(){return["nullText"]},setValue:function(value){return this.set("value",value)},getValue:function(){return this.get("value")},_render:function(){this._setPlaceholder();$(this.element).attr("autocomplete","off")},_setPlaceholder:function(){if(this.options.placeholder){$(this.element).attr("placeholder",this.options.placeholder)}},setPlaceholder:function(text){this.set("placeholder",text)},_setReadonly:function(readonly){var wrapper=this.wrapper||this.text,p=this.options;if(p.disabled||!wrapper||!wrapper.hasClass("l-text")){return}var inputText=this.inputText;if(readonly){if(inputText){inputText.attr("readonly","readonly")}wrapper.addClass("l-text-readonly");if(this._setCancelable){this._setCancelable(false)}}else{if(inputText){inputText.removeAttr("readonly")}wrapper.removeClass("l-text-readonly");if(this._setCancelable){this._setCancelable(true)}}},setReadonly:function(readonly){return this.set("readonly",readonly)},setEnabled:function(){return this.set("disabled",false)},setDisabled:function(){return this.set("disabled",true)},updateStyle:function(){},resize:function(width,height){this.set({width:width,height:height+2})},setTypeCase:function(typecase){return this.set("typeCase",typecase)},_setRequired:function(required){var wrapper=this.wrapper||this.text;if(!wrapper||!wrapper.hasClass("l-text")){return}if(required){wrapper.addClass("l-text-required")}else{wrapper.removeClass("l-text-required")}},setRequired:function(required){return this.set("required",required)}});liger.win={top:false,grids:{},mask:function(win){if(this.masking){return}function setHeight(){if(!liger.win.windowMask){return}var h=$(window).height()+$(window).scrollTop();liger.win.windowMask.height(h)}if(!this.windowMask){this.windowMask=$("<div class='l-window-mask' style='display: block;'></div>").appendTo("body");$(window).bind("resize.ligeruiwin",setHeight);$(window).bind("scroll",setHeight)}this.windowMask.show();setHeight();this.masking=true;for(var id in $.ligerui.managers){var cmp=$.ligerui.managers[id];if(cmp instanceof $.ligerui.controls.Grid&&$(cmp.element).is(":visible")){this.grids[id]=cmp}}},unmask:function(win){var jwins=$("body > .l-dialog:visible,body > .l-window:visible");for(var i=0,l=jwins.length;i<l;i++){var winid=jwins.eq(i).attr("ligeruiid");if(win&&win.id==winid){continue}var winmanager=liger.get(winid);if(!winmanager){continue}var modal=winmanager.get("modal");if(modal){return}}if(this.windowMask){this.windowMask.hide()}this.masking=false;this.grids={}},createTaskbar:function(){if(!this.taskbar){this.taskbar=$('<div class="l-taskbar"><div class="l-taskbar-tasks"></div><div class="l-clear"></div></div>').appendTo("body");if(this.top){this.taskbar.addClass("l-taskbar-top")}this.taskbar.tasks=$(".l-taskbar-tasks:first",this.taskbar);this.tasks={}}this.taskbar.show();this.taskbar.animate({bottom:0});return this.taskbar},removeTaskbar:function(){var self=this;self.taskbar.animate({bottom:-32},function(){self.taskbar.remove();self.taskbar=null})},activeTask:function(win){for(var winid in this.tasks){var t=this.tasks[winid];if(winid==win.id){t.addClass("l-taskbar-task-active")}else{t.removeClass("l-taskbar-task-active")}}},getTask:function(win){var self=this;if(!self.taskbar){return}if(self.tasks[win.id]){return self.tasks[win.id]}return null},addTask:function(win){var self=this;if(!self.taskbar){self.createTaskbar()}if(self.tasks[win.id]){return self.tasks[win.id]}var title=win.get("title");var task=self.tasks[win.id]=$('<div class="l-taskbar-task"><div class="l-taskbar-task-icon"></div><div class="l-taskbar-task-content">'+title+"</div></div>");self.taskbar.tasks.append(task);self.activeTask(win);task.bind("click",function(){self.activeTask(win);if(win.actived){win.min()}else{win.active()}}).hover(function(){$(this).addClass("l-taskbar-task-over")},function(){$(this).removeClass("l-taskbar-task-over")});return task},hasTask:function(){for(var p in this.tasks){if(this.tasks[p]){return true}}return false},removeTask:function(win){var self=this;if(!self.taskbar){return}if(self.tasks[win.id]){self.tasks[win.id].unbind();self.tasks[win.id].remove();delete self.tasks[win.id]}if(!self.hasTask()){self.removeTaskbar()}},setFront:function(win){var pre=this.queue[this.queue.length-1];if(pre==win){pre=this.queue[this.queue.length-2]}if(pre){$(pre.element).css("z-index","8900")}$(win.element).css("z-index","9100")},queue:[],add:function(win){if(jQuery.inArray(win,this.queue)==-1){this.queue.push(win)}},remove:function(win){var g=this,q=g.queue;q.splice(jQuery.inArray(win,q),1);if(q.length){g.setFront(q[q.length-1])}}};liger.core.Win=function(element,options){liger.core.Win.base.constructor.call(this,element,options)};liger.core.Win.ligerExtend(liger.core.UIComponent,{__getType:function(){return"liger.controls.Win"},_init:function(){liger.core.Win.base._init.call(this);liger.win.add(this)},mask:function(){if(this.options.modal){liger.win.mask(this)}},unmask:function(){if(this.options.modal){liger.win.unmask(this)}},min:function(){},max:function(){},active:function(){}});liger.draggable={dragging:false};liger.resizable={reszing:false};liger.toJSON=typeof JSON==="object"&&JSON.stringify?JSON.stringify:function(o){var f=function(n){return n<10?"0"+n:n},escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,quote=function(value){escapable.lastIndex=0;return escapable.test(value)?'"'+value.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+value+'"'};if(o===null){return"null"}var type=typeof o;if(type==="undefined"){return undefined}if(type==="string"){return quote(o)}if(type==="number"||type==="boolean"){return""+o}if(type==="object"){if(typeof o.toJSON==="function"){return liger.toJSON(o.toJSON())}if(o.constructor===Date){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null}var pairs=[];if(o.constructor===Array){for(var i=0,l=o.length;i<l;i++){pairs.push(liger.toJSON(o[i])||"null")}return"["+pairs.join(",")+"]"}var name,val;for(var k in o){type=typeof k;if(type==="number"){name='"'+k+'"'}else{if(type==="string"){name=quote(k)}else{continue}}type=typeof o[k];if(type==="function"||type==="undefined"){continue}val=liger.toJSON(o[k]);pairs.push(name+":"+val)}return"{"+pairs.join(",")+"}"}};liger.getEditor=function(e){var type=e.type,control=e.control,master=e.master;if(!type){return null}var inputTag=0;if(control){control=control.substr(0,1).toUpperCase()+control.substr(1)}var defaultOp={create:function(container,editParm,controlOptions){var field=editParm.field||editParm.column,options=controlOptions||{};var isInGrid=editParm.column?true:false;var p=$.extend({},e.options);var inputType="text";if($.inArray(type,["file","checkbox","radio"])!=-1){inputType=type}var inputBody=$(field.type=="textarea"?'<textarea style="resize:none"/>':"<input type='"+inputType+"'/>");if(e.body){inputBody=e.body.clone()}if(e.password){$('<input type="password" style="display:none"/>').appendTo(container)}inputBody.appendTo(container);if(e.password){inputBody.focus(function(){inputBody.attr("type","password")})}if(editParm.field){var txtInputName=field.name;var prefixID=$.isFunction(options.prefixID)?options.prefixID(master):(options.prefixID||"");p.id=field.id||(prefixID+field.name);if($.inArray(type,["select","combobox","autocomplete","popup"])!=-1){txtInputName=field.textField||field.comboboxName;if(field.comboboxName&&!field.id){p.id=(options.prefixID||"")+field.comboboxName}}if($.inArray(type,["select","combobox","autocomplete","popup","radiolist","checkboxlist","listbox"])!=-1){p.valueFieldID=prefixID+field.name}if(!e.body){var inputName=prefixID+txtInputName;var inputId=new Date().getTime()+"_"+ ++inputTag+"_"+field.name;inputBody.attr($.extend({id:inputId,name:inputName},field.attr));if(field.cssClass){inputBody.addClass(field.cssClass)}if(field.validate&&!master.options.unSetValidateAttr){inputBody.attr("validate",liger.toJSON(field.validate))}}$.extend(p,field.options)}if(field.dictionary){field.editor=field.editor||{};if(!field.editor.data){var dicEditorData=[],dicItems=field.dictionary.split("|");$(dicItems).each(function(i,dicItem){var dics=dicItem.split(",");var dicItemId=dics[0],dicItemText=dics.length>=2?dics[1]:dics[0];dicEditorData.push({id:dicItemId,value:dicItemId,text:dicItemText})});field.editor.data=dicEditorData}}if(field.editor){if(field.editor.options){$.extend(p,field.editor.options);delete field.editor.options}if(field.editor.valueColumnName){p.valueField=field.editor.valueColumnName;delete field.editor.valueColumnName}if(field.editor.displayColumnName){p.textField=field.editor.displayColumnName;delete field.editor.displayColumnName}var ext=field.editor.p||field.editor.ext;if(ext){ext=typeof(ext)=="function"?ext(editParm):ext;$.extend(p,ext);delete field.editor.p;delete field.editor.ext}var staticOptions=field.editor.staticOptions||field.editor.sp;if(staticOptions){staticOptions=typeof(staticOptions)=="function"?staticOptions(editParm):staticOptions;$.extend(p,staticOptions)}$.extend(p,field.editor)}if(isInGrid){p.host_grid=this;p.host_grid_row=editParm.record;p.host_grid_column=editParm.column}else{p.host_form=this;if(field.readonly||p.host_form.get("readonly")){p.readonly=true}}if(field.validate&&field.validate.required){p.required=true}p.typeCase=field.typeCase;var lobj=inputBody["liger"+control](p);return lobj},getValue:function(editor,editParm){var field=editParm.field||editParm.column;if(editor.getValue){var value=editor.getValue();var edtirType=editParm.column?editParm.column.editor.type:editParm.field.type;if(field&&field.editor&&field.editor.isArrayValue&&value){value=value.split(";")}if(field&&field.editor&&field.editor.isRef&&editor.getText){value=[value,editor.getText()]}if(field&&field.editor&&field.editor.isRefMul&&editor.getText){var vs=value.split(";");var ts=editor.getText().split(";");value=[];for(var i=0;i<vs.length;i++){value.push([vs[i],ts[i]])}}if(edtirType=="int"||edtirType=="digits"||edtirType=="float"||edtirType=="number"){if($.isEmpty(value)){return""}if(edtirType=="int"||edtirType=="digits"){value=value?parseInt(value,10):0}else{value=value?parseFloat(value):0}}return value}},setValue:function(editor,value,editParm){var field=editParm.field||editParm.column;if(editor.setValue){if(field&&field.editor&&field.editor.isArrayValue&&value){value=value.join(";")}if(field&&field.editor&&field.editor.isRef&&$.isArray(value)){value=value[0]}if(field&&field.editor&&field.editor.isRefMul&&$.isArray(value)){var vs=[];for(var i=0;i<value.length;i++){vs.push(value[i].length>1?value[i][1]:value[i][0])}value=vs.join(";")}if(editor.setValue.length>2){editor.setValue(value,undefined,!!editParm.column)}else{editor.setValue(value,!!editParm.column)}}},getText:function(editor,editParm){var field=editParm.field||editParm.column;if(editor.getText){var text=editor.getText();if(text){return text}}},setText:function(editor,text,editParm){if(text&&editor.setText){editor.setText(text)}else{var field=editParm.field||editParm.column;text=editor.setValue()||editParm.value||"";if(field&&field.editor&&field.editor.isRef&&$.isArray(text)&&text.length>1){text=text[1]}if(field&&field.editor&&field.editor.isRefMul&&$.isArray(text)&&text.length>1){var vs=[];for(var i=0;i<text.length;i++){vs.push(text[1])}text=vs.join(";")}if(editor.setText){editor.setText(text)}}},getSelected:function(editor,editParm){if(editor.getSelected){return editor.getSelected()}},resize:function(editor,width,height,editParm){if(editParm.field){width=width-2}if(editor.resize){editor.resize(width,height)}},setEnabled:function(editor,isEnabled){if(isEnabled){if(editor.setEnabled){editor.setEnabled()}}else{if(editor.setDisabled){editor.setDisabled()}}},destroy:function(editor,editParm){if(editor.destroy){editor.destroy()}}};return $.extend({},defaultOp,liger.editorCreatorDefaults||{},e)};liger.editors={text:{control:"TextBox"},textarea:{control:"TextArea"},date:{control:"DateEditor",setValue:function(editor,value,editParm){if(typeof value=="string"&&/^\/Date/.test(value)){value=value.replace(/^\//,"new ").replace(/\/$/,"");eval("value = "+value)}editor.setValue(value)}},combobox:{control:"ComboBox"},spinner:{control:"Spinner"},checkbox:{control:"CheckBox"},checkboxlist:{control:"CheckBoxList",body:$("<div></div>"),resize:function(editor,width,height,editParm){editor.set("width",width-2)}},radiolist:{control:"RadioList",body:$("<div></div>"),resize:function(editor,width,height,editParm){editor.set("width",width-2)}},listbox:{control:"ListBox",body:$("<div></div>"),resize:function(editor,width,height,editParm){editor.set("width",width-2)}},popup:{control:"PopupEdit"},tl:{control:"TLEdit"},number:{control:"TextBox",options:{number:true}},currency:{control:"TextBox",options:{currency:true}},digits:{control:"TextBox",options:{digits:true}},password:{control:"TextBox",password:true}};liger.editors.string=liger.editors.text;liger.editors.select=liger.editors.combobox;liger.editors["int"]=liger.editors.digits;liger.editors["float"]=liger.editors.number;liger.editors.chk=liger.editors.checkbox;liger.editors.popupedit=liger.editors.popup;$.fn.live=$.fn.on?$.fn.on:$.fn.live;if(!$.browser){var userAgent=navigator.userAgent.toLowerCase();$.browser={version:(userAgent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:/webkit/.test(userAgent),opera:/opera/.test(userAgent),msie:/msie/.test(userAgent)&&!/opera/.test(userAgent),mozilla:/mozilla/.test(userAgent)&&!/(compatible|webkit)/.test(userAgent)}}})(jQuery);(function(a){liger.inject={prev:"liger-",defaults:{Grid_detail:{height:null,onShowDetail:null},Grid_editor:"ComboBox,DateEditor,Spinner,TextBox,PopupEdit,CheckBoxList,RadioList,Grid_editor",Grid_popup:"PopupEdit",Grid_grid:"Grid",Grid_condition:"Form",Grid_toolbar:"Toolbar",Grid_fields:"Form_fields",Form_editor:"ComboBox,DateEditor,Spinner,TextBox,PopupEdit,CheckBoxList,RadioList,Form_editor",Form_grid:"Grid",Form_columns:"Grid_columns",Form_condition:"Form",Form_popup:"PopupEdit",Form_buttons:"Button",Portal_panel:"Panel"},config:{Grid:{dynamics:"data,isChecked,detail,rowDraggingRender,toolbar,columns",arrays:"columns",columns:{dynamics:"render,totalSummary,headerRender,columns,editor,columns",arrays:"columns",textProperty:"display",columns:"liger.inject.config.Grid.columns",editor:{dynamics:"data,columns,render,renderItem,grid,condition,ext",grid:"liger.inject.config.Grid",condition:"liger.inject.config.Form"}},toolbar:{arrays:"items"}},Form:{dynamics:"validate,fields,buttons",arrays:"fields,buttons",fields:{textProperty:"label",dynamics:"validate,editor",editor:{dynamics:"data,columns,render,renderItem,grid,condition,attr",grid:"liger.inject.config.Grid",condition:"liger.inject.config.Form"}},buttons:"liger.inject.config.Button"},PopupEdit:{dynamics:"grid,condition"},Button:{textProperty:"text",dynamics:"click"},ComboBox:{dynamics:"columns,data,tree,grid,condition,render,parms,renderItem"},ListBox:{dynamics:"columns,data,render,parms"},RadioList:{dynamics:"data,parms"},CheckBoxList:{dynamics:"data,parms"},Panel:{},Portal:{dynamics:"rows,columns",arrays:"rows,columns",columns:{dynamics:"panels",arrays:"panels"},rows:{dynamics:"panels",arrays:"panels"},toolbar:{arrays:"items"}}},parse:function(b){try{if(b==null){return null}return new Function("return "+b+";")()}catch(c){return null}},parseDefault:function(d){var c=this;if(!d){return d}var b={};a(d.split(",")).each(function(f,e){if(!e){return}e=e.substr(0,1).toUpperCase()+e.substr(1);a.extend(b,c.parse("liger.defaults."+e))});return b},fotmatValue:function(c,b){if(b=="boolean"){return c=="true"||c=="1"}if(b=="number"&&c){return parseFloat(c.toString())}return c},getOptions:function(n){var j=n.jelement,h=n.defaults,c=n.config;c=a.extend({ignores:"",dynamics:"",arrays:""},c);var m=this,t={},q;if(c.textProperty){t[c.textProperty]=j.text()}for(var k in h){var o=k.toLowerCase();var d=a("> ."+o,j);if(a.inArray(k,c.ignores.split(","))!=-1){continue}if(d.length){var r=n.controlName+"_"+k;var f=m.defaults[r]||liger.defaults[r],b=c[k];if(typeof(f)=="string"){f=m.parseDefault(f)}else{if(typeof(f)=="funcion"){f=f()}}if(typeof(b)=="string"){b=m.parse(b)}else{if(typeof(b)=="funcion"){b=b()}}if(f){if(a.inArray(k,c.arrays.split(","))!=-1){q=[];a(">div,>li,>input",d).each(function(){q.push(m.getOptions({defaults:f,controlName:n.controlName,config:b,jelement:a(this)}))});t[k]=q}else{t[k]=m.getOptions({defaults:f,controlName:n.controlName,config:b,jelement:d})}}d.remove()}else{if(a.inArray(k,c.dynamics.split(","))!=-1||k.indexOf("on")==0){q=m.parse(j.attr("data-"+k)||j.attr(k));if(q){t[k]=m.fotmatValue(q,typeof(h[k]))}}else{q=j.attr("data-"+k)||j.attr(k);if(q){t[k]=m.fotmatValue(q,typeof(h[k]))}}}}var s=j.attr("data-options")||j.attr("data-property");if(s){s=m.parse("{"+s+"}")}if(s){a.extend(t,s)}return t},init:function(){var e=this,h=this.config;for(var c in e.defaults){if(typeof(e.defaults[c])=="string"){e.defaults[c]=e.parseDefault(e.defaults[c])}}for(var f in liger.controls){var b=h[f]||{};var d=e.prev+f.toLowerCase();a("."+d).each(function(){var m=a(this),j;var k=a.extend({onrender:null,onrendered:null},liger.defaults[f]);var g=e.getOptions({defaults:k,controlName:f,config:b,jelement:m});m[liger.pluginPrev+f](g)})}}};a(function(){liger.inject.init()})})(jQuery);(function(a){a.fn.ligerAccordion=function(b){return a.ligerui.run.call(this,"ligerAccordion",arguments)};a.fn.ligerGetAccordionManager=function(){return a.ligerui.get(this)};a.ligerDefaults.Accordion={height:null,speed:"normal",changeHeightOnResize:false,heightDiff:0};a.ligerMethos.Accordion={};a.ligerui.controls.Accordion=function(c,b){a.ligerui.controls.Accordion.base.constructor.call(this,c,b)};a.ligerui.controls.Accordion.ligerExtend(a.ligerui.core.UIComponent,{__getType:function(){return"Accordion"},__idPrev:function(){return"Accordion"},_extendMethods:function(){return a.ligerMethos.Accordion},_render:function(){var c=this,d=this.options;c.accordion=a(c.element);if(!c.accordion.hasClass("l-accordion-panel")){c.accordion.addClass("l-accordion-panel")}var b=0;if(a("> div[lselected=true]",c.accordion).length>0){b=a("> div",c.accordion).index(a("> div[lselected=true]",c.accordion))}a("> div",c.accordion).each(function(e,f){var g=a('<div class="l-accordion-header"><div class="l-accordion-toggle"></div><div class="l-accordion-header-inner"></div></div>');if(e==b){a(".l-accordion-toggle",g).addClass("l-accordion-toggle-open")}if(a(f).attr("title")){a(".l-accordion-header-inner",g).html(a(f).attr("title"));a(f).attr("title","")}a(f).before(g);if(!a(f).hasClass("l-accordion-content")){a(f).addClass("l-accordion-content")}if(a(f).attr("data-icon")){g.addClass("l-accordion-header-hasicon");g.append('<i><img src="'+a(f).attr("data-icon")+'" /></i>')}});a(".l-accordion-header",c.accordion).removeClass("l-accordion-header-downfirst");a(".l-accordion-content:visible",c.accordion).next(".l-accordion-header:first").addClass("l-accordion-header-downfirst");a(".l-accordion-toggle",c.accordion).each(function(){if(!a(this).hasClass("l-accordion-toggle-open")&&!a(this).hasClass("l-accordion-toggle-close")){a(this).addClass("l-accordion-toggle-close")}if(a(this).hasClass("l-accordion-toggle-close")){a(this).parent().next(".l-accordion-content:visible").hide()}});a(".l-accordion-header",c.accordion).hover(function(){a(this).addClass("l-accordion-header-over")},function(){a(this).removeClass("l-accordion-header-over")});a(".l-accordion-toggle",c.accordion).hover(function(){if(a(this).hasClass("l-accordion-toggle-open")){a(this).addClass("l-accordion-toggle-open-over")}else{if(a(this).hasClass("l-accordion-toggle-close")){a(this).addClass("l-accordion-toggle-close-over")}}},function(){if(a(this).hasClass("l-accordion-toggle-open")){a(this).removeClass("l-accordion-toggle-open-over")}else{if(a(this).hasClass("l-accordion-toggle-close")){a(this).removeClass("l-accordion-toggle-close-over")}}});a(">.l-accordion-header",c.accordion).click(function(){var e=a(".l-accordion-toggle:first",this);if(e.hasClass("l-accordion-toggle-close")){e.removeClass("l-accordion-toggle-close").removeClass("l-accordion-toggle-close-over l-accordion-toggle-open-over");e.addClass("l-accordion-toggle-open");a(this).next(".l-accordion-content").show(d.speed).siblings(".l-accordion-content:visible").hide(d.speed);a(this).siblings(".l-accordion-header").find(".l-accordion-toggle").removeClass("l-accordion-toggle-open").addClass("l-accordion-toggle-close")}else{e.removeClass("l-accordion-toggle-open").removeClass("l-accordion-toggle-close-over l-accordion-toggle-open-over").addClass("l-accordion-toggle-close");a(this).next(".l-accordion-content").hide(d.speed)}a(".l-accordion-header",c.accordion).removeClass("l-accordion-header-downfirst");a(".l-accordion-content:visible",c.accordion).next(".l-accordion-header:first").addClass("l-accordion-header-downfirst")});c.headerHoldHeight=0;a("> .l-accordion-header",c.accordion).each(function(){c.headerHoldHeight+=a(this).height()});if(d.height&&typeof(d.height)=="string"&&d.height.indexOf("%")>0){c.onResize();if(d.changeHeightOnResize){a(window).resize(function(){c.onResize()})}}else{if(d.height){c.height=d.heightDiff+d.height;c.accordion.height(c.height);c.setHeight(d.height)}else{c.header=c.accordion.height()}}c.set(d)},onResize:function(){var b=this,c=this.options;if(!c.height||typeof(c.height)!="string"||c.height.indexOf("%")==-1){return false}if(b.accordion.parent()[0].tagName.toLowerCase()=="body"){var d=a(window).height();d-=parseInt(b.layout.parent().css("paddingTop"));d-=parseInt(b.layout.parent().css("paddingBottom"));b.height=c.heightDiff+d*parseFloat(b.height)*0.01}else{b.height=c.heightDiff+(b.accordion.parent().height()*parseFloat(c.height)*0.01)}b.accordion.height(b.height);b.setContentHeight(b.height-b.headerHoldHeight)},setHeight:function(b){var c=this,d=this.options;c.accordion.height(b);b-=c.headerHoldHeight;a("> .l-accordion-content",c.accordion).height(b)}})})(jQuery);(function(a){a.fn.ligerButton=function(b){return a.ligerui.run.call(this,"ligerButton",arguments)};a.fn.ligerGetButtonManager=function(){return a.ligerui.run.call(this,"ligerGetButtonManager",arguments)};a.ligerDefaults.Button={width:60,text:"Button",disabled:false,click:null,icon:null};a.ligerMethos.Button={};a.ligerui.controls.Button=function(c,b){a.ligerui.controls.Button.base.constructor.call(this,c,b)};a.ligerui.controls.Button.ligerExtend(a.ligerui.controls.Input,{__getType:function(){return"Button"},__idPrev:function(){return"Button"},_extendMethods:function(){return a.ligerMethos.Button},_render:function(){var b=this,c=this.options;b.button=a(b.element);b.button.attr("tabIndex",0);b.button.addClass("l-button");b.button.append('<div class="l-button-l"></div><div class="l-button-r"></div><span></span>');b.button.hover(function(){if(c.disabled){return}b.button.addClass("l-button-over")},function(){if(c.disabled){return}b.button.removeClass("l-button-over")}).keyup(function(d){if(d.which==13||d.which==32){if(!c.disabled&&c.click){c.click()}}}).focus(function(){a(this).addClass("l-button-focus")}).blur(function(){a(this).removeClass("l-button-focus")});c.click&&b.button.click(function(){if(!c.disabled){c.click()}});b.set(c)},_setIcon:function(b){var c=this;if(!b){c.button.removeClass("l-button-hasicon");c.button.find("img").remove()}else{c.button.addClass("l-button-hasicon");c.button.append('<img src="'+b+'" />')}},_setEnabled:function(b){if(b){this.button.removeClass("l-button-disabled")}},_setDisabled:function(b){if(b){this.button.addClass("l-button-disabled");this.options.disabled=true}else{this.button.removeClass("l-button-disabled");this.options.disabled=false}},_setWidth:function(b){this.button.width(b)},_setText:function(b){a("span",this.button).html(b)},setValue:function(b){this.set("text",b)},getValue:function(){return this.options.text},setEnabled:function(){this.set("disabled",false)},setDisabled:function(){this.set("disabled",true)}})})(jQuery);(function(a){a.fn.ligerCheckBox=function(b){return a.ligerui.run.call(this,"ligerCheckBox",arguments)};a.fn.ligerGetCheckBoxManager=function(){return a.ligerui.run.call(this,"ligerGetCheckBoxManager",arguments)};a.ligerDefaults.CheckBox={disabled:false,readonly:false,checkValue:true,uncheckValue:false,onClick:null};a.ligerMethos.CheckBox={};a.ligerui.controls.CheckBox=function(c,b){a.ligerui.controls.CheckBox.base.constructor.call(this,c,b)};a.ligerui.controls.CheckBox.ligerExtend(a.ligerui.controls.Input,{__getType:function(){return"CheckBox"},__idPrev:function(){return"CheckBox"},_extendMethods:function(){return a.ligerMethos.CheckBox},_render:function(){var b=this,c=this.options;b.input=a(b.element);b.link=a('<a class="l-checkbox" tabindex="0"></a>');b.wrapper=b.input.addClass("l-hidden").wrap('<div class="l-checkbox-wrapper"></div>').parent();b.wrapper.prepend(b.link);function d(){if(b.input.attr("disabled")||b.input.attr("readonly")){return false}if(c.disabled||c.readonly){return false}if(b.trigger("beforeClick",[b.element])==false){return false}if(a(this).hasClass("l-checkbox-checked")){b._setValue(c.uncheckValue)}else{b._setValue(c.checkValue)}b.input.trigger("change");b.trigger("click")}b.link.click(d).keydown(function(f){if(f.keyCode==32||f.keyCode==13){d.call(this)}});b.wrapper.hover(function(){if(!c.disabled){a(this).addClass("l-over")}},function(){a(this).removeClass("l-over")});this.set(c);this.updateStyle()},_setCss:function(b){this.wrapper.css(b)},_setValue:function(c){var b=this,d=this.options;if(c===d.uncheckValue){b.input[0].checked=false;b.link.removeClass("l-checkbox-checked")}else{b.input[0].checked=true;b.link.addClass("l-checkbox-checked")}},_setDisabled:function(b){if(b){this.input.attr("disabled",true);this.wrapper.addClass("l-disabled")}else{this.input.attr("disabled",false);this.wrapper.removeClass("l-disabled")}},_getValue:function(){if(this.element.checked){return this.options.checkValue}else{return this.options.uncheckValue}},updateStyle:function(){if(this.input.attr("disabled")){this.wrapper.addClass("l-disabled");this.options.disabled=true}if(this.input[0].checked){this.link.addClass("l-checkbox-checked")}else{this.link.removeClass("l-checkbox-checked")}}})})(jQuery);(function(a){a.fn.ligerCheckBoxList=function(b){return a.ligerui.run.call(this,"ligerCheckBoxList",arguments)};a.ligerDefaults.CheckBoxList={rowSize:3,valueField:"id",textField:"text",valueFieldID:null,name:null,split:";",data:null,parms:null,url:null,ajaxType:"post",onSuccess:null,onError:null,css:null,value:null,valueFieldCssClass:null};a.ligerMethos.CheckBoxList=a.ligerMethos.CheckBoxList||{};a.ligerui.controls.CheckBoxList=function(c,b){a.ligerui.controls.CheckBoxList.base.constructor.call(this,c,b)};a.ligerui.controls.CheckBoxList.ligerExtend(a.ligerui.controls.Input,{__getType:function(){return"CheckBoxList"},_extendMethods:function(){return a.ligerMethos.CheckBoxList},_init:function(){a.ligerui.controls.CheckBoxList.base._init.call(this)},_render:function(){var b=this,c=this.options;b.data=c.data;b.valueField=null;if(a(this.element).is(":hidden")||a(this.element).is(":text")){b.valueField=a(this.element);if(a(this.element).is(":text")){b.valueField.hide()}}else{if(c.valueFieldID){b.valueField=a("#"+c.valueFieldID+":input,[name="+c.valueFieldID+"]:input");if(b.valueField.length==0){b.valueField=a('<input type="hidden"/>')}b.valueField[0].id=b.valueField[0].name=c.valueFieldID}else{b.valueField=a('<input type="hidden"/>');b.valueField[0].id=b.valueField[0].name=b.id+"_val"}}if(b.valueField[0].name==null){b.valueField[0].name=b.valueField[0].id}if(c.valueFieldCssClass){b.valueField.addClass(c.valueFieldCssClass)}b.valueField.attr("data-ligerid",b.id);if(a(this.element).is(":hidden")||a(this.element).is(":text")){b.checkboxList=a("<div></div>").insertBefore(this.element)}else{b.checkboxList=a(this.element)}b.checkboxList.html('<div class="l-checkboxlist-inner"><table cellpadding="0" cellspacing="0" border="0" class="l-checkboxlist-table"></table></div>').addClass("l-checkboxlist").append(b.valueField);b.checkboxList.table=a("table:first",b.checkboxList);b.set(c);b._addClickEven()},destroy:function(){if(this.checkboxList){this.checkboxList.remove()}this.options=null;a.ligerui.remove(this)},clear:function(){this._changeValue("");this.trigger("clear")},_setCss:function(b){if(b){this.checkboxList.addClass(b)}},_setDisabled:function(b){if(b){this.checkboxList.addClass("l-checkboxlist-disabled");a("input:checkbox",this.radioList).attr("disabled",true)}else{this.checkboxList.removeClass("l-checkboxlist-disabled");a("input:checkbox",this.radioList).removeAttr("disabled")}},_setWidth:function(b){this.checkboxList.width(b)},_setHeight:function(b){this.checkboxList.height(b)},indexOf:function(e){var d=this,f=this.options;if(!d.data){return -1}for(var c=0,b=d.data.length;c<b;c++){if(typeof(e)=="object"){if(d.data[c]==e){return c}}else{if(d.data[c][f.valueField].toString()==e.toString()){return c}}}return -1},removeItems:function(b){var c=this;if(!c.data){return}a(b).each(function(e,f){var d=c.indexOf(f);if(d==-1){return}c.data.splice(d,1)});c.refresh()},removeItem:function(c){if(!this.data){return}var b=this.indexOf(c);if(b==-1){return}this.data.splice(b,1);this.refresh()},insertItem:function(d,b){var c=this;if(!c.data){c.data=[]}c.data.splice(b,0,d);c.refresh()},addItems:function(b){var c=this;if(!c.data){c.data=[]}a(b).each(function(d,e){c.data.push(e)});c.refresh()},addItem:function(c){var b=this;if(!b.data){b.data=[]}b.data.push(c);b.refresh()},_setValue:function(c){var b=this,d=this.options;d.value=c;b.valueField.val(d.value);this._dataInit()},setValue:function(b){this._setValue(b)},_setUrl:function(b){if(!b){return}var d=this,e=this.options;var c=a.isFunction(e.parms)?e.parms():e.parms;a.ajax({type:e.ajaxType||"post",url:b,data:c,cache:false,dataType:"json",success:function(f){d.setData(f);d.trigger("success",[f])},error:function(f,g){d.trigger("error",[f,g])}})},setUrl:function(b){return this._setUrl(b)},setParm:function(b,e){if(!b){return}var d=this;var c=d.get("parms");if(!c){c={}}c[b]=e;d.set("parms",c)},clearContent:function(){var b=this,c=this.options;a("table",b.checkboxList).html("")},_setData:function(b){this.setData(b)},setData:function(c){var b=this,d=this.options;if(!c||!c.length){return}b.data=c;b.refresh();b.updateStyle()},refresh:function(){var m=this,d=this.options,j=this.data;this.clearContent();if(!j){return}var f=[],o=d.rowSize,n=false,b=d.name||m.id;for(var k=0;k<j.length;k++){var e=j[k][d.valueField],h=j[k][d.textField],c=m.id+"-"+k;var q=k%o==0;if(q){if(n){f.push("</tr>")}f.push("<tr>");n=true}f.push("<td><input type='checkbox' name='"+b+"' value='"+e+"' id='"+c+"'/><label for='"+c+"'>"+h+"</label></td>")}if(n){f.push("</tr>")}m.checkboxList.table.append(f.join(""))},_getValue:function(){var d=this,e=this.options,c=e.name||d.id;var b=[];a('input:checkbox[name="'+c+'"]:checked').each(function(){b.push(this.value)});if(!b.length){return null}return b.join(e.split)},getValue:function(){return this._getValue()},getText:function(){var d=this,e=this.options,c=e.name||d.id;var b=[];a('input:checkbox[name="'+c+'"]:checked').each(function(){b.push(a(this).next("label").text())});if(!b.length){return null}return b.join(e.split)},updateStyle:function(){this._dataInit()},_dataInit:function(){var b=this,d=this.options;var c=b.valueField.val();b._changeValue(c)},_changeValue:function(f){var e=this,h=this.options,d=h.name||e.id;var b=f?f.split(h.split):[];a("input:checkbox[name='"+d+"']",e.checkboxList).each(function(){this.checked=a.inArray(this.value,b)>-1});var c=e.valueField.val();e.valueField.val(f);e.selectedValue=f;if(c!=f){e.trigger("changeValue",f)}},_addClickEven:function(){var b=this,c=this.options;b.checkboxList.click(function(f){var d=b.getValue();if(d){b.valueField.val(d)}})}})})(jQuery);(function(a){a.fn.ligerComboBox=function(b){return a.ligerui.run.call(this,"ligerComboBox",arguments)};a.fn.ligerGetComboBoxManager=function(){return a.ligerui.run.call(this,"ligerGetComboBoxManager",arguments)};a.ligerDefaults.ComboBox={resize:true,isMultiSelect:false,isShowCheckBox:false,columns:null,width:null,selectBoxWidth:null,selectBoxHeight:120,selectBoxPosYDiff:-3,onBeforeSelect:false,onAfterShowData:null,onSelected:null,initValue:null,value:"",initText:null,valueField:"id",textField:"text",dataParmName:null,valueFieldID:null,ajaxComplete:null,ajaxBeforeSend:null,ajaxContentType:null,slide:false,split:";",data:null,dataGetter:null,tree:null,treeLeafOnly:true,condition:null,grid:null,onStartResize:null,onEndResize:null,hideOnLoseFocus:true,hideGridOnLoseFocus:false,url:null,urlParms:null,selectBoxRender:null,selectBoxRenderUpdate:null,detailEnabled:true,detailUrl:null,detailPostIdField:null,detailDataParmName:null,detailParms:null,detailDataGetter:null,delayLoad:false,triggerToLoad:false,emptyText:null,addRowButton:"新增",addRowButtonClick:null,triggerIcon:null,onSuccess:null,onBeforeSetData:null,onError:null,onBeforeOpen:null,onButtonClick:null,onTextBoxKeyDown:null,onTextBoxKeyEnter:null,render:null,absolute:true,cancelable:true,css:null,parms:null,renderItem:null,autocomplete:true,autocompleteAllowEmpty:true,highLight:true,readonly:false,ajaxType:"post",alwayShowInTop:false,alwayShowInDown:false,valueFieldCssClass:null,isRowReadOnly:null,rowClsRender:null,initIsTriggerEvent:false,conditionSearchClick:null,focusWhenSetValue:true};a.ligerDefaults.ComboBoxString={Search:"搜索"};a.ligerMethos.ComboBox=a.ligerMethos.ComboBox||{};a.ligerui.controls.ComboBox=function(c,b){a.ligerui.controls.ComboBox.base.constructor.call(this,c,b)};a.ligerui.controls.ComboBox.ligerExtend(a.ligerui.controls.Input,{__getType:function(){return"ComboBox"},_extendMethods:function(){return a.ligerMethos.ComboBox},_init:function(){a.ligerui.controls.ComboBox.base._init.call(this);var b=this.options;if(b.columns){b.isShowCheckBox=true}if(b.isMultiSelect){b.isShowCheckBox=true;b.autocomplete=false}if(b.triggerToLoad){b.delayLoad=true}},setCustomParam:function(b,c){if(b instanceof Object){this.options.customParms=b}else{this.options.customParms=new Object();this.options.customParms[b]=c}},_render:function(){a.ligerui.controls.ComboBox.base._render.call(this);var b=this,c=this.options;b.data=c.data;b.inputText=null;b.select=null;b.textFieldID="";b.valueFieldID="";if(a(this.element).is(":hidden")){a(this.element).hide();b.valueField=a(this.element);b.textFieldID=c.textFieldID||(this.element.id+"_txt");b.inputText=a('<input type="text" autocomplete="off" readonly="true"/>');b.inputText.attr("id",b.textFieldID).insertAfter(a(this.element));if(b.valueField.attr("validate")){b.inputText.attr("validate",b.valueField.attr("validate"));b.valueField.removeAttr("validate")}if(b.valueField.attr("validateMessage")){b.inputText.attr("validateMessage",b.valueField.attr("validateMessage"));b.valueField.removeAttr("validateMessage")}}else{if(this.element.tagName.toLowerCase()=="input"){this.element.readOnly=true;b.inputText=a(this.element);b.inputText.attr("autocomplete","off");b.textFieldID=this.element.id}else{if(this.element.tagName.toLowerCase()=="select"){a(this.element).hide();b.select=a(this.element);c.isMultiSelect=false;c.isShowCheckBox=false;c.cancelable=false;b.textFieldID=c.textFieldID||(this.element.id+"_txt");b.inputText=a('<input type="text" autocomplete="off" readonly="true"/>');b.inputText.attr("id",b.textFieldID).insertAfter(a(this.element));if(b.select.attr("validate")){b.inputText.attr("validate",b.select.attr("validate"));b.select.removeAttr("validate")}if(b.select.attr("validateMessage")){b.inputText.attr("validateMessage",b.select.attr("validateMessage"));b.select.removeAttr("validateMessage")}if(!c.value&&this.element.value){c.value=this.element.value}}}}if(b.inputText[0].name==undefined||b.inputText[0].name=="undefined"){b.inputText[0].name=b.textFieldID}b.inputText.attr("data-comboboxid",b.id);if(b.valueField==null){if(c.valueFieldID){b.valueField=a("#"+c.valueFieldID+":input,[name="+c.valueFieldID+"]:input").filter("input:hidden");if(b.valueField.length==0){b.valueField=a('<input type="hidden"/>')}b.valueField[0].id=b.valueField[0].name=c.valueFieldID}else{b.valueField=a('<input type="hidden"/>');b.valueField[0].id=b.valueField[0].name=b.textFieldID+"_val"}}if(c.valueFieldCssClass){b.valueField.addClass(c.valueFieldCssClass)}if(b.valueField[0].name==undefined){b.valueField[0].name=b.valueField[0].id}if(c.initValue!=null){b.valueField[0].value=c.initValue}b.valueField.attr("data-ligerid",b.id);b.link=a('<div class="l-trigger"><div class="l-trigger-icon"></div></div>');if(c.triggerIcon){b.link.find("div:first").addClass(c.triggerIcon)}b.selectBox=a('<div class="l-box-select" style="display:none"><div class="l-box-select-inner"><table cellpadding="0" cellspacing="0" border="0" class="l-box-select-table"></table></div></div>');b.selectBox.table=a("table:first",b.selectBox);b.selectBoxInner=b.selectBox.find(".l-box-select-inner:first");b.wrapper=b.inputText.wrap('<div class="l-text l-text-combobox"></div>').parent();b.wrapper.append('<div class="l-text-l"></div><div class="l-text-r"></div>');b.wrapper.append(b.link);b.textwrapper=b.wrapper.wrap('<div class="l-text-wrapper"></div>').parent();if(c.absolute){b.selectBox.appendTo("body").addClass("l-box-select-absolute")}else{b.textwrapper.append(b.selectBox)}b.textwrapper.append(b.valueField);b.inputText.addClass("l-text-field");if(c.isShowCheckBox&&!b.select){a("table",b.selectBox).addClass("l-table-checkbox")}else{c.isShowCheckBox=false;a("table",b.selectBox).addClass("l-table-nocheckbox")}b.link.hover(function(){if(c.disabled||c.readonly){return}this.className="l-trigger-hover"},function(){if(c.disabled||c.readonly){return}this.className="l-trigger"}).mousedown(function(){if(c.disabled||c.readonly){return}this.className="l-trigger-pressed"}).mouseup(function(){if(c.disabled||c.readonly){return}this.className="l-trigger-hover"}).click(function(){if(c.disabled||c.readonly){return}if(b.trigger("buttonClick")==false){return false}if(b.trigger("beforeOpen")==false){return false}if(c.triggerToLoad&&!b.triggerLoaded){b.triggerLoaded=true;b.selectBox.table.html("<tr><td>正在查询...</td></tr>");b._toggleSelectBox(b.selectBox.is(":visible"));b._setUrl(c.url)}else{b._toggleSelectBox(b.selectBox.is(":visible"))}});b.inputText.click(function(){if(c.disabled||c.readonly){return}if(b.trigger("beforeOpen")==false){return false}if(!c.autocomplete){if(c.triggerToLoad&&!b.triggerLoaded){b.triggerLoaded=true;b.selectBox.table.html("<tr><td>正在查询...</td></tr>");b._toggleSelectBox(b.selectBox.is(":visible"));b._setUrl(c.url)}else{b._toggleSelectBox(b.selectBox.is(":visible"))}}else{b.updateSelectBoxPosition()}});b.inputText.blur(function(){if(c.disabled||c.readonly){return}b.wrapper.removeClass("l-text-focus");if(c.autocomplete==false){return}var e=b.inputText.val(),d;a.each(b.data_bak||b.data,function(f,g){if(e==g[b.options.textField]){d=g[b.options.valueField];return false}});if(d){b._changeValue(d,e,false)}else{b.clear()}}).focus(function(){if(c.disabled||c.readonly){return}b.wrapper.addClass("l-text-focus")}).keydown(function(g){if(c.disabled||c.readonly){return}var f=g.keyCode;if(!b.selectBox.is(":visible")){if(f==40){if(b.trigger("beforeOpen")==false){return false}if(c.triggerToLoad&&!b.triggerLoaded){b.triggerLoaded=true;b.selectBox.table.html("<tr><td>正在查询...</td></tr>");b._toggleSelectBox(false);b._setUrl(c.url)}else{b._toggleSelectBox(false)}}}else{if(f==38||f==40){var h=a("table.l-table-nocheckbox td.l-over",b.selectBox),d;if(h.length){h.removeClass("l-over");d=h.parent()[f==38?"prev":"next"]("tr").children("td")}if(!d||!d.length){d=a("table.l-table-nocheckbox td"+(f==38?":last":":first"),b.selectBox)}d.addClass("l-over")}else{if(f==13){b._selectItem.call(a("table.l-table-nocheckbox td.l-over",b.selectBox),{data:b})}else{if(f==9){b._toggleSelectBox(true)}}}}});b.wrapper.hover(function(){if(c.disabled||c.readonly){return}b.wrapper.addClass("l-text-over")},function(){if(c.disabled||c.readonly){return}b.wrapper.removeClass("l-text-over")});b.resizing=false;b.selectBox.hover(null,function(d){if(c.hideOnLoseFocus&&b.selectBox.is(":visible")&&!b.boxToggling&&!b.resizing){b._toggleSelectBox(true)}});b.bulidContent();b.set(c,null,"init");if(c.selectBoxWidth){b.selectBox.width(c.selectBoxWidth)}else{b.selectBox.css("width",b.wrapper.css("width"))}if(c.grid){b.bind("show",function(){if(!b.grid){b.setGrid(c.grid);b.set("SelectBoxHeight",c.selectBoxHeight)}})}b.updateSelectBoxPosition();a(document).bind("click.combobox",function(d){if(b.selectBox.is(":visible")&&a((d.target||d.srcElement)).closest(".l-box-select, .l-text-combobox").length==0){b._toggleSelectBox(true)}})},destroy:function(){if(this.ajaxId){this.ajaxId.abort();this.ajaxId=null}if(this.wrapper){this.wrapper.remove()}if(this.selectBox){this.selectBox.remove()}this.options=null;a.ligerui.remove(this)},clear:function(){this._changeValue("","");a("a.l-checkbox-checked",this.selectBox).removeClass("l-checkbox-checked");a("td.l-selected",this.selectBox).removeClass("l-selected");a(":checkbox",this.selectBox).each(function(){this.checked=false});this.trigger("clear")},_setSelectBoxHeight:function(b){if(!b){return}var c=this,d=this.options;if(d.grid){c.grid&&c.grid.set("height",c.getGridHeight(b))}if(!d.tree){var e=a("tr",c.selectBox.table).length;if(!d.selectBoxHeight&&e<8){d.selectBoxHeight=e*30}if(d.selectBoxHeight){if(e<8){c.selectBoxInner.height("auto")}else{c.selectBoxInner.height(d.selectBoxHeight)}}}},_setCss:function(b){if(b){this.wrapper.addClass(b)}},_setCancelable:function(c){var b=this,d=this.options;if(!c&&b.unselect){b.unselect.remove();b.unselect=null;b.wrapper.unbind("mouseenter mouseleave")}if(!c&&!b.unselect){return}b.unselect=a('<div class="l-trigger l-trigger-cancel"><div class="l-trigger-icon"></div></div>').hide();b.wrapper.hover(function(){b.unselect.show()},function(){b.unselect.hide()});if(!d.disabled&&!d.readonly&&d.cancelable){b.wrapper.append(b.unselect)}b.unselect.hover(function(){this.className="l-trigger-hover l-trigger-cancel"},function(){this.className="l-trigger l-trigger-cancel"}).click(function(){b.clear()})},_setDisabled:function(b){var c=this.options;c.disabled=false;if(b){this.inputText.attr("readonly","readonly");this.wrapper.addClass("l-text-disabled");this._setCancelable(false)}else{if(c.autocomplete&&c.readonly!==true){this.inputText.removeAttr("readonly")}this.wrapper.removeClass("l-text-disabled");if(this.options.cancelable){this._setCancelable(true)}}c.disabled=b},_setReadonly:function(b){if(this.options.autocomplete==false){if(b){this.wrapper.addClass("l-text-readonly")}else{this.wrapper.removeClass("l-text-readonly")}}else{a.ligerui.controls.ComboBox.base._setReadonly.call(this,b)}},_setLable:function(b){var c=this,d=this.options;if(b){if(c.labelwrapper){c.labelwrapper.find(".l-text-label:first").html(b+":&nbsp")}else{c.labelwrapper=c.textwrapper.wrap('<div class="l-labeltext"></div>').parent();c.labelwrapper.prepend('<div class="l-text-label" style="float:left;display:inline;">'+b+":&nbsp</div>");c.textwrapper.css("float","left")}if(!d.labelWidth){d.labelWidth=a(".l-text-label",c.labelwrapper).outerWidth()}else{a(".l-text-label",c.labelwrapper).outerWidth(d.labelWidth)}a(".l-text-label",c.labelwrapper).width(d.labelWidth);a(".l-text-label",c.labelwrapper).height(c.wrapper.height());c.labelwrapper.append('<br style="clear:both;" />');if(d.labelAlign){a(".l-text-label",c.labelwrapper).css("text-align",d.labelAlign)}c.textwrapper.css({display:"inline"});c.labelwrapper.width(c.wrapper.outerWidth()+d.labelWidth+2)}},_setWidth:function(c){var b=this,d=this.options;if(c>20){b.wrapper.css({width:c});b.inputText.css({width:c-20});if(!d.selectBoxWidth){b.selectBox.css({width:c})}}},_setHeight:function(c){var b=this;if(c>10){b.wrapper.height(c);b.inputText.height(c-2)}},_setResize:function(b){var d=this,e=this.options;if(e.columns){return}if(b&&a.fn.ligerResizable){var c=e.selectBoxHeight?"e":"se,s,e";d.selectBox.ligerResizable({handles:c,onStartResize:function(){d.resizing=true;d.trigger("startResize")},onEndResize:function(){d.resizing=false;if(d.trigger("endResize")==false){return false}},onStopResize:function(g,f){if(d.grid){if(g.newWidth){d.selectBox.width(g.newWidth)}if(g.newHeight){d.set({selectBoxHeight:g.newHeight})}d.grid.refreshSize();d.trigger("endResize");return false}return true}});d.selectBox.append("<div class='l-btn-nw-drop'></div>")}},findTextByValue:function(f){var b=this,h=this.options;if(f==null){return""}var e="";var c=function(k){var d=f.toString().split(h.split);for(var g=0;g<d.length;g++){if(d[g]==k){return true}}return false};var j;if(b.options.grid&&b.options.grid.data){j=b.options.grid.data.Rows}else{j=b.data}a(j).each(function(g,k){var m=k[h.valueField];var d=k[h.textField];if(c(m)){e+=d+h.split}});if(e.length>0){e=e.substr(0,e.length-1)}return e},findValueByText:function(f){var c=this,e=this.options;if(!f&&f==""){return""}var d=function(j){var g=f.toString().split(e.split);for(var h=0;h<g.length;h++){if(g[h]==j){return true}}return false};var b="";a(c.data).each(function(h,j){var k=j[e.valueField];var g=j[e.textField];if(d(g)){b+=k+e.split}});if(b.length>0){b=b.substr(0,b.length-1)}return b},insertItem:function(d,b){var c=this,e=this.options;c.data=c.data||[];c.data.splice(b,0,d);c.setData(c.data)},addItem:function(c){var b=this,d=this.options;b.insertItem(c,(b.data||[]).length)},_setValue:function(j,k,b){var h=this,c=this.options;var f=false,m=true;if(k=="init"){k=null;f=true;m=c.initIsTriggerEvent?true:false}k=k||h.findTextByValue(j);if(c.tree){h.selectValueByTree(j)}else{if(!c.isMultiSelect){h._changeValue(j,k,m,b);a("tr[value='"+j+"'] td",h.selectBox).addClass("l-selected");a("tr[value!='"+j+"'] td",h.selectBox).removeClass("l-selected")}else{h._changeValue(j,k,m,b);if(j!=null){var e=j.toString().split(c.split);a("table.l-table-checkbox :checkbox",h.selectBox).each(function(){this.checked=false});for(var d=0;d<e.length;d++){a("table.l-table-checkbox tr[value="+e[d]+"] :checkbox",h.selectBox).each(function(){this.checked=true})}}}}if(c.selectBoxRenderUpdate){c.selectBoxRenderUpdate.call(h,{selectBox:h.selectBox,value:j,text:k})}},selectValue:function(b,c){this._setValue(b,undefined,c)},bulidContent:function(){var b=this,c=this.options;this.clearContent();if(b.select){b.setSelect()}else{if(c.tree){b.setTree(c.tree)}}},reload:function(){var b=this,c=this.options;if(c.url){b.set("url",c.url)}else{if(b.grid){b.grid.reload()}}},_setUrl:function(c,j){if(!c){return}var e=this,h=this.options;if(h.readonly){return}if(h.delayLoad&&!e.isAccessDelay&&!e.triggerLoaded){e.isAccessDelay=true;return}c=a.isFunction(c)?c.call(e):c;var f=a.isFunction(h.urlParms)?h.urlParms.call(e):h.urlParms;if(f){for(name in f){c+=c.indexOf("?")==-1?"?":"&";c+=name+"="+f[name]}}var d=a.isFunction(h.parms)?h.parms.call(e):h.parms;if(h.ajaxContentType=="application/json"&&typeof(d)!="string"){d=liger.toJSON(d)}d=a.extend(d,{page:1,pagesize:1000});var b={type:h.ajaxType,url:c,data:d,cache:false,dataType:"json",beforeSend:h.ajaxBeforeSend,complete:h.ajaxComplete,success:function(g){var k=a.isFunction(h.dataGetter)?k=h.dataGetter.call(e,g):g;k=h.dataParmName&&k?k[h.dataParmName]:k;if(e.trigger("beforeSetData",[k])==false){return}e.setData(k);e.trigger("success",[k]);if(a.isFunction(j)){j(k)}},error:function(g,k){e.trigger("error",[g,k])}};if(h.ajaxContentType){b.contentType=h.ajaxContentType}e.ajaxId=a.ajax(b)},setUrl:function(b,c){return this._setUrl(b,c)},setParm:function(b,e){if(!b){return}var d=this;var c=d.get("parms");if(!c){c={}}c[b]=e;d.set("parms",c)},clearContent:function(){var b=this,c=this.options;if(!b){return}a("table",b.selectBox).html("");if(!b){return}b._setSelectBoxHeight(c.selectBoxHeight)},setSelect:function(){var b=this,c=this.options;this.clearContent();b.data=[];a("option",b.select).each(function(e){var g=a(this).val();var d=a(this).html();b.data.push({text:d,id:g});var f=a("<tr><td index='"+e+"' value='"+g+"' text='"+d+"'>"+d+"</td>");a("table.l-table-nocheckbox",b.selectBox).append(f);a("td",f).hover(function(){a(this).addClass("l-over").siblings("td").removeClass("l-over")},function(){a(this).removeClass("l-over")})});a("td:eq("+b.select[0].selectedIndex+")",b.selectBox).each(function(){if(a(this).hasClass("l-selected")){b.selectBox.hide();return}a(".l-selected",b.selectBox).removeClass("l-selected");a(this).addClass("l-selected");if(b.select[0].selectedIndex!=a(this).attr("index")&&b.select[0].onchange){b.select[0].selectedIndex=a(this).attr("index");b.select[0].onchange()}var d=parseInt(a(this).attr("index"));b.select[0].selectedIndex=d;b.select.trigger("change");b.selectBox.hide();var e=a(this).attr("value");var f=a(this).html();if(c.render){b.inputText.val(c.render(e,f))}else{b.inputText.val(f)}});b._addClickEven()},_setData:function(b){this.setData(b)},getRowIndex:function(d){var c=this,e=this.options;if(!d){return -1}if(!c.data||!c.data.length){return -1}for(var b=0;b<c.data.length;b++){var f=c.data[b][e.valueField];if(f==d){return b}}return -1},getRow:function(d){var c=this,e=this.options;if(!d){return null}if(!c.data||!c.data.length){return null}for(var b=0;b<c.data.length;b++){var f=c.data[b][e.valueField];if(f==d){return c.data[b]}}return null},setData:function(k){var n=this,b=this.options;k=k&&k.rows||k;if(b.host_grid_column&&b.host_grid_row){if(!b.host_grid_row.__combobox_datas){b.host_grid_row.__combobox_datas={}}b.host_grid_row.__combobox_datas[b.host_grid_column.columnname]=k}if(n.select){return}if(b.selectBoxRender){b.selectBoxRender.call(n,{selectBox:n.selectBox,data:k});return}if(!k||!k.length){k=[]}if(n.data!=k){n.data=k}n.data=a.isFunction(n.data)?n.data():n.data;this.clearContent();if(b.columns){n.selectBox.table.headrow=a("<tr class='l-table-headerow'><td width='18px'></td></tr>");n.selectBox.table.append(n.selectBox.table.headrow);n.selectBox.table.addClass("l-box-select-grid");for(var e=0;e<b.columns.length;e++){var r=a("<td columnindex='"+e+"' columnname='"+b.columns[e].name+"'>"+b.columns[e].header+"</td>");if(b.columns[e].width){r.width(b.columns[e].width)}n.selectBox.table.headrow.append(r)}}var f=[];if(b.emptyText){n.emptyRow={};n.emptyRow[b.textField]=b.emptyText;n.emptyRow[b.valueField]=b.emptyValue!=undefined?b.emptyValue:"";k.splice(0,0,n.emptyRow)}for(var m=0;m<k.length;m++){var c=k[m][b.valueField];var h=k[m][b.textField];var o=a.isFunction(b.isRowReadOnly)?b.isRowReadOnly(k[m]):false;if(!b.columns){f.push("<tr value='"+c+"'");var s=[];if(o){s.push(" rowreadonly ")}if(a.isFunction(b.rowClsRender)){s.push(b.rowClsRender(k[m]))}if(s.length){f.push(" class='");f.push(s.join(""));f.push("'")}f.push(">");if(b.isShowCheckBox){f.push("<td style='width:18px;'  index='"+m+"' value='"+c+"' text='"+h+"' ><input type='checkbox' /></td>")}var d=h;if(b.renderItem){d=b.renderItem.call(n,{data:k[m],value:c,text:h,key:n.inputText.val()})}else{if(b.autocomplete&&b.highLight){d=n._highLight(h,n.inputText.val())}else{d="<span>"+d+"</span>"}}f.push("<td index='"+m+"' value='"+c+"' text='"+h+"' align='left'>"+d+"</td></tr>")}else{f.push("<tr value='"+c+"'");if(o){f.push(" class='rowreadonly'")}f.push(">");f.push("<td style='width:18px;'  index='"+m+"' value='"+c+"' text='"+h+"' ><input type='checkbox' /></td>");for(var e=0;e<b.columns.length;e++){var q=b.columns[e].name;f.push("<td>"+k[m][q]+"</td>")}f.push("</tr>")}}if(!b.columns){if(b.isShowCheckBox){a("table.l-table-checkbox",n.selectBox).append(f.join(""))}else{a("table.l-table-nocheckbox",n.selectBox).append(f.join(""))}}else{n.selectBox.table.append(f.join(""))}if(b.addRowButton&&b.addRowButtonClick&&!n.addRowButton){n.addRowButton=a('<div class="l-box-select-add"><a href="javascript:void(0)" class="link"><div class="icon"></div></a></div>');n.addRowButton.find(".link").append(b.addRowButton).click(b.addRowButtonClick);n.selectBoxInner.after(n.addRowButton)}n.set("selectBoxHeight",b.selectBoxHeight);if(b.isShowCheckBox&&a.fn.ligerCheckBox){a("table input:checkbox",n.selectBox).ligerCheckBox()}a(".l-table-checkbox input:checkbox",n.selectBox).change(function(){if(this.checked&&n.hasBind("beforeSelect")){var g=null;if(a(this).parent().get(0).tagName.toLowerCase()=="div"){g=a(this).parent().parent()}else{g=a(this).parent()}if(g!=null&&n.trigger("beforeSelect",[g.attr("value"),g.attr("text")])==false){n.selectBox.slideToggle("fast");return false}}if(!b.isMultiSelect){if(this.checked){a("input:checked",n.selectBox).not(this).each(function(){this.checked=false;a(".l-checkbox-checked",a(this).parent()).removeClass("l-checkbox-checked")});n.selectBox.slideToggle("fast")}}n._checkboxUpdateValue()});a("table.l-table-nocheckbox td",n.selectBox).hover(function(){if(!a(this).parent().hasClass("rowreadonly")){a(this).addClass("l-over")}},function(){a(this).removeClass("l-over")});n._addClickEven();if(!b.autocomplete){n.updateStyle()}n.trigger("afterShowData",[k])},setTree:function(b){var c=this,d=this.options;this.clearContent();c.selectBox.table.remove();if(b.checkbox!=false){b.onCheck=function(){var e=c.treeManager.getChecked();var f=[];var g=[];a(e).each(function(h,j){if(d.treeLeafOnly&&j.data.children){return}f.push(j.data[d.valueField]);g.push(j.data[d.textField])});c._changeValue(f.join(d.split),g.join(d.split),true)}}else{b.onSelect=function(e){if(c.trigger("BeforeSelect",[e])==false){return}if(d.treeLeafOnly&&e.data.children){return}var f=e.data[d.valueField];var g=e.data[d.textField];c._changeValue(f,g,true);c.selectBox.hide()};b.onCancelSelect=function(e){c._changeValue("","",true)}}b.onAfterAppend=function(g,e){if(!c.treeManager){return}var f=null;if(d.initValue){f=d.initValue}else{if(c.valueField.val()!=""){f=c.valueField.val()}}c.selectValueByTree(f)};c.tree=a("<ul></ul>");a("div:first",c.selectBox).append(c.tree);c.innerTree=c.tree.ligerTree(b);c.treeManager=c.tree.ligerGetTreeManager()},getTree:function(){return this.innerTree},selectValueByTree:function(d){var c=this,e=this.options;if(d!=null){var f="";var b=d.toString().split(e.split);a(b).each(function(g,h){c.treeManager.selectNode(h.toString(),false);f+=c.treeManager.getTextByID(h);if(g<b.length-1){f+=e.split}});c._changeValue(d,f,e.initIsTriggerEvent)}},setGrid:function(b){var n=this,d=this.options;if(n.grid){return}d.hideOnLoseFocus=d.hideGridOnLoseFocus?true:false;this.clearContent();n.selectBox.addClass("l-box-select-lookup");n.selectBox.table.remove();var c=a("div:first",n.selectBox);var s=a("<div></div>").appendTo(c);var o=a("<div></div>").appendTo(c);n.conditionPanel=s;if(d.condition){var j=a.extend({labelWidth:60,space:20,width:d.selectBoxWidth},d.condition);n.condition=s.ligerForm(j)}else{s.remove()}b=a.extend({columnWidth:120,alternatingRow:false,frozen:true,rownumbers:true,allowUnSelectRow:true},b,{width:"100%",height:n.getGridHeight(),inWindow:false,parms:d.parms,isChecked:function(t){var g=n.getValue();if(!g){return false}if(!d.valueField||!t[d.valueField]){return false}return a.inArray(t[d.valueField].toString(),g.split(d.split))!=-1}});n.grid=n.gridManager=o.ligerGrid(b);n.grid.bind("afterShowData",function(){n.updateSelectBoxPosition()});var q=[],h=function(){var g=[],t=[];a(q).each(function(u,v){g.push(v[d.valueField]);t.push(v[d.textField])});if(b.checkbox){n.selected=q}else{if(q.length){n.selected=q[0]}else{n.selected=null}}n._changeValue(g.join(d.split),t.join(d.split),true);n.trigger("gridSelect",{value:g.join(d.split),text:t.join(d.split),data:q})},r=function(t){for(var g=q.length-1;g>=0;g--){if(q[g][d.valueField]==t[d.valueField]){q.splice(g,1)}}},f=function(t){for(var g=q.length-1;g>=0;g--){if(q[g][d.valueField]==t[d.valueField]){return}}q.push(t)};if(b.checkbox){var e=function(g,t){g&&f(t);!g&&r(t)};n.grid.bind("CheckAllRow",function(g){a(n.grid.rows).each(function(t,u){e(g,u)});h()});n.grid.bind("CheckRow",function(g,t){e(g,t);h()})}else{n.grid.bind("SelectRow",function(g){q=[g];h();n._toggleSelectBox(true)});n.grid.bind("UnSelectRow",function(){q=[];h()})}n.bind("show",function(){n.grid.refreshSize()});n.bind("clear",function(){q=[];n.grid.selecteds=[];n.grid._showData()});if(d.condition){var m=a('<li style="margin-right:9px"><div></div></li>');var k=a('<li style="margin-right:9px;float:right"><div></div></li>');a("ul:first",s).append(m).append(k).after('<div class="l-clear"></div>');a("div",m).ligerButton({text:d.Search,width:40,click:function(){var g=n.condition.toConditions();if(d.conditionSearchClick){d.conditionSearchClick({grid:n.grid,rules:g})}else{if(n.grid.url){n.grid.setParm(b.conditionParmName||"condition",a.ligerui.toJSON(g));n.grid.reload()}else{n.grid.loadData(a.ligerFilter.getFilterFunction(g))}}}});a("div",k).ligerButton({text:"关闭",width:40,click:function(){n.selectBox.hide()}})}n.grid.refreshSize()},getGridHeight:function(b){var c=this,d=this.options;b=b||c.selectBox.height();b-=c.conditionPanel.height();return b},_getValue:function(){return a(this.valueField).val()},getValue:function(){return this._getValue()},getSelected:function(){return this.selected},upFocus:function(){var c=this,d=this.options;var b=c.selectBox.table.find("td.l-over").attr("index");if(b==undefined||b=="0"){return}else{b=parseInt(b)-1}c.selectBox.table.find("td.l-over").removeClass("l-over");c.selectBox.table.find("td[index="+b+"]").addClass("l-over");c._scrollAdjust(b)},downFocus:function(){var c=this,d=this.options;var b=c.selectBox.table.find("td.l-over").attr("index");if(b==c.data.length-1){return}if(b==undefined){b=0}else{b=parseInt(b)+1}c.selectBox.table.find("td.l-over").removeClass("l-over");c.selectBox.table.find("td[index="+b+"]").addClass("l-over");c._scrollAdjust(b)},_scrollAdjust:function(c){var e=this,h=this.options;var j=a(".l-box-select-inner",e.selectBox).height();var d=a(".l-box-select-inner table",e.selectBox).height();if(d<=j){return}var b=parseInt(d/j)+((d%j)?1:0);var k=d/e.data.length;var f=parseInt((c+1)*k/j)+(((c+1)*k%j)?1:0);a(".l-box-select-inner",e.selectBox).scrollTop((f-1)*j)},getText:function(){return this.inputText.val()},setText:function(b){this.inputText.val(b)},updateStyle:function(){var b=this,c=this.options;c.initValue=b._getValue();b._dataInit()},_dataInit:function(){var b=this,d=this.options;var c=null;if(d.initValue!=null&&d.initText!=null){b._changeValue(d.initValue,d.initText)}if(d.initValue!=null){c=d.initValue;if(d.tree){if(c){b.selectValueByTree(c)}}else{if(b.data){var e=b.findTextByValue(c);b._changeValue(c,e)}}}else{if(b.valueField.val()!=""){c=b.valueField.val();if(d.tree){if(c){b.selectValueByTree(c)}}else{if(b.data){var e=b.findTextByValue(c);b._changeValue(c,e)}}}}if(!d.isShowCheckBox){a("table tr",b.selectBox).find("td:first").each(function(){if(c!=null&&c==a(this).attr("value")){a(this).addClass("l-selected")}else{a(this).removeClass("l-selected")}})}else{a(":checkbox",b.selectBox).each(function(){var h=null;var g=a(this);if(g.parent().get(0).tagName.toLowerCase()=="div"){h=g.parent().parent()}else{h=g.parent()}if(h==null){return}a(".l-checkbox",h).removeClass("l-checkbox-checked");g[0].checked=false;var f=(c||"").toString().split(d.split);a(f).each(function(j,k){if(c!=null&&k==h.attr("value")){a(".l-checkbox",h).addClass("l-checkbox-checked");g[0].checked=true}})})}},_changeValue:function(d,h,k,b){var j=this,e=this.options,c=j.valueField.val();j.valueField.val(d);if(e&&e.render){j.inputText.val(e.render(d,h))}else{j.inputText.val(h)}if(j.select){a("option",j.select).each(function(){a(this).attr("selected",a(this).attr("value")==d)})}j.selectedValue=d;j.selectedText=h;j.inputText.trigger("change");if(k&&h&&e.focusWhenSetValue){j.inputText.focus()}var f=null;if(d&&typeof(d)=="string"&&d.indexOf(e.split)>-1){f=[];var m=d.split(e.split);a(m).each(function(n,g){f.push(j.getRow(g))})}else{if(d){f=j.getRow(d)}}if(k){j.trigger("selected",[d,h,f])}if(!b&&c!=d){j.trigger("changeValue",[d,h,f])}},_checkboxUpdateValue:function(){var d=this,e=this.options;var b="";var c="";a("input:checked",d.selectBox).each(function(){var f=null;if(a(this).parent().get(0).tagName.toLowerCase()=="div"){f=a(this).parent().parent()}else{f=a(this).parent()}if(!f){return}b+=f.attr("value")+e.split;c+=f.attr("text")+e.split});if(b.length>0){b=b.substr(0,b.length-1)}if(c.length>0){c=c.substr(0,c.length-1)}d._changeValue(b,c)},loadDetail:function(e,h){var d=this,f=this.options;var c=a.isFunction(f.detailParms)?f.detailParms.call(d):f.detailParms;c[f.detailPostIdField||"id"]=e;if(f.ajaxContentType=="application/json"){c=liger.toJSON(c)}c=a.extend(c,{page:1,pagesize:1000});var b={type:f.ajaxType,url:f.detailUrl,data:c,cache:true,dataType:"json",beforeSend:f.ajaxBeforeSend,complete:f.ajaxComplete,success:function(g){var j=a.isFunction(f.detailDataGetter)?f.detailDataGetter(g):g;j=f.detailDataParmName?j[f.detailDataParmName]:j;h&&h(j)}};if(f.ajaxContentType){b.contentType=f.ajaxContentType}a.ajax(b)},enabledLoadDetail:function(){var b=this,c=this.options;return c.detailUrl&&c.detailEnabled?true:false},_addClickEven:function(){var b=this,c=this.options;a(".l-table-nocheckbox td",b.selectBox).click(b,b._selectItem)},_selectItem:function(j){var f=j.data,b=f.options;var k=a(this);var n=k.attr("value");var h=parseInt(a(this).attr("index"));var d=f.data[h];var o=k.attr("text");var c=k.parent().hasClass("rowreadonly");if(c){return}if(f.enabledLoadDetail()){f.loadDetail(n,function(e){if(e!=null){f.data[h]=d=e}m()})}else{m()}function m(){if(f.hasBind("beforeSelect")&&f.trigger("beforeSelect",[n,o,d])==false){if(b.slide){f.selectBox.slideToggle("fast")}else{f.selectBox.hide()}return false}f.selected=d;if(a(this).hasClass("l-selected")){if(b.slide){f.selectBox.slideToggle("fast")}else{f.selectBox.hide()}return}a(".l-selected",f.selectBox).removeClass("l-selected");k.addClass("l-selected");if(f.select){if(f.select[0].selectedIndex!=h){f.select[0].selectedIndex=h;f.select.trigger("change")}}if(b.slide){f.boxToggling=true;f.selectBox.hide("fast",function(){f.boxToggling=false})}else{f.selectBox.hide()}f.lastInputText=o;f._changeValue(n,o,true)}},updateSelectBoxPosition:function(){var c=this,e=this.options;if(e&&e.absolute){var b=a(document).height();if(e.alwayShowInTop||Number(c.wrapper.offset().top+1+c.wrapper.outerHeight()+c.selectBox.height())>b&&b>Number(c.selectBox.height()+1)){c.selectBox.css({left:c.wrapper.offset().left,top:c.wrapper.offset().top-1-c.selectBox.height()+(e.selectBoxPosYDiff||0)})}else{c.selectBox.css({left:c.wrapper.offset().left,top:c.wrapper.offset().top+1+c.wrapper.outerHeight()+(e.selectBoxPosYDiff||0)})}if(e.alwayShowInDown){c.selectBox.css({left:c.wrapper.offset().left,top:c.wrapper.offset().top+1+c.wrapper.outerHeight()})}}else{var f=c.wrapper.offset().top-a(window).scrollTop();var d=c.selectBox.height()+textHeight+4;if(f+d>a(window).height()&&f>d){c.selectBox.css("marginTop",-1*(c.selectBox.height()+textHeight+5)+(e.selectBoxPosYDiff||0))}}},_toggleSelectBox:function(b){var j=this,c=this.options;if(!j||!c){return}var m=a.ligerui.find(a.ligerui.controls.ComboBox);for(var h=0,e=m.length;h<e;h++){var d=m[h];if(d.id!=j.id){if(d.selectBox.is(":visible")!=null&&d.selectBox.is(":visible")){d.selectBox.hide()}}}m=a.ligerui.find(a.ligerui.controls.DateEditor);for(var h=0,e=m.length;h<e;h++){var d=m[h];if(d.id!=j.id){if(d.dateeditor.is(":visible")!=null&&d.dateeditor.is(":visible")){d.dateeditor.hide()}}}var k=j.wrapper.height();j.boxToggling=true;if(b){if(c.slide){j.selectBox.slideToggle("fast",function(){j.boxToggling=false})}else{j.selectBox.hide();j.boxToggling=false}}else{j._resetData();j.updateSelectBoxPosition();if(c.slide){j.selectBox.slideToggle("fast",function(){j.boxToggling=false;if(!c.isShowCheckBox&&a("td.l-selected",j.selectBox).length>0){var g=(a("td.l-selected",j.selectBox).offset().top-j.selectBox.offset().top);a(".l-box-select-inner",j.selectBox).animate({scrollTop:g})}})}else{j._selectBoxShow();j.boxToggling=false;if(!j.tree&&!j.grid&&!c.isShowCheckBox&&a("td.l-selected",j.selectBox).length>0){var f=(a("td.l-selected",j.selectBox).offset().top-j.selectBox.offset().top);a(".l-box-select-inner",j.selectBox).animate({scrollTop:f})}}}j.isShowed=j.selectBox.is(":visible");j.trigger("toggle",[b]);j.trigger(b?"hide":"show")},_selectBoxShow:function(){var b=this,c=this.options;if(!c.grid&&!c.tree){if(b.selectBox.table.find("tr").length||(c.selectBoxRender&&b.selectBoxInner.html())){b.selectBox.show()}else{b.selectBox.hide()}return}b.selectBox.show();return},_highLight:function(d,c){if(!d||typeof(d)!="string"){return d}var b=d.indexOf(c);if(b==-1){return d}return d.substring(0,b)+"<span class='l-highLight'>"+c+"</span>"+d.substring(c.length+b)},_resetData:function(){var b=this;if(b.data_bak){b.data=b.data_bak;b.data_bak=null}b.setData(b.data)},_setAutocomplete:function(c){var b=this,d=this.options;if(!c||d.readonly){return}b.inputText.removeAttr("readonly");b.lastInputText=b.inputText.val();b.inputText.keydown(function(f){if(this._acto){clearTimeout(this._acto)}var g=f.keyCode;if(g==38||g==40||g==13||g==9||g==16){return}if(d.readonly||d.disabled){return}function e(h){b._resetData();if(h){var j=new RegExp(h.replace(/[+?*.^$\[\](){}\\|]/g,function(m){return"\\"+m}),"i"),k=[];a.each(b.data,function(m,n){if(j.test(n[b.options.textField])!==false){k.push(n)}});b.data_bak=b.data;b.data=k}b.setData(b.data)}this._acto=setTimeout(function(){if(b.lastInputText==b.inputText.val()){return}d.initValue="";b.valueField.val("");var h=b.inputText.val();if(h){h=h.replace(/(^\s*)|(\s*$)/g,"")}if(a.isFunction(c)){c.call(b,{key:h,show:function(){b._selectBoxShow()}});return}if(!d.autocompleteAllowEmpty&&!h){b.clear();b.selectBox.hide();return}if(d.url){e(h);b._selectBoxShow()}else{if(d.grid){b.grid.setParm("key",h);b.grid.reload()}else{e(h);b._selectBoxShow()}}b.lastInputText=b.inputText.val();this._acto=null},300)})}});a.ligerui.controls.ComboBox.prototype.setValue=a.ligerui.controls.ComboBox.prototype.selectValue;a.ligerui.controls.ComboBox.prototype.setInputValue=a.ligerui.controls.ComboBox.prototype._changeValue})(jQuery);(function($){$.fn.ligerDateEditor=function(){return $.ligerui.run.call(this,"ligerDateEditor",arguments)};$.fn.ligerGetDateEditorManager=function(){return $.ligerui.run.call(this,"ligerGetDateEditorManager",arguments)};$.ligerDefaults.DateEditor={format:"yyyy-MM-dd hh:mm",width:null,showTime:false,onChangeDate:false,onEnterDown:null,absolute:true,cancelable:true,readonly:false};$.ligerDefaults.DateEditorString={dayMessage:[$l("type.hand.commom.date.daysmin.sunday"),$l("type.hand.commom.date.daysmin.monday"),$l("type.hand.commom.date.daysmin.tuesday"),$l("type.hand.commom.date.daysmin.wednesday"),$l("type.hand.commom.date.daysmin.thursday"),$l("type.hand.commom.date.daysmin.friday"),$l("type.hand.commom.date.daysmin.saturday")],monthMessage:[$l("type.hand.commom.date.monthsshort.january"),$l("type.hand.commom.date.monthsshort.february"),$l("type.hand.commom.date.monthsshort.march"),$l("type.hand.commom.date.monthsshort.april"),$l("type.hand.commom.date.monthsshort.may"),$l("type.hand.commom.date.monthsshort.june"),$l("type.hand.commom.date.monthsshort.july"),$l("type.hand.commom.date.monthsshort.august"),$l("type.hand.commom.date.monthsshort.september"),$l("type.hand.commom.date.monthsshort.october"),$l("type.hand.commom.date.monthsshort.november"),$l("type.hand.commom.date.monthsshort.december")],todayMessage:$l("type.hand.commom.date.today"),closeMessage:$l("sys.hand.btn.close")};$.ligerMethos.DateEditor={};$.ligerui.controls.DateEditor=function(element,options){$.ligerui.controls.DateEditor.base.constructor.call(this,element,options)};$.ligerui.controls.DateEditor.ligerExtend($.ligerui.controls.Input,{__getType:function(){return"DateEditor"},__idPrev:function(){return"DateEditor"},_extendMethods:function(){return $.ligerMethos.DateEditor},_render:function(){$.ligerui.controls.DateEditor.base._render.call(this);var g=this,p=this.options;if(!p.showTime&&p.format.indexOf(" hh:mm")>-1){p.format=p.format.replace(" hh:mm","")}if(this.element.tagName.toLowerCase()!="input"||this.element.type!="text"){return}g.inputText=$(this.element);if(!g.inputText.hasClass("l-text-field")){g.inputText.addClass("l-text-field")}g.link=$('<div class="l-trigger"><div class="l-trigger-icon"></div></div>');g.text=g.inputText.wrap('<div class="l-text l-text-date"></div>').parent();g.text.append('<div class="l-text-l"></div><div class="l-text-r"></div>');g.text.append(g.link);g.textwrapper=g.text.wrap('<div class="l-text-wrapper"></div>').parent();var dateeditorHTML="";dateeditorHTML+="<div class='l-box-dateeditor' style='display:none'>";dateeditorHTML+="    <div class='l-box-dateeditor-header'>";dateeditorHTML+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-prevyear'><span></span></div>";dateeditorHTML+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-prevmonth'><span></span></div>";dateeditorHTML+="        <div class='l-box-dateeditor-header-text'><a class='l-box-dateeditor-header-month'></a> , <a  class='l-box-dateeditor-header-year'></a></div>";dateeditorHTML+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-nextmonth'><span></span></div>";dateeditorHTML+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-nextyear'><span></span></div>";dateeditorHTML+="    </div>";dateeditorHTML+="    <div class='l-box-dateeditor-body'>";dateeditorHTML+="        <table cellpadding='0' cellspacing='0' border='0' class='l-box-dateeditor-calendar'>";dateeditorHTML+="            <thead>";dateeditorHTML+="                <tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr>";dateeditorHTML+="            </thead>";dateeditorHTML+="            <tbody>";dateeditorHTML+="                <tr class='l-first'><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr>";dateeditorHTML+="            </tbody>";dateeditorHTML+="        </table>";dateeditorHTML+="        <ul class='l-box-dateeditor-monthselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>";dateeditorHTML+="        <ul class='l-box-dateeditor-yearselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>";dateeditorHTML+="        <ul class='l-box-dateeditor-hourselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>";dateeditorHTML+="        <ul class='l-box-dateeditor-minuteselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>";dateeditorHTML+="    </div>";dateeditorHTML+="    <div class='l-box-dateeditor-toolbar'>";dateeditorHTML+="        <div class='l-box-dateeditor-time'></div>";dateeditorHTML+="        <div class='l-button l-button-today'></div>";dateeditorHTML+="        <div class='l-button l-button-close'></div>";dateeditorHTML+="        <div class='l-clear'></div>";dateeditorHTML+="    </div>";dateeditorHTML+="</div>";g.dateeditor=$(dateeditorHTML);if(p.absolute){g.dateeditor.appendTo("body").addClass("l-box-dateeditor-absolute")}else{g.textwrapper.append(g.dateeditor)}g.header=$(".l-box-dateeditor-header",g.dateeditor);g.body=$(".l-box-dateeditor-body",g.dateeditor);g.toolbar=$(".l-box-dateeditor-toolbar",g.dateeditor);g.body.thead=$("thead",g.body);g.body.tbody=$("tbody",g.body);g.body.monthselector=$(".l-box-dateeditor-monthselector",g.body);g.body.yearselector=$(".l-box-dateeditor-yearselector",g.body);g.body.hourselector=$(".l-box-dateeditor-hourselector",g.body);g.body.minuteselector=$(".l-box-dateeditor-minuteselector",g.body);g.toolbar.time=$(".l-box-dateeditor-time",g.toolbar);g.toolbar.time.hour=$("<a></a>");g.toolbar.time.minute=$("<a></a>");g.buttons={btnPrevYear:$(".l-box-dateeditor-header-prevyear",g.header),btnNextYear:$(".l-box-dateeditor-header-nextyear",g.header),btnPrevMonth:$(".l-box-dateeditor-header-prevmonth",g.header),btnNextMonth:$(".l-box-dateeditor-header-nextmonth",g.header),btnYear:$(".l-box-dateeditor-header-year",g.header),btnMonth:$(".l-box-dateeditor-header-month",g.header),btnToday:$(".l-button-today",g.toolbar),btnClose:$(".l-button-close",g.toolbar)};var nowDate=new Date();g.now={year:nowDate.getFullYear(),month:nowDate.getMonth()+1,day:nowDate.getDay(),date:nowDate.getDate(),hour:nowDate.getHours(),minute:nowDate.getMinutes()};g.currentDate={year:nowDate.getFullYear(),month:nowDate.getMonth()+1,day:nowDate.getDay(),date:nowDate.getDate(),hour:nowDate.getHours(),minute:nowDate.getMinutes()};g.selectedDate=null;g.usedDate=null;$("td",g.body.thead).each(function(i,td){$(td).html(p.dayMessage[i])});$("li",g.body.monthselector).each(function(i,li){$(li).html(p.monthMessage[i])});g.buttons.btnToday.html(p.todayMessage);g.buttons.btnClose.html(p.closeMessage);if(p.showTime){g.toolbar.time.show();g.toolbar.time.append(g.toolbar.time.hour).append(":").append(g.toolbar.time.minute);$("li",g.body.hourselector).each(function(i,item){var str=i;if(i<10){str="0"+i.toString()}$(this).html(str)});$("li",g.body.minuteselector).each(function(i,item){var str=i;if(i<10){str="0"+i.toString()}$(this).html(str)})}g.bulidContent();if(p.initValue){g.inputText.val(p.initValue)}if(g.inputText.val()!=""){g.onTextChange()}g.link.hover(function(){if(p.disabled){return}this.className="l-trigger-hover"},function(){if(p.disabled){return}this.className="l-trigger"}).mousedown(function(){if(p.disabled){return}this.className="l-trigger-pressed"}).mouseup(function(){if(p.disabled){return}this.className="l-trigger-hover"}).click(function(){if(p.disabled){return}g.bulidContent();g.toggleDateEditor(g.dateeditor.is(":visible"))});if(p.disabled){g.inputText.attr("readonly","readonly");g.text.addClass("l-text-disabled")}g.buttons.btnClose.click(function(){g.toggleDateEditor(true)});$("td",g.body.tbody).hover(function(){if($(this).hasClass("l-box-dateeditor-today")){return}$(this).addClass("l-box-dateeditor-over")},function(){$(this).removeClass("l-box-dateeditor-over")}).click(selectDate);$(".l-box-dateeditor-header-btn",g.header).hover(function(){$(this).addClass("l-box-dateeditor-header-btn-over")},function(){$(this).removeClass("l-box-dateeditor-header-btn-over")});g.buttons.btnYear.click(function(){if(!g.body.yearselector.is(":visible")){$("li",g.body.yearselector).each(function(i,item){var currentYear=g.currentDate.year+(i-4);if(currentYear==g.currentDate.year){$(this).addClass("l-selected")}else{$(this).removeClass("l-selected")}$(this).html(currentYear)})}g.body.yearselector.slideToggle()});g.body.yearselector.hover(function(){},function(){$(this).slideUp()});$("li",g.body.yearselector).click(function(){g.currentDate.year=parseInt($(this).html());g.body.yearselector.slideToggle();g.bulidContent()});g.buttons.btnMonth.click(function(){$("li",g.body.monthselector).each(function(i,item){if(g.currentDate.month==i+1){$(this).addClass("l-selected")}else{$(this).removeClass("l-selected")}});g.body.monthselector.slideToggle()});g.body.monthselector.hover(function(){},function(){$(this).slideUp("fast")});$("li",g.body.monthselector).click(function(){var index=$("li",g.body.monthselector).index(this);g.currentDate.month=index+1;g.body.monthselector.slideToggle();g.bulidContent()});g.toolbar.time.hour.click(function(){$("li",g.body.hourselector).each(function(i,item){if(g.currentDate.hour==i){$(this).addClass("l-selected")}else{$(this).removeClass("l-selected")}});g.body.hourselector.slideToggle()});g.body.hourselector.hover(function(){},function(){$(this).slideUp("fast")});$("li",g.body.hourselector).click(function(){var index=$("li",g.body.hourselector).index(this);g.currentDate.hour=index;g.body.hourselector.slideToggle();g.bulidContent();g.showDate()});g.toolbar.time.minute.click(function(){$("li",g.body.minuteselector).each(function(i,item){if(g.currentDate.minute==i){$(this).addClass("l-selected")}else{$(this).removeClass("l-selected")}});g.body.minuteselector.slideToggle("fast",function(){var index=$("li",this).index($("li.l-selected",this));if(index>29){var offSet=($("li.l-selected",this).offset().top-$(this).offset().top);$(this).animate({scrollTop:offSet})}})});g.body.minuteselector.hover(function(){},function(){$(this).slideUp("fast")});$("li",g.body.minuteselector).click(function(){var index=$("li",g.body.minuteselector).index(this);g.currentDate.minute=index;g.body.minuteselector.slideToggle("fast");g.bulidContent();g.showDate()});g.buttons.btnPrevMonth.click(prevMonth);g.buttons.btnNextMonth.click(nextMonth);g.buttons.btnPrevYear.click(function(){g.currentDate.year--;g.bulidContent()});g.buttons.btnNextYear.click(function(){g.currentDate.year++;g.bulidContent()});g.buttons.btnToday.click(function(){g.currentDate={year:g.now.year,month:g.now.month,day:g.now.day,date:g.now.date};g.selectedDate={year:g.now.year,month:g.now.month,day:g.now.day,date:g.now.date};g.showDate();g.dateeditor.slideToggle("fast")});g.inputText.change(function(){g.onTextChange()}).blur(function(){g.text.removeClass("l-text-focus")}).focus(function(){g.text.addClass("l-text-focus")}).keydown(function(e){if(p.disabled||p.readonly){return}var code=e.keyCode;if(g.dateeditor.is(":visible")){switch(e.keyCode){case 37:goLeft(e);break;case 38:goUp(e);break;case 39:goRight(e);break;case 40:goDown(e);break;case 13:selectDate.call($("td.l-box-dateeditor-over",g.body.tbody));break;case 9:g.toggleDateEditor(true);default:$("td.l-box-dateeditor-over",g.body.tbody).removeClass("l-box-dateeditor-over")}}else{if(code==40){g.bulidContent();g.toggleDateEditor(false)}else{if(code==13){g.trigger("enterdown");if(g.options&&g.options.host_form){g.options.host_form.trigger("enterdown")}}}}});function prevMonth(){if(--g.currentDate.month==0){g.currentDate.month=12;g.currentDate.year--}g.bulidContent()}function nextMonth(){if(++g.currentDate.month==13){g.currentDate.month=1;g.currentDate.year++}g.bulidContent()}function selectDate(){$(".l-box-dateeditor-selected",g.body.tbody).removeClass("l-box-dateeditor-selected");if(!$(this).hasClass("l-box-dateeditor-today")){$(this).addClass("l-box-dateeditor-selected")}g.currentDate.date=parseInt($(this).html());g.currentDate.day=new Date(g.currentDate.year,g.currentDate.month-1,1).getDay();if($(this).hasClass("l-box-dateeditor-out")){if($("tr",g.body.tbody).index($(this).parent())==0){if(--g.currentDate.month==0){g.currentDate.month=12;g.currentDate.year--}}else{if(++g.currentDate.month==13){g.currentDate.month=1;g.currentDate.year++}}}g.selectedDate={year:g.currentDate.year,month:g.currentDate.month,date:g.currentDate.date};g.showDate();g.editorToggling=true;g.dateeditor.slideToggle("fast",function(){g.editorToggling=false});g.inputText.focus()}function goUp(e){var td=$("td.l-box-dateeditor-over",g.body.tbody),tr,cell;if(td.length){td.removeClass("l-box-dateeditor-over");cell=td.parent().children().index(td);tr=td.parent().prev();if(tr.length){td=tr.children("td:nth("+cell+")")}else{prevMonth();td=g.body.tbody.find("tr:last td:nth("+cell+")")}td.addClass("l-box-dateeditor-over");e.preventDefault()}}function goDown(e){var td=$("td.l-box-dateeditor-over",g.body.tbody),tr,cell;if(td.length){td.removeClass("l-box-dateeditor-over");cell=td.parent().children().index(td);tr=td.parent().next();if(tr.length){td=tr.children("td:nth("+cell+")")}else{nextMonth();td=g.body.tbody.find("tr:first td:nth("+cell+")")}}else{td=$("td:first",g.body.tbody)}td.addClass("l-box-dateeditor-over");e.preventDefault()}function goLeft(e){var td=$("td.l-box-dateeditor-over",g.body.tbody),row;if(td.length){td.removeClass("l-box-dateeditor-over");row=g.body.tbody.children().index(td.parent());td=td.prev();if(!td.length){prevMonth();td=g.body.tbody.find("tr:nth("+row+") td:last")}td.addClass("l-box-dateeditor-over");e.preventDefault()}}function goRight(e){var td=$("td.l-box-dateeditor-over",g.body.tbody),row;if(td.length){td.removeClass("l-box-dateeditor-over");row=g.body.tbody.children().index(td.parent());td=td.next();if(!td.length){nextMonth();td=g.body.tbody.find("tr:nth("+row+") td:first")}td.addClass("l-box-dateeditor-over");e.preventDefault()}}g.text.hover(function(){g.text.addClass("l-text-over")},function(){g.text.removeClass("l-text-over")});if(p.label){g.labelwrapper=g.textwrapper.wrap('<div class="l-labeltext"></div>').parent();g.labelwrapper.prepend('<div class="l-text-label" style="float:left;display:inline;">'+p.label+":&nbsp</div>");g.textwrapper.css("float","left");if(!p.labelWidth){p.labelWidth=$(".l-text-label",g.labelwrapper).outerWidth()}else{$(".l-text-label",g.labelwrapper).outerWidth(p.labelWidth)}$(".l-text-label",g.labelwrapper).width(p.labelWidth);$(".l-text-label",g.labelwrapper).height(g.text.height());g.labelwrapper.append('<br style="clear:both;" />');if(p.labelAlign){$(".l-text-label",g.labelwrapper).css("text-align",p.labelAlign)}g.textwrapper.css({display:"inline"});g.labelwrapper.width(g.text.outerWidth()+p.labelWidth+2)}g.set(p);$(document).bind("click.dateeditor",function(e){if(g.dateeditor.is(":visible")&&$((e.target||e.srcElement)).closest(".l-box-dateeditor, .l-text-date").length==0){g.toggleDateEditor(true)}})},destroy:function(){if(this.textwrapper){this.textwrapper.remove()}if(this.dateeditor){this.dateeditor.remove()}this.options=null;$.ligerui.remove(this)},bulidContent:function(){var g=this,p=this.options;var thismonthFirstDay=new Date(g.currentDate.year,g.currentDate.month-1,1).getDay();var nextMonth=g.currentDate.month;var nextYear=g.currentDate.year;if(++nextMonth==13){nextMonth=1;nextYear++}var monthDayNum=new Date(nextYear,nextMonth-1,0).getDate();var prevMonthDayNum=new Date(g.currentDate.year,g.currentDate.month-1,0).getDate();g.buttons.btnMonth.html(p.monthMessage[g.currentDate.month-1]);g.buttons.btnYear.html(g.currentDate.year);g.toolbar.time.hour.html(g.currentDate.hour);g.toolbar.time.minute.html(g.currentDate.minute);if(g.toolbar.time.hour.html().length==1){g.toolbar.time.hour.html("0"+g.toolbar.time.hour.html())}if(g.toolbar.time.minute.html().length==1){g.toolbar.time.minute.html("0"+g.toolbar.time.minute.html())}$("td",this.body.tbody).each(function(){this.className=""});$("tr",this.body.tbody).each(function(i,tr){$("td",tr).each(function(j,td){var id=i*7+(j-thismonthFirstDay);var showDay=id+1;if(g.selectedDate&&g.currentDate.year==g.selectedDate.year&&g.currentDate.month==g.selectedDate.month&&id+1==g.selectedDate.date){if(j==0||j==6){$(td).addClass("l-box-dateeditor-holiday")}$(td).addClass("l-box-dateeditor-selected");$(td).siblings().removeClass("l-box-dateeditor-selected")}else{if(g.currentDate.year==g.now.year&&g.currentDate.month==g.now.month&&id+1==g.now.date){if(j==0||j==6){$(td).addClass("l-box-dateeditor-holiday")}$(td).addClass("l-box-dateeditor-today")}else{if(id<0){showDay=prevMonthDayNum+showDay;$(td).addClass("l-box-dateeditor-out").removeClass("l-box-dateeditor-selected")}else{if(id>monthDayNum-1){showDay=showDay-monthDayNum;$(td).addClass("l-box-dateeditor-out").removeClass("l-box-dateeditor-selected")}else{if(j==0||j==6){$(td).addClass("l-box-dateeditor-holiday").removeClass("l-box-dateeditor-selected")}else{td.className=""}}}}}$(td).html(showDay)})})},updateSelectBoxPosition:function(){var g=this,p=this.options;if(p.absolute){var contentHeight=$(document).height();if(Number(g.text.offset().top+1+g.text.outerHeight()+g.dateeditor.height())>contentHeight&&contentHeight>Number(g.dateeditor.height()+1)){g.dateeditor.css({left:g.text.offset().left,top:g.text.offset().top-1-g.dateeditor.height()})}else{g.dateeditor.css({left:g.text.offset().left,top:g.text.offset().top+1+g.text.outerHeight()})}}else{if(g.text.offset().top+4>g.dateeditor.height()&&g.text.offset().top+g.dateeditor.height()+textHeight+4-$(window).scrollTop()>$(window).height()){g.dateeditor.css("marginTop",-1*(g.dateeditor.height()+textHeight+5));g.showOnTop=true}else{g.showOnTop=false}}},toggleDateEditor:function(isHide){var g=this,p=this.options;var managers=$.ligerui.find($.ligerui.controls.ComboBox);for(var i=0,l=managers.length;i<l;i++){var o=managers[i];if(o.id!=g.id){if(o.selectBox.is(":visible")!=null&&o.selectBox.is(":visible")){o.selectBox.hide()}}}managers=$.ligerui.find($.ligerui.controls.DateEditor);for(var i=0,l=managers.length;i<l;i++){var o=managers[i];if(o.id!=g.id){if(o.dateeditor.is(":visible")!=null&&o.dateeditor.is(":visible")){o.dateeditor.hide()}}}var textHeight=g.text.height();g.editorToggling=true;if(isHide){g.dateeditor.hide("fast",function(){g.editorToggling=false})}else{g.updateSelectBoxPosition();g.dateeditor.slideDown("fast",function(){g.editorToggling=false})}},showDate:function(){var g=this,p=this.options;if(!this.currentDate){return}this.currentDate.hour=parseInt(g.toolbar.time.hour.html(),10);this.currentDate.minute=parseInt(g.toolbar.time.minute.html(),10);var dateStr=this.currentDate.year+"/"+this.currentDate.month+"/"+this.currentDate.date+" "+this.currentDate.hour+":"+this.currentDate.minute;var myDate=new Date(dateStr);dateStr=g.getFormatDate(myDate);this.inputText.val(dateStr);this.onTextChange()},isDateTime:function(dateStr){var g=this,p=this.options;var r=dateStr.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(r==null){return false}var d=new Date(r[1],r[3]-1,r[4]);if(d=="NaN"){return false}return(d.getFullYear()==r[1]&&(d.getMonth()+1)==r[3]&&d.getDate()==r[4])},isLongDateTime:function(dateStr){var g=this,p=this.options;var reg=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2})$/;var r=dateStr.match(reg);if(r==null){return false}var d=new Date(r[1],r[3]-1,r[4],r[5],r[6]);if(d=="NaN"){return false}return(d.getFullYear()==r[1]&&(d.getMonth()+1)==r[3]&&d.getDate()==r[4]&&d.getHours()==r[5]&&d.getMinutes()==r[6])},getFormatDate:function(date){if(date===null||date=="NaN"){return null}var g=this,p=this.options;var format=p.format;var o={"M+":date.getMonth()+1,"d+":date.getDate(),"h+":date.getHours(),"m+":date.getMinutes(),"s+":date.getSeconds(),"q+":Math.floor((date.getMonth()+3)/3),S:date.getMilliseconds()};if(/(y+)/.test(format)){format=format.replace(RegExp.$1,(date.getFullYear()+"").substr(4-RegExp.$1.length))}for(var k in o){if(new RegExp("("+k+")").test(format)){format=format.replace(RegExp.$1,RegExp.$1.length==1?o[k]:("00"+o[k]).substr((""+o[k]).length))}}return format},clear:function(){this.set("value","");this.usedDate="";this.onTextChange(true)},_setCancelable:function(value){var g=this,p=this.options;if(!value&&g.unselect){g.unselect.remove();g.unselect=null;g.text.unbind("mouseenter mouseleave")}if(!value&&!g.unselect){return}g.unselect=$('<div class="l-trigger l-trigger-cancel"><div class="l-trigger-icon"></div></div>').hide();g.text.hover(function(){g.unselect.show()},function(){g.unselect.hide()});if(!p.disabled&&p.cancelable){g.text.append(g.unselect)}g.unselect.hover(function(){this.className="l-trigger-hover l-trigger-cancel"},function(){this.className="l-trigger l-trigger-cancel"}).click(function(){if(p.readonly){return}g.clear()})},_rever:function(){var g=this,p=this.options;if(!g.usedDate){g.inputText.val("")}else{g.inputText.val(g.getFormatDate(g.usedDate))}},_getMatch:function(format){var r=[-1,-1,-1,-1,-1,-1],groupIndex=0,regStr="^",str=format||this.options.format;while(true){var tmp_r=str.match(/^yyyy|MM|dd|mm|hh|HH|ss|-|\/|:|\s/);if(tmp_r){var c=tmp_r[0].charAt(0);var mathLength=tmp_r[0].length;var index="yMdhms".indexOf(c);if(index!=-1){r[index]=groupIndex+1;regStr+="(\\d{1,"+mathLength+"})"}else{var st=c==" "?"\\s":c;regStr+="("+st+")"}groupIndex++;if(mathLength==str.length){regStr+="$";break}str=str.substring(mathLength)}else{return null}}return{reg:new RegExp(regStr),position:r}},_bulidDate:function(dateStr){var g=this,p=this.options;var r=this._getMatch();if(!r){return null}var t=dateStr.match(r.reg);if(!t){return null}var tt={y:r.position[0]==-1?1900:t[r.position[0]],M:r.position[1]==-1?0:parseInt(t[r.position[1]],10)-1,d:r.position[2]==-1?1:parseInt(t[r.position[2]],10),h:r.position[3]==-1?0:parseInt(t[r.position[3]],10),m:r.position[4]==-1?0:parseInt(t[r.position[4]],10),s:r.position[5]==-1?0:parseInt(t[r.position[5]],10)};if(tt.M<0||tt.M>11||tt.d<0||tt.d>31){return null}var d=new Date(tt.y,tt.M,tt.d);if(p.showTime){if(tt.m<0||tt.m>59||tt.h<0||tt.h>23||tt.s<0||tt.s>59){return null}d.setHours(tt.h);d.setMinutes(tt.m);d.setSeconds(tt.s)}return d},updateStyle:function(){this.onTextChange()},onTextChange:function(){var g=this,p=this.options;var val=g.inputText.val();if(!val){g.selectedDate=null;g.usedDate="";return true}var newDate=g._bulidDate(val);if(!newDate){g._rever();return}else{g.usedDate=newDate}g.selectedDate={year:g.usedDate.getFullYear(),month:g.usedDate.getMonth()+1,day:g.usedDate.getDay(),date:g.usedDate.getDate(),hour:g.usedDate.getHours(),minute:g.usedDate.getMinutes()};g.currentDate={year:g.usedDate.getFullYear(),month:g.usedDate.getMonth()+1,day:g.usedDate.getDay(),date:g.usedDate.getDate(),hour:g.usedDate.getHours(),minute:g.usedDate.getMinutes()};var formatVal=g.getFormatDate(newDate);g.inputText.val(formatVal);g.trigger("changeDate",[formatVal]);if($(g.dateeditor).is(":visible")){g.bulidContent()}},_setHeight:function(value){var g=this;if(value>4){g.text.css({height:value});g.inputText.css({height:value});g.textwrapper.css({height:value})}},_setWidth:function(value){var g=this;if(value>20){g.text.css({width:value});g.inputText.css({width:value-20});g.textwrapper.css({width:value})}},_setValue:function(value){var g=this;if(!value){g.inputText.val("")}if(typeof value=="string"){if(/^\/Date/.test(value)){value=value.replace(/^\//,"new ").replace(/\/$/,"");eval("value = "+value)}g.inputText.val(value);g.usedDate=value}if(typeof value=="object"){if(value instanceof Date){g.inputText.val(g.getFormatDate(value));g.onTextChange()}}},_getValue:function(){return this.usedDate},_setDisabled:function(value){var g=this,p=this.options;p.disabled=false;if(value){this.inputText.attr("readonly","readonly");this.text.addClass("l-text-disabled");this._setCancelable(false)}else{this.inputText.removeAttr("readonly");this.text.removeClass("l-text-disabled");if(p.cancelable){this._setCancelable(true)}}p.disabled=value},setEnabled:function(){this.set("disabled",false)},setDisabled:function(){this.set("disabled",true)}})})(jQuery);(function(b){var a=b.ligerui;b(".l-dialog-btn").live("mouseover",function(){b(this).addClass("l-dialog-btn-over")}).live("mouseout",function(){b(this).removeClass("l-dialog-btn-over")});b(".l-dialog-tc .l-dialog-close").live("mouseover",function(){b(this).addClass("l-dialog-close-over")}).live("mouseout",function(){b(this).removeClass("l-dialog-close-over")});b.ligerDialog=function(){return a.run.call(null,"ligerDialog",arguments,{isStatic:true})};b.ligerui.DialogImagePath="../../lib/ligerUI/skins/Aqua/images/win/";function c(e){for(var d in e){b("<img />").attr("src",a.DialogImagePath+e[d])}}b.ligerDefaults.Dialog={cls:null,contentCls:null,id:null,buttons:null,isDrag:true,width:280,height:null,content:"",target:null,url:null,urlParms:null,load:false,type:"none",left:null,top:null,modal:true,data:null,name:null,isResize:false,allowClose:true,opener:null,timeParmName:null,closeWhenEnter:null,closeWhenEsc:null,isHidden:true,show:true,title:$l("sys.hand.tip.info"),showMax:false,showToggle:false,showMin:false,slide:b.browser.msie?false:true,fixedType:null,showType:null,layoutMode:1,onLoaded:null,onExtend:null,onExtended:null,onCollapse:null,onCollapseed:null,onContentHeightChange:null,onClose:null,onClosed:null,onStopResize:null};b.ligerDefaults.DialogString={titleMessage:$l("sys.hand.tip.info"),ok:$l("sys.hand.btn.ok"),yes:$l("sys.hand.btn.yes"),no:$l("sys.hand.btn.no"),cancel:$l("sys.hand.btn.cancel"),waittingMessage:$l("sys.hand.tip.waitting")};b.ligerMethos.Dialog=b.ligerMethos.Dialog||{};a.controls.Dialog=function(d){a.controls.Dialog.base.constructor.call(this,null,d)};a.controls.Dialog.ligerExtend(a.core.Win,{__getType:function(){return"Dialog"},__idPrev:function(){return"Dialog"},_extendMethods:function(){return b.ligerMethos.Dialog},_render:function(){var m=this,j=this.options;var d="";m.set(j,true);var o=b('<div class="l-dialog"><table class="l-dialog-table" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="l-dialog-tl"></td><td class="l-dialog-tc"><div class="l-dialog-tc-inner"><div class="l-dialog-icon"></div><div class="l-dialog-title"></div><div class="l-dialog-winbtns"><div class="l-dialog-winbtn l-dialog-close"></div></div></div></td><td class="l-dialog-tr"></td></tr><tr><td class="l-dialog-cl"></td><td class="l-dialog-cc"><div class="l-dialog-body"><div class="l-dialog-image"></div> <div class="l-dialog-content"></div><div class="l-dialog-buttons"><div class="l-dialog-buttons-inner"></div></td><td class="l-dialog-cr"></td></tr><tr><td class="l-dialog-bl"></td><td class="l-dialog-bc"></td><td class="l-dialog-br"></td></tr></tbody></table></div>');b("body").append(o);m.dialog=o;if(j.layoutMode==2){o.find("td.l-dialog-tl,td.l-dialog-cl,td.l-dialog-bl,td.l-dialog-tr,td.l-dialog-cr,td.l-dialog-br").remove()}m.element=o[0];m.dialog.body=b(".l-dialog-body:first",m.dialog);m.dialog.header=b(".l-dialog-tc-inner:first",m.dialog);m.dialog.winbtns=b(".l-dialog-winbtns:first",m.dialog.header);m.dialog.buttons=b(".l-dialog-buttons:first",m.dialog);m.dialog.content=b(".l-dialog-content:first",m.dialog);m.set(j,false);if(j.allowClose==false){b(".l-dialog-close",m.dialog).remove()}if(j.target||j.url||j.type=="none"){j.type=null;m.dialog.addClass("l-dialog-win")}if(j.cls){m.dialog.addClass(j.cls)}if(j.id){m.dialog.attr("id",j.id)}m.mask();if(j.isDrag){m._applyDrag()}if(j.isResize){m._applyResize()}if(j.type){m._setImage()}else{b(".l-dialog-image",m.dialog).remove();m.dialog.content.addClass("l-dialog-content-noimage")}if(j.contentCls){m.dialog.content.addClass(j.contentCls)}if(!j.show){m.unmask();m.dialog.hide()}if(j.target){m.dialog.content.prepend(j.target);b(j.target).show()}else{if(j.url){var f=b.isFunction(j.url)?j.url.call(m):j.url;var n=b.isFunction(j.urlParms)?j.urlParms.call(m):j.urlParms;if(j.timeParmName){n=n||{};n[j.timeParmName]=new Date().getTime()}if(n){for(var h in n){f+=f.indexOf("?")==-1?"?":"&";f+=h+"="+n[h]}}if(j.load){m.dialog.body.load(f,function(){m._saveStatus();m.trigger("loaded")})}else{m.jiframe=b("<iframe frameborder='0'></iframe>");var e=j.name?j.name:"ligerwindow"+new Date().getTime();m.jiframe.attr("name",e);m.jiframe.attr("id",e);m.dialog.content.prepend(m.jiframe);m.dialog.content.addClass("l-dialog-content-nopadding l-dialog-content-frame");setTimeout(function(){if(m.dialog.body.find(".l-dialog-loading:first").length==0){m.dialog.body.append("<div class='l-dialog-loading' style='display:block;'></div>")}var g=b(".l-dialog-loading:first",m.dialog.body);m.jiframe[0].dialog=m;m.jiframe.attr("src",f).bind("load.dialog",function(){g.hide();m.trigger("loaded")});m.frame=window.frames[m.jiframe.attr("name")]},0);d="jquery_ligerui_"+new Date().getTime();m.tmpInput=b("<input></input>");m.tmpInput.attr("id",d);m.dialog.content.prepend(m.tmpInput)}}}if(j.opener){m.dialog.opener=j.opener}if(j.buttons){b(j.buttons).each(function(q,r){var g=b('<div class="l-dialog-btn"><div class="l-dialog-btn-l"></div><div class="l-dialog-btn-r"></div><div class="l-dialog-btn-inner"></div></div>');b(".l-dialog-btn-inner",g).html(r.text);b(".l-dialog-buttons-inner",m.dialog.buttons).prepend(g);r.width&&g.width(r.width);if(r.attr){g.attr(r.attr)}r.onclick&&g.click(function(){r.onclick(r,m,q)});r.cls&&g.addClass(r.cls)})}else{m.dialog.buttons.remove()}b(".l-dialog-buttons-inner",m.dialog.buttons).append("<div class='l-clear'></div>");b(".l-dialog-title",m.dialog).bind("selectstart",function(){return false});m.dialog.mousedown(function(){a.win.setFront(m)});b(".l-dialog-tc .l-dialog-close",m.dialog).click(function(){if(j.isHidden){m.hide()}else{m.close()}});if(!j.fixedType){if(j.width=="auto"){setTimeout(function(){k()},100)}else{k()}}function k(){var r=0;var q=0;var g=j.width||m.dialog.width();if(j.slide==true){j.slide="fast"}if(j.left!=null){r=j.left}else{j.left=r=0.5*(b(window).width()-g)}if(j.top!=null){q=j.top}else{j.top=q=0.5*(b(window).height()-m.dialog.height())+b(window).scrollTop()-10}if(r<0){j.left=r=0}if(q<0){j.top=q=0}m.dialog.css({left:r,top:q})}m.show();b("body").bind("keydown.dialog",function(q){var g=q.which;if(g==13){m.enter()}else{if(g==27){m.esc()}}});m._updateBtnsWidth();m._saveStatus();m._onReisze();if(d!=""){b("#"+d).focus();b("#"+d).remove()}},_borderX:12,_borderY:32,doMax:function(e){var h=this,m=this.options;var f=b(window).width(),d=b(window).height(),k=0,j=0;if(a.win.taskbar){d-=a.win.taskbar.outerHeight();if(a.win.top){j+=a.win.taskbar.outerHeight()}}if(e){h.dialog.body.animate({width:f-h._borderX},m.slide);h.dialog.animate({left:k,top:j},m.slide);h.dialog.content.animate({height:d-h._borderY-h.dialog.buttons.outerHeight()},m.slide,function(){h._onReisze()})}else{h.set({width:f,height:d,left:k,top:j});h._onReisze()}},max:function(){var d=this,e=this.options;if(d.winmax){d.winmax.addClass("l-dialog-recover");d.doMax(e.slide);if(d.wintoggle){if(d.wintoggle.hasClass("l-dialog-extend")){d.wintoggle.addClass("l-dialog-toggle-disabled l-dialog-extend-disabled")}else{d.wintoggle.addClass("l-dialog-toggle-disabled l-dialog-collapse-disabled")}}if(d.resizable){d.resizable.set({disabled:true})}if(d.draggable){d.draggable.set({disabled:true})}d.maximum=true;b(window).bind("resize.dialogmax",function(){d.doMax(false)})}},recover:function(){var d=this,e=this.options;if(d.winmax){d.winmax.removeClass("l-dialog-recover");if(e.slide){d.dialog.body.animate({width:d._width-d._borderX},e.slide);d.dialog.animate({left:d._left,top:d._top},e.slide);d.dialog.content.animate({height:d._height-d._borderY-d.dialog.buttons.outerHeight()},e.slide,function(){d._onReisze()})}else{d.set({width:d._width,height:d._height,left:d._left,top:d._top});d._onReisze()}if(d.wintoggle){d.wintoggle.removeClass("l-dialog-toggle-disabled l-dialog-extend-disabled l-dialog-collapse-disabled")}b(window).unbind("resize.dialogmax")}if(this.resizable){this.resizable.set({disabled:false})}if(d.draggable){d.draggable.set({disabled:false})}d.maximum=false},min:function(){var e=this,f=this.options;var d=a.win.getTask(this);if(f.slide){e.dialog.body.animate({width:1},f.slide);d.y=d.offset().top+d.height();d.x=d.offset().left+d.width()/2;e.dialog.animate({left:d.x,top:d.y},f.slide,function(){e.dialog.hide()})}else{e.dialog.hide()}e.unmask();e.minimize=true;e.actived=false},active:function(){var f=this,k=this.options;if(f.minimize){var e=f._width,d=f._height,j=f._left,h=f._top;if(f.maximum){e=b(window).width();d=b(window).height();j=h=0;if(a.win.taskbar){d-=a.win.taskbar.outerHeight();if(a.win.top){h+=a.win.taskbar.outerHeight()}}}if(k.slide){f.dialog.body.animate({width:e-f._borderX},k.slide);f.dialog.animate({left:j,top:h},k.slide)}else{f.set({width:e,height:d,left:j,top:h})}}f.actived=true;f.minimize=false;a.win.setFront(f);f.show()},toggle:function(){var d=this,e=this.options;if(!d.wintoggle){return}if(d.wintoggle.hasClass("l-dialog-extend")){d.extend()}else{d.collapse()}},collapse:function(d){var e=this,f=this.options;if(!e.wintoggle){return}if(f.slide&&d!=false){e.dialog.content.animate({height:1},f.slide)}else{e.dialog.content.height(1)}if(this.resizable){this.resizable.set({disabled:true})}e.wintoggle.addClass("l-dialog-extend")},extend:function(){var e=this,f=this.options;if(!e.wintoggle){return}var d=e._height-e._borderY-e.dialog.buttons.outerHeight();if(f.slide){e.dialog.content.animate({height:d},f.slide)}else{e.dialog.content.height(d)}if(this.resizable){this.resizable.set({disabled:false})}e.wintoggle.removeClass("l-dialog-extend")},_updateBtnsWidth:function(){var e=this;var d=b(">div",e.dialog.winbtns).length;e.dialog.winbtns.width(22*d)},_setLeft:function(d){if(!this.dialog){return}if(d!=null){this.dialog.css({left:d})}},_setTop:function(d){if(!this.dialog){return}if(d!=null){this.dialog.css({top:d})}},_setWidth:function(d){if(!this.dialog){return}if(d>=this._borderX){this.dialog.body.width(d-this._borderX)}},_setHeight:function(f){var e=this,h=this.options;if(!this.dialog){return}if(f=="auto"){e.dialog.content.height("auto")}else{if(f>=this._borderY){var d=f-this._borderY-e.dialog.buttons.outerHeight();if(e.trigger("ContentHeightChange",[d])==false){return}if(h.load){e.dialog.body.height(d)}else{e.dialog.content.height(d)}e.trigger("ContentHeightChanged",[d])}}},_setShowMax:function(e){var d=this,f=this.options;if(e){if(!d.winmax){d.winmax=b('<div class="l-dialog-winbtn l-dialog-max"></div>').appendTo(d.dialog.winbtns).hover(function(){if(b(this).hasClass("l-dialog-recover")){b(this).addClass("l-dialog-recover-over")}else{b(this).addClass("l-dialog-max-over")}},function(){b(this).removeClass("l-dialog-max-over l-dialog-recover-over")}).click(function(){if(b(this).hasClass("l-dialog-recover")){d.recover()}else{d.max()}})}}else{if(d.winmax){d.winmax.remove();d.winmax=null}}d._updateBtnsWidth()},_setShowMin:function(e){var d=this,f=this.options;if(e){if(!d.winmin){d.winmin=b('<div class="l-dialog-winbtn l-dialog-min"></div>').appendTo(d.dialog.winbtns).hover(function(){b(this).addClass("l-dialog-min-over")},function(){b(this).removeClass("l-dialog-min-over")}).click(function(){d.min()});a.win.addTask(d)}}else{if(d.winmin){d.winmin.remove();d.winmin=null}}d._updateBtnsWidth()},_setShowToggle:function(e){var d=this,f=this.options;if(e){if(!d.wintoggle){d.wintoggle=b('<div class="l-dialog-winbtn l-dialog-collapse"></div>').appendTo(d.dialog.winbtns).hover(function(){if(b(this).hasClass("l-dialog-toggle-disabled")){return}if(b(this).hasClass("l-dialog-extend")){b(this).addClass("l-dialog-extend-over")}else{b(this).addClass("l-dialog-collapse-over")}},function(){b(this).removeClass("l-dialog-extend-over l-dialog-collapse-over")}).click(function(){if(b(this).hasClass("l-dialog-toggle-disabled")){return}if(d.wintoggle.hasClass("l-dialog-extend")){if(d.trigger("extend")==false){return}d.wintoggle.removeClass("l-dialog-extend");d.extend();d.trigger("extended")}else{if(d.trigger("collapse")==false){return}d.wintoggle.addClass("l-dialog-extend");d.collapse();d.trigger("collapseed")}})}}else{if(d.wintoggle){d.wintoggle.remove();d.wintoggle=null}}},enter:function(){var e=this,f=this.options;var d;if(f.closeWhenEnter!=undefined){d=f.closeWhenEnter}else{if(f.type=="warn"||f.type=="error"||f.type=="success"||f.type=="question"){d=true}}if(d){e.close()}},esc:function(){var e=this,f=this.options;var d;if(f.closeWhenEsc!=undefined){d=f.closeWhenEsc}else{if(f.type=="warn"||f.type=="error"||f.type=="success"||f.type=="question"){d=true}}if(d){e.close()}},_removeDialog:function(){var e=this,f=this.options;if(f.showType&&f.fixedType){e.dialog.animate({bottom:-1*f.height},function(){d()})}else{d()}function d(){var g=b("iframe",e.dialog);if(g.length){var j=g[0];j.src="about:blank";if(j.contentWindow&&j.contentWindow.document){try{j.contentWindow.document.write("")}catch(h){}}b.browser.msie&&CollectGarbage();g.remove()}e.dialog.remove()}},close:function(){var d=this,e=this.options;if(d.trigger("Close")==false){return}d.doClose();if(d.trigger("Closed")==false){return}},doClose:function(){var d=this;a.win.removeTask(this);a.win.remove(this);b.ligerui.remove(this);d.unmask();d._removeDialog();b("body").unbind("keydown.dialog")},_getVisible:function(){return this.dialog.is(":visible")},_setUrl:function(d){var e=this,f=this.options;f.url=d;if(f.load){e.dialog.body.html("").load(f.url,function(){e.trigger("loaded")})}else{if(e.jiframe){e.jiframe.attr("src",f.url)}}},_setContent:function(d){this.dialog.content.html(d)},_setTitle:function(e){var d=this;var f=this.options;if(e){b(".l-dialog-title",d.dialog).html(e)}},_hideDialog:function(){var d=this,e=this.options;if(e.showType&&e.fixedType){d.dialog.animate({bottom:-1*e.height},function(){d.dialog.hide()})}else{d.dialog.hide()}},hidden:function(){var d=this;a.win.remove(d);a.win.removeTask(d);d.dialog.hide();d.unmask()},show:function(){var d=this,e=this.options;d.mask();if(e.fixedType){if(e.showType){d.dialog.css({bottom:-1*e.height}).addClass("l-dialog-fixed");d.dialog.show().animate({bottom:0})}else{d.dialog.show().css({bottom:0}).addClass("l-dialog-fixed")}}else{d.dialog.show()}a.win.add(d);b.ligerui.win.setFront.ligerDefer(b.ligerui.win,100,[d])},setUrl:function(d){this._setUrl(d)},_saveStatus:function(){var d=this;d._width=d.dialog.body.width();d._height=d.dialog.body.height();var f=0;var e=0;if(!isNaN(parseInt(d.dialog.css("top")))){f=parseInt(d.dialog.css("top"))}if(!isNaN(parseInt(d.dialog.css("left")))){e=parseInt(d.dialog.css("left"))}d._top=f;d._left=e},_applyDrag:function(){var d=this,e=this.options;if(b.fn.ligerDrag){d.draggable=d.dialog.ligerDrag({handler:".l-dialog-title",animate:false,onStartDrag:function(){a.win.setFront(d);var f=b("<div class='l-dragging-mask' style='display:block'></div>").height(d.dialog.height());d.dialog.append(f);d.dialog.content.addClass("l-dialog-content-dragging")},onDrag:function(h,g){var f=g.pageY||g.screenY;if(f<0){return false}},onStopDrag:function(){d.dialog.find("div.l-dragging-mask:first").remove();d.dialog.content.removeClass("l-dialog-content-dragging");if(e.target){var g=a.find(b.ligerui.controls.DateEditor);var f=a.find(b.ligerui.controls.ComboBox);b(b.merge(g,f)).each(function(){if(this.updateSelectBoxPosition){this.updateSelectBoxPosition()}})}d._saveStatus()}})}},_onReisze:function(){var h=this,j=this.options;if(j.target||j.url){var e=b(j.target).liger();if(!e){e=b(j.target).find(":first").liger()}if(!e){return}var f=h.dialog.content.height();var d=h.dialog.content.width();e.trigger("resize",[{width:d,height:f}])}},_applyResize:function(){var d=this,e=this.options;if(b.fn.ligerResizable){d.resizable=d.dialog.ligerResizable({onStopResize:function(j,h){var g=0;var f=0;if(!isNaN(parseInt(d.dialog.css("top")))){g=parseInt(d.dialog.css("top"))}if(!isNaN(parseInt(d.dialog.css("left")))){f=parseInt(d.dialog.css("left"))}if(j.diffLeft){d.set({left:f+j.diffLeft})}if(j.diffTop){d.set({top:g+j.diffTop})}if(j.newWidth){d.set({width:j.newWidth});d.dialog.body.css({width:j.newWidth-d._borderX})}if(j.newHeight){d.set({height:j.newHeight})}d._onReisze();d._saveStatus();d.trigger("stopResize");return false},animate:false})}},_setImage:function(){var d=this,e=this.options;if(e.type){var f={paddingLeft:74,paddingRight:15,paddingBottom:30};if(e.type=="success"||e.type=="donne"||e.type=="ok"){b(".l-dialog-image",d.dialog).addClass("l-dialog-image-donne").show();d.dialog.content.css(f)}else{if(e.type=="error"){b(".l-dialog-image",d.dialog).addClass("l-dialog-image-error").show();d.dialog.content.css(f)}else{if(e.type=="warn"){b(".l-dialog-image",d.dialog).addClass("l-dialog-image-warn").show();d.dialog.content.css(f)}else{if(e.type=="question"){b(".l-dialog-image",d.dialog).addClass("l-dialog-image-question").show();d.dialog.content.css(f)}}}}}}});a.controls.Dialog.prototype.hide=a.controls.Dialog.prototype.hidden;b.ligerDialog.open=function(d){return b.ligerDialog(d)};b.ligerDialog.close=function(){var f=a.find(a.controls.Dialog.prototype.__getType());for(var e in f){var g=f[e];g.destroy.ligerDefer(g,5)}a.win.unmask()};b.ligerDialog.show=function(f){var e=a.find(a.controls.Dialog.prototype.__getType());if(e.length){for(var d in e){e[d].show();return}}return b.ligerDialog(f)};b.ligerDialog.hide=function(){var f=a.find(a.controls.Dialog.prototype.__getType());for(var e in f){var g=f[e];g.hide()}};b.ligerDialog.tip=function(d){d=b.extend({showType:"slide",width:240,modal:false,height:100},d||{});b.extend(d,{fixedType:"se",type:"none",isDrag:false,isResize:false,showMax:false,showToggle:false,showMin:false});return b.ligerDialog.open(d)};b.ligerDialog.alert=function(g,h,f,j,e){g=g||"";if(typeof(h)=="function"){j=h;f=null}else{if(typeof(f)=="function"){j=f}}var d=function(n,k,m){k.close();if(j){j(n,k,m)}};p={content:g,buttons:[{text:b.ligerDefaults.DialogString.ok,onclick:d}]};if(typeof(h)=="string"&&h!=""){p.title=h}if(typeof(f)=="string"&&f!=""){p.type=f}b.extend(p,{showMax:false,showToggle:false,showMin:false},e||{});return b.ligerDialog(p)};b.ligerDialog.confirm=function(e,f,g){if(typeof(f)=="function"){g=f;type=null}var d=function(j,h){h.close();if(g){g(j.type=="ok")}};p={type:"question",content:e,buttons:[{text:b.ligerDefaults.DialogString.yes,onclick:d,type:"ok",cls:"l-dialog-btn-ok"},{text:b.ligerDefaults.DialogString.no,onclick:d,type:"no",cls:"l-dialog-btn-no"}]};if(typeof(f)=="string"&&f!=""){p.title=f}b.extend(p,{showMax:false,showToggle:false,showMin:false});return b.ligerDialog(p)};b.ligerDialog.warning=function(f,g,h,e){if(typeof(g)=="function"){h=g;type=null}var d=function(k,j){j.close();if(h){h(k.type)}};p={type:"question",content:f,buttons:[{text:b.ligerDefaults.DialogString.yes,onclick:d,type:"yes"},{text:b.ligerDefaults.DialogString.no,onclick:d,type:"no"},{text:b.ligerDefaults.DialogString.cancel,onclick:d,type:"cancel"}]};if(typeof(g)=="string"&&g!=""){p.title=g}b.extend(p,{showMax:false,showToggle:false,showMin:false},e||{});return b.ligerDialog(p)};b.ligerDialog.waitting=function(d){d=d||b.ligerDefaults.Dialog.waittingMessage;return b.ligerDialog.open({cls:"l-dialog-waittingdialog",type:"none",content:'<div style="padding:4px">'+d+"</div>",allowClose:false})};b.ligerDialog.closeWaitting=function(){var f=a.find(a.controls.Dialog);for(var e in f){var g=f[e];if(g.dialog.hasClass("l-dialog-waittingdialog")){g.close()}}};b.ligerDialog.success=function(f,g,e,d){return b.ligerDialog.alert(f,g,"success",e,d)};b.ligerDialog.error=function(f,g,e,d){return b.ligerDialog.alert(f,g,"error",e,d)};b.ligerDialog.warn=function(f,g,e,d){return b.ligerDialog.alert(f,g,"warn",e,d)};b.ligerDialog.question=function(e,f,d){return b.ligerDialog.alert(e,f,"question",null,d)};b.ligerDialog.prompt=function(h,e,g,j){var f=b('<input type="text" class="l-dialog-inputtext"/>');if(typeof(g)=="function"){j=g}if(typeof(e)=="function"){j=e}else{if(typeof(e)=="boolean"){g=e}}if(typeof(g)=="boolean"&&g){f=b('<textarea class="l-dialog-textarea"></textarea>')}if(typeof(e)=="string"||typeof(e)=="int"){f.val(e)}var d=function(n,k,m){k.close();if(j){j(n.type=="yes",f.val())}};p={title:h,target:f,width:320,buttons:[{text:b.ligerDefaults.DialogString.ok,onclick:d,type:"yes"},{text:b.ligerDefaults.DialogString.cancel,onclick:d,type:"cancel"}]};return b.ligerDialog(p)}})(jQuery);(function(b){var a=b.ligerui;b.fn.ligerDrag=function(c){return a.run.call(this,"ligerDrag",arguments,{idAttrName:"ligeruidragid",hasElement:false,propertyToElemnt:"target"})};b.fn.ligerGetDragManager=function(){return a.run.call(this,"ligerGetDragManager",arguments,{idAttrName:"ligeruidragid",hasElement:false,propertyToElemnt:"target"})};b.ligerDefaults.Drag={onStartDrag:false,onDrag:false,onStopDrag:false,handler:null,clickDelay:100,proxy:true,revert:false,animate:true,onRevert:null,onEndRevert:null,receive:null,onDragEnter:null,onDragOver:null,onDragLeave:null,onDrop:null,disabled:false,proxyX:null,proxyY:null};a.controls.Drag=function(c){a.controls.Drag.base.constructor.call(this,null,c)};a.controls.Drag.ligerExtend(a.core.UIComponent,{__getType:function(){return"Drag"},__idPrev:function(){return"Drag"},_render:function(){var c=this,d=this.options;this.set(d);c.cursor="move";c.handler.css("cursor",c.cursor);c.mouseDowned=false;c.handler.bind("mousedown.drag",function(f){if(d.disabled){return}if(f.button==2){return}c.mouseDowned=true;b(document).bind("selectstart.drag",function(){return false});setTimeout(function(){if(c.mouseDowned){c._start.call(c,f)}},d.clickDelay||100)}).bind("mousemove.drag",function(){if(d.disabled){return}c.handler.css("cursor",c.cursor)}).bind("mouseup.drag",function(){b(document).unbind("selectstart.drag")});b(document).bind("mouseup",function(){c.mouseDowned=false})},_rendered:function(){this.options.target.ligeruidragid=this.id},_start:function(f){var c=this,d=this.options;if(c.reverting){return}if(d.disabled){return}c.current={target:c.target,left:c.target.offset().left,top:c.target.offset().top,startX:f.pageX||f.screenX,startY:f.pageY||f.clientY};if(c.trigger("startDrag",[c.current,f])==false){return false}c.cursor="move";c._createProxy(d.proxy,f);if(d.proxy&&!c.proxy){return false}(c.proxy||c.handler).css("cursor",c.cursor);b(document).bind("mousemove.drag",function(){c._drag.apply(c,arguments)});a.draggable.dragging=true;b(document).bind("mouseup.drag",function(){a.draggable.dragging=false;c._stop.apply(c,arguments)})},_drag:function(j){var f=this,h=this.options;if(!f.current){return}var d=j.pageX||j.screenX;var c=j.pageY||j.screenY;f.current.diffX=d-f.current.startX;f.current.diffY=c-f.current.startY;(f.proxy||f.handler).css("cursor",f.cursor);if(f.receive){f.receive.each(function(e,m){var k=b(m);var g=k.offset();if(d>g.left&&d<g.left+k.width()&&c>g.top&&c<g.top+k.height()){if(!f.receiveEntered[e]){f.receiveEntered[e]=true;f.trigger("dragEnter",[m,f.proxy||f.target,j])}else{f.trigger("dragOver",[m,f.proxy||f.target,j])}}else{if(f.receiveEntered[e]){f.receiveEntered[e]=false;f.trigger("dragLeave",[m,f.proxy||f.target,j])}}})}if(f.hasBind("drag")){if(f.trigger("drag",[f.current,j])!=false){f._applyDrag()}else{if(f.proxy){f._removeProxy()}else{f._stop()}}}else{f._applyDrag()}},_stop:function(f){var c=this,d=this.options;b(document).unbind("mousemove.drag");b(document).unbind("mouseup.drag");b(document).unbind("selectstart.drag");if(c.receive){c.receive.each(function(e,g){if(c.receiveEntered[e]){c.trigger("drop",[g,c.proxy||c.target,f])}})}if(c.proxy){if(d.revert){if(c.hasBind("revert")){if(c.trigger("revert",[c.current,f])!=false){c._revert(f)}else{c._removeProxy()}}else{c._revert(f)}}else{c._applyDrag(c.target);c._removeProxy()}}c.cursor="move";c.trigger("stopDrag",[c.current,f]);c.current=null;c.handler.css("cursor",c.cursor)},_revert:function(d){var c=this;c.reverting=true;c.proxy.animate({left:c.current.left,top:c.current.top},function(){c.reverting=false;c._removeProxy();c.trigger("endRevert",[c.current,d]);c.current=null})},_applyDrag:function(c){var d=this,f=this.options;c=c||d.proxy||d.target;var j={},h=false;var e=c==d.target;if(d.current.diffX){if(e||f.proxyX==null){j.left=d.current.left+d.current.diffX}else{j.left=d.current.startX+f.proxyX+d.current.diffX}h=true}if(d.current.diffY){if(e||f.proxyY==null){j.top=d.current.top+d.current.diffY}else{j.top=d.current.startY+f.proxyY+d.current.diffY}h=true}if(c==d.target&&d.proxy&&f.animate){d.reverting=true;c.animate(j,function(){d.reverting=false})}else{c.css(j)}},_setReceive:function(c){this.receiveEntered={};if(!c){return}if(typeof c=="string"){this.receive=b(c)}else{this.receive=c}},_setHandler:function(c){var d=this,e=this.options;if(!c){d.handler=b(e.target)}else{d.handler=(typeof c=="string"?b(c,e.target):c)}},_setTarget:function(c){this.target=b(c)},_setCursor:function(c){this.cursor=c;(this.proxy||this.handler).css("cursor",c)},_createProxy:function(c,h){if(!c){return}var d=this,f=this.options;if(typeof c=="function"){d.proxy=c.call(this.options.target,d,h)}else{if(c=="clone"){d.proxy=d.target.clone().css("position","absolute");d.proxy.appendTo("body")}else{d.proxy=b("<div class='l-draggable'></div>");d.proxy.width(d.target.width()).height(d.target.height());d.proxy.attr("dragid",d.id).appendTo("body")}}d.proxy.css({left:f.proxyX==null?d.current.left:d.current.startX+f.proxyX,top:f.proxyY==null?d.current.top:d.current.startY+f.proxyY}).show()},_removeProxy:function(){var c=this;if(c.proxy){c.proxy.remove();c.proxy=null}}})})(jQuery);(function(a){a.fn.ligerEasyTab=function(){return a.ligerui.run.call(this,"ligerEasyTab",arguments)};a.fn.ligerGetEasyTabManager=function(){return a.ligerui.run.call(this,"ligerGetEasyTabManager",arguments)};a.ligerDefaults.EasyTab={};a.ligerMethos.EasyTab={};a.ligerui.controls.EasyTab=function(c,b){a.ligerui.controls.EasyTab.base.constructor.call(this,c,b)};a.ligerui.controls.EasyTab.ligerExtend(a.ligerui.core.UIComponent,{__getType:function(){return"EasyTab"},__idPrev:function(){return"EasyTab"},_extendMethods:function(){return a.ligerMethos.EasyTab},_render:function(){var c=this,d=this.options;c.tabs=a(this.element);c.tabs.addClass("l-easytab");var b=0;if(a("> div[lselected=true]",c.tabs).length>0){b=a("> div",c.tabs).index(a("> div[lselected=true]",c.tabs))}c.tabs.ul=a('<ul class="l-easytab-header"></ul>');a("> div",c.tabs).each(function(f,g){var e=a("<li><span></span></li>");if(f==b){a("span",e).addClass("l-selected")}if(a(g).attr("title")){a("span",e).html(a(g).attr("title"));a(g).removeAttr("title")}c.tabs.ul.append(e);if(!a(g).hasClass("l-easytab-panelbox")){a(g).addClass("l-easytab-panelbox")}});c.tabs.ul.prependTo(c.tabs);a(".l-easytab-panelbox:eq("+b+")",c.tabs).show().siblings(".l-easytab-panelbox").hide();a("> ul:first span",c.tabs).click(function(){if(a(this).hasClass("l-selected")){return}var e=a("> ul:first span",c.tabs).index(this);a(this).addClass("l-selected").parent().siblings().find("span.l-selected").removeClass("l-selected");a(".l-easytab-panelbox:eq("+e+")",c.tabs).show().siblings(".l-easytab-panelbox").hide()}).not("l-selected").hover(function(){a(this).addClass("l-over")},function(){a(this).removeClass("l-over")});c.set(d)}})})(jQuery);(function(a){a.fn.ligerFilter=function(){return a.ligerui.run.call(this,"ligerFilter",arguments)};a.fn.ligerGetFilterManager=function(){return a.ligerui.run.call(this,"ligerGetFilterManager",arguments)};a.ligerDefaults.Filter={fields:[],operators:{},editors:{},buttonCls:null};a.ligerDefaults.FilterString={strings:{and:"并且",or:"或者",equal:"相等",notequal:"不相等",startwith:"以..开始",endwith:"以..结束",like:"相似",greater:"大于",greaterorequal:"大于或等于",less:"小于",lessorequal:"小于或等于","in":"包括在...",notin:"不包括...",addgroup:"增加分组",addrule:"增加条件",deletegroup:"删除分组"}};a.ligerDefaults.Filter.operators.string=a.ligerDefaults.Filter.operators.text=["equal","notequal","startwith","endwith","like","greater","greaterorequal","less","lessorequal","in","notin"];a.ligerDefaults.Filter.operators.number=a.ligerDefaults.Filter.operators["int"]=a.ligerDefaults.Filter.operators["float"]=a.ligerDefaults.Filter.operators.date=["equal","notequal","greater","greaterorequal","less","lessorequal","in","notin"];a.ligerDefaults.Filter.editors.string={create:function(b,d){var c=a("<input type='text'/>");b.append(c);c.ligerTextBox(d.editor.options||{});return c},setValue:function(b,c){b.val(c)},getValue:function(b){return b.liger("option","value")},destroy:function(b){b.liger("destroy")}};a.ligerDefaults.Filter.editors.date={create:function(b,d){var c=a("<input type='text'/>");b.append(c);c.ligerDateEditor(d.editor.options||{});return c},setValue:function(b,c){b.liger("option","value",c)},getValue:function(b,c){return b.liger("option","value")},destroy:function(b){b.liger("destroy")}};a.ligerDefaults.Filter.editors.number={create:function(b,e){var c=a("<input type='text'/>");b.append(c);var d={minValue:e.editor.minValue,maxValue:e.editor.maxValue};c.ligerSpinner(a.extend(d,e.editor.options||{}));return c},setValue:function(b,c){b.val(c)},getValue:function(b,d){var c=d.editor.type=="int";if(c){return parseInt(b.val(),10)}else{return parseFloat(b.val())}},destroy:function(b){b.liger("destroy")}};a.ligerDefaults.Filter.editors.combobox={create:function(b,e){var c=a("<input type='text'/>");b.append(c);var d={data:e.data,slide:false,valueField:e.editor.valueField||e.editor.valueColumnName,textField:e.editor.textField||e.editor.displayColumnName};a.extend(d,e.editor.options||{});c.ligerComboBox(d);return c},setValue:function(b,c){b.liger("option","value",c)},getValue:function(b){return b.liger("option","value")},destroy:function(b){b.liger("destroy")}};a.ligerui.controls.Filter=function(c,b){a.ligerui.controls.Filter.base.constructor.call(this,c,b)};a.ligerui.controls.Filter.ligerExtend(a.ligerui.core.UIComponent,{__getType:function(){return"Filter"},__idPrev:function(){return"Filter"},_init:function(){var d=this,e=this.options;a.ligerui.controls.Filter.base._init.call(this);for(var c in liger.editors){var b=liger.editors[c];if(!b||c in e.editors){continue}e.editors[c]=liger.getEditor(a.extend({type:c,master:d},b))}},_render:function(){var b=this,c=this.options;b.set(c);a(b.element).bind("click",function(g){g.preventDefault();var j=a((g.target||g.srcElement));var h=j.get(0).className;if(h.indexOf("addgroup")>=0){var f=j.parent().parent().parent().parent();b.addGroup(f)}else{if(h.indexOf("deletegroup")>=0){var f=j.parent().parent().parent().parent();b.deleteGroup(f)}else{if(h.indexOf("addrule")>=0){var f=j.parent().parent().parent().parent();b.addRule(f)}else{if(h.indexOf("deleterole")>=0){var d=j.parent().parent();b.deleteRule(d)}}}}})},_setFields:function(b){var c=this,d=this.options;if(c.group){c.group.remove()}c.group=a(c._bulidGroupTableHtml()).appendTo(c.element);d.buttonCls&&c.group.find(".addgroup,.addrule,.deletegroup").addClass(d.buttonCls)},editors:{},editorCounter:0,addGroup:function(d){var f=this,h=this.options;d=a(d||f.group);var k=a(">tbody:first > tr:last",d);var b=[];b.push('<tr class="l-filter-rowgroup"><td class="l-filter-cellgroup" colSpan="4">');var e=!d.hasClass("l-filter-group-alt");b.push(f._bulidGroupTableHtml(e,true));b.push("</td></tr>");var j=a(b.join(""));h.buttonCls&&j.find(".addgroup,.addrule,.deletegroup").addClass(h.buttonCls);k.before(j);var c=j.find("table:first");if(h.addDefult){f.addRule(c)}return c},deleteGroup:function(d){var b=this,c=this.options;a("td.l-filter-value",d).each(function(){var e=a(this).parent();a("select.fieldsel",e).unbind();b.removeEditor(e)});a(d).parent().parent().remove()},removeEditor:function(b){var e=this,f=this.options;var d=a(b).attr("editortype");var h=a(b).attr("editorid");var c=e.editors[h];if(c&&f.editors[d].destroy){f.editors[d].destroy(c)}a("td.l-filter-value:first",b).html("")},setData:function(e,b){var c=this,d=this.options;b=b||c.group;var f=a(">tbody:first > tr:last",b);if(b){b.find(">tbody:first > tr").not(f).remove()}a("select:first",f).val(e.op);if(e.rules){a(e.rules).each(function(){var g=c.addRule(b);a("select.opsel",g).html(c._bulidOpSelectOptionsHtml(this.type||"string"));g.attr("fieldtype",this.type||"string");a("select.opsel",g).val(this.op);a("select.fieldsel",g).val(this.field).trigger("change");var h=g.attr("editorid");if(h&&c.editors[h]){var k=c.getField(this.field);if(k&&k.editor){var j={field:k,filter:c};d.editors[k.editor.type].setValue.call(c,c.editors[h],this.value,j)}}else{a(":text",g).val(this.value)}})}if(e.groups){a(e.groups).each(function(){var g=c.addGroup(b);c.setData(this,g)})}},addRule:function(c){var d=this,e=this.options;c=c||d.group;var f=a(">tbody:first > tr:last",c);var b=a(d._bulidRuleRowHtml());f.before(b);if(e.fields.length){d.appendEditor(b,e.fields[0])}a("select.fieldsel",b).bind("change",function(){var m=a(this).parent().next().find("select:first");var o=a(this).val();if(!o){return}var n=d.getField(o);var k=n.type||"string";var h=b.attr("fieldtype");if(k!=h){m.html(d._bulidOpSelectOptionsHtml(k));b.attr("fieldtype",k)}var g=null;var j=b.attr("editortype");if(d.enabledEditor(n)){g=n.editor.type}if(j){d.removeEditor(b)}if(g){d.appendEditor(b,n)}else{b.removeAttr("editortype").removeAttr("editorid");a("td.l-filter-value:first",b).html('<input type="text" class="valtxt l-text" />')}});return b},deleteRule:function(b){a("select.fieldsel",b).unbind();this.removeEditor(b);a(b).remove()},appendEditor:function(b,k){var f=this,j=this.options;if(f.enabledEditor(k)){var d=a("td.l-filter-value:first",b).html("");var e=j.editors[k.editor.type];var c=++f.editorCounter;var h={filter:f};h.field=a.extend(true,{},k);h.field.name=k.name+"_"+c;f.editors[c]=e.create.call(this,d,h);b.attr("editortype",k.editor.type).attr("editorid",c)}},getData:function(e){var c=this,d=this.options;e=e||c.group;var b={};a("> tbody > tr",e).each(function(j,r){var h=a(r).hasClass("l-filter-rowlast");var g=a(r).hasClass("l-filter-rowgroup");if(g){var f=a("> td:first > table:first",r);if(f.length){if(!b.groups){b.groups=[]}b.groups.push(c.getData(f))}}else{if(h){b.op=a(".groupopsel:first",r).val()}else{var q=a("select.fieldsel:first",r).val();var n=c.getField(q);var k=a(".opsel:first",r).val();var o=c._getRuleValue(r,n);var m=a(r).attr("fieldtype")||"string";if(!b.rules){b.rules=[]}if(o){b.rules.push({field:q,op:k,value:o,type:m})}}}});return b},_getRuleValue:function(b,k){var f=this,j=this.options;var d=a(b).attr("editorid");var c=a(b).attr("editortype");var e=f.editors[d];var h={field:k,filter:f};if(e){return j.editors[c].getValue.call(f,e,h)}return a(".valtxt:first",b).val()},enabledEditor:function(d){var b=this,c=this.options;if(!d.editor||!d.editor.type){return false}return(d.editor.type in c.editors)},getField:function(c){var e=this,h=this.options;for(var d=0,b=h.fields.length;d<b;d++){var f=h.fields[d];if(f.name==c){return f}}return null},_bulidGroupTableHtml:function(c,b){var d=this,f=this.options;var e=[];e.push('<table cellpadding="0" cellspacing="0" border="0" class="l-filter-group');if(c){e.push(" l-filter-group-alt")}e.push('"><tbody>');e.push('<tr class="l-filter-rowlast"><td class="l-filter-rowlastcell" align="right" colSpan="4">');e.push('<select class="groupopsel">');e.push('<option value="and">'+f.strings.and+"</option>");e.push('<option value="or">'+f.strings.or+"</option>");e.push("</select>");e.push('<input type="button" value="'+f.strings.addgroup+'" class="addgroup">');e.push('<input type="button" value="'+f.strings.addrule+'" class="addrule">');if(b){e.push('<input type="button" value="'+f.strings.deletegroup+'" class="deletegroup">')}e.push("</td></tr>");e.push("</tbody></table>");return e.join("")},_bulidRuleRowHtml:function(b){var h=this,k=this.options;b=b||k.fields;var f=[];var d=b[0].type||"string";f.push('<tr fieldtype="'+d+'"><td class="l-filter-column">');f.push('<select class="fieldsel">');for(var e=0,c=b.length;e<c;e++){var j=b[e];f.push('<option value="'+j.name+'"');if(e==0){f.push(" selected ")}f.push(">");f.push(j.display);f.push("</option>")}f.push("</select>");f.push("</td>");f.push('<td class="l-filter-op">');f.push('<select class="opsel">');f.push(h._bulidOpSelectOptionsHtml(d));f.push("</select>");f.push("</td>");f.push('<td class="l-filter-value">');f.push('<input type="text" class="valtxt" />');f.push("</td>");f.push("<td>");f.push('<div class="l-icon-cross deleterole"></div>');f.push("</td>");f.push("</tr>");return f.join("")},_bulidOpSelectOptionsHtml:function(d){var h=this,j=this.options;var f=j.operators[d];var b=[];if(!f||!f.length){f=["equal","notequal"]}for(var e=0,c=f.length;e<c;e++){var k=f[e];b[b.length]='<option value="'+k+'">';b[b.length]=j.strings[k];b[b.length]="</option>"}return b.join("")}});a.ligerFilter=function(){};a.ligerFilter.filterTranslator={translateGroup:function(h){var d=[];if(h==null){return" 1==1 "}var f=false;d.push("(");if(h.rules!=null){for(var e in h.rules){if(e=="indexOf"){continue}var g=h.rules[e];if(f){d.push(this.getOperatorQueryText(h.op))}d.push(this.translateRule(g));f=true}}if(h.groups!=null){for(var c in h.groups){var b=h.groups[c];if(f){d.push(this.getOperatorQueryText(h.op))}d.push(this.translateGroup(b));f=true}}d.push(")");if(f==false){return" 1==1 "}return d.join("")},translateRule:function(c){var b=[];if(c==null){return" 1==1 "}if(c.op=="like"||c.op=="startwith"||c.op=="endwith"){b.push("/");if(c.op=="startwith"){b.push("^")}b.push(c.value);if(c.op=="endwith"){b.push("$")}b.push("/i.test(");b.push('o["');b.push(c.field);b.push('"]');b.push(")");return b.join("")}b.push('o["');b.push(c.field);b.push('"]');b.push(this.getOperatorQueryText(c.op));b.push('"');b.push(c.value);b.push('"');return b.join("")},getOperatorQueryText:function(b){switch(b){case"equal":return" == ";case"notequal":return" != ";case"greater":return" > ";case"greaterorequal":return" >= ";case"less":return" < ";case"lessorequal":return" <= ";case"and":return" && ";case"or":return" || ";default:return" == "}}};a.ligerFilter.getFilterFunction=function(c){if(a.isArray(c)){c={op:"and",rules:c}}var b=" return  "+a.ligerFilter.filterTranslator.translateGroup(c);return new Function("o",b)}})(jQuery);(function($){$.fn.ligerForm=function(){return $.ligerui.run.call(this,"ligerForm",arguments)};$.ligerui.getConditions=function(form,options){if(!form){return null}form=liger.get($(form));if(form&&form.toConditions){return form.toConditions()}};$.ligerDefaults=$.ligerDefaults||{};$.ligerDefaults.Form={width:null,inputWidth:180,labelWidth:90,space:40,rightToken:"：",labelAlign:"left",align:"left",autoTypePrev:"ui-",fields:[],appendID:true,prefixID:null,toJSON:$.ligerui.toJSON,labelCss:null,fieldCss:null,spaceCss:null,onAfterSetFields:null,buttons:null,readonly:false,editors:{},validate:null,unSetValidateAttr:false,tab:null,clsTab:"ui-tabs-nav ui-helper-clearfix",clsTabItem:"ui-state-default",clsTabItemSelected:"ui-tabs-selected",clsTabContent:"ui-tabs-panel ui-widget-content"};$.ligerDefaults.FormString={invalidMessage:"存在{errorCount}个字段验证不通过，请检查!",detailMessage:"detail",okMessage:$("sys.hand.btn.ok")};$.ligerDefaults.Form.editors.hidden={create:function(container,editParm,p){var editor=$('<input type = "hidden"  />');var id=(p.prefixID||"")+editParm.field.name;if($("#"+id).length){editor=$("#"+id)}editor.attr($.extend({id:id,name:id},editParm.field.attr));var eo=editParm.field.editor||editParm.field.options;eo&&editor.val(eo.value);container.append(editor);return editor},getValue:function(editor,editParm){return editor.val()},setValue:function(editor,value,editParm){editor.val(value)}};$.ligerDefaults.Form_fields={name:null,textField:null,type:null,editor:null,label:null,labelInAfter:false,afterContent:null,beforeContent:null,hideSpace:false,hideLabel:false,rightToken:null,attrRender:null,style:null,containerCls:null,newline:true,op:null,vt:null,attr:null,validate:null};$.ligerDefaults.Form_editor={};$.ligerDefaults.Form.editorBulider=function(jinput){var g=this,p=this.options;if(!jinput||!jinput.length){return}var options={},ltype=jinput.attr("ltype"),field={};if(p.readonly){options.readonly=true}options=$.extend({width:(field.width||p.inputWidth)-2},field.options,field.editor,options);var control=null;if(ltype=="autocomplete"){options.autocomplete=true}if(jinput.is("select")&&ltype!="none"){control=jinput.ligerComboBox(options)}else{if(jinput.is(":password")&&ltype!="none"){control=jinput.ligerTextBox(options)}else{if(jinput.is(":radio")&&ltype!="none"){control=jinput.ligerRadio(options)}else{if(jinput.is(":checkbox")&&ltype!="none"){control=jinput.ligerCheckBox(options)}else{if(jinput.is("textarea")&&ltype!="none"){control=jinput.ligerTextArea(options)}else{if(ltype&&ltype!="none"){if(jinput.is(":text")){switch(ltype){case"select":case"combobox":case"autocomplete":control=jinput.ligerComboBox(options);break;case"spinner":control=jinput.ligerSpinner(options);break;case"date":control=jinput.ligerDateEditor(options);break;case"popup":control=jinput.ligerPopupEdit(options);break;case"currency":control=options.currency=true;case"float":case"number":options.number=true;control=jinput.ligerTextBox(options);break;case"int":case"digits":options.digits=true;default:control=jinput.ligerTextBox(options);break}}else{if(jinput.is(":hidden")){switch(ltype){case"select":case"combobox":case"autocomplete":control=jinput.ligerComboBox(options);break;case"checkboxlist":control=jinput.ligerCheckBoxList(options);break;case"radiolist":control=jinput.ligerRadioList(options);break;case"listbox":control=jinput.ligerListBox(options);break}}}}else{var classname=jinput.get(0).className;if(!classname){return}var autoTypePrev=p.autoTypePrev||"ui-";if(classname.indexOf(autoTypePrev)==-1){return}classname=classname.replace(autoTypePrev,"");switch(classname){case"textbox":case"password":control=jinput.ligerTextBox(options);break;case"datepicker":control=jinput.ligerDateEditor(options);break;case"spinner":control=jinput.ligerSpinner(options);break;case"checkbox":control=jinput.ligerCheckBox(options);break;case"combobox":control=jinput.ligerComboBox(options);break;case"checkboxlist":control=jinput.ligerCheckBoxList(options);break;case"radiolist":control=jinput.ligerRadioList(options);break;case"listbox":control=jinput.ligerListBox(options);break}}}}}}}if(!control){return null}return{name:jinput.attr("name"),control:control}};$.ligerui.controls.Form=function(element,options){$.ligerui.controls.Form.base.constructor.call(this,element,options)};$.ligerui.controls.Form.ligerExtend($.ligerui.core.UIComponent,{__getType:function(){return"Form"},__idPrev:function(){return"Form"},_init:function(){var g=this,p=this.options;$.ligerui.controls.Form.base._init.call(this);for(var type in liger.editors){var editor=liger.editors[type];if(!editor||type in p.editors){continue}p.editors[type]=liger.getEditor($.extend({type:type,master:g},editor))}},_render:function(){var g=this,p=this.options;var jform=$(this.element);g.form=jform.is("form")?jform:jform.parents("form:first");$("input,select,textarea",jform).each(function(){var result=p.editorBulider.call(g,$(this));if(result){g.autoEditors=g.autoEditors||[];g.autoEditors.push(result)}});if(g.autoEditors&&g.autoEditors.length&&p.validate){g.validate=g.validate||{};$(g.autoEditors).each(function(){var name=this.name;var control=this.control;if(name&&control.inputText&&control.inputText.attr("validate")){var v=null,vm=null;eval("v = "+control.inputText.attr("validate"));if(v){g.validate.rules=g.validate.rules||{};g.validate.rules[name]=v}if(control.inputText.attr("validateMessage")){eval("vm = "+control.inputText.attr("validateMessage"));if(vm){g.validate.messages=g.validate.messages||{};g.validate.messages[name]=vm}}}})}g.set(p);g.initValidate();if(p.buttons){var jbuttons=$('<ul class="l-form-buttons"></ul>').appendTo(jform);$(p.buttons).each(function(){var jbutton=$("<li><div></div></li>").appendTo(jbuttons);this.id=$("div:first",jbutton).ligerButton(this).id})}if(!g.element.id){g.element.id=g.id}$("#"+g.element.id+" .togglebtn").live("click",function(){if($(this).hasClass("togglebtn-down")){$(this).removeClass("togglebtn-down")}else{$(this).addClass("togglebtn-down")}var boxs=$(this).parent().nextAll("ul,div");for(var i=0;i<boxs.length;i++){var jbox=$(boxs[i]);if(jbox.hasClass("l-group")){break}if($(this).hasClass("togglebtn-down")){jbox.hide()}else{jbox.show()}}})},_setWidth:function(value){var g=this,p=this.options;if(value){g.form.width(value)}},getEditor:function(name){var g=this,p=this.options;if(!g.editors){return}var o=find(null);if(o){return o}if(p.tab&&p.tab.items){for(var i=0;i<p.tab.items.length;i++){var item=p.tab.items[i];var o=find(item,i);if(o){return o}}}return null;function find(tabitem,tabindex){var fields=tabitem==null?p.fields:tabitem.fields;for(var i=0,l=fields.length;i<l;i++){var field=fields[i];var eIndex=tabindex==null?i:"tab"+tabindex+"_"+i;if(field.name==name&&g.editors[eIndex]){return g.editors[eIndex].control}}}},getField:function(index){var g=this,p=this.options;if(!p.fields){return null}return p.fields[index]},toConditions:function(){var g=this,p=this.options;var conditions=[];$(p.fields).each(function(fieldIndex,field){var name=field.name,textField=field.textField,editor=g.editors[fieldIndex];if(!editor||!name){return}var value=editor.editor.getValue.call(g,editor.control,{field:field});if(value!=null&&value!==""){conditions.push({op:field.operator||"like",field:name,value:value,type:field.type||"string"})}});return conditions},_preSetFields:function(fields){var g=this,p=this.options,lastVisitedGroup=null,lastVisitedGroupIcon=null;$(p.fields).each(function(i,field){if(p.readonly||field.readonly||(field.editor&&field.editor.readonly)){delete field.validate}if(field.type=="hidden"){return}field.type=field.type||"text";if(field.newline==null){field.newline=true}if(lastVisitedGroup&&!field.group){field.group=lastVisitedGroup;field.groupicon=lastVisitedGroupIcon}if(field.group){field.group=field.group.toString().replace(/^\s\s*/,"").replace(/\s\s*$/,"");lastVisitedGroup=field.group;lastVisitedGroupIcon=field.groupicon}})},_setReadonly:function(readonly){var g=this,p=this.options;if(readonly&&g.editors){for(var index in g.editors){var control=g.editors[index].control;if(control&&control._setReadonly){control._setReadonly(true)}}}},_setFields:function(fields){var g=this,p=this.options;if($.isFunction(p.prefixID)){p.prefixID=p.prefixID(g)}var jform=$(g.element).addClass("l-form");g._initFieldsValidate({fields:fields});g._initFieldsHtml({panel:jform,fields:fields});g._createEditors({fields:fields});g.trigger("afterSetFields")},_initFieldsValidate:function(e){var g=this,p=this.options;var fields=e.fields;g.validate=g.validate||{};if(fields&&fields.length){$(fields).each(function(index,field){var name=field.name,readonly=(field.readonly||(field.editor&&field.editor.readonly))?true:false,txtInputName=(p.prefixID||"")+(field.textField||field.id||field.name);if(field.validate&&!readonly){g.validate.rules=g.validate.rules||{};g.validate.rules[txtInputName]=field.validate;if(field.validateMessage){g.validate.messages=g.validate.messages||{};g.validate.messages[txtInputName]=field.validateMessage}}})}},_initFieldsHtml:function(e){var g=this,p=this.options;var jform=e.panel,fields=e.fields,idPrev=e.idPrev||g.id,tabindex=e.tabindex;$(">.l-form-container",jform).remove();var lineWidth=0,maxWidth=0;if(fields&&fields.length){g._preSetFields(fields);var out=['<div class="l-form-container">'],appendULStartTag=false,lastVisitedGroup=null,groups=[];$(fields).each(function(index,field){if(!field.group){field.group=""}if($.inArray(field.group,groups)==-1){groups.push(field.group)}});$(groups).each(function(groupIndex,group){$(fields).each(function(i,field){if(field.group!=group){return}var index=$.inArray(field,fields);var name=field.id||field.name,newline=field.newline;var inputName=(p.prefixID||"")+(field.id||field.name);if(!name){return}if(field.type=="hidden"){if(!$("#"+inputName).length){out.push('<div style="display:none" id="'+(idPrev+"|"+i)+'"></div>')}return}var toAppendGroupRow=field.group&&field.group!=lastVisitedGroup;if(index==0||toAppendGroupRow){newline=true}if(newline){lineWidth=0;if(appendULStartTag){out.push("</ul>");appendULStartTag=false}if(toAppendGroupRow){out.push('<div class="l-group');if(field.groupicon){out.push(" l-group-hasicon")}out.push('">');if(field.groupicon){out.push('<img src="'+field.groupicon+'" />')}out.push("<span>"+field.group+"</span></div>");lastVisitedGroup=field.group}out.push("<ul>");appendULStartTag=true}out.push('<li class="l-fieldcontainer');if(newline){out.push(" l-fieldcontainer-first")}if(field.containerCls){out.push(" "+field.containerCls)}out.push('"');if(field.style){out.push(' style="'+field.style+'"')}out.push(' fieldindex="'+index+'"');if(tabindex!=null){out.push(' tabindex="'+tabindex+'"')}if(field.attrRender){out.push(" "+field.attrRender())}out.push("><ul>");if(field.beforeContent){var beforeContent=$.isFunction(field.beforeContent)?field.afterContent(field):field.beforeContent;beforeContent&&out.push(beforeContent)}if(!field.hideLabel&&!field.labelInAfter){out.push(g._buliderLabelContainer(field,index))}out.push(g._buliderControlContainer(field,index,e.idPrev));if(field.labelInAfter){out.push(g._buliderLabelContainer(field,index))}if(field.afterContent){var afterContent=$.isFunction(field.afterContent)?field.afterContent(field):field.afterContent;afterContent&&out.push(afterContent)}if(!field.hideSpace){out.push(g._buliderSpaceContainer(field,index))}out.push("</ul></li>");lineWidth+=(field.width||p.inputWidth||0);lineWidth+=(field.space||p.space||0);lineWidth+=(field.labelWidth||p.labelWidth||0);if(lineWidth>maxWidth){maxWidth=lineWidth}})});if(appendULStartTag){out.push("</ul>");appendULStartTag=false}out.push('<div class="l-clear"></div>');out.push("</div>");jform.append(out.join(""));if(!p.width||maxWidth>p.width){}$(".l-group .togglebtn",jform).remove();$(".l-group",jform).width(jform.width()*0.95).append("<div class='togglebtn'></div>")}},_createEditors:function(e){var g=this,p=this.options;var fields=e.fields,idPrev=e.idPrev||g.id,editPrev=e.editPrev||"";g.editors=g.editors||{};var jform=$(g.element);$(fields).each(function(fieldIndex,field){var container=document.getElementById(idPrev+"|"+fieldIndex),editor=p.editors[field.type],editId=editPrev+fieldIndex;if(!container){return}container=$(container);var editorControl=g._createEditor(editor,container,{field:field},container.width(),container.height());if(!editorControl){return}if(g.editors[editId]&&g.editors[editId].control&&g.editors[editId].control.destroy){g.editors[editId].control.destroy()}g.editors[editId]={control:editorControl,editor:editor}})},getChanges:function(){var g=this,p=this.options;var originData=g.data;var curData=g.getData();g.data=originData;var c={};for(var k in originData){if(curData[k]!=originData[k]){c[k]=curData[k]}}return c},setEnabled:function(arg,isEnabled){var fieldNames=[];if($.isArray(arg)){fieldNames=arg}if(typeof(arg)=="string"){fieldNames.push(arg)}var g=this,p=this.options;setEnabledInFields(p.fields);if(p.tab&&p.tab.items){for(var i=0;i<p.tab.items.length;i++){var item=p.tab.items[i];setEnabledInFields(item.fields,i)}}function setEnabledInFields(fields,tabIndex){$(fields).each(function(fieldIndex,field){var name=field.name,textField=field.textField,editPrev=tabIndex==null?"":"tab"+tabIndex+"_",editor=g.editors[editPrev+fieldIndex];if(!editor||!name){return}if(!editor.editor||!editor.editor.setEnabled){return}if($.inArray(name,fieldNames)==-1){return}editor.editor.setEnabled(editor.control,isEnabled)})}},setVisible:function(arg,isVisible){var fieldNames=[];if($.isArray(arg)){fieldNames=arg}if(typeof(arg)=="string"){fieldNames.push(arg)}var g=this,p=this.options;setVisibleInFields(p.fields);if(p.tab&&p.tab.items){for(var i=0;i<p.tab.items.length;i++){var item=p.tab.items[i];setVisibleInFields(item.fields,i)}}function setVisibleInFields(fields,tabIndex){$(fields).each(function(fieldIndex,field){var name=field.name;if($.inArray(name,fieldNames)==-1){return}g._setFieldPanelVisible(tabIndex,fieldIndex,isVisible)})}},_setFieldPanelVisible:function(tabindex,fieldindex,visible){var g=this,p=this.options;if(tabindex==null){$("li.l-fieldcontainer[fieldindex="+fieldindex+"]",g.element)[visible?"show":"hide"]()}else{$("div."+p.clsTabContent+"[data-index="+tabindex+"] li.l-fieldcontainer[fieldindex="+fieldindex+"]",g.element)[visible?"show":"hide"]()}},getData:function(){var g=this,p=this.options;g.data=g.data||{};if(g.autoEditors&&g.autoEditors.length){$(g.autoEditors).each(function(){var name=this.name;var control=this.control;if(name&&control&&control.getValue){g.data[name]=control.getValue()}})}getFieldValueToData(p.fields);if(p.tab&&p.tab.items){for(var i=0;i<p.tab.items.length;i++){var item=p.tab.items[i];getFieldValueToData(item.fields,i)}}function getFieldValueToData(fields,tabIndex){$(fields).each(function(fieldIndex,field){var name=field.name,textField=field.textField,editPrev=tabIndex==null?"":"tab"+tabIndex+"_",editor=g.editors[editPrev+fieldIndex];if(!editor){return}if(name){var value=editor.editor.getValue.call(g,editor.control,{field:field});g._setValueByName(g.data,name,value)}if(textField&&editor.editor.getText){var value=editor.editor.getText.call(g,editor.control,{field:field});g._setValueByName(g.data,textField,value)}})}return g.data},_setData:function(data){this.setData(data)},setData:function(data){var g=this,p=this.options;g.data=data||{};if(g.autoEditors&&g.autoEditors.length){$(g.autoEditors).each(function(){var name=this.name;var control=this.control;if(name&&g.data[name]&&control&&control.setValue){control.setValue(g.data[name])}})}setDataToFields(p.fields);if(p.tab&&p.tab.items){for(var i=0;i<p.tab.items.length;i++){var item=p.tab.items[i];setDataToFields(item.fields,i)}}function setDataToFields(fields,tabIndex){$(fields).each(function(fieldIndex,field){var name=field.name,textField=field.textField,editPrev=tabIndex==null?"":"tab"+tabIndex+"_",editor=g.editors[editPrev+fieldIndex];if(!editor){return}if(name&&(name in g.data)){var value=g._getValueByName(g.data,name);editor.editor.setValue.call(g,editor.control,value,{field:field})}if(textField&&(textField in g.data)){var text=g._getValueByName(g.data,textField);editor.editor.setText.call(g,editor.control,text,{field:field})}})}},_setValueByName:function(data,name,value){if(!data||!name){return null}if(name.indexOf(".")==-1){data[name]=value}else{try{new Function("data,value","data."+name+"=value;")(data,value)}catch(e){}}},_getValueByName:function(data,name){if(!data||!name){return null}if(name.indexOf(".")==-1){return data[name]}else{try{return new Function("data","return data."+name+";")(data)}catch(e){return null}}},valid:function(){var g=this,p=this.options;if(!g.form||!g.validator){return true}return g.form.valid()},showFieldError:function(name,errorText){var element=$("[name="+name+"]",this.element);if(element.hasClass("l-textarea")){element.addClass("l-textarea-invalid")}else{if(element.hasClass("l-text-field")){element.parent().addClass("l-text-invalid")}}$(element).removeAttr("title").ligerHideTip();$(element).attr("title",errorText).ligerTip({distanceX:5,distanceY:-3,auto:true})},hideFieldError:function(name){var element=$("[name="+name+"]",this.element);if(element.hasClass("l-textarea")){element.removeClass("l-textarea-invalid")}else{element.parent().removeClass("l-text-invalid")}$(element).removeAttr("title").ligerHideTip()},initValidate:function(){var g=this,p=this.options;if(!g.form||!p.validate||!g.form.validate){g.validator=null;return}var validate=p.validate==true?{}:p.validate;var validateOptions=$.extend({errorPlacement:function(lable,element){if(!$(lable).html()){return}if(!element.attr("id")){var eleid=new Date().getTime();element.attr("id",eleid);lable.attr("for",eleid)}if(element.hasClass("l-textarea")){element.addClass("l-textarea-invalid")}else{if(element.hasClass("l-text-field")){element.parent().addClass("l-text-invalid")}}$(element).removeAttr("title").ligerHideTip();$(element).attr("title",$(lable).html()).ligerTip({distanceX:5,distanceY:-3,auto:true})},success:function(lable){var eleId=lable.attr("for");if(!eleId){return}var element=$("#"+eleId);if(element.hasClass("l-textarea")){element.removeClass("l-textarea-invalid")}else{element.parent().removeClass("l-text-invalid")}$(element).removeAttr("title").ligerHideTip()}},validate,{rules:g.validate.rules,messages:g.validate.messages});g.validator=g.form.validate(validateOptions)},setFieldValidate:function(name,validate,messages){var jele=$("[ligeruiid="+name+"]");if(!jele.length||!jele.rules){return}var oldRule=jele.rules();if(oldRule){if(jele.hasClass("l-text-field")){jele.parent().removeClass("l-text-invalid")}jele.removeAttr("title").ligerHideTip();if(oldRule.required){jele.parents("div.l-text").removeClass("l-text-required")}}if(!validate){return}var rule=$.extend({},validate,{messages:messages});jele.rules("remove");jele.rules("add",rule);if(validate.required){jele.parents("div.l-text").addClass("l-text-required")}},showInvalid:function(){var g=this,p=this.options;if(!g.validator){return}var invalidMessage=p.invalidMessage.replace("{errorCount}",g.validator.errorList.length);if(p.showInvalid){p.showInvalid(invalidMessage)}else{var jmessage=$('<div><div class="invalid">'+invalidMessage+'<a class="viewInvalidDetail" href="javascript:void(0)">'+p.detailMessage+'</a></div><div class="invalidDetail" style="display:none;">'+getInvalidInf(g.validator.errorList)+"</div></div>");jmessage.find("a.viewInvalidDetail:first").bind("click",function(){$(this).parent().next("div.invalidDetail").toggle()});$.ligerDialog.open({type:"error",width:350,showMax:false,showToggle:false,showMin:false,target:jmessage,buttons:[{text:p.okMessage,onclick:function(item,dailog){dailog.close()}}]})}},_createEditor:function(editorBuilder,container,editParm,width,height){var g=this,p=this.options;try{var editor=editorBuilder.create.call(this,container,editParm,p);if(editor&&editorBuilder.resize){editorBuilder.resize.call(this,editor,width,height,editParm)}return editor}catch(e){return null}},_buliderLabelContainer:function(field){var g=this,p=this.options;var label=field.label||field.display;var labelWidth=field.labelWidth||field.labelwidth||p.labelWidth;var labelAlign=field.labelAlign||p.labelAlign;if(label){var rightToken=field.rightToken;if(rightToken==null||rightToken==""){rightToken=p.rightToken}label+=rightToken}var out=[];out.push("<li");if(p.labelCss){out.push(' class="'+p.labelCss+'"')}out.push(' style="');if(/px$/i.test(labelWidth)||/auto/i.test(labelWidth)||/%$/i.test(labelWidth)){out.push("width:"+labelWidth+";")}else{if(labelWidth){out.push("width:"+labelWidth+"px;")}}if(labelAlign&&labelAlign!="top"){out.push("text-align:"+labelAlign+";")}out.push('">');if(label){out.push(label)}out.push("</li>");return out.join("")},_buliderControlContainer:function(field,fieldIndex,idPrev){var g=this,p=this.options;var width=field.width||p.inputWidth,align=field.align||field.textAlign||field.textalign||p.align,out=[],idPrev=idPrev||g.id;var labelAlign=field.labelAlign||p.labelAlign;out.push("<li");out.push(' id="'+(idPrev+"|"+fieldIndex)+'"');if(p.fieldCss){out.push(' class="'+p.fieldCss+'"')}out.push(' style="');if(/px$/i.test(width)||/auto/i.test(width)||/%$/i.test(width)){out.push("width:"+width+";")}else{if(width){out.push("width:"+width+"px;")}}if(align){out.push("text-align:"+align+";")}if(labelAlign=="top"){out.push("clear:both;")}out.push('">');out.push("</li>");return out.join("")},_buliderSpaceContainer:function(field){var g=this,p=this.options;var spaceWidth=field.space||field.spaceWidth||p.space;if(field.space===0||field.spaceWidth===0){spaceWidth=0}var out=[];out.push("<li");if(p.spaceCss){out.push(' class="'+p.spaceCss+'"')}out.push(' style="');if(/px$/i.test(spaceWidth)||/auto/i.test(spaceWidth)||/%$/i.test(spaceWidth)){out.push("width:"+spaceWidth+";")}if(spaceWidth){out.push("width:"+spaceWidth+"px;")}out.push('">');out.push("</li>");return out.join("")},_getInputAttrHtml:function(field){var out=[],type=(field.type||"text").toLowerCase();if(type=="textarea"){field.cols&&out.push('cols="'+field.cols+'" ');field.rows&&out.push('rows="'+field.rows+'" ')}out.push('ltype="'+type+'" ');field.op&&out.push('op="'+field.op+'" ');field.vt&&out.push('vt="'+field.vt+'" ');if(field.attr){for(var attrp in field.attr){out.push(attrp+'="'+field.attr[attrp]+'" ')}}return out.join("")},_setTab:function(tab){var g=this,p=this.options;if(!tab||!tab.items){return}var jtab=$('<div class="l-form-tabs"></div>').appendTo(g.element);var jtabNav=$('<ul class="'+p.clsTab+'" original-title="">').appendTo(jtab);for(var i=0;i<tab.items.length;i++){var tabItem=tab.items[i],jnavItem=$('<li class="'+p.clsTabItem+'"><a href="javascript:void(0)"></a></li>').appendTo(jtabNav),jcontentItem=$('<div class="'+p.clsTabContent+'">').appendTo(jtab),idPrev=g.id+"|tdb"+i;jnavItem.add(jcontentItem).attr("data-index",i);if(tabItem.id){jnavItem.attr("data-id",tabItem.id)}jnavItem.find("a:first").text(tabItem.title);g._initFieldsValidate({fields:tabItem.fields});g._initFieldsHtml({panel:jcontentItem,fields:tabItem.fields,tabindex:i,idPrev:idPrev});g._createEditors({fields:tabItem.fields,idPrev:idPrev,editPrev:"tab"+i+"_"})}jtabNav.find("li").click(function(){$(this).addClass(p.clsTabItemSelected)},function(){$(this).removeClass(p.clsTabItemSelected)}).click(function(){var index=$(this).attr("data-index");g.selectTab(index)});g.selectTab(0)},selectTab:function(index){var g=this,p=this.options;var jtab=$(g.element).find(".l-form-tabs:first");var links=jtab.find(".ui-tabs-nav li"),contents=jtab.find(".ui-tabs-panel");links.filter("[data-index="+index+"]").addClass(p.clsTabItemSelected);links.filter("[data-index!="+index+"]").removeClass(p.clsTabItemSelected);contents.filter("[data-index="+index+"]").show();contents.filter("[data-index!="+index+"]").hide()},destroy:function(){try{var g=this,p=this.options;liger.remove(this);for(var index in g.editors){var control=g.editors[index].control;if(control&&control.destroy){control.destroy()}}$(g.element).remove()}catch(e){}}});function getInvalidInf(errorList){var out=[];$(errorList).each(function(i,error){var label=$(error.element).parents("li:first").prev("li:first").html();var message=error.message;out.push("<div>"+label+" "+message+"</div>")});return out.join("")}})(jQuery);(function($){var l=$.ligerui;$.fn.ligerGrid=function(options){return $.ligerui.run.call(this,"ligerGrid",arguments)};$.fn.ligerGetGridManager=function(){return $.ligerui.run.call(this,"ligerGetGridManager",arguments)};$.ligerDefaults.Grid={title:null,width:"auto",height:"auto",columnWidth:null,resizable:true,url:false,urlParms:null,data:null,usePager:true,hideLoadButton:false,pagerRender:null,page:1,pageSize:10,pageSizeOptions:[10,20,30,40,50],parms:[],columns:[],minColToggle:1,dataType:"server",dataAction:"server",showTableToggleBtn:false,switchPageSizeApplyComboBox:false,allowAdjustColWidth:true,checkbox:false,isSingleCheck:false,allowHideColumn:true,enabledEdit:false,isScroll:true,dateFormat:"yyyy-MM-dd",inWindow:true,statusName:"__status",method:"post",async:true,fixedCellHeight:true,heightDiff:0,cssClass:null,root:"Rows",record:"Total",pageParmName:"page",pagesizeParmName:"pagesize",sortnameParmName:"sortname",sortorderParmName:"sortorder",allowUnSelectRow:false,alternatingRow:true,mouseoverRowCssClass:"",enabledSort:true,rowClsRender:null,rowAttrRender:null,groupColumnName:null,groupColumnDisplay:"分组",groupRender:null,totalRender:null,delayLoad:false,where:null,selectRowButtonOnly:false,selectable:true,whenRClickToSelect:false,contentType:null,checkboxColWidth:27,detailColWidth:29,clickToEdit:true,detailToEdit:false,onEndEdit:null,minColumnWidth:80,tree:null,isChecked:null,isSelected:null,frozen:true,frozenDetail:false,frozenCheckbox:true,detail:null,detailHeight:260,isShowDetailToggle:null,rownumbers:false,frozenRownumbers:true,rownumbersColWidth:26,colDraggable:false,rowDraggable:false,rowDraggingRender:null,autoCheckChildren:true,onRowDragDrop:null,rowHeight:28,headerRowHeight:28,toolbar:null,toolbarShowInLeft:true,headerImg:null,editorTopDiff:3,editorLeftDiff:1,editorHeightDiff:-1,unSetValidateAttr:true,autoFilter:false,rowSelectable:true,scrollToPage:false,scrollToAppend:true,onDragCol:null,onToggleCol:null,onChangeSort:null,onSuccess:null,onDblClickRow:null,onSelectRow:null,onBeforeSelectRow:null,onUnSelectRow:null,onBeforeCheckRow:null,onCheckRow:null,onBeforeCheckAllRow:null,onCheckAllRow:null,onBeforeShowData:null,onAfterShowData:null,onError:null,onSubmit:null,onReload:null,onToFirst:null,onToPrev:null,onToNext:null,onToLast:null,onAfterAddRow:null,onBeforeEdit:null,onBeforeSubmitEdit:null,onAfterEdit:null,onLoading:null,onLoaded:null,onContextmenu:null,onBeforeCancelEdit:null,onAfterSubmitEdit:null,onRowDragDrop:null,onGroupExtend:null,onGroupCollapse:null,onTreeExpand:null,onTreeCollapse:null,onTreeExpanded:null,onTreeCollapsed:null,onLoadData:null,onHeaderCellBulid:null,onEnter:null,selectByKey:false};$.ligerDefaults.GridString={errorMessage:"Error",pageStatMessage:$l("sys.hand.grid.pageinfo"),pageTextMessage:"Page",loadingMessage:$l("sys.hand.tip.loading"),findTextMessage:$l("sys.hand.btn.query"),noRecordMessage:"没有符合条件的记录存在",isContinueByDataChanged:"数据已经改变,如果继续将丢失数据,是否继续?",cancelMessage:$l("sys.hand.btn.cancel"),saveMessage:$l("sys.hand.btn.save"),applyMessage:$l("sys.hand.btn.ok"),draggingMessage:"{count}"};$.ligerDefaults.Grid_columns={id:null,name:null,totalSummary:null,display:null,headerRender:null,isAllowHide:true,isSort:false,type:null,columns:null,width:120,minWidth:80,format:null,align:"left",hide:false,editor:null,render:null,textField:null};$.ligerDefaults.Grid_editor={type:null,ext:null,onChange:null,onChanged:null};$.ligerMethos.Grid=$.ligerMethos.Grid||{};$.ligerDefaults.Grid.sorters=$.ligerDefaults.Grid.sorters||{};$.ligerDefaults.Grid.formatters=$.ligerDefaults.Grid.formatters||{};$.ligerDefaults.Grid.editors=$.ligerDefaults.Grid.editors||{};$.ligerDefaults.Grid.sorters.date=function(val1,val2){return val1<val2?-1:val1>val2?1:0};$.ligerDefaults.Grid.sorters["int"]=function(val1,val2){return parseInt(val1)<parseInt(val2)?-1:parseInt(val1)>parseInt(val2)?1:0};$.ligerDefaults.Grid.sorters["float"]=function(val1,val2){return parseFloat(val1)<parseFloat(val2)?-1:parseFloat(val1)>parseFloat(val2)?1:0};$.ligerDefaults.Grid.sorters.string=function(val1,val2){if(!val1){return false}return val1.localeCompare(val2)};$.ligerDefaults.Grid.formatters.date=function(value,column){function getFormatDate(date,dateformat){var g=this,p=this.options;if(isNaN(date)){return null}var format=dateformat;var o={"M+":date.getMonth()+1,"d+":date.getDate(),"h+":date.getHours(),"m+":date.getMinutes(),"s+":date.getSeconds(),"q+":Math.floor((date.getMonth()+3)/3),S:date.getMilliseconds()};if(/(y+)/.test(format)){format=format.replace(RegExp.$1,(date.getFullYear()+"").substr(4-RegExp.$1.length))}for(var k in o){if(new RegExp("("+k+")").test(format)){format=format.replace(RegExp.$1,RegExp.$1.length==1?o[k]:("00"+o[k]).substr((""+o[k]).length))}}return format}if(!value){return""}if(typeof(value)=="string"&&/^\/Date/.test(value)){value=value.replace(/^\//,"new ").replace(/\/$/,"");eval("value = "+value)}if(value instanceof Date){var format=column.format||this.options.dateFormat||"yyyy-MM-dd";return getFormatDate(value,format)}else{return value.toString()}};$.ligerDefaults.Grid.formatters.ref=function(value){if($.isArray(value)){return value.length>1?value[1]:value[0]}return value};$.ligerui.controls.Grid=function(element,options){$.ligerui.controls.Grid.base.constructor.call(this,element,options)};$.ligerui.controls.Grid.ligerExtend($.ligerui.core.UIComponent,{__getType:function(){return"$.ligerui.controls.Grid"},__idPrev:function(){return"grid"},_extendMethods:function(){return $.ligerMethos.Grid},_init:function(){$.ligerui.controls.Grid.base._init.call(this);var g=this,p=this.options;p.dataType=p.url?"server":"local";if(p.dataType=="local"){p.data=p.data||[];p.dataAction="local"}if(p.isScroll==false){p.height="auto"}if(!p.frozen){p.frozenCheckbox=false;p.frozenDetail=false;p.frozenRownumbers=false}if(p.detailToEdit){p.enabledEdit=true;p.clickToEdit=false;p.detail={height:"auto",onShowDetail:function(record,container,callback){$(container).addClass("l-grid-detailpanel-edit");g.beginEdit(record,function(rowdata,column){var editContainer=$("<div class='l-editbox'></div>");editContainer.width(120).height(p.rowHeight+1);editContainer.appendTo(container);return editContainer});function removeRow(){$(container).parent().parent().remove();g.collapseDetail(record)}$("<div class='l-clear'></div>").appendTo(container);$("<div class='l-button'>"+p.saveMessage+"</div>").appendTo(container).click(function(){g.endEdit(record);removeRow()});$("<div class='l-button'>"+p.applyMessage+"</div>").appendTo(container).click(function(){g.submitEdit(record)});$("<div class='l-button'>"+p.cancelMessage+"</div>").appendTo(container).click(function(){g.cancelEdit(record);removeRow()})}}}if(p.tree){p.tree.childrenName=p.tree.childrenName||"children";p.tree.isParent=p.tree.isParent||function(rowData){var exist=p.tree.childrenName in rowData;return exist};p.tree.isExtend=p.tree.isExtend||function(rowData){if("isextend" in rowData&&rowData.isextend==false){return false}return true}}for(var type in liger.editors){var editor=liger.editors[type];if(!editor||type in p.editors){continue}p.editors[type]=liger.getEditor($.extend({type:type,master:g},editor))}},_render:function(){var g=this,p=this.options;g.grid=$(g.element);g.grid.addClass("l-panel");g.grid.attr("tabindex",0);var gridhtmlarr=[];gridhtmlarr.push("        <div class='l-panel-header'><span class='l-panel-header-text'></span></div>");gridhtmlarr.push("                    <div class='l-grid-loading'></div>");gridhtmlarr.push("        <div class='l-panel-topbar' style='display:none'><div class='l-panel-topbarinner'></div></div><div class='l-clear'></div>");gridhtmlarr.push("        <div class='l-panel-bwarp'>");gridhtmlarr.push("            <div class='l-panel-body'>");gridhtmlarr.push("                <div class='l-grid'>");gridhtmlarr.push("                    <div class='l-grid-dragging-line'></div>");gridhtmlarr.push("                    <div class='l-grid-popup'><table cellpadding='0' cellspacing='0'><tbody></tbody></table></div>");gridhtmlarr.push("                  <div class='l-grid1'>");gridhtmlarr.push("                      <div class='l-grid-header l-grid-header1'>");gridhtmlarr.push("                          <div class='l-grid-header-inner'><table class='l-grid-header-table' cellpadding='0' cellspacing='0'><tbody></tbody></table></div>");gridhtmlarr.push("                      </div>");gridhtmlarr.push("                      <div class='l-grid-body l-grid-body1'>");gridhtmlarr.push("                      </div>");gridhtmlarr.push("                  </div>");gridhtmlarr.push("                  <div class='l-grid2'>");gridhtmlarr.push("                      <div class='l-grid-header l-grid-header2'>");gridhtmlarr.push("                          <div class='l-grid-header-inner'><table class='l-grid-header-table' cellpadding='0' cellspacing='0'><tbody></tbody></table></div>");gridhtmlarr.push("                      </div>");gridhtmlarr.push("                      <div class='l-grid-body l-grid-body2 l-scroll'>");gridhtmlarr.push("                      </div>");gridhtmlarr.push("                  </div>");gridhtmlarr.push("                 </div>");gridhtmlarr.push("              </div>");gridhtmlarr.push("         </div>");gridhtmlarr.push("         <div class='l-panel-bar'>");gridhtmlarr.push("            <div class='l-panel-bbar-inner'>");gridhtmlarr.push("                <div class='l-bar-group  l-bar-message'><span class='l-bar-text'></span></div>");if(p.pageSizeBtn!==false){gridhtmlarr.push("            <div class='l-bar-group l-bar-selectpagesize'></div>")}gridhtmlarr.push("                <div class='l-bar-separator'></div>");gridhtmlarr.push("                <div class='l-bar-group'>");gridhtmlarr.push("                    <div class='l-bar-button l-bar-btnfirst'><span></span></div>");gridhtmlarr.push("                    <div class='l-bar-button l-bar-btnprev'><span></span></div>");gridhtmlarr.push("                </div>");gridhtmlarr.push("                <div class='l-bar-separator'></div>");gridhtmlarr.push("                <div class='l-bar-group'><span class='pcontrol'> <input type='text' size='4' value='1' style='width:20px' maxlength='3' /> / <span></span></span></div>");gridhtmlarr.push("                <div class='l-bar-separator'></div>");gridhtmlarr.push("                <div class='l-bar-group'>");gridhtmlarr.push("                     <div class='l-bar-button l-bar-btnnext'><span></span></div>");gridhtmlarr.push("                    <div class='l-bar-button l-bar-btnlast'><span></span></div>");gridhtmlarr.push("                </div>");gridhtmlarr.push("                <div class='l-bar-separator'></div>");if(p.refreshBtn!==false){gridhtmlarr.push("                <div class='l-bar-group'>");gridhtmlarr.push("                     <div class='l-bar-button l-bar-btnload'><span></span></div>");gridhtmlarr.push("                </div>");gridhtmlarr.push("                <div class='l-bar-separator'></div>")}gridhtmlarr.push("                <div class='l-clear'></div>");gridhtmlarr.push("            </div>");gridhtmlarr.push("         </div>");g.grid.html(gridhtmlarr.join(""));g.header=$(".l-panel-header:first",g.grid);g.body=$(".l-panel-body:first",g.grid);g.toolbar=$(".l-panel-bar:first",g.grid);g.popup=$(".l-grid-popup:first",g.grid);g.gridloading=$(".l-grid-loading:first",g.grid);g.draggingline=$(".l-grid-dragging-line",g.grid);g.topbar=$(".l-panel-topbarinner:first",g.grid);g.gridview=$(".l-grid:first",g.grid);g.gridview.attr("id",g.id+"grid");g.gridview1=$(".l-grid1:first",g.gridview);g.gridview2=$(".l-grid2:first",g.gridview);g.gridheader=$(".l-grid-header:first",g.gridview2);g.gridbody=$(".l-grid-body:first",g.gridview2);if(p.autoFilter){var item={text:"高级查询",gridid:g.id,click:function(){g.showFilter()},icon:"search2"};if(p.toolbar&&p.toolbar.items){p.toolbar.items.push(item)}else{p.toolbar={items:[item]}}}g.f={};g.f.gridheader=$(".l-grid-header:first",g.gridview1);g.f.gridbody=$(".l-grid-body:first",g.gridview1);g.currentData=null;g.changedCells={};g.editors={};g.editor={editing:false};g.cacheData={};if(p.height=="auto"){g.bind("SysGridHeightChanged",function(){if(g.enabledFrozen()){g.gridview.height(Math.max(g.gridview1.height(),g.gridview2.height()))}})}var pc=$.extend({},p);this._bulid();this._setColumns(p.columns);delete pc.columns;delete pc.data;delete pc.url;g.set(pc);if(!p.delayLoad){if(p.url){g.set({url:p.url})}else{if(p.data){g.set({data:p.data})}}}},_setFrozen:function(frozen){if(frozen){this.grid.addClass("l-frozen")}else{this.grid.removeClass("l-frozen")}},_setCssClass:function(value){this.grid.addClass(value)},_setLoadingMessage:function(value){this.gridloading.html(value)},_setToolbar:function(value){var g=this,p=this.options;if(value&&$.fn.ligerToolBar){g.topbar.parent().show();g.toolbarManager=g.topbar.ligerToolBar(value);if(value.title){var jtitle=$("<div class='l-panel-topbartitle'><span>"+value.title+"</span></div>");if(value.icon){jtitle.append("<img class='l-panel-topbaricon' src='"+value.icon+"'></img>");jtitle.addClass("l-panel-topbartitle-hasicon")}g.topbar.parent().append(jtitle)}if(p.toolbarShowInLeft){g.topbar.addClass("l-panel-topbarinner-left")}}else{g.topbar.parent().remove()}},isHorizontalScrollShowed:function(){var g=this;var inner=g.gridbody.find(".l-grid-body-inner:first");if(!inner.length){return false}return g.gridbody.width()-20<inner.width()},_setHeight:function(h){var g=this,p=this.options;g.unbind("SysGridHeightChanged");if(h=="auto"){g.bind("SysGridHeightChanged",function(){if(g.enabledFrozen()){g.gridview.height(Math.max(g.gridview1.height(),g.gridview2.height()))}});return}h=g._calculateGridBodyHeight(h);if(h>0){g.gridbody.height(h);if(p.frozen){var w=g.gridbody.width(),w2=$(":first-child",g.gridbody).width();if(w2&&(w2+18>w)){if(h>18){g.f.gridbody.height(h-18)}}else{g.f.gridbody.height(h)}}var gridHeaderHeight=p.headerRowHeight*(g._columnMaxLevel-1)+p.headerRowHeight-1;g.gridview.height(h+gridHeaderHeight)}g._updateHorizontalScrollStatus.ligerDefer(g,10)},_calculateGridBodyHeight:function(h){var g=this,p=this.options;if(typeof h=="string"&&h.indexOf("%")>0){if(p.inWindow){h=$(window).height()*parseInt(h)*0.01}else{h=g.grid.parent().height()*parseInt(h)*0.01}}if(p.title){h-=24}if(p.usePager&&p.pagerRender||!p.scrollToPage){h-=g.toolbar.outerHeight()}if(p.totalRender){h-=25}if(p.toolbar){h-=g.topbar.outerHeight()}var gridHeaderHeight=p.headerRowHeight*(g._columnMaxLevel-1)+p.headerRowHeight-1;h-=(gridHeaderHeight||0);return h},_updateHorizontalScrollStatus:function(){var g=this,p=this.options;if(g.isHorizontalScrollShowed()){g.gridview.addClass("l-grid-hashorizontal")}else{g.gridview.removeClass("l-grid-hashorizontal")}},_updateFrozenWidth:function(){var g=this,p=this.options;if(g.enabledFrozen()){g.gridview1.width(g.f.gridtablewidth);var view2width=g.gridview.width()-g.f.gridtablewidth;g.gridview2.css({left:g.f.gridtablewidth});if(view2width>0){g.gridview2.css({width:view2width})}}},_setWidth:function(value){var g=this,p=this.options;if(g.enabledFrozen()){g._onResize()}},_setUrl:function(value){this.options.url=value;if(value){this.options.dataType="server";this.loadData(true)}else{this.options.dataType="local"}},removeParm:function(name){var g=this;var parms=g.get("parms");if(!parms){parms={}}if(parms instanceof Array){removeArrItem(parms,function(p){return p.name==name})}else{delete parms[name]}g.set("parms",parms)},setParm:function(name,value){var g=this;var parms=g.get("parms");if(!parms){parms={}}if(parms instanceof Array){removeArrItem(parms,function(p){return p.name==name});parms.push({name:name,value:value})}else{parms[name]=value}g.set("parms",parms)},_setData:function(value){this.loadData(this.options.data);this.trigger("afterSetData")},loadData:function(loadDataParm,sourceType){var g=this,p=this.options;g.loading=true;g.deletedRows=[];g.trigger("loadData");var clause=null;var loadServer=true;if(typeof(loadDataParm)=="function"){clause=loadDataParm;if(g.lastData){g.data=g.lastData}else{g.data=g.currentData;if(!g.data){g.data={}}if(!g.data[p.root]){g.data[p.root]=[]}g.lastData=g.data}loadServer=false}else{if(typeof(loadDataParm)=="boolean"){loadServer=loadDataParm}else{if(typeof(loadDataParm)=="object"&&loadDataParm){loadServer=false;p.dataType="local";p.data=loadDataParm}else{if(typeof(loadDataParm)=="number"){p.newPage=loadDataParm}}}}if(!p.newPage){p.newPage=1}if(p.dataAction=="server"){if(!p.sortOrder){p.sortOrder="asc"}}var param=[];if(p.parms){var parms=$.isFunction(p.parms)?p.parms():p.parms;if(parms.length){$(parms).each(function(){param.push({name:this.name,value:this.value})});for(var i=parms.length-1;i>=0;i--){if(parms[i].temp){parms.splice(i,1)}}}else{if(typeof parms=="object"){for(var name in parms){param.push({name:name,value:parms[name]})}}}}if(p.dataAction=="server"){if(p.usePager){if(p.pagerHandler){p.pagerHandler.call(window,param,p)}else{param.push({name:p.pageParmName,value:p.newPage});param.push({name:p.pagesizeParmName,value:p.pageSize})}}if(p.sortName){param.push({name:p.sortnameParmName,value:p.sortName});param.push({name:p.sortorderParmName,value:p.sortOrder})}}$(".l-bar-btnload span",g.toolbar).addClass("l-disabled");if(p.dataType=="local"){g.filteredData=$.extend(true,{},p.data||g.currentData);if(clause){g.filteredData[p.root]=g._searchData(g.filteredData[p.root],clause)}if(p.usePager){g.currentData=g._getCurrentPageData(g.filteredData)}else{g.currentData=g.filteredData}g._convertTreeData();g._showData()}else{if(p.dataAction=="local"&&!loadServer){if(g.data&&g.data[p.root]){g.filteredData=g.data;if(clause){g.filteredData[p.root]=g._searchData(g.filteredData[p.root],clause)}g.currentData=g._getCurrentPageData(g.filteredData);g._convertTreeData();g._showData()}}else{g.loadServerData(param,clause,sourceType)}}g.loading=false},_convertTreeData:function(){var g=this,p=this.options;if(p.tree&&p.tree.idField&&p.tree.parentIDField){g.currentData[p.root]=g.arrayToTree(g.currentData[p.root],p.tree.idField,p.tree.parentIDField);g.currentData[p.record]=g.currentData[p.root].length}},loadServerData:function(param,clause,sourceType){var g=this,p=this.options;var url=p.url;if($.isFunction(url)){url=url.call(g)}var urlParms=$.isFunction(p.urlParms)?p.urlParms.call(g):p.urlParms;if(urlParms){for(name in urlParms){url+=url.indexOf("?")==-1?"?":"&";url+=name+"="+urlParms[name]}}var ajaxOptions={type:p.method,url:url,data:param,async:p.async,dataType:"json",beforeSend:function(){if(g.hasBind("loading")){g.trigger("loading")}else{g.toggleLoading(true)}},success:function(data){g.trigger("success",[data,g]);if(!data||!data[p.root]||!data[p.root].length){g.currentData=g.data={};g.currentData[p.root]=g.data[p.root]=[];if(data&&data[p.record]){g.currentData[p.record]=g.data[p.record]=data[p.record]}else{g.currentData[p.record]=g.data[p.record]=0}g._convertTreeData();g._showData(sourceType);return}g.data=data;if(g.data[p.record]!=null){g.cacheData.records=g.data[p.record]}if(p.dataAction=="server"){g.currentData=g.data;if(g.currentData[p.record]==null&&g.cacheData.records){g.currentData[p.record]=g.cacheData.records}}else{g.filteredData=g.data;if(clause){g.filteredData[p.root]=g._searchData(g.filteredData[p.root],clause)}if(p.usePager){g.currentData=g._getCurrentPageData(g.filteredData)}else{g.currentData=g.filteredData}}g._convertTreeData();g._showData.ligerDefer(g,10,[sourceType])},complete:function(){g.trigger("complete",[g]);if(g.hasBind("loaded")){g.trigger("loaded",[g])}else{g.toggleLoading.ligerDefer(g,10,[false])}},error:function(XMLHttpRequest,textStatus,errorThrown){g.currentData=g.data={};g.currentData[p.root]=g.data[p.root]=[];g.currentData[p.record]=g.data[p.record]=0;g.toggleLoading.ligerDefer(g,10,[false]);$(".l-bar-btnload span",g.toolbar).removeClass("l-disabled");g.trigger("error",[XMLHttpRequest,textStatus,errorThrown])}};if(p.contentType){ajaxOptions.contentType=p.contentType}if(p.contentType=="application/json"&&typeof(parms)!="string"){ajaxOptions.data=converParmJson(param)}$.ajax(ajaxOptions);function converParmJson(parm){if(!parm){return"null"}var o=parm,result={};if($.isArray(o)){for(var i=0;i<o.length;i++){result[o[i].name]=o[i].value}}else{result=o}return liger.toJSON(result)}},toggleLoading:function(show){this.gridloading[show?"show":"hide"]()},_createEditor:function(editorBuilder,container,editParm,width,height){var editor=editorBuilder.create.call(this,container,editParm);if(editorBuilder.setValue){editorBuilder.setValue.call(this,editor,editParm.value,editParm)}if(editParm.column.editor&&editParm.column.editor.initSelect){if(editor.element&&$(editor.element).is(":text")){$(editor.element).select()}if(editor instanceof jQuery){if(editor.is(":text")){editor.select()}else{editor.find(":text").select()}}}if(editorBuilder.setText&&editParm.column.textField){editorBuilder.setText.call(this,editor,editParm.text,editParm)}if(editorBuilder.resize){editorBuilder.resize.call(this,editor,width,height,editParm)}return editor},beginEdit:function(rowParm,containerBulider){var g=this,p=this.options;if(!p.enabledEdit){return}var rowdata=g.getRow(rowParm);if(rowdata._editing){return}if(g.trigger("beginEdit",{record:rowdata,rowindex:rowdata.__index})==false){return}g.editors[rowdata.__id]={};rowdata._editing=true;g.reRender({rowdata:rowdata});containerBulider=containerBulider||function(rowdata,column){var cellobj=g.getCellObj(rowdata,column);var container=$(cellobj).html("");g.setCellEditing(rowdata,column,true);return container};for(var i=0,l=g.columns.length;i<l;i++){var column=g.columns[i];if(!column.name||!column.editor||!column.editor.type||!p.editors[column.editor.type]){continue}var editor=p.editors[column.editor.type];var editParm={record:rowdata,value:g._getValueByName(rowdata,column.name),column:column,rowindex:rowdata.__index,grid:g};var container=containerBulider(rowdata,column);var width=container.width(),height=container.height();var editorControl=g._createEditor(editor,container,editParm,width,height);g.editors[rowdata.__id][column.__id]={editor:editor,input:editorControl,editParm:editParm,container:container}}g.trigger("afterBeginEdit",{record:rowdata,rowindex:rowdata.__index})},cancelEdit:function(rowParm){var g=this;if(rowParm==undefined){for(var rowid in g.editors){g.cancelEdit(rowid)}}else{var rowdata=g.getRow(rowParm);if(!g.editors[rowdata.__id]){return}if(g.trigger("beforeCancelEdit",{record:rowdata,rowindex:rowdata.__index})==false){return}for(var columnid in g.editors[rowdata.__id]){var o=g.editors[rowdata.__id][columnid];if(o.editor.destroy){o.editor.destroy(o.input,o.editParm)}}delete g.editors[rowdata.__id];delete rowdata._editing;g.reRender({rowdata:rowdata})}},addEditRow:function(rowdata,containerBulider){this.submitEdit();rowdata=this.add(rowdata);this.beginEdit(rowdata,containerBulider)},submitEdit:function(rowParm){var g=this,p=this.options;if(rowParm==undefined){for(var rowid in g.editors){g.submitEdit(rowid)}}else{var rowdata=g.getRow(rowParm);var newdata={};if(!g.editors[rowdata.__id]){return}for(var columnid in g.editors[rowdata.__id]){var o=g.editors[rowdata.__id][columnid];var column=o.editParm.column;if(column.name){newdata[column.name]=o.editor.getValue(o.input,o.editParm)}if(column.textField&&o.editor.getText){newdata[column.textField]=o.editor.getText(o.input,o.editParm)}}if(g.trigger("beforeSubmitEdit",{record:rowdata,rowindex:rowdata.__index,newdata:newdata})==false){return false}g.updateRow(rowdata,newdata);g.trigger("afterSubmitEdit",{record:rowdata,rowindex:rowdata.__index,newdata:newdata})}},_enabledEditByCell:function(cell){var g=this,p=this.options;var column=g.getColumn(cell);if(!column){return false}return column.editor&&column.editor.type},endEditToNext:function(){var g=this,p=this.options;var editor=g.editor,jnext=null,jprev=null;if(editor){var editParm=editor.editParm;var column=editParm.column;var columnIndex=$.inArray(column,g.columns);var cell=g.getCellObj(editParm.record,editParm.column);jprev=$(cell);jnext=jprev.next();if(!jnext.length){jnext=getNextRowCell()}if(jnext.length){while(!g._enabledEditByCell(jnext.get(0))){jprev=jnext;jnext=jnext.next();if(!jnext.length){jnext=getNextRowCell()}}}function getNextRowCell(){return jprev.parent("tr").next(".l-grid-row").find("td:first")}}g.endEdit();if(jnext&&jnext.length){g._applyEditor(jnext.get(0))}},endEdit:function(rowParm){var g=this,p=this.options;if(g.editor.editing){var o=g.editor;o.input.element.blur();g.trigger("sysEndEdit",[o.editParm]);g.trigger("endEdit",[o.editParm]);if(o.editor.destroy){o.editor.destroy(o.input,o.editParm)}o.container.remove();g.reRender({rowdata:o.editParm.record,column:o.editParm.column});g.trigger("afterEdit",[o.editParm]);g.editor={editing:false}}else{if(rowParm!=undefined){var rowdata=g.getRow(rowParm);if(!g.editors[rowdata.__id]){return}if(g.submitEdit(rowParm)==false){return false}for(var columnid in g.editors[rowdata.__id]){var o=g.editors[rowdata.__id][columnid];if(o.editor.destroy){o.editor.destroy(o.input,o.editParm)}}delete g.editors[rowdata.__id];delete rowdata._editing;g.trigger("afterEdit",{record:rowdata,rowindex:rowdata.__index})}else{for(var rowid in g.editors){g.endEdit(rowid)}}}g._fixHeight.ligerDefer(g,10)},setWidth:function(w){return this._setWidth(w)},setHeight:function(h){return this._setHeight(h)},enabledCheckbox:function(){return this.options.checkbox?true:false},enabledFrozen:function(){var g=this,p=this.options;if(!p.frozen){return false}var cols=g.columns||[];if(g.enabledDetail()&&p.frozenDetail||g.enabledCheckbox()&&p.frozenCheckbox||p.frozenRownumbers&&p.rownumbers){return true}for(var i=0,l=cols.length;i<l;i++){if(cols[i].frozen){return true}}this._setFrozen(false);return false},enabledDetailEdit:function(){if(!this.enabledDetail()){return false}return this.options.detailToEdit?true:false},enabledDetail:function(){if(this.options.detail&&this.options.detail.onShowDetail){return true}return false},enabledGroup:function(){return this.options.groupColumnName?true:false},deleteSelectedRow:function(){if(!this.selected){return}for(var i in this.selected){var o=this.selected[i];if(o.__id in this.records){this._deleteData.ligerDefer(this,10,[o])}}this.reRender.ligerDefer(this,20)},removeRange:function(rowArr){var g=this,p=this.options;$.each(rowArr,function(){g._removeData(this)});g.reRender()},remove:function(rowParm){var g=this,p=this.options;var rowdata=g.getRow(rowParm);g._removeData(rowParm);g.reRender()},deleteRange:function(rowArr){var g=this,p=this.options;$.each(rowArr,function(){g._deleteData(this)});g.reRender()},deleteRow:function(rowParm){var g=this,p=this.options;var rowdata=g.getRow(rowParm);if(!rowdata){return}g._deleteData(rowdata);g.reRender();g.isDataChanged=true},_deleteData:function(rowParm){var g=this,p=this.options;var rowdata=g.getRow(rowParm);rowdata[p.statusName]="delete";if(p.tree){var children=g.getChildren(rowdata,true);if(children){for(var i=0,l=children.length;i<l;i++){children[i][p.statusName]="delete"}}}g.deletedRows=g.deletedRows||[];g.deletedRows.push(rowdata);g._removeSelected(rowdata)},updateCell:function(arg,value,rowParm){var g=this,p=this.options;var column,cellObj,rowdata;if(typeof(arg)=="string"){for(var i=0,l=g.columns.length;i<l;i++){if(g.columns[i].name==arg){g.updateCell(i,value,rowParm)}}return}if(typeof(arg)=="number"){column=g.columns[arg];rowdata=g.getRow(rowParm);cellObj=g.getCellObj(rowdata,column)}else{if(typeof(arg)=="object"&&arg.__id){column=arg;rowdata=g.getRow(rowParm);cellObj=g.getCellObj(rowdata,column)}else{cellObj=arg;var ids=cellObj.id.split("|");var columnid=ids[ids.length-1];column=g._columns[columnid];var row=$(cellObj).parent();rowdata=rowdata||g.getRow(row[0])}}if(value!=null&&column.name){g._setValueByName(rowdata,column.name,value);if(rowdata[p.statusName]!="add"){rowdata[p.statusName]="update"}g.isDataChanged=true}g.reRender({rowdata:rowdata,column:column})},addRows:function(rowdataArr,neardata,isBefore,parentRowData){var g=this,p=this.options;$(rowdataArr).each(function(){g.addRow(this,neardata,isBefore,parentRowData)})},_createRowid:function(){return"r"+(1000+this.recordNumber)},_isRowId:function(str){return(str in this.records)},_addNewRecord:function(o,previd,pid){var g=this,p=this.options;g.recordNumber++;o.__id=g._createRowid();o.__previd=previd;if(previd&&previd!=-1){var prev=g.records[previd];if(prev.__nextid&&prev.__nextid!=-1){var prevOldNext=g.records[prev.__nextid];if(prevOldNext){prevOldNext.__previd=o.__id}}prev.__nextid=o.__id;o.__index=prev.__index+1}else{o.__index=0}if(p.tree){if(pid&&pid!=-1){var parent=g.records[pid];o.__pid=pid;o.__level=parent.__level+1}else{o.__pid=-1;o.__level=1}o.__hasChildren=o[p.tree.childrenName]?true:false}o[p.statusName]=o[p.statusName]||"nochanged";g.rows[o.__index]=o;g.records[o.__id]=o;return o},_getRows:function(data){var g=this,p=this.options;var targetData=[];function load(data){if(!data||!data.length){return}for(var i=0,l=data.length;i<l;i++){var o=data[i];targetData.push(o);if(o[p.tree.childrenName]){load(o[p.tree.childrenName])}}}load(data);return targetData},_updateGridData:function(){var g=this,p=this.options;g.rows=[];var previd=-1;if(p.scrollToPage){previd=p.previd}else{g.records={};g.recordNumber=0}function load(data,pid){if(!data||!data.length){return}for(var i=0,l=data.length;i<l;i++){var o=data[i];g.formatRecord(o);if(o[p.statusName]=="delete"){continue}g._addNewRecord(o,previd,pid);previd=o.__id;if(o.__hasChildren){load(o[p.tree.childrenName],o.__id)}}if(p.scrollToPage){p.previd=previd}}load(g.currentData[p.root],-1);return g.rows},_moveData:function(from,to,isAfter){var g=this,p=this.options;var fromRow=g.getRow(from);var toRow=g.getRow(to);var fromIndex,toIndex;var listdata=g._getParentChildren(fromRow);fromIndex=$.inArray(fromRow,listdata);listdata.splice(fromIndex,1);listdata=g._getParentChildren(toRow);toIndex=$.inArray(toRow,listdata);listdata.splice(toIndex+(isAfter?1:0),0,fromRow)},move:function(from,to,isAfter){this._moveData(from,to,isAfter);this.reRender()},moveRange:function(rows,to,isAfter){for(var i in rows){this._moveData(rows[i],to,isAfter)}this.reRender()},up:function(rowParm){var g=this,p=this.options;var rowdata=g.getRow(rowParm);var listdata=g._getParentChildren(rowdata);var index=$.inArray(rowdata,listdata);if(index==-1||index==0){return}var selected=g.getSelected();g.move(rowdata,listdata[index-1],false);g.select(selected)},down:function(rowParm){var g=this,p=this.options;var rowdata=g.getRow(rowParm);var listdata=g._getParentChildren(rowdata);var index=$.inArray(rowdata,listdata);if(index==-1||index==listdata.length-1){return}var selected=g.getSelected();g.move(rowdata,listdata[index+1],true);g.select(selected)},addRow:function(rowdata,neardata,isBefore,parentRowData){var g=this,p=this.options;rowdata=rowdata||{};rowdata[p.statusName]="add";if(p.tree){var children=g.getChildren(rowdata,true);if(children){for(var i=0,l=children.length;i<l;i++){children[i][p.statusName]="add"}}}g._addData(rowdata,parentRowData,neardata,isBefore);g.reRender();g.isDataChanged=true;g.trigger("SysGridHeightChanged");g.trigger("afterAddRow",[rowdata]);return rowdata},updateRow:function(rowDom,newRowData){var g=this,p=this.options;var rowdata=g.getRow(rowDom);g.isDataChanged=true;$.extend(rowdata,newRowData||{});if(rowdata[p.statusName]!="add"){rowdata[p.statusName]="update"}g.reRender.ligerDefer(g,10,[{rowdata:rowdata}]);return rowdata},setCellEditing:function(rowdata,column,editing){var g=this,p=this.options;var cell=g.getCellObj(rowdata,column);var methodName=editing?"addClass":"removeClass";$(cell)[methodName]("l-grid-row-cell-editing");if(rowdata.__id!=0){var prevrowobj=$(g.getRowObj(rowdata.__id)).prev();if(!prevrowobj.length||prevrowobj.length<=0||prevrowobj[0].id==null||prevrowobj[0].id==""){return}var prevrow=g.getRow(prevrowobj[0]);var cellprev=g.getCellObj(prevrow,column);if(!cellprev){return}$(cellprev)[methodName]("l-grid-row-cell-editing-topcell")}if(column.__previd!=-1&&column.__previd!=null){var cellprev=$(g.getCellObj(rowdata,column)).prev();$(cellprev)[methodName]("l-grid-row-cell-editing-leftcell")}},reRender:function(e){var g=this,p=this.options;e=e||{};var rowdata=e.rowdata,column=e.column,totalOnly=e.totalOnly;if(column&&(column.isdetail||column.ischeckbox)){return}if(rowdata&&rowdata[p.statusName]=="delete"){return}if(totalOnly){$(g.columns).each(function(){reRenderTotal(this)})}else{if(rowdata&&column){var cell=g.getCellObj(rowdata,column);$(cell).html(g._getCellHtml(rowdata,column));if(!column.issystem){g.setCellEditing(rowdata,column,false)}}else{if(rowdata){$(g.columns).each(function(){g.reRender({rowdata:rowdata,column:this})})}else{if(column){for(var rowid in g.records){g.reRender({rowdata:g.records[rowid],column:column})}reRenderTotal(column)}else{g._showData()}}}}function reRenderTotal(column){if(!column.totalSummary){return}for(var i=0;i<g.totalNumber;i++){var tobj=document.getElementById(g.id+"|total"+i+"|"+column.__id);$("div:first",tobj).html(g._getTotalCellContent(column,g.groups&&g.groups[i]?g.groups[i]:g.currentData[p.root]))}}},getData:function(status,removeStatus){var g=this,p=this.options;var data=[];if(removeStatus==undefined){removeStatus=true}for(var rowid in g.records){var o=$.extend(true,{},g.records[rowid]);if(o[p.statusName]==status||status==undefined){data.push(g.formatRecord(o,removeStatus))}}return data},formatRecord:function(o,removeStatus){delete o.__id;delete o.__previd;delete o.__nextid;delete o.__index;if(this.options.tree){delete o.__pid;delete o.__level;delete o.__hasChildren}if(removeStatus){delete o[this.options.statusName]}return o},getUpdated:function(){return this.getData("update",true)},getDeleted:function(){return this.deletedRows},getAdded:function(){return this.getData("add",true)},getChanges:function(){var g=this,p=this.options;var data=[];if(this.deletedRows){$(this.deletedRows).each(function(){var o=$.extend(true,{},this);data.push(g.formatRecord(o,false))})}$.merge(data,g.getData("update",false));$.merge(data,g.getData("add",false));return data},getColumn:function(columnParm){var g=this,p=this.options;if(typeof columnParm=="string"){if(g._isColumnId(columnParm)){return g._columns[columnParm]}else{return g.columns[parseInt(columnParm)]}}else{if(typeof(columnParm)=="number"){return g.columns[columnParm]}else{if(typeof columnParm=="object"&&columnParm.nodeType==1){var ids=columnParm.id.split("|");var columnid=ids[ids.length-1];return g._columns[columnid]}}}return columnParm},getColumnByName:function(columnname){var g=this,p=this.options;for(i=0;i<g.columns.length;i++){if(g.columns[i].name==columnname){return g.columns[i]}}return null},getColumnType:function(columnname){var g=this,p=this.options;for(i=0;i<g.columns.length;i++){if(g.columns[i].name==columnname){if(g.columns[i].type){return g.columns[i].type}return"string"}}return null},isTotalSummary:function(){var g=this,p=this.options;for(var i=0;i<g.columns.length;i++){if(g.columns[i].totalSummary){return true}}return false},getColumns:function(columnLevel){var g=this,p=this.options;var columns=[];for(var id in g._columns){var col=g._columns[id];if(columnLevel!=undefined){if(col.__level==columnLevel){columns.push(col)}}else{if(col.__leaf){columns.push(col)}}}return columns},changeSort:function(columnName,sortOrder){var g=this,p=this.options;if(g.loading){return true}if(p.dataAction=="local"){var columnType=g.getColumnType(columnName);if(!g.sortedData){g.sortedData=g.filteredData}if(!g.sortedData||!g.sortedData[p.root]){return}if(p.sortName==columnName){g.sortedData[p.root].reverse()}else{g.sortedData[p.root].sort(function(data1,data2){return g._compareData(data1,data2,columnName,columnType)})}if(p.usePager){g.currentData=g._getCurrentPageData(g.sortedData)}else{g.currentData=g.sortedData}g._showData()}p.sortName=columnName;p.sortOrder=sortOrder;if(p.dataAction=="server"){g.loadData(p.where)}},changePage:function(ctype){var g=this,p=this.options;if(g.loading){return true}if(p.dataAction!="local"&&g.isDataChanged&&!confirm(p.isContinueByDataChanged)){return false}p.pageCount=parseInt($(".pcontrol span",g.toolbar).html());switch(ctype){case"first":if(p.page==1){return}p.newPage=1;break;case"prev":if(p.page==1){return}if(p.page>1){p.newPage=parseInt(p.page)-1}break;case"next":if(p.page>=p.pageCount){return}p.newPage=parseInt(p.page)+1;break;case"last":if(p.page>=p.pageCount){return}p.newPage=p.pageCount;break;case"input":var nv=parseInt($(".pcontrol input",g.toolbar).val());if(isNaN(nv)){nv=1}if(nv<1){nv=1}else{if(nv>p.pageCount){nv=p.pageCount}}$(".pcontrol input",g.toolbar).val(nv);p.newPage=nv;break}if(p.newPage==p.page){return false}if(p.newPage==1){$(".l-bar-btnfirst span",g.toolbar).addClass("l-disabled");$(".l-bar-btnprev span",g.toolbar).addClass("l-disabled")}else{$(".l-bar-btnfirst span",g.toolbar).removeClass("l-disabled");$(".l-bar-btnprev span",g.toolbar).removeClass("l-disabled")}if(p.newPage==p.pageCount){$(".l-bar-btnlast span",g.toolbar).addClass("l-disabled");$(".l-bar-btnnext span",g.toolbar).addClass("l-disabled")}else{$(".l-bar-btnlast span",g.toolbar).removeClass("l-disabled");$(".l-bar-btnnext span",g.toolbar).removeClass("l-disabled")}g.trigger("changePage",[p.newPage]);if(p.dataAction=="server"){if(!p.parms){p.parms=[]}if($.isArray(p.parms)){p.parms.push({name:"changepage",value:"1",temp:true})}else{p.parms.changepage="1"}g.loadData(p.where)}else{g.currentData=g._getCurrentPageData(g.filteredData);if(p.tree){var childrenName=p.tree.childrenName;$(g.filteredData[p.root]).each(function(index,item){if(item[childrenName]){item[childrenName]=[]}});g._convertTreeData()}g._showData()}},getSelectedRow:function(){for(var i in this.selected){var o=this.selected[i];if(o.__id in this.records){return o}}return null},getSelectedRows:function(){var arr=[];for(var i in this.selected){var o=this.selected[i];if(o.__id in this.records){arr.push(o)}}return arr},getSelectedRowObj:function(){for(var i in this.selected){var o=this.selected[i];if(o.__id in this.records){return this.getRowObj(o)}}return null},getSelectedRowObjs:function(){var arr=[];for(var i in this.selected){var o=this.selected[i];if(o.__id in this.records){arr.push(this.getRowObj(o))}}return arr},getCellObj:function(rowParm,column){var rowdata=this.getRow(rowParm);column=this.getColumn(column);return document.getElementById(this._getCellDomId(rowdata,column))},getRowObj:function(rowParm,frozen){var g=this,p=this.options;if(rowParm==null){return null}if(typeof(rowParm)=="string"){if(g._isRowId(rowParm)){return document.getElementById(g.id+(frozen?"|1|":"|2|")+rowParm)}else{return document.getElementById(g.id+(frozen?"|1|":"|2|")+g.rows[parseInt(rowParm)]["__id"])}}else{if(typeof(rowParm)=="number"){return document.getElementById(g.id+(frozen?"|1|":"|2|")+g.rows[rowParm]["__id"])}else{if(typeof(rowParm)=="object"&&rowParm.__id){return g.getRowObj(rowParm.__id,frozen)}}}return rowParm},getRow:function(rowParm){var g=this,p=this.options;if(rowParm==null){return null}if(typeof(rowParm)=="string"){if(g._isRowId(rowParm)){return g.records[rowParm]}else{return g.rows[parseInt(rowParm)]}}else{if(typeof(rowParm)=="number"){return g.rows[parseInt(rowParm)]}else{if(typeof(rowParm)=="object"&&rowParm.nodeType==1&&!rowParm.__id){return g._getRowByDomId(rowParm.id)}}}return rowParm},_setColumnVisible:function(column,hide){var g=this,p=this.options;if(!hide){column._hide=false;document.getElementById(column.__domid).style.display="";if(column.__pid!=-1){var pcol=g._columns[column.__pid];if(pcol._hide){document.getElementById(pcol.__domid).style.display="";this._setColumnVisible(pcol,hide)}}}else{column._hide=true;document.getElementById(column.__domid).style.display="none";if(column.__pid!=-1){var hideall=true;var pcol=this._columns[column.__pid];for(var i=0;pcol&&i<pcol.columns.length;i++){if(!pcol.columns[i]._hide){hideall=false;break}}if(hideall){pcol._hide=true;document.getElementById(pcol.__domid).style.display="none";this._setColumnVisible(pcol,hide)}}}},toggleCol:function(columnparm,visible,toggleByPopup){var g=this,p=this.options;var column;if(typeof(columnparm)=="number"){column=g.columns[columnparm]}else{if(typeof(columnparm)=="object"&&columnparm.__id){column=columnparm}else{if(typeof(columnparm)=="string"){if(g._isColumnId(columnparm)){column=g._columns[columnparm]}else{$(g.columns).each(function(){if(this.name==columnparm){g.toggleCol(this,visible,toggleByPopup)}});return}}}}if(!column){return}var columnindex=column.__leafindex;var headercell=document.getElementById(column.__domid);if(!headercell){return}headercell=$(headercell);var cells=[];for(var i in g.rows){var obj=g.getCellObj(g.rows[i],column);if(obj){cells.push(obj)}}for(var i=0;i<g.totalNumber;i++){var tobj=document.getElementById(g.id+"|total"+i+"|"+column.__id);if(tobj){cells.push(tobj)}}var colwidth=column._width;if(visible&&column._hide){if(column.frozen){g.f.gridtablewidth+=(parseInt(colwidth)+1)}else{g.gridtablewidth+=(parseInt(colwidth)+1)}g._setColumnVisible(column,false);$(cells).show()}else{if(!visible&&!column._hide){if(column.frozen){g.f.gridtablewidth-=(parseInt(colwidth)+1)}else{g.gridtablewidth-=(parseInt(colwidth)+1)}g._setColumnVisible(column,true);$(cells).hide()}}if(column.frozen){$("div:first",g.f.gridheader).width(g.f.gridtablewidth);$("div:first",g.f.gridbody).width(g.f.gridtablewidth)}else{$("div:first",g.gridheader).width(g.gridtablewidth+40);$("div:first",g.gridbody).width(g.gridtablewidth)}g._updateFrozenWidth();if(!toggleByPopup){$(":checkbox[columnindex="+columnindex+"]",g.popup).each(function(){this.checked=visible;if($.fn.ligerCheckBox){var checkboxmanager=$(this).ligerGetCheckBoxManager();if(checkboxmanager){checkboxmanager.updateStyle()}}})}},setColumnWidth:function(columnparm,newwidth){var g=this,p=this.options;if(!newwidth){return}newwidth=parseInt(newwidth,10);var column;if(typeof(columnparm)=="number"){column=g.columns[columnparm]}else{if(typeof(columnparm)=="object"&&columnparm.__id){column=columnparm}else{if(typeof(columnparm)=="string"){if(g._isColumnId(columnparm)){column=g._columns[columnparm]}else{$(g.columns).each(function(){if(this.name==columnparm){g.setColumnWidth(this,newwidth)}});return}}}}if(!column){return}var mincolumnwidth=p.minColumnWidth;if(column.minWidth){mincolumnwidth=column.minWidth}newwidth=newwidth<mincolumnwidth?mincolumnwidth:newwidth;var diff=newwidth-column._width;if(g.trigger("beforeChangeColumnWidth",[column,newwidth])==false){return}column._width=newwidth;if(column.frozen){g.f.gridtablewidth+=diff;$("div:first",g.f.gridheader).width(g.f.gridtablewidth);$("div:first",g.f.gridbody).width(g.f.gridtablewidth)}else{g.gridtablewidth+=diff;$("div:first",g.gridheader).width(g.gridtablewidth+40);$("div:first",g.gridbody).width(g.gridtablewidth)}$(document.getElementById(column.__domid)).css("width",newwidth);var cells=[];for(var rowid in g.records){var obj=g.getCellObj(g.records[rowid],column);if(obj){cells.push(obj)}if(!g.enabledDetailEdit()&&g.editors[rowid]&&g.editors[rowid][column.__id]){var o=g.editors[rowid][column.__id];if(o.editor.resize){o.editor.resize(o.input,newwidth,o.container.height(),o.editParm)}}}for(var i=0;i<g.totalNumber;i++){var tobj=document.getElementById(g.id+"|total"+i+"|"+column.__id);if(tobj){cells.push(tobj)}}$(cells).css("width",newwidth).find("> div.l-grid-row-cell-inner:first").css("width",newwidth-8);g._updateFrozenWidth();g._updateHorizontalScrollStatus.ligerDefer(g,10);g.trigger("afterChangeColumnWidth",[column,newwidth])},changeHeaderText:function(columnparm,headerText){var g=this,p=this.options;var column;if(typeof(columnparm)=="number"){column=g.columns[columnparm]}else{if(typeof(columnparm)=="object"&&columnparm.__id){column=columnparm}else{if(typeof(columnparm)=="string"){if(g._isColumnId(columnparm)){column=g._columns[columnparm]}else{$(g.columns).each(function(){if(this.name==columnparm){g.changeHeaderText(this,headerText)}});return}}}}if(!column){return}var columnindex=column.__leafindex;var headercell=document.getElementById(column.__domid);$(".l-grid-hd-cell-text",headercell).html(headerText);if(p.allowHideColumn){$(":checkbox[columnindex="+columnindex+"]",g.popup).parent().next().html(headerText)}},changeCol:function(from,to,isAfter){var g=this,p=this.options;if(!from||!to){return}var fromCol=g.getColumn(from);var toCol=g.getColumn(to);fromCol.frozen=toCol.frozen;var fromColIndex,toColIndex;var fromColumns=fromCol.__pid==-1?p.columns:g._columns[fromCol.__pid].columns;var toColumns=toCol.__pid==-1?p.columns:g._columns[toCol.__pid].columns;fromColIndex=$.inArray(fromCol,fromColumns);toColIndex=$.inArray(toCol,toColumns);var sameParent=fromColumns==toColumns;var sameLevel=fromCol.__level==toCol.__level;toColumns.splice(toColIndex+(isAfter?1:0),0,fromCol);if(!sameParent){fromColumns.splice(fromColIndex,1)}else{if(isAfter){fromColumns.splice(fromColIndex,1)}else{fromColumns.splice(fromColIndex+1,1)}}g._setColumns(p.columns);g.reRender()},collapseDetail:function(rowParm){var g=this,p=this.options;var rowdata=g.getRow(rowParm);if(!rowdata){return}for(var i=0,l=g.columns.length;i<l;i++){if(g.columns[i].isdetail){var row=g.getRowObj(rowdata);var cell=g.getCellObj(rowdata,g.columns[i]);$(row).next("tr.l-grid-detailpanel").hide();$(".l-grid-row-cell-detailbtn:first",cell).removeClass("l-open");g.trigger("SysGridHeightChanged");return}}},extendDetail:function(rowParm){var g=this,p=this.options;var rowdata=g.getRow(rowParm);if(!rowdata){return}for(var i=0,l=g.columns.length;i<l;i++){if(g.columns[i].isdetail){var row=g.getRowObj(rowdata);var cell=g.getCellObj(rowdata,g.columns[i]);$(row).next("tr.l-grid-detailpanel").show();$(".l-grid-row-cell-detailbtn:first",cell).addClass("l-open");g.trigger("SysGridHeightChanged");return}}},getParent:function(rowParm){var g=this,p=this.options;if(!p.tree){return null}var rowdata=g.getRow(rowParm);if(!rowdata){return null}if(rowdata.__pid in g.records){return g.records[rowdata.__pid]}else{return null}},getChildren:function(rowParm,deep){var g=this,p=this.options;if(!p.tree){return null}var rowData=g.getRow(rowParm);if(!rowData){return null}var arr=[];function loadChildren(data){if(data[p.tree.childrenName]){for(var i=0,l=data[p.tree.childrenName].length;i<l;i++){var o=data[p.tree.childrenName][i];if(o[p.statusName]=="delete"){continue}arr.push(o);if(deep){loadChildren(o)}}}}loadChildren(rowData);return arr},isLeaf:function(rowParm){var g=this,p=this.options;var rowdata=g.getRow(rowParm);if(!rowdata){return}return rowdata.__hasChildren?false:true},hasChildren:function(rowParm){var g=this,p=this.options;var rowdata=this.getRow(rowParm);if(!rowdata){return}return(rowdata[p.tree.childrenName]&&rowdata[p.tree.childrenName].length)?true:false},existRecord:function(record){for(var rowid in this.records){if(this.records[rowid]==record){return true}}return false},_removeSelected:function(rowdata){var g=this,p=this.options;if(p.tree){var children=g.getChildren(rowdata,true);if(children){for(var i=0,l=children.length;i<l;i++){var index2=$.inArray(children[i],g.selected);if(index2!=-1){g.selected.splice(index2,1)}}}}var index=$.inArray(rowdata,g.selected);if(index!=-1){g.selected.splice(index,1)}},_getParentChildren:function(rowParm){var g=this,p=this.options;var rowdata=g.getRow(rowParm);var listdata;if(p.tree&&g.existRecord(rowdata)&&rowdata.__pid in g.records){listdata=g.records[rowdata.__pid][p.tree.childrenName]}else{listdata=g.currentData[p.root]}return listdata},_removeData:function(rowdata){var g=this,p=this.options;var listdata=g._getParentChildren(rowdata);var index=$.inArray(rowdata,listdata);if(index!=-1){listdata.splice(index,1)}g._removeSelected(rowdata)},_addData:function(rowdata,parentdata,neardata,isBefore){var g=this,p=this.options;if(!g.currentData){g.currentData={}}if(!g.currentData[p.root]){g.currentData[p.root]=[]}var listdata=g.currentData[p.root];if(neardata){if(p.tree){if(parentdata){listdata=parentdata[p.tree.childrenName]}else{if(neardata.__pid in g.records){listdata=g.records[neardata.__pid][p.tree.childrenName]}}}var index=$.inArray(neardata,listdata);listdata.splice(index==-1?-1:index+(isBefore?0:1),0,rowdata)}else{if(p.tree&&parentdata){listdata=parentdata[p.tree.childrenName]}listdata.push(rowdata)}},_appendData:function(rowdata,parentdata,neardata,isBefore){var g=this,p=this.options;rowdata[p.statusName]="update";g._removeData(rowdata);g._addData(rowdata,parentdata,neardata,isBefore)},appendRange:function(rows,parentdata,neardata,isBefore){var g=this,p=this.options;var toRender=false;$.each(rows,function(i,item){if(item.__id&&g.existRecord(item)){if(g.isLeaf(parentdata)){g.upgrade(parentdata)}g._appendData(item,parentdata,neardata,isBefore);toRender=true}else{g.appendRow(item,parentdata,neardata,isBefore)}});if(toRender){g.reRender()}},appendRow:function(rowdata,parentdata,neardata,isBefore){var g=this,p=this.options;if($.isArray(rowdata)){g.appendRange(rowdata,parentdata,neardata,isBefore);return}if(rowdata.__id&&g.existRecord(rowdata)){g._appendData(rowdata,parentdata,neardata,isBefore);g.reRender();return}if(parentdata&&g.isLeaf(parentdata)){g.upgrade(parentdata)}g.addRow(rowdata,neardata,isBefore?true:false,parentdata)},upgrade:function(rowParm){var g=this,p=this.options;var rowdata=g.getRow(rowParm);if(!rowdata||!p.tree){return}rowdata[p.tree.childrenName]=rowdata[p.tree.childrenName]||[];rowdata.__hasChildren=true;var rowobjs=[g.getRowObj(rowdata)];if(g.enabledFrozen()){rowobjs.push(g.getRowObj(rowdata,true))}$("> td > div > .l-grid-tree-space:last",rowobjs).addClass("l-grid-tree-link l-grid-tree-link-open")},demotion:function(rowParm){var g=this,p=this.options;var rowdata=g.getRow(rowParm);if(!rowdata||!p.tree){return}var rowobjs=[g.getRowObj(rowdata)];if(g.enabledFrozen()){rowobjs.push(g.getRowObj(rowdata,true))}$("> td > div > .l-grid-tree-space:last",rowobjs).removeClass("l-grid-tree-link l-grid-tree-link-open l-grid-tree-link-close");if(g.hasChildren(rowdata)){var children=g.getChildren(rowdata);for(var i=0,l=children.length;i<l;i++){g.deleteRow(children[i])}}rowdata.__hasChildren=false},collapseAll:function(){var g=this,p=this.options;$(g.rows).each(function(rowIndex,rowParm){var targetRowObj=g.getRowObj(rowParm);var linkbtn=$(".l-grid-tree-link",targetRowObj);if(linkbtn.hasClass("l-grid-tree-link-close")){return}g.toggle(rowParm)})},expandAll:function(){var g=this,p=this.options;$(g.rows).each(function(rowIndex,rowParm){var targetRowObj=g.getRowObj(rowParm);var linkbtn=$(".l-grid-tree-link",targetRowObj);if(linkbtn.hasClass("l-grid-tree-link-open")){return}g.toggle(rowParm)})},collapse:function(rowParm){var g=this,p=this.options;var targetRowObj=g.getRowObj(rowParm);var linkbtn=$(".l-grid-tree-link",targetRowObj);if(linkbtn.hasClass("l-grid-tree-link-close")){return}g.toggle(rowParm)},expand:function(rowParm){var g=this,p=this.options;var targetRowObj=g.getRowObj(rowParm);var linkbtn=$(".l-grid-tree-link",targetRowObj);if(linkbtn.hasClass("l-grid-tree-link-open")){return}g.toggle(rowParm)},toggle:function(rowParm){if(!rowParm){return}var g=this,p=this.options;var rowdata=g.getRow(rowParm);var targetRowObj=[g.getRowObj(rowdata)];if(g.enabledFrozen()){targetRowObj.push(g.getRowObj(rowdata,true))}var level=rowdata.__level,indexInCollapsedRows;var linkbtn=$(".l-grid-tree-link:first",targetRowObj);var opening=true;g.collapsedRows=g.collapsedRows||[];if(linkbtn.hasClass("l-grid-tree-link-close")){if(g.hasBind("treeExpand")&&g.trigger("treeExpand",[rowdata])==false){return false}linkbtn.removeClass("l-grid-tree-link-close").addClass("l-grid-tree-link-open");indexInCollapsedRows=$.inArray(rowdata,g.collapsedRows);if(indexInCollapsedRows!=-1){g.collapsedRows.splice(indexInCollapsedRows,1)}}else{if(g.hasBind("treeCollapse")&&g.trigger("treeCollapse",[rowdata])==false){return false}opening=false;linkbtn.addClass("l-grid-tree-link-close").removeClass("l-grid-tree-link-open");indexInCollapsedRows=$.inArray(rowdata,g.collapsedRows);if(indexInCollapsedRows==-1){g.collapsedRows.push(rowdata)}}var children=[];if(!opening){children=g.getChildren(rowdata,true);$(children).each(function(){$(g.getRowObj(this)).hide();if(g.enabledFrozen()){$(g.getRowObj(this,true)).hide()}});g.trigger("treeCollapsed",[rowdata]);return}children=g.getChildren(rowdata,false);function toggleChildren(items){for(var i=0,l=items.length;i<l;i++){var o=items[i];var subchildren=g.getChildren(o,false);var haschildren=subchildren&&subchildren.length?true:false;var currentRow=$([g.getRowObj(o.__id)]);if(g.enabledFrozen()){currentRow=currentRow.add(g.getRowObj(o.__id,true))}if(haschildren){if($(".l-grid-tree-link",currentRow).hasClass("l-grid-tree-link-close")){currentRow.show()}else{currentRow.show();toggleChildren(subchildren)}}else{$(".l-grid-tree-link",currentRow).removeClass("l-grid-tree-link-close").addClass("l-grid-tree-link-open");currentRow.show()}}}toggleChildren(children);g.trigger("treeExpanded",[rowdata])},_bulid:function(){var g=this;g._clearGrid();g._initBuildHeader();g._initHeight();g._initFootbar();g._buildPager();g._setEvent()},_setColumns:function(columns){var g=this;g._initColumns();g._initBuildGridHeader();g._initBuildPopup()},_initBuildHeader:function(){var g=this,p=this.options;if(p.title){$(".l-panel-header-text",g.header).html(p.title);if(p.headerImg){g.header.append("<img src='"+p.headerImg+"' />").addClass("l-panel-header-hasicon")}}else{g.header.hide()}if(p.toolbar){if($.fn.ligerToolBar){g.toolbarManager=g.topbar.ligerToolBar(p.toolbar);if(g.topbar.height()==0){g.topbar.parent().height(25)}else{g.topbar.parent().height(g.topbar.height())}}}else{g.topbar.parent().remove()}},_createColumnId:function(column){if(column.id!=null&&column.id!=""){return column.id.toString()}return"c"+(100+this._columnCount)},_isColumnId:function(str){return(str in this._columns)},_initColumns:function(){var g=this,p=this.options;g._columns={};g._columnCount=0;g._columnLeafCount=0;g._columnMaxLevel=1;if(!p.columns){return}function removeProp(column,props){for(var i in props){if(props[i] in column){delete column[props[i]]}}}function setColumn(column,level,pid,previd){if(column.editorType){column.editor=column.editor||{};column.editor.type=column.editorType}removeProp(column,["__id","__pid","__previd","__nextid","__domid","__leaf","__leafindex","__level","__colSpan","__rowSpan"]);if(level>g._columnMaxLevel){g._columnMaxLevel=level}g._columnCount++;column.__id=g._createColumnId(column);column.__domid=g.id+"|hcell|"+column.__id;g._columns[column.__id]=column;if(!column.columns||!column.columns.length){column.__leafindex=g._columnLeafCount++}column.__level=level;column.__pid=pid;column.__previd=previd;if(!column.columns||!column.columns.length){column.__leaf=true;return 1}var leafcount=0;var newid=-1;for(var i=0,l=column.columns.length;i<l;i++){var col=column.columns[i];leafcount+=setColumn(col,level+1,column.__id,newid);newid=col.__id}column.__leafcount=leafcount;return leafcount}var lastid=-1;if(p.rownumbers){var frozenRownumbers=g.enabledGroup()?false:p.frozen&&p.frozenRownumbers;var col={isrownumber:true,issystem:true,width:p.rownumbersColWidth,frozen:frozenRownumbers};setColumn(col,1,-1,lastid);lastid=col.__id}if(g.enabledDetail()){var frozenDetail=g.enabledGroup()?false:p.frozen&&p.frozenDetail;var col={isdetail:true,issystem:true,width:p.detailColWidth,frozen:frozenDetail};setColumn(col,1,-1,lastid);lastid=col.__id}if(g.enabledCheckbox()){var frozenCheckbox=g.enabledGroup()?false:p.frozen&&p.frozenCheckbox;var col={ischeckbox:true,issystem:true,width:p.detailColWidth,frozen:frozenCheckbox};setColumn(col,1,-1,lastid);lastid=col.__id}for(var i=0,l=p.columns.length;i<l;i++){var col=p.columns[i];if(!col){continue}setColumn(col,1,-1,lastid);lastid=col.__id}for(var id in g._columns){var col=g._columns[id];if(col.__leafcount>1){col.__colSpan=col.__leafcount}if(col.__leaf&&col.__level!=g._columnMaxLevel){col.__rowSpan=g._columnMaxLevel-col.__level+1}}g.columns=g.getColumns();$(g.columns).each(function(i,column){column.columnname=column.name;column.columnindex=i;column.type=column.type||"string";column.islast=i==g.columns.length-1;column.isSort=column.isSort==true?true:false;column.frozen=column.frozen?true:false;column._width=g._getColumnWidth(column);column._hide=column.hide?true:false})},_getColumnWidth:function(column){var g=this,p=this.options;if(column._width){return column._width}var colwidth=column.width||p.columnWidth;if(!colwidth||colwidth=="auto"){var autoColumnNumber=0,noAutoColumnWidth=0;$(g.columns).each(function(i,col){var colwidth=col.width||p.columnWidth;var isAuto=(!colwidth||colwidth=="auto")?true:false;if(isAuto){autoColumnNumber++}else{noAutoColumnWidth+=(parseInt(g._getColumnWidth(col))+1)}});colwidth=parseInt((g.grid.width()-noAutoColumnWidth)/autoColumnNumber)-1}if(typeof(colwidth)=="string"&&colwidth.indexOf("%")>0){var lwidth=0;if(g.enabledDetail()){lwidth+=p.detailColWidth}if(g.enabledCheckbox()){lwidth+=p.checkboxColWidth}if(g.options.rownumbers){lwidth+=g.options.rownumbersColWidth}column._width=colwidth=parseInt(parseInt(colwidth)*0.01*(g.grid.width()-lwidth-(g.columns.length/2)-1))}if(column.minWidth&&colwidth<column.minWidth){colwidth=column.minWidth}if(column.maxWidth&&colwidth>column.maxWidth){colwidth=column.maxWidth}return colwidth},_createHeaderCell:function(column){var g=this,p=this.options;var jcell=$("<td class='l-grid-hd-cell'><div class='l-grid-hd-cell-inner'><span class='l-grid-hd-cell-text'></span></div></td>");jcell.attr("id",column.__domid);if(!column.__leaf){jcell.addClass("l-grid-hd-cell-mul")}if(column.columnindex==g.columns.length-1){jcell.addClass("l-grid-hd-cell-last")}if(column.isrownumber){jcell.addClass("l-grid-hd-cell-rownumbers");jcell.html("<div class='l-grid-hd-cell-inner'></div>")}if(column.ischeckbox){!p.isSingleCheck&&jcell.addClass("l-grid-hd-cell-checkbox");jcell.html("<div class='l-grid-hd-cell-inner'><div class='l-grid-hd-cell-text l-grid-hd-cell-btn-checkbox'></div></div>")}if(column.isdetail){jcell.addClass("l-grid-hd-cell-detail");jcell.html("<div class='l-grid-hd-cell-inner'><div class='l-grid-hd-cell-text l-grid-hd-cell-btn-detail'></div></div>")}if(column.heightAlign){$(".l-grid-hd-cell-inner:first",jcell).css("textAlign",column.heightAlign)}if(column.__colSpan){jcell.attr("colSpan",column.__colSpan)}if(column.__rowSpan){jcell.attr("rowSpan",column.__rowSpan);jcell.height(p.headerRowHeight*column.__rowSpan);var paddingTop=(p.headerRowHeight*column.__rowSpan-p.headerRowHeight)/2-5;$(".l-grid-hd-cell-inner:first",jcell).css("paddingTop",paddingTop)}else{jcell.height(p.headerRowHeight)}if(column.__leaf){jcell.width(column._width);jcell.attr("columnindex",column.__leafindex)}var cellHeight=jcell.height();if(!column.__rowSpan&&cellHeight>10){$(">div:first",jcell).height(cellHeight)}if(column._hide){jcell.hide()}if(column.name){jcell.attr({columnname:column.name})}var headerText="";if(column.display&&column.display!=""){headerText=column.display}else{if(column.headerRender){headerText=column.headerRender(column)}else{headerText="&nbsp;"}}$(".l-grid-hd-cell-text:first",jcell).html(headerText);if(!column.issystem&&column.__leaf&&column.resizable!==false&&$.fn.ligerResizable&&p.allowAdjustColWidth){g.colResizable[column.__id]=jcell.ligerResizable({handles:"e",onStartResize:function(e,ev){this.proxy.hide();g.draggingline.css({height:g.body.height(),top:0,left:ev.pageX-g.grid.offset().left+parseInt(g.body[0].scrollLeft)}).show()},onResize:function(e,ev){g.colresizing=true;g.draggingline.css({left:ev.pageX-g.grid.offset().left+parseInt(g.body[0].scrollLeft)});$("body").add(jcell).css("cursor","e-resize")},onStopResize:function(e){g.colresizing=false;$("body").add(jcell).css("cursor","default");g.draggingline.hide();g.setColumnWidth(column,parseInt(column._width)+e.diffX);return false}})}g.trigger("headerCellBulid",[jcell,column]);return jcell},_initBuildGridHeader:function(){var g=this,p=this.options;g.gridtablewidth=0;g.f.gridtablewidth=0;if(g.colResizable){for(var i in g.colResizable){g.colResizable[i].destroy()}g.colResizable=null}g.colResizable={};$("tbody:first",g.gridheader).html("");$("tbody:first",g.f.gridheader).html("");for(var level=1;level<=g._columnMaxLevel;level++){var columns=g.getColumns(level);var islast=level==g._columnMaxLevel;var tr=$("<tr class='l-grid-hd-row'></tr>");var trf=$("<tr class='l-grid-hd-row'></tr>");if(!islast){tr.add(trf).addClass("l-grid-hd-mul")}$("tbody:first",g.gridheader).append(tr);$("tbody:first",g.f.gridheader).append(trf);$(columns).each(function(i,column){(column.frozen?trf:tr).append(g._createHeaderCell(column));if(column.__leaf){var colwidth=column._width;if(!column.frozen){g.gridtablewidth+=(parseInt(colwidth)?parseInt(colwidth):0)+1}else{g.f.gridtablewidth+=(parseInt(colwidth)?parseInt(colwidth):0)+1}}})}if(g._columnMaxLevel>0){var h=p.headerRowHeight*g._columnMaxLevel;g.gridheader.add(g.f.gridheader).height(h);if(p.rownumbers&&p.frozenRownumbers){g.f.gridheader.find("td:first").height(h)}}g._updateFrozenWidth();$("div:first",g.gridheader).width(g.gridtablewidth+40)},_initBuildPopup:function(){var g=this,p=this.options;$(":checkbox",g.popup).unbind();$("tbody tr",g.popup).remove();$(g.columns).each(function(i,column){if(column.issystem){return}if(column.isAllowHide==false){return}var chk='checked="checked"';if(column._hide){chk=""}var header=column.display;$("tbody",g.popup).append('<tr><td class="l-column-left"><input type="checkbox" '+chk+' class="l-checkbox" columnindex="'+i+'"/></td><td class="l-column-right">'+header+"</td></tr>")});if($.fn.ligerCheckBox){$("input:checkbox",g.popup).ligerCheckBox({onBeforeClick:function(obj){if(!obj.checked){return true}if($("input:checked",g.popup).length<=p.minColToggle){return false}return true}})}if(p.allowHideColumn){$("tr",g.popup).hover(function(){$(this).addClass("l-popup-row-over")},function(){$(this).removeClass("l-popup-row-over")});var onPopupCheckboxChange=function(){if($("input:checked",g.popup).length+1<=p.minColToggle){return false}g.toggleCol(parseInt($(this).attr("columnindex")),this.checked,true)};if($.fn.ligerCheckBox){$(":checkbox",g.popup).bind("change",onPopupCheckboxChange)}else{$(":checkbox",g.popup).bind("click",onPopupCheckboxChange)}}},_initHeight:function(){var g=this,p=this.options;if(p.height=="auto"){g.gridbody.height("auto");g.f.gridbody.height("auto")}if(p.width){g.grid.width(p.width)}g._onResize.call(g)},_initFootbar:function(){var g=this,p=this.options;if(p.usePager){if(p.pagerRender){g.toolbar.html(p.pagerRender.call(g));return}if(p.scrollToPage){g.toolbar.hide();return}var optStr="";var selectedIndex=-1;$(p.pageSizeOptions).each(function(i,item){var selectedStr="";if(p.pageSize==item){selectedIndex=i}optStr+="<option value='"+item+"' "+selectedStr+" >"+item+"</option>"});if(p.pageSizeBtn!=false){$(".l-bar-selectpagesize",g.toolbar).append("<select name='rp'>"+optStr+"</select>");if(selectedIndex!=-1){$(".l-bar-selectpagesize select",g.toolbar)[0].selectedIndex=selectedIndex}if(p.switchPageSizeApplyComboBox&&$.fn.ligerComboBox){$(".l-bar-selectpagesize select",g.toolbar).ligerComboBox({onBeforeSelect:function(){if(p.url&&g.isDataChanged&&!confirm(p.isContinueByDataChanged)){return false}return true},width:45})}}}else{g.toolbar.hide()}},_searchData:function(data,clause){var g=this,p=this.options;var newData=new Array();for(var i=0;i<data.length;i++){if(clause(data[i],i)){newData[newData.length]=data[i]}}return newData},_clearGrid:function(){var g=this,p=this.options;g._fixRows();for(var i in g.rows){var rowobj=$(g.getRowObj(g.rows[i]));if(g.enabledFrozen()){rowobj=rowobj.add(g.getRowObj(g.rows[i],true))}rowobj.unbind()}g.gridbody.html("");g.f.gridbody.html("");g.recordNumber=0;g.records={};g.rows=[];g._fixRows();g.selected=[];g.totalNumber=0;g.editorcounter=0;g.gridview1.find("tr.l-grid-hd-row").removeClass("l-checked")},_fixRows:function(){var g=this,p=this.options;if(!g.rows){return}for(var i in g.rows){if($.isFunction(g.rows[i])){delete g.rows[i]}}},_fillGridBody:function(data,frozen,sourceType){var g=this,p=this.options;var gridhtmlarr=sourceType=="scrollappend"?[]:['<div class="l-grid-body-inner"><table class="l-grid-body-table" cellpadding=0 cellspacing=0><tbody>'];if(g.enabledGroup()){var groups=[];var groupsdata=[];g.groups=groupsdata;for(var rowparm in data){var item=data[rowparm];var groupColumnValue=item[p.groupColumnName];var valueIndex=$.inArray(groupColumnValue,groups);if(valueIndex==-1){groups.push(groupColumnValue);valueIndex=groups.length-1;groupsdata.push([])}groupsdata[valueIndex].push(item)}$(groupsdata).each(function(i,item){if(groupsdata.length==1){gridhtmlarr.push('<tr class="l-grid-grouprow l-grid-grouprow-last l-grid-grouprow-first"')}if(i==groupsdata.length-1){gridhtmlarr.push('<tr class="l-grid-grouprow l-grid-grouprow-last"')}else{if(i==0){gridhtmlarr.push('<tr class="l-grid-grouprow l-grid-grouprow-first"')}else{gridhtmlarr.push('<tr class="l-grid-grouprow"')}}gridhtmlarr.push(' groupindex"='+i+'" >');gridhtmlarr.push('<td colSpan="'+g.columns.length+'" class="l-grid-grouprow-cell">');gridhtmlarr.push('<span class="l-grid-group-togglebtn">&nbsp;&nbsp;&nbsp;&nbsp;</span>');if(p.groupRender){gridhtmlarr.push(p.groupRender(groups[i],item,p.groupColumnDisplay))}else{gridhtmlarr.push(p.groupColumnDisplay+":"+groups[i])}gridhtmlarr.push("</td>");gridhtmlarr.push("</tr>");gridhtmlarr.push(g._getHtmlFromData(item,frozen));if(g.isTotalSummary()){gridhtmlarr.push(g._getTotalSummaryHtml(item,"l-grid-totalsummary-group",frozen))}})}else{gridhtmlarr.push(g._getHtmlFromData(data,frozen))}if(!sourceType=="scrollappend"){gridhtmlarr.push("</tbody></table></div>")}if(sourceType=="scrollappend"){(frozen?g.f.gridbody:g.gridbody).find("tbody:first").append(gridhtmlarr.join(""))}else{(frozen?g.f.gridbody:g.gridbody).html(gridhtmlarr.join(""))}if(frozen){g.f.gridbody.find(">l-jplace").remove();g.f.gridbody.append('<div class="l-jplace"></div>')}if(p.usePager&&p.scrollToPage&&!p.scrollToAppend){var jgridbodyinner=frozen?g.f.gridbody.find("> .l-grid-body-inner"):g.gridbody.find("> .l-grid-body-inner");var jreplace=jgridbodyinner.find("> .l-scrollreplacetop");jreplace=jreplace.length?jreplace:$('<div class="l-scrollreplacetop"></div>').prependTo(jgridbodyinner);jreplace.css("width","80%").height(g.lastScrollTop);jreplace=jgridbodyinner.find("> .l-scrollreplacebottom");jreplace=jreplace.length?jreplace:$('<div class="l-scrollreplacebottom"></div>').appendTo(jgridbodyinner);jreplace.css("width","80%").height((p.pageCount-p.newPage)*g._getOnePageHeight())}if(!g.enabledGroup()){g._bulidTotalSummary(frozen)}$("> div:first",g.gridbody).width(g.gridtablewidth);g._onResize()},_showData:function(sourceType){var g=this,p=this.options;g.changedCells={};var data=g.currentData[p.root];if(p.usePager){if(p.dataAction=="server"&&g.data&&g.data[p.record]){p.total=g.data[p.record]}else{if(g.filteredData&&g.filteredData[p.root]){p.total=g.filteredData[p.root].length}else{if(g.data&&g.data[p.root]){p.total=g.data[p.root].length}else{if(data){p.total=data.length}}}}p.page=p.newPage;if(!p.total){p.total=0}if(!p.page){p.page=1}p.pageCount=Math.ceil(p.total/p.pageSize);if(!p.pageCount){p.pageCount=1}if(!p.scrollToPage){g._buildPager()}}$(".l-bar-btnloading:first",g.toolbar).removeClass("l-bar-btnloading");if(g.trigger("beforeShowData",[g.currentData])==false){return}if(sourceType!="scrollappend"){g._clearGrid()}g.isDataChanged=false;if(!data||!data.length){g.gridview.addClass("l-grid-empty");$(g.element).addClass("l-empty");$("<div></div>").addClass("l-grid-body-inner").appendTo(g.gridbody).css({width:g.gridheader.find(">div:first").width(),height:g.gridbody.height()});if(p.pagerRender){g.toolbar.html(p.pagerRender.call(g));return}g._onResize.ligerDefer(g,50);return}else{g.gridview.removeClass("l-grid-empty");$(g.element).removeClass("l-empty")}$(".l-bar-btnload:first span",g.toolbar).removeClass("l-disabled");g._updateGridData();if(g.enabledFrozen()){g._fillGridBody(g.rows,true,sourceType)}g._fillGridBody(g.rows,false,sourceType);g.trigger("SysGridHeightChanged");if(sourceType=="scroll"){g.trigger("sysScrollLoaded")}if(p.totalRender){$(".l-panel-bar-total",g.element).remove();$(".l-panel-bar",g.element).before('<div class="l-panel-bar-total">'+p.totalRender(g.data,g.filteredData)+"</div>")}if(p.mouseoverRowCssClass){for(var i in g.rows){var rowobj=$(g.getRowObj(g.rows[i]));if(g.enabledFrozen()){rowobj=rowobj.add(g.getRowObj(g.rows[i],true))}rowobj.bind("mouseover.gridrow",function(){g._onRowOver(this,true)}).bind("mouseout.gridrow",function(){g._onRowOver(this,false)})}}g._fixHeight();if(p.pagerRender){g.toolbar.html(p.pagerRender.call(g));return}g.gridbody.trigger("scroll.grid");g.trigger("afterShowData",[g.currentData])},_fixHeight:function(){var g=this,p=this.options;if(p.fixedCellHeight||!p.frozen){return}var column1,column2;for(var i in g.columns){var column=g.columns[i];if(column1&&column2){break}if(column.frozen&&!column1){column1=column;continue}if(!column.frozen&&!column2){column2=column;continue}}if(!column1||!column2){return}for(var rowid in g.records){var cell1=g.getCellObj(rowid,column1),cell2=g.getCellObj(rowid,column2);var height=Math.max($(cell1).height(),($(cell2).height()));$(cell1).add(cell2).height(height)}},_getRowDomId:function(rowdata,frozen){return this.id+"|"+(frozen?"1":"2")+"|"+rowdata.__id},_getCellDomId:function(rowdata,column){return this._getRowDomId(rowdata,column.frozen)+"|"+column.__id},_getHtmlFromData:function(data,frozen){if(!data){return""}var g=this,p=this.options;var gridhtmlarr=[];for(var i in data){var item=data[i];var rowid=item.__id;if(!item){continue}gridhtmlarr.push("<tr");gridhtmlarr.push(' id="'+g._getRowDomId(item,frozen)+'"');gridhtmlarr.push(' class="l-grid-row');if(!frozen&&g.enabledCheckbox()&&p.isChecked&&p.isChecked(item)){g.select(item);gridhtmlarr.push(" l-selected")}else{if(g.isSelected(item)){gridhtmlarr.push(" l-selected")}else{if(p.isSelected&&p.isSelected(item)){g.select(item);gridhtmlarr.push(" l-selected")}}}if(item.__index%2==1&&p.alternatingRow){gridhtmlarr.push(" l-grid-row-alt")}if(p.rowClsRender){var rowcls=p.rowClsRender(item,rowid);rowcls&&gridhtmlarr.push(" "+rowcls)}gridhtmlarr.push('" ');if(p.rowAttrRender){gridhtmlarr.push(p.rowAttrRender(item,rowid))}if(p.tree&&g.collapsedRows&&g.collapsedRows.length){var isHide=function(){var pitem=g.getParent(item);while(pitem){if($.inArray(pitem,g.collapsedRows)!=-1){return true}pitem=g.getParent(pitem)}return false};if(isHide()){gridhtmlarr.push(' style="display:none;" ')}}gridhtmlarr.push(">");$(g.columns).each(function(columnindex,column){if(frozen!=column.frozen){return}gridhtmlarr.push("<td");gridhtmlarr.push(' id="'+g._getCellDomId(item,this)+'"');if(this.isrownumber){gridhtmlarr.push(' class="l-grid-row-cell l-grid-row-cell-rownumbers" style="width:'+this.width+'px"><div class="l-grid-row-cell-inner"');if(p.fixedCellHeight){gridhtmlarr.push(' style = "height:'+p.rowHeight+'px;" ')}else{gridhtmlarr.push(' style = "min-height:'+p.rowHeight+'px;" ')}gridhtmlarr.push(">"+(parseInt(item.__index)+1)+"</div></td>");return}if(this.ischeckbox){var showCheckBox=true;if(p.canSelect){showCheckBox=p.canSelect(item)}gridhtmlarr.push(' class="l-grid-row-cell l-grid-row-cell-'+(p.isSingleCheck?"radio":"checkbox")+'" style="width:'+this.width+'px"><div class="l-grid-row-cell-inner"');if(p.fixedCellHeight){gridhtmlarr.push(' style = "height:'+p.rowHeight+'px;" ')}else{gridhtmlarr.push(' style = "min-height:'+p.rowHeight+'px;" ')}gridhtmlarr.push(">");if(showCheckBox){gridhtmlarr.push('<span class="l-grid-row-cell-btn-checkbox"></span>')}gridhtmlarr.push("</div></td>");return}else{if(this.isdetail){gridhtmlarr.push(' class="l-grid-row-cell l-grid-row-cell-detail" style="width:'+this.width+'px"><div class="l-grid-row-cell-inner"');if(p.fixedCellHeight){gridhtmlarr.push(' style = "height:'+p.rowHeight+'px;" ')}else{gridhtmlarr.push(' style = "min-height:'+p.rowHeight+'px;" ')}gridhtmlarr.push(">");if(!p.isShowDetailToggle||p.isShowDetailToggle(item)){gridhtmlarr.push('<span class="l-grid-row-cell-detailbtn"></span>')}gridhtmlarr.push("</div></td>");return}}var colwidth=this._width;gridhtmlarr.push(' class="l-grid-row-cell ');var editParm={record:item,value:item[column.name],column:column};var disableEdit=g.trigger("beforeEdit",[editParm])==false;if(!this.editor||g.options.enabledEdit==false||disableEdit){gridhtmlarr.push("l-grid-row-cell-noeditor ")}else{gridhtmlarr.push("l-grid-row-cell-editor-"+this.editor.type+" ")}if(this.validate&&this.validate.required){gridhtmlarr.push("l-text-required ")}if(g.changedCells[rowid+"_"+this["__id"]]){gridhtmlarr.push("l-grid-row-cell-edited ")}if(this.islast){gridhtmlarr.push("l-grid-row-cell-last ")}gridhtmlarr.push('"');gridhtmlarr.push(' style = "');gridhtmlarr.push("width:"+colwidth+"px; ");if(column._hide){gridhtmlarr.push("display:none;")}gridhtmlarr.push(' ">');gridhtmlarr.push(g._getCellHtml(item,column));gridhtmlarr.push("</td>")});gridhtmlarr.push("</tr>")}return gridhtmlarr.join("")},_getCellHtml:function(rowdata,column){var g=this,p=this.options,gridhtmlarr=[];if(column.isrownumber){gridhtmlarr.push('<div class="l-grid-row-cell-inner"');if(p.fixedCellHeight){gridhtmlarr.push(' style = "height:'+p.rowHeight+'px;" ')}else{gridhtmlarr.push(' style = "min-height:'+p.rowHeight+'px;" ')}gridhtmlarr.push(">"+(parseInt(rowdata.__index)+1)+"</div>");return gridhtmlarr.join("")}var htmlarr=[];htmlarr.push('<div class="l-grid-row-cell-inner"');if(column.validate){htmlarr.push(" validate='",liger.toJSON(column.validate),"'")}htmlarr.push(' style = "width:'+parseInt(column._width-8)+"px;");if(p.fixedCellHeight){htmlarr.push("height:"+p.rowHeight+"px;")}htmlarr.push("min-height:"+p.rowHeight+"px; ");if(column.align){htmlarr.push("text-align:"+column.align+";")}var content=g._getCellContent(rowdata,column);htmlarr.push('">'+content+"</div>");return htmlarr.join("")},_setValueByName:function(data,name,value){if(!data||!name){return null}if(name.indexOf(".")==-1){data[name]=value}else{try{new Function("data,value","data."+name+"=value;")(data,value)}catch(e){}}},_getValueByName:function(data,name){if(!data||!name){return null}if(name.indexOf(".")==-1){return data[name]}else{try{return new Function("data","return data."+name+";")(data)}catch(e){return null}}},_getCellContent:function(rowdata,column){var g=this,p=this.options;if(!rowdata||!column){return""}if(column.isrownumber){return parseInt(rowdata.__index)+1}var rowid=rowdata.__id;var rowindex=rowdata.__index;var value=$.escapeHtml(g._getValueByName(rowdata,column.name));var text=$.escapeHtml(g._getValueByName(rowdata,column.textField));var content="";if(column.render){content=column.render.call(g,rowdata,rowindex,value,column)}else{if(p.formatters[column.type]){content=p.formatters[column.type].call(g,value,column)}else{if(text!=null){content=text.toString()}else{if(value!=null){content=value.toString()}}}}if(p.tree&&(p.tree.columnName!=null&&p.tree.columnName==column.name||p.tree.columnId!=null&&p.tree.columnId==column.id)){content=g._getTreeCellHtml(content,rowdata)}if(column.fieldsCode){content=column.fieldsCode[content]}return content||""},_getTreeCellHtml:function(oldContent,rowdata){var level=rowdata.__level;var g=this,p=this.options;var isExtend=$.inArray(rowdata,g.collapsedRows||[])==-1;var isParent=p.tree.isParent(rowdata);var content="";level=parseInt(level)||1;for(var i=1;i<level;i++){content+="<div class='l-grid-tree-space'></div>"}if(isExtend&&isParent){content+="<div class='l-grid-tree-space l-grid-tree-link l-grid-tree-link-open'></div>"}else{if(isParent){content+="<div class='l-grid-tree-space l-grid-tree-link l-grid-tree-link-close'></div>"}else{content+="<div class='l-grid-tree-space'></div>"}}content+="<span class='l-grid-tree-content'>"+oldContent+"</span>";return content},_focusCell:function(obj){var ub=this.gridbody,h=ub.height(),w=ub.width(),oo=obj.offset(),oot=oo.top,ool=oo.left,uo=ub.offset(),uot=uo.top,uol=uo.left,ust=ub.scrollTop(),usl=ub.scrollLeft(),oh=obj.outerHeight(),ow=obj.outerWidth(),sh=ub[0].scrollWidth>w?17:0,sw=ub[0].scrollHeight>h?17:0;if(oot-uot<0){ub.scrollTop(oot+ust-uot)}else{if(oot-uot+oh>h-sh){ub.scrollTop(oot+ust-uot+oh-h+sh)}}if(ool-uol<0){ub.scrollLeft(ool+usl-uol)}else{if(ool-uol+ow>w-sw){ub.scrollLeft(ool+usl-uol+ow-w+sw)}}},_applyEditor:function(obj){var g=this,p=this.options;var ids=obj.id.split("|");var columnid=ids[ids.length-1],column=g._columns[columnid];var dom=document.getElementById(obj.id);var jcell=$(dom);var row=jcell.parent(),rowdata=g.getRow(row[0]),rowid=rowdata.__id,rowindex=rowdata.__index;if(!column||!column.editor){return false}var columnname=column.name,columnindex=column.columnindex;if(column.editor.type&&p.editors[column.editor.type]){var currentdata=g._getValueByName(rowdata,columnname);var editParm={record:rowdata,value:currentdata,column:column,rowindex:rowindex};if(column.textField){editParm.text=g._getValueByName(rowdata,column.textField)}if(g.trigger("beforeEdit",[editParm])==false){return false}g._focusCell(jcell);g.lastEditRow=rowdata;liger.lastEditGrid=g;var editor=p.editors[column.editor.type],width=jcell.width(),height=jcell.height(),container=$("<div class='l-grid-editor'></div>").appendTo(g.form?$(g.form):g.grid),pc=jcell.offset(),pe=$(g.element).offset(),left=pc.left-pe.left,top=pc.top-pe.top;g.setCellEditing(rowdata,column,true);if($.browser.msie||$.browser.mozilla){top-=1;left-=1}container.offset({left:left,top:top}).show();if(column.textField){editParm.text=g._getValueByName(rowdata,column.textField)}var editorInput=g._createEditor(editor,container,editParm,width,height-2),inputBody=editorInput.element;if(inputBody){inputBody.name=columnname;inputBody.row=rowdata;if(column.validate){inputBody.gridRowCell=obj;$(inputBody).attr("validate",liger.toJSON(column.validate))}$(inputBody).keydown(function(e){if(e.keyCode==9){e.preventDefault();g.endEdit();g._showEditorBy(e.shiftKey?37:39,column,rowdata)}})}g.editor={editing:true,editor:editor,input:editorInput,editParm:editParm,container:container};g.unbind("sysEndEdit");g.bind("sysEndEdit",function(){var newValue=editor.getValue(editorInput,editParm);if(column.textField&&editor.getText){editParm.text=editor.getText(editorInput,editParm)}if(editor.getSelected){editParm.selected=editor.getSelected(editorInput,editParm)}jcell.addClass("l-grid-row-cell-edited");g.changedCells[rowid+"_"+column.__id]=true;editParm.value=newValue;if(column.editor.onChange){column.editor.onChange.call(editorInput,editParm)}if(g._checkEditAndUpdateCell(editParm)){if(column.editor.onChanged){column.editor.onChanged.call(editorInput,editParm)}}});inputBody.focus()}},_showEditorBy:function(dir,column,row){var g=this,columns=g.columns;if(dir==39||dir==37){var step=dir==39?1:-1;column=columns[column.columnindex+step];if(!column){row=g.rows[row.__index+step];column=columns[dir==39?0:columns.length-1]}if(row&&g._applyEditor(g.getCellObj(row,column))==false){g._showEditorBy(dir,column,row)}}},_checkEditAndUpdateCell:function(editParm){var g=this,p=this.options;if(g.trigger("beforeSubmitEdit",[editParm])==false){return false}var column=editParm.column;if(column.textField){g._setValueByName(editParm.record,column.textField,editParm.text)}g.updateCell(column,editParm.value,editParm.record);if(column.render||g.enabledTotal()){g.reRender({column:column})}g.reRender({rowdata:editParm.record});return true},_getCurrentPageData:function(source){var g=this,p=this.options;var data={};data[p.root]=[];if(!source||!source[p.root]||!source[p.root].length){data[p.record]=0;return data}data[p.record]=source[p.root].length;if(!p.newPage){p.newPage=1}for(i=(p.newPage-1)*p.pageSize;i<source[p.root].length&&i<p.newPage*p.pageSize;i++){data[p.root].push(source[p.root][i])}return data},_compareData:function(data1,data2,columnName,columnType){var g=this,p=this.options;var val1=data1[columnName],val2=data2[columnName];if(val1==null&&val2!=null){return 1}else{if(val1==null&&val2==null){return 0}else{if(val1!=null&&val2==null){return -1}}}if(p.sorters[columnType]){return p.sorters[columnType].call(g,val1,val2)}else{return val1<val2?-1:val1>val2?1:0}},_getTotalInfo:function(column,data){var g=this,p=this.options;try{var totalsummaryArr=[];if(!column.totalSummary){return null}var sum=0,count=0,avg=0,min=0,max=0;if(data&&data.length){max=parseFloat(data[0][column.name]);min=parseFloat(data[0][column.name]);for(var i=0;i<data.length;i++){if(data[i][p.statusName]=="delete"){continue}count+=1;var value=data[i][column.name];if(typeof(value)=="string"){value=value.replace(/\$|\,/g,"")}value=parseFloat(value);if(!value){continue}sum+=value;if(value>max){max=value}if(value<min){min=value}}avg=sum*1/data.length}return{sum:sum,count:count,avg:avg,min:min,max:max}}catch(e){return{}}},_getTotalCellContent:function(column,data){var g=this,p=this.options;var totalsummaryArr=[];if(column.totalSummary){var isExist=function(type){for(var i=0;i<types.length;i++){if(types[i].toLowerCase()==type.toLowerCase()){return true}}return false};var info=g._getTotalInfo(column,data);if(column.totalSummary.render){var renderhtml=column.totalSummary.render(info,column,g.data);totalsummaryArr.push(renderhtml)}else{if(column.totalSummary.type&&info){var types=column.totalSummary.type.split(",");if(isExist("sum")){totalsummaryArr.push("<div>Sum="+info.sum.toFixed(2)+"</div>")}if(isExist("tsum")){totalsummaryArr.push("<div>"+sum.toFixed(0)+"</div>")}if(isExist("count")){totalsummaryArr.push("<div>Count="+info.count+"</div>")}if(isExist("max")){totalsummaryArr.push("<div>Max="+info.max.toFixed(2)+"</div>")}if(isExist("min")){totalsummaryArr.push("<div>Min="+info.min.toFixed(2)+"</div>")}if(isExist("avg")){totalsummaryArr.push("<div>Avg="+info.avg.toFixed(2)+"</div>")}}}}return totalsummaryArr.join("")},_getTotalSummaryHtml:function(data,classCssName,frozen){var g=this,p=this.options;var totalsummaryArr=[];if(classCssName){totalsummaryArr.push('<tr class="l-grid-totalsummary '+classCssName+'">')}else{totalsummaryArr.push('<tr class="l-grid-totalsummary">')}$(g.columns).each(function(columnindex,column){if(this.frozen!=frozen){return}if(this.isrownumber){totalsummaryArr.push('<td class="l-grid-totalsummary-cell l-grid-totalsummary-cell-rownumbers" style="width:'+this.width+'px"><div>&nbsp;</div></td>');return}if(this.ischeckbox){totalsummaryArr.push('<td class="l-grid-totalsummary-cell l-grid-totalsummary-cell-checkbox" style="width:'+this.width+'px"><div>&nbsp;</div></td>');return}else{if(this.isdetail){totalsummaryArr.push('<td class="l-grid-totalsummary-cell l-grid-totalsummary-cell-detail" style="width:'+this.width+'px"><div>&nbsp;</div></td>');return}}totalsummaryArr.push('<td class="l-grid-totalsummary-cell');if(this.islast){totalsummaryArr.push(" l-grid-totalsummary-cell-last")}totalsummaryArr.push('" ');totalsummaryArr.push('id="'+g.id+"|total"+g.totalNumber+"|"+column.__id+'" ');totalsummaryArr.push('width="'+this._width+'" ');columnname=this.columnname;if(columnname){totalsummaryArr.push('columnname="'+columnname+'" ')}totalsummaryArr.push('columnindex="'+columnindex+'" ');totalsummaryArr.push('><div class="l-grid-totalsummary-cell-inner"');if(column.align){totalsummaryArr.push(' style="text-Align:'+column.align+';"')}totalsummaryArr.push(">");totalsummaryArr.push(g._getTotalCellContent(column,data));totalsummaryArr.push("</div></td>")});totalsummaryArr.push("</tr>");if(!frozen){g.totalNumber++}return totalsummaryArr.join("")},_bulidTotalSummary:function(frozen){var g=this,p=this.options;if(!g.isTotalSummary()){return false}if(!g.currentData||g.currentData[p.root].length==0){return false}var totalRow=$(g._getTotalSummaryHtml(g.currentData[p.root],null,frozen));$("tbody:first",frozen?g.f.gridbody:g.gridbody).append(totalRow);if(frozen){g.totalRow1=totalRow}else{g.totalRow2=totalRow}},updateTotalSummary:function(){var g=this,p=this.options;g.reRender({totalOnly:true})},_buildPager:function(){var g=this,p=this.options;if(p.pagerRender){return}$(".pcontrol input",g.toolbar).val(p.page);if(!p.pageCount){p.pageCount=1}$(".pcontrol span",g.toolbar).html(p.pageCount);var r1=parseInt((p.page-1)*p.pageSize)+1;var r2=parseInt(r1)+parseInt(p.pageSize)-1;if(!p.total){p.total=0}if(p.total<r2){r2=p.total}if(!p.total){r1=r2=0}if(r1<0){r1=0}if(r2<0){r2=0}var stat=p.pageStatMessage;stat=stat.replace(/{from}/,r1);stat=stat.replace(/{to}/,r2);stat=stat.replace(/{total}/,p.total);stat=stat.replace(/{pagesize}/,p.pageSize);$(".l-bar-text",g.toolbar).html(stat);if(!p.total){$(".l-bar-btnfirst span,.l-bar-btnprev span,.l-bar-btnnext span,.l-bar-btnlast span",g.toolbar).addClass("l-disabled")}if(p.hideLoadButton){$(".l-bar-btnload:first",g.toolbar).parent().hide();$(".l-bar-btnload:first",g.toolbar).parent().next().hide()}if(p.page==1){$(".l-bar-btnfirst span",g.toolbar).addClass("l-disabled");$(".l-bar-btnprev span",g.toolbar).addClass("l-disabled")}else{if(p.page>p.pageCount&&p.pageCount>0){$(".l-bar-btnfirst span",g.toolbar).removeClass("l-disabled");$(".l-bar-btnprev span",g.toolbar).removeClass("l-disabled")}}if(p.page==p.pageCount){$(".l-bar-btnlast span",g.toolbar).addClass("l-disabled");$(".l-bar-btnnext span",g.toolbar).addClass("l-disabled")}else{if(p.page<p.pageCount&&p.pageCount>0){$(".l-bar-btnlast span",g.toolbar).removeClass("l-disabled");$(".l-bar-btnnext span",g.toolbar).removeClass("l-disabled")}}},_getRowIdByDomId:function(domid){var ids=domid.split("|");var rowid=ids[2];return rowid},_getRowByDomId:function(domid){return this.records[this._getRowIdByDomId(domid)]},_isEditing:function(jobjs){return jobjs.hasClass("l-box-dateeditor")||jobjs.hasClass("l-box-select")||jobjs.hasClass("l-autocomplete-view")||jobjs.hasClass("l-popup")},_getSrcElementByEvent:function(e){var g=this;var obj=(e.target||e.srcElement);var jobjs=$(obj).parents().add(obj);var fn=function(parm){for(var i=0,l=jobjs.length;i<l;i++){if(typeof parm=="string"){if($(jobjs[i]).hasClass(parm)){return jobjs[i]}}else{if(typeof parm=="object"){if(jobjs[i]==parm){return jobjs[i]}}}}return null};if(fn("l-grid-editor")){return{editing:true,editor:fn("l-grid-editor")}}if(jobjs.index(this.element)==-1){if(g._isEditing(jobjs)){return{editing:true}}else{return{out:true}}}var indetail=false;if(jobjs.hasClass("l-grid-detailpanel")&&g.detailrows){for(var i=0,l=g.detailrows.length;i<l;i++){if(jobjs.index(g.detailrows[i])!=-1){indetail=true;break}}}var r={grid:fn("l-panel"),indetail:indetail,frozen:fn(g.gridview1[0])?true:false,header:fn("l-panel-header"),gridheader:fn("l-grid-header"),gridbody:fn("l-grid-body"),total:fn("l-panel-bar-total"),popup:fn("l-grid-popup"),toolbar:fn("l-panel-bar")};if(r.gridheader){r.hrow=fn("l-grid-hd-row");r.hcell=fn("l-grid-hd-cell");r.hcelltext=fn("l-grid-hd-cell-text");r.checkboxall=fn("l-grid-hd-cell-checkbox");if(r.hcell){var columnid=r.hcell.id.split("|")[2];r.column=g._columns[columnid]}}if(r.gridbody){r.row=fn("l-grid-row");r.cell=fn("l-grid-row-cell");r.checkbox=fn("l-grid-row-cell-btn-checkbox");r.groupbtn=fn("l-grid-group-togglebtn");r.grouprow=fn("l-grid-grouprow");r.detailbtn=fn("l-grid-row-cell-detailbtn");r.detailrow=fn("l-grid-detailpanel");r.totalrow=fn("l-grid-totalsummary");r.totalcell=fn("l-grid-totalsummary-cell");r.rownumberscell=$(r.cell).hasClass("l-grid-row-cell-rownumbers")?r.cell:null;r.detailcell=$(r.cell).hasClass("l-grid-row-cell-detail")?r.cell:null;r.checkboxcell=$(r.cell).hasClass("l-grid-row-cell-"+(g.options.isSingleCheck?"radio":"checkbox"))?r.cell:null;r.treelink=fn("l-grid-tree-link");r.editor=fn("l-grid-editor");if(r.row){r.data=this._getRowByDomId(r.row.id)}if(r.cell){r.editing=$(r.cell).hasClass("l-grid-row-cell-editing")}if(r.editor){r.editing=true}if(r.editing){r.out=false}}if(r.toolbar){r.first=fn("l-bar-btnfirst");r.last=fn("l-bar-btnlast");r.next=fn("l-bar-btnnext");r.prev=fn("l-bar-btnprev");r.load=fn("l-bar-btnload");r.button=fn("l-bar-button")}return r},_getOnePageHeight:function(){var g=this,p=this.options;return(parseFloat(p.rowHeight||24)+1)*parseInt(p.pageSize)},_setEvent:function(){var g=this,p=this.options;$(document).bind("mousedown.grid",function(e){g._onClick(e)});g.grid.bind("dblclick.grid",function(e){g._onDblClick.call(g,e)});g.grid.bind("contextmenu.grid",function(e){return g._onContextmenu.call(g,e)});g.grid.bind("keydown.grid",function(e){var code=e.keyCode;if(code==13){g.trigger("enterdown")}else{if(p.selectable&&p.selectByKey&&(code==38||code==40)){e.preventDefault();var len=g.selected.length,selectedIndex=len?g.rows.indexOf(g.selected[len-1])+(code==38?-1:1):0;rowdata=g.rows[selectedIndex];if(rowdata){g.select(rowdata,e.shiftKey)}}}});$(document).bind("mouseup.grid",function(e){g._onMouseUp.call(g,e)});$(window).bind("resize.grid",function(e){g._onResize.call(g)});g.gridbody.bind("scroll.grid",function(){var scrollLeft=g.gridbody.scrollLeft();var scrollTop=g.gridbody.scrollTop();if(scrollLeft!=null){g.gridheader[0].scrollLeft=scrollLeft}if(scrollTop!=null){g.f.gridbody[0].scrollTop=scrollTop}if(p.scrollToPage&&p.usePager&&!g.loading){var innerHeight=g.gridbody.find(".l-grid-body-inner:first").height();var toHeight=scrollTop+g.gridbody.height();if(p.scrollToAppend){if(p.newPage!=p.pageCount){if(toHeight>=innerHeight){g.reload(p.newPage+1,"scrollappend")}}}else{var topage=toHeight>=innerHeight?p.pageCount:Math.ceil(toHeight/g._getOnePageHeight());if(!g.scrollLoading){g.scrollLoading=true;g.lastScrollTop=scrollTop;g.unbind("sysScrollLoaded");g.bind("sysScrollLoaded",function(){g.gridbody.scrollTop(scrollTop);setTimeout(function(){g.scrollLoading=false},500)});g.scrollLoading=true;g.reload(topage,"scroll")}}}g.trigger("SysGridHeightChanged")}).bind("mousewheel",function(event){if(g.editor.editing){g.endEdit()}});$("select",g.toolbar).change(function(){if(g.isDataChanged&&p.dataAction!="local"&&!confirm(p.isContinueByDataChanged)){return false}p.newPage=1;p.pageSize=this.value;g.loadData(p.dataAction!="local"?p.where:false)});$("span.pcontrol :text",g.toolbar).blur(function(e){g.changePage("input")});$("div.l-bar-button",g.toolbar).hover(function(){$(this).addClass("l-bar-button-over")},function(){$(this).removeClass("l-bar-button-over")});if($.fn.ligerDrag&&p.colDraggable){g.colDroptip=$("<div class='l-drag-coldroptip' style='display:none'><div class='l-drop-move-up'></div><div class='l-drop-move-down'></div></div>").appendTo("body");g.gridheader.add(g.f.gridheader).ligerDrag({revert:true,animate:false,proxyX:0,proxyY:0,proxy:function(draggable,e){var src=g._getSrcElementByEvent(e);if(src.hcell&&src.column){var content=$(".l-grid-hd-cell-text:first",src.hcell).html();var proxy=$("<div class='l-drag-proxy' style='display:none'><div class='l-drop-icon l-drop-no'></div></div>").appendTo("body");proxy.append(content);return proxy}},onRevert:function(){return false},onRendered:function(){this.set("cursor","default");g.children[this.id]=this},onStartDrag:function(current,e){if(e.button==2){return false}if(g.colresizing){return false}this.set("cursor","default");var src=g._getSrcElementByEvent(e);if(!src.hcell||!src.column||src.column.issystem||src.hcelltext){return false}if($(src.hcell).css("cursor").indexOf("resize")!=-1){return false}this.draggingColumn=src.column;g.coldragging=true;var gridOffset=g.grid.offset();this.validRange={top:gridOffset.top,bottom:gridOffset.top+g.gridheader.height(),left:gridOffset.left-10,right:gridOffset.left+g.grid.width()+10}},onDrag:function(current,e){this.set("cursor","default");var column=this.draggingColumn;if(!column){return false}if(g.colresizing){return false}if(g.colDropIn==null){g.colDropIn=-1}var pageX=e.pageX;var pageY=e.pageY;var visit=false;var gridOffset=g.grid.offset();var validRange=this.validRange;if(pageX<validRange.left||pageX>validRange.right||pageY>validRange.bottom||pageY<validRange.top){g.colDropIn=-1;g.colDroptip.hide();this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes").addClass("l-drop-no");return}for(var colid in g._columns){var col=g._columns[colid];if(column==col){visit=true;continue}if(col.issystem){continue}var sameLevel=col.__level==column.__level;var isAfter=!sameLevel?false:visit?true:false;if(column.frozen!=col.frozen){isAfter=col.frozen?false:true}if(g.colDropIn!=-1&&g.colDropIn!=colid){continue}var cell=document.getElementById(col.__domid);var offset=$(cell).offset();var range={top:offset.top,bottom:offset.top+$(cell).height(),left:offset.left-10,right:offset.left+10};if(isAfter){var cellwidth=$(cell).width();range.left+=cellwidth;range.right+=cellwidth}if(pageX>range.left&&pageX<range.right&&pageY>range.top&&pageY<range.bottom){var height=p.headerRowHeight;if(col.__rowSpan){height*=col.__rowSpan}g.colDroptip.css({left:range.left+5,top:range.top-9,height:height+9*2}).show();g.colDropIn=colid;g.colDropDir=isAfter?"right":"left";this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no").addClass("l-drop-yes");break}else{if(g.colDropIn!=-1){g.colDropIn=-1;g.colDroptip.hide();this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes").addClass("l-drop-no")}}}},onStopDrag:function(current,e){var column=this.draggingColumn;g.coldragging=false;if(g.colDropIn!=-1){g.changeCol.ligerDefer(g,0,[column,g.colDropIn,g.colDropDir=="right"]);g.colDropIn=-1}g.colDroptip.hide();this.set("cursor","default")}})}if($.fn.ligerDrag&&p.rowDraggable){g.rowDroptip=$("<div class='l-drag-rowdroptip' style='display:none'></div>").appendTo("body");g.gridbody.add(g.f.gridbody).ligerDrag({revert:true,animate:false,proxyX:0,proxyY:0,proxy:function(draggable,e){var src=g._getSrcElementByEvent(e);if(src.row){var content=p.draggingMessage.replace(/{count}/,draggable.draggingRows?draggable.draggingRows.length:1);if(p.rowDraggingRender){content=p.rowDraggingRender(draggable.draggingRows,draggable,g)}var proxy=$("<div class='l-drag-proxy' style='display:none'><div class='l-drop-icon l-drop-no'></div>"+content+"</div>").appendTo("body");return proxy}},onRevert:function(){return false},onRendered:function(){this.set("cursor","default");g.children[this.id]=this},onStartDrag:function(current,e){if(e.button==2){return false}if(g.colresizing){return false}if(!g.columns.length){return false}this.set("cursor","default");var src=g._getSrcElementByEvent(e);if(!src.cell||!src.data||src.checkbox){return false}var ids=src.cell.id.split("|");var column=g._columns[ids[ids.length-1]];if(src.rownumberscell||src.detailcell||src.checkboxcell||column==g.columns[0]){if(g.enabledCheckbox()){this.draggingRows=g.getSelecteds();if(!this.draggingRows||!this.draggingRows.length){return false}}else{this.draggingRows=[src.data]}this.draggingRow=src.data;this.set("cursor","move");g.rowdragging=true;this.validRange={top:g.gridbody.offset().top,bottom:g.gridbody.offset().top+g.gridbody.height(),left:g.grid.offset().left-10,right:g.grid.offset().left+g.grid.width()+10}}else{return false}},onDrag:function(current,e){var rowdata=this.draggingRow;if(!rowdata){return false}var rows=this.draggingRows?this.draggingRows:[rowdata];if(g.colresizing){return false}if(g.rowDropIn==null){g.rowDropIn=-1}var pageX=e.pageX;var pageY=e.pageY;var visit=false;var validRange=this.validRange;if(pageX<validRange.left||pageX>validRange.right||pageY>validRange.bottom||pageY<validRange.top){g.rowDropIn=-1;g.rowDroptip.hide();this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes l-drop-add").addClass("l-drop-no");return}for(var i in g.rows){var rd=g.rows[i];var rowid=rd.__id;if(rowdata==rd){visit=true}if($.inArray(rd,rows)!=-1){continue}var isAfter=visit?true:false;if(g.rowDropIn!=-1&&g.rowDropIn!=rowid){continue}var rowobj=g.getRowObj(rowid);var offset=$(rowobj).offset();var range={top:offset.top-4,bottom:offset.top+$(rowobj).height()+4,left:g.grid.offset().left,right:g.grid.offset().left+g.grid.width()};if(pageX>range.left&&pageX<range.right&&pageY>range.top&&pageY<range.bottom){var lineTop=offset.top;if(isAfter){lineTop+=$(rowobj).height()}g.rowDroptip.css({left:range.left,top:lineTop,width:range.right-range.left}).show();g.rowDropIn=rowid;g.rowDropDir=isAfter?"bottom":"top";if(p.tree&&pageY>range.top+5&&pageY<range.bottom-5){this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no l-drop-yes").addClass("l-drop-add");g.rowDroptip.hide();g.rowDropInParent=true}else{this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no l-drop-add").addClass("l-drop-yes");g.rowDroptip.show();g.rowDropInParent=false}break}else{if(g.rowDropIn!=-1){g.rowDropIn=-1;g.rowDropInParent=false;g.rowDroptip.hide();this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes  l-drop-add").addClass("l-drop-no")}}}},onStopDrag:function(current,e){var rows=this.draggingRows;g.rowdragging=false;for(var i=0;i<rows.length;i++){var children=rows[i].children;if(children){rows=$.grep(rows,function(node,i){var isIn=$.inArray(node,children)==-1;return isIn})}}if(g.rowDropIn!=-1){if(p.tree){var neardata,prow;if(g.rowDropInParent){prow=g.getRow(g.rowDropIn)}else{neardata=g.getRow(g.rowDropIn);prow=g.getParent(neardata)}g.appendRange(rows,prow,neardata,g.rowDropDir!="bottom");g.trigger("rowDragDrop",{rows:rows,parent:prow,near:neardata,after:g.rowDropDir=="bottom"})}else{g.moveRange(rows,g.rowDropIn,g.rowDropDir=="bottom");g.trigger("rowDragDrop",{rows:rows,parent:prow,near:g.getRow(g.rowDropIn),after:g.rowDropDir=="bottom"})}g.rowDropIn=-1}g.rowDroptip.hide();this.set("cursor","default")}})}},_onRowOver:function(rowParm,over){if(l.draggable.dragging){return}var g=this,p=this.options;var rowdata=g.getRow(rowParm);var methodName=over?"addClass":"removeClass";if(over&&g.editor.editing){$("tr."+p.mouseoverRowCssClass,g.gridview).removeClass(p.mouseoverRowCssClass)}if(g.enabledFrozen()){$(g.getRowObj(rowdata,true))[methodName](p.mouseoverRowCssClass)}$(g.getRowObj(rowdata,false))[methodName](p.mouseoverRowCssClass)},_onMouseUp:function(e){var g=this,p=this.options;if(l.draggable.dragging){var src=g._getSrcElementByEvent(e);if(src.hcell&&src.column){g.trigger("dragdrop",[{type:"header",column:src.column,cell:src.hcell},e])}else{if(src.row){g.trigger("dragdrop",[{type:"row",record:src.data,row:src.row},e])}}}},_onMouseDown:function(e){var g=this,p=this.options},_onContextmenu:function(e){var g=this,p=this.options;var src=g._getSrcElementByEvent(e);if(src.row){if(p.whenRClickToSelect){g.select(src.data)}if(g.hasBind("contextmenu")){return g.trigger("contextmenu",[{data:src.data,rowindex:src.data.__index,row:src.row},e])}}else{if(src.hcell){if(!p.allowHideColumn){return true}var columnindex=$(src.hcell).attr("columnindex");if(columnindex==undefined){return true}var left=(e.pageX-g.body.offset().left+parseInt(g.body[0].scrollLeft));if(columnindex==g.columns.length-1){left-=50}g.popup.css({left:left,top:g.gridheader.height()+1});g.popup.toggle();return false}}},_onDblClick:function(e){var g=this,p=this.options;var src=g._getSrcElementByEvent(e);if(src.row){g.trigger("dblClickRow",[src.data,src.data.__id,src.row])}},_onClick:function(e){var obj=(e.target||e.srcElement);var g=this,p=this.options;var src=g._getSrcElementByEvent(e);if(src.out){if(g.editor.editing&&!$.ligerui.win.grids[g.id]){g.endEdit()}if(p.allowHideColumn){g.popup.hide()}return}if(src.indetail||src.editing){return}if(g.editor.editing){g.endEdit()}if(p.allowHideColumn){if(!src.popup){g.popup.hide()}}if(src.checkboxall){var row=$(src.hrow);var uncheck=row.hasClass("l-checked");if(g.trigger("beforeCheckAllRow",[!uncheck,g.element])==false){return false}if(uncheck){row.removeClass("l-checked")}else{row.addClass("l-checked")}g.selected=[];var canSelect=this.options.canSelect;for(var rowid in g.records){var ck=true;if(canSelect){ck=canSelect(g.records[rowid])}if(ck){if(uncheck){g.unselect(g.records[rowid])}else{g.select(g.records[rowid])}}}g.trigger("checkAllRow",[!uncheck,g.element])}else{if(src.hcelltext){var hcell=$(src.hcelltext).parent().parent();if(!p.enabledSort||!src.column){return}if(src.column.isSort==false||g.rows.length==0){return}if(p.url&&p.dataAction!="local"&&g.isDataChanged&&!confirm(p.isContinueByDataChanged)){return}var sort=$(".l-grid-hd-cell-sort:first",hcell);var columnName=src.column.name;if(!columnName){return}if(sort.length>0){if(sort.hasClass("l-grid-hd-cell-sort-asc")){sort.removeClass("l-grid-hd-cell-sort-asc").addClass("l-grid-hd-cell-sort-desc");hcell.removeClass("l-grid-hd-cell-asc").addClass("l-grid-hd-cell-desc");g.trigger("ChangeSort",[columnName,"desc"]);g.changeSort(columnName,"desc")}else{if(sort.hasClass("l-grid-hd-cell-sort-desc")){sort.removeClass("l-grid-hd-cell-sort-desc").addClass("l-grid-hd-cell-sort-asc");hcell.removeClass("l-grid-hd-cell-desc").addClass("l-grid-hd-cell-asc");g.trigger("ChangeSort",[columnName,"asc"]);g.changeSort(columnName,"asc")}}}else{hcell.removeClass("l-grid-hd-cell-desc").addClass("l-grid-hd-cell-asc");$(src.hcelltext).after("<span class='l-grid-hd-cell-sort l-grid-hd-cell-sort-asc'>&nbsp;&nbsp;</span>");g.trigger("ChangeSort",[columnName,"asc"]);g.changeSort(columnName,"asc")}$(".l-grid-hd-cell-sort",g.gridheader).add($(".l-grid-hd-cell-sort",g.f.gridheader)).not($(".l-grid-hd-cell-sort:first",hcell)).remove()}else{if(src.detailbtn&&p.detail){var item=src.data;var row=$([g.getRowObj(item,false)]);if(g.enabledFrozen()){row=row.add(g.getRowObj(item,true))}var rowid=item.__id;if($(src.detailbtn).hasClass("l-open")){if(p.detail.onCollapse){p.detail.onCollapse(item,$(".l-grid-detailpanel-inner:first",nextrow)[0])}row.next("tr.l-grid-detailpanel").hide();$(src.detailbtn).removeClass("l-open")}else{var nextrow=row.next("tr.l-grid-detailpanel");if(nextrow.length>0){nextrow.show();if(p.detail.onExtend){p.detail.onExtend(item,$(".l-grid-detailpanel-inner:first",nextrow)[0])}$(src.detailbtn).addClass("l-open");g.trigger("SysGridHeightChanged");return}$(src.detailbtn).addClass("l-open");var frozenColNum=0;for(var i=0;i<g.columns.length;i++){if(g.columns[i].frozen){frozenColNum++}}var detailRow=$("<tr class='l-grid-detailpanel'><td><div class='l-grid-detailpanel-inner' style='display:none'></div></td></tr>");var detailFrozenRow=$("<tr class='l-grid-detailpanel'><td><div class='l-grid-detailpanel-inner' style='display:none'></div></td></tr>");detailRow.find("div:first").width(g.gridheader.find("div:first").width()-50);detailRow.attr("id",g.id+"|detail|"+rowid);g.detailrows=g.detailrows||[];g.detailrows.push(detailRow[0]);g.detailrows.push(detailFrozenRow[0]);var detailRowInner=$("div:first",detailRow);detailRowInner.parent().attr("colSpan",g.columns.length-frozenColNum);row.eq(0).after(detailRow);if(frozenColNum>0){detailFrozenRow.find("td:first").attr("colSpan",frozenColNum);row.eq(1).after(detailFrozenRow)}if(p.detail.onShowDetail){p.detail.onShowDetail(item,detailRowInner[0],function(){g.trigger("SysGridHeightChanged")});$("div:first",detailFrozenRow).add(detailRowInner).show().height(p.detail.height||p.detailHeight)}else{if(p.detail.render){detailRowInner.append(p.detail.render());detailRowInner.show()}}g.trigger("SysGridHeightChanged")}}else{if(src.groupbtn){var grouprow=$(src.grouprow);var opening=true;if($(src.groupbtn).hasClass("l-grid-group-togglebtn-close")){$(src.groupbtn).removeClass("l-grid-group-togglebtn-close");if(grouprow.hasClass("l-grid-grouprow-last")){$("td:first",grouprow).width("auto")}}else{opening=false;$(src.groupbtn).addClass("l-grid-group-togglebtn-close");if(grouprow.hasClass("l-grid-grouprow-last")){$("td:first",grouprow).width(g.gridtablewidth)}}var currentRow=grouprow.next(".l-grid-row,.l-grid-totalsummary-group,.l-grid-detailpanel");while(true){if(currentRow.length==0){break}if(opening){currentRow.show();if(currentRow.hasClass("l-grid-detailpanel")&&!currentRow.prev().find("td.l-grid-row-cell-detail:first span.l-grid-row-cell-detailbtn:first").hasClass("l-open")){currentRow.hide()}}else{currentRow.hide()}currentRow=currentRow.next(".l-grid-row,.l-grid-totalsummary-group,.l-grid-detailpanel")}g.trigger(opening?"groupExtend":"groupCollapse");g.trigger("SysGridHeightChanged")}else{if(src.treelink){g.toggle(src.data)}else{if(src.row){var row=$(src.row),rowdata=g.getRow(src.data),rowid=rowdata.__id,rowobj=g.getRowObj(rowid),rowobj1=g.getRowObj(rowid,true);$((rowobj?[rowobj]:[]).concat(rowobj1||[])).addClass("l-current-row").siblings(".l-current-row").removeClass("l-current-row");if(g.enabledCheckbox()){var selectRowButtonOnly=p.selectRowButtonOnly?true:false;if(p.enabledEdit){selectRowButtonOnly=true}if(obj.tagName.toLowerCase()=="a"){return}if((src.checkbox||!selectRowButtonOnly)&&p.selectable!=false){var uncheck=row.hasClass("l-selected");if(g.trigger("beforeCheckRow",[!uncheck,src.data,src.data.__id,src.row])==false){return false}var met=uncheck?"unselect":"select";g[met](src.data);if(p.tree&&p.autoCheckChildren){var children=g.getChildren(src.data,true);for(var i=0,l=children.length;i<l;i++){g[met](children[i])}}g.trigger("checkRow",[!uncheck,src.data,src.data.__id,src.row])}if(!src.checkbox&&src.cell&&p.enabledEdit&&p.clickToEdit){setTimeout(function(){g._applyEditor(src.cell)},100)}}else{if(p.selectable!=false){if(src.cell&&p.enabledEdit&&p.clickToEdit){g._applyEditor(src.cell)}if(row.hasClass("l-selected")){if(!p.allowUnSelectRow){row.addClass("l-selected-again");return}g.unselect(src.data)}else{g.select(src.data,e.ctrlKey)}}}}else{if(src.toolbar){if(src.first){if(g.trigger("toFirst",[g.element])==false){return false}g.changePage("first")}else{if(src.prev){if(g.trigger("toPrev",[g.element])==false){return false}g.changePage("prev")}else{if(src.next){if(g.trigger("toNext",[g.element])==false){return false}g.changePage("next")}else{if(src.last){if(g.trigger("toLast",[g.element])==false){return false}g.changePage("last")}else{if(src.load){if($("span",src.load).hasClass("l-disabled")){return false}if(g.trigger("reload",[g.element])==false){return false}if(p.url&&g.isDataChanged&&!confirm(p.isContinueByDataChanged)){return false}if(g.rows.length==0){return}g.loadData(p.where)}}}}}}}}}}}}},select:function(rowParm,ctrlKey){var g=this,p=this.options;var rowdata=g.getRow(rowParm);var rowid=rowdata.__id;var rowobj=g.getRowObj(rowid);if(!p.rowSelectable||g.trigger("beforeSelectRow",[rowdata,rowid,rowobj])==false){return}var rowobj1=g.getRowObj(rowid,true);if((!g.enabledCheckbox()&&!ctrlKey)||p.isSingleCheck){for(var i in g.selected){var o=g.selected[i];if(o.__id in g.records){$(g.getRowObj(o)).removeClass("l-selected l-selected-again");if(g.enabledFrozen()){$(g.getRowObj(o,true)).removeClass("l-selected l-selected-again")}}}g.selected=[]}if(rowobj){$(rowobj).addClass("l-selected")}if(rowobj1){$(rowobj1).addClass("l-selected")}if(!this.isSelected(rowParm)){g.selected[g.selected.length]=rowdata}g.trigger("selectRow",[rowdata,rowid,rowobj])},unselect:function(rowParm){var g=this,p=this.options;var rowdata=g.getRow(rowParm);var rowid=rowdata.__id;var rowobj=g.getRowObj(rowid);var rowobj1=g.getRowObj(rowid,true);$(rowobj).removeClass("l-selected l-selected-again");if(g.enabledFrozen()){$(rowobj1).removeClass("l-selected l-selected-again")}g._removeSelected(rowdata);g.trigger("unSelectRow",[rowdata,rowid,rowobj])},isSelected:function(rowParm){var g=this,p=this.options;var rowdata=g.getRow(rowParm);for(var i in g.selected){if(g.selected[i]==rowdata){return true}}return false},arrayToTree:function(data,id,pid){var g=this,p=this.options;var childrenName="children";if(p.tree){childrenName=p.tree.childrenName}if(!data||!data.length){return[]}var targetData=[];var records={};var itemLength=data.length;for(var i=0;i<itemLength;i++){var o=data[i];var key=getKey(o[id]);records[key]=o}for(var i=0;i<itemLength;i++){var currentData=data[i];var key=getKey(currentData[pid]);var parentData=records[key];if(!parentData){targetData.push(currentData);continue}parentData[childrenName]=parentData[childrenName]||[];parentData[childrenName].push(currentData)}return targetData;function getKey(key){if(typeof(key)=="string"){key=key.replace(/[.]/g,"").toLowerCase()}return key}},_onResize:function(){var g=this,p=this.options;if(p.height&&p.height!="auto"){var windowHeight=$(window).height();var h=0;var parentHeight=null;if(typeof(p.height)=="string"&&p.height.indexOf("%")>0){var gridparent=g.grid.parent();if(p.inWindow){parentHeight=windowHeight;parentHeight-=parseInt($("body").css("paddingTop"));parentHeight-=parseInt($("body").css("paddingBottom"))}else{parentHeight=gridparent.height()}h=parentHeight*parseInt(p.height)*0.01;if(p.inWindow||gridparent[0].tagName.toLowerCase()=="body"){h-=(g.grid.offset().top-parseInt($("body").css("paddingTop")))}}else{h=parseInt(p.height)}h+=p.heightDiff;g.windowHeight=windowHeight;g._setHeight(h)}else{g._updateHorizontalScrollStatus.ligerDefer(g,10)}if(g.enabledFrozen()){var gridView1Width=g.gridview1.width();var gridViewWidth=g.gridview.width();g.gridview2.css({width:gridViewWidth-gridView1Width})}g.trigger("SysGridHeightChanged")},showFilter:function(){var g=this,p=this.options;if(g.winfilter){g.winfilter.show();return}var filtercontainer=$('<div id="'+g.id+'_filtercontainer"></div>').width(380).height(120).hide();var filter=filtercontainer.ligerFilter({fields:getFields()});filter.addRule($(filter.element.firstChild));return g.winfilter=$.ligerDialog.open({width:420,height:208,target:filtercontainer,isResize:true,top:50,buttons:[{text:"确定",onclick:function(item,dialog){loadData();dialog.hide()}},{text:"取消",onclick:function(item,dialog){dialog.hide()}}]});function getFields(){var fields=[];$(g.columns).each(function(){var o={name:this.name,display:this.display};var isNumber=this.type=="int"||this.type=="number"||this.type=="float";var isDate=this.type=="date";if(isNumber){o.type="number"}if(isDate){o.type="date"}if(this.editor){o.editor=this.editor}fields.push(o)});return fields}function loadData(){var data=filter.getData();if(g.options.dataType=="server"){loadServerData(data)}else{loadClientData(data)}}function loadServerData(data){if(data&&data.rules&&data.rules.length){g.setParm("where",JSON.stringify(data))}else{g.removeParm("where")}g.loadData()}function loadClientData(data){g.loadData($.ligerFilter.getFilterFunction(data))}}});$.ligerui.controls.Grid.prototype.enabledTotal=$.ligerui.controls.Grid.prototype.isTotalSummary;$.ligerui.controls.Grid.prototype.add=$.ligerui.controls.Grid.prototype.addRow;$.ligerui.controls.Grid.prototype.update=$.ligerui.controls.Grid.prototype.updateRow;$.ligerui.controls.Grid.prototype.append=$.ligerui.controls.Grid.prototype.appendRow;$.ligerui.controls.Grid.prototype.getSelected=$.ligerui.controls.Grid.prototype.getSelectedRow;$.ligerui.controls.Grid.prototype.getSelecteds=$.ligerui.controls.Grid.prototype.getSelectedRows;$.ligerui.controls.Grid.prototype.getCheckedRows=$.ligerui.controls.Grid.prototype.getSelectedRows;$.ligerui.controls.Grid.prototype.getCheckedRowObjs=$.ligerui.controls.Grid.prototype.getSelectedRowObjs;$.ligerui.controls.Grid.prototype.setOptions=$.ligerui.controls.Grid.prototype.set;$.ligerui.controls.Grid.prototype.reload=$.ligerui.controls.Grid.prototype.loadData;$.ligerui.controls.Grid.prototype.refreshSize=$.ligerui.controls.Grid.prototype._onResize;function removeArrItem(arr,filterFn){for(var i=arr.length-1;i>=0;i--){if(filterFn(arr[i])){arr.splice(i,1)}}}})(jQuery);(function(a){a.fn.ligerLayout=function(b){return a.ligerui.run.call(this,"ligerLayout",arguments)};a.fn.ligerGetLayoutManager=function(){return a.ligerui.run.call(this,"ligerGetLayoutManager",arguments)};a.ligerDefaults.Layout={topHeight:50,bottomHeight:50,leftWidth:110,centerWidth:300,rightWidth:170,centerBottomHeight:100,allowCenterBottomResize:true,inWindow:true,heightDiff:0,height:"100%",onHeightChanged:null,isLeftCollapse:false,isRightCollapse:false,allowLeftCollapse:true,allowRightCollapse:true,allowLeftResize:true,allowRightResize:true,allowTopResize:true,allowBottomResize:true,space:3,onEndResize:null,minLeftWidth:80,minRightWidth:80};a.ligerMethos.Layout={};a.ligerui.controls.Layout=function(c,b){a.ligerui.controls.Layout.base.constructor.call(this,c,b)};a.ligerui.controls.Layout.ligerExtend(a.ligerui.core.UIComponent,{__getType:function(){return"Layout"},__idPrev:function(){return"Layout"},_extendMethods:function(){return a.ligerMethos.Layout},_init:function(){a.ligerui.controls.Layout.base._init.call(this);var b=this,c=this.options;if(c.InWindow!=null&&c.inWindow==null){c.inWindow=c.InWindow}},_render:function(){var e=this,h=this.options;e.layout=a(this.element);e.layout.addClass("l-layout");e.width=e.layout.width();if(a("> div[position=top]",e.layout).length>0){e.top=a("> div[position=top]",e.layout).wrap('<div class="l-layout-top" style="top:0px;"></div>').parent();e.top.content=a("> div[position=top]",e.top);if(!e.top.content.hasClass("l-layout-content")){e.top.content.addClass("l-layout-content")}e.topHeight=h.topHeight;if(e.topHeight){e.top.height(e.topHeight)}}if(a("> div[position=bottom]",e.layout).length>0){e.bottom=a("> div[position=bottom]",e.layout).wrap('<div class="l-layout-bottom"></div>').parent();e.bottom.content=a("> div[position=bottom]",e.bottom);if(!e.bottom.content.hasClass("l-layout-content")){e.bottom.content.addClass("l-layout-content")}e.bottomHeight=h.bottomHeight;if(e.bottomHeight){e.bottom.height(e.bottomHeight)}var c=e.bottom.content.attr("title");if(c){e.bottom.header=a('<div class="l-layout-header"></div>');e.bottom.prepend(e.bottom.header);e.bottom.header.html(c);e.bottom.content.attr("title","")}}if(a("> div[position=left]",e.layout).length>0){e.left=a("> div[position=left]",e.layout).wrap('<div class="l-layout-left" style="left:0px;"></div>').parent();e.left.header=a('<div class="l-layout-header"><div class="l-layout-header-toggle"></div><div class="l-layout-header-inner"></div></div>');e.left.prepend(e.left.header);e.left.header.toggle=a(".l-layout-header-toggle",e.left.header);e.left.content=a("> div[position=left]",e.left);if(!e.left.content.hasClass("l-layout-content")){e.left.content.addClass("l-layout-content")}if(!h.allowLeftCollapse){a(".l-layout-header-toggle",e.left.header).remove()}var d=e.left.content.attr("title");if(d){e.left.content.attr("title","");a(".l-layout-header-inner",e.left.header).html(d)}if(e.left.content.attr("hidetitle")){e.left.content.attr("title","");e.left.header.remove()}e.leftWidth=h.leftWidth;if(e.leftWidth){e.left.width(e.leftWidth)}}if(a("> div[position=center]",e.layout).length>0){e.center=a("> div[position=center]",e.layout).wrap('<div class="l-layout-center" ></div>').parent();e.center.content=a("> div[position=center]",e.center);e.center.content.addClass("l-layout-content");var b=e.center.content.attr("title");if(b){e.center.content.attr("title","");e.center.header=a('<div class="l-layout-header"></div>');e.center.prepend(e.center.header);e.center.header.html(b)}if(e.center.content.attr("hidetitle")){e.center.content.attr("title","");e.center.header.remove()}e.centerWidth=h.centerWidth;if(e.centerWidth){e.center.width(e.centerWidth)}if(a("> div[position=centerbottom]",e.layout).length>0){e.centerBottom=a("> div[position=centerbottom]",e.layout).wrap('<div class="l-layout-centerbottom" ></div>').parent();e.centerBottom.content=a("> div[position=centerbottom]",e.centerBottom);e.centerBottom.content.addClass("l-layout-content");var b=e.centerBottom.content.attr("title");if(b){e.centerBottom.content.attr("title","");e.centerBottom.header=a('<div class="l-layout-header"></div>');e.centerBottom.prepend(e.centerBottom.header);e.centerBottom.header.html(b)}if(e.centerBottom.content.attr("hidetitle")){e.centerBottom.content.attr("title","");if(e.centerBottom.header){e.centerBottom.header.remove()}}if(e.centerWidth){e.centerBottom.width(e.centerWidth)}}}if(a("> div[position=right]",e.layout).length>0){e.right=a("> div[position=right]",e.layout).wrap('<div class="l-layout-right"></div>').parent();e.right.header=a('<div class="l-layout-header"><div class="l-layout-header-toggle"></div><div class="l-layout-header-inner"></div></div>');e.right.prepend(e.right.header);e.right.header.toggle=a(".l-layout-header-toggle",e.right.header);if(!h.allowRightCollapse){a(".l-layout-header-toggle",e.right.header).remove()}e.right.content=a("> div[position=right]",e.right);if(!e.right.content.hasClass("l-layout-content")){e.right.content.addClass("l-layout-content")}var f=e.right.content.attr("title");if(f){e.right.content.attr("title","");a(".l-layout-header-inner",e.right.header).html(f)}if(e.right.content.attr("hidetitle")){e.right.content.attr("title","");e.right.header.remove()}e.rightWidth=h.rightWidth;if(e.rightWidth){e.right.width(e.rightWidth)}}e.layout.lock=a("<div class='l-layout-lock'></div>");e.layout.append(e.layout.lock);e._addDropHandle();e.isLeftCollapse=h.isLeftCollapse;e.isRightCollapse=h.isRightCollapse;e.leftCollapse=a('<div class="l-layout-collapse-left" style="display: none; "><div class="l-layout-collapse-left-toggle"></div></div>');e.rightCollapse=a('<div class="l-layout-collapse-right" style="display: none; "><div class="l-layout-collapse-right-toggle"></div></div>');e.layout.append(e.leftCollapse).append(e.rightCollapse);e.leftCollapse.toggle=a("> .l-layout-collapse-left-toggle",e.leftCollapse);e.rightCollapse.toggle=a("> .l-layout-collapse-right-toggle",e.rightCollapse);e._setCollapse();e._bulid();a(window).resize(function(){e._onResize()});e.set(h);e.mask.height(e.layout.height())},setLeftCollapse:function(c){var b=this,d=this.options;if(!b.left){return false}b.isLeftCollapse=c;if(b.isLeftCollapse){b.leftCollapse.show();b.leftDropHandle&&b.leftDropHandle.hide();b.left.hide()}else{b.leftCollapse.hide();b.leftDropHandle&&b.leftDropHandle.show();b.left.show()}b._onResize()},setRightCollapse:function(c){var b=this,d=this.options;if(!b.right){return false}b.isRightCollapse=c;b._onResize();if(b.isRightCollapse){b.rightCollapse.show();b.rightDropHandle&&b.rightDropHandle.hide();b.right.hide()}else{b.rightCollapse.hide();b.rightDropHandle&&b.rightDropHandle.show();b.right.show()}b._onResize()},_bulid:function(){var b=this,c=this.options;a("> .l-layout-left .l-layout-header,> .l-layout-right .l-layout-header",b.layout).hover(function(){a(this).addClass("l-layout-header-over")},function(){a(this).removeClass("l-layout-header-over")});a(".l-layout-header-toggle",b.layout).hover(function(){a(this).addClass("l-layout-header-toggle-over")},function(){a(this).removeClass("l-layout-header-toggle-over")});a(".l-layout-header-toggle",b.left).click(function(){b.setLeftCollapse(true)});a(".l-layout-header-toggle",b.right).click(function(){b.setRightCollapse(true)});b.middleTop=0;if(b.top){b.middleTop+=b.top.height();b.middleTop+=parseInt(b.top.css("borderTopWidth"));b.middleTop+=parseInt(b.top.css("borderBottomWidth"));b.middleTop+=c.space}if(b.left){b.left.css({top:b.middleTop});b.leftCollapse.css({top:b.middleTop})}if(b.center){b.center.css({top:b.middleTop})}if(b.right){b.right.css({top:b.middleTop});b.rightCollapse.css({top:b.middleTop})}if(b.left){b.left.css({left:0})}b._onResize();b._onResize()},_setCollapse:function(){var b=this,c=this.options;b.leftCollapse.hover(function(){a(this).addClass("l-layout-collapse-left-over")},function(){a(this).removeClass("l-layout-collapse-left-over")});b.leftCollapse.toggle.hover(function(){a(this).addClass("l-layout-collapse-left-toggle-over")},function(){a(this).removeClass("l-layout-collapse-left-toggle-over")});b.rightCollapse.hover(function(){a(this).addClass("l-layout-collapse-right-over")},function(){a(this).removeClass("l-layout-collapse-right-over")});b.rightCollapse.toggle.hover(function(){a(this).addClass("l-layout-collapse-right-toggle-over")},function(){a(this).removeClass("l-layout-collapse-right-toggle-over")});b.leftCollapse.toggle.click(function(){b.setLeftCollapse(false)});b.rightCollapse.toggle.click(function(){b.setRightCollapse(false)});if(b.left&&b.isLeftCollapse){b.leftCollapse.show();b.leftDropHandle&&b.leftDropHandle.hide();b.left.hide()}if(b.right&&b.isRightCollapse){b.rightCollapse.show();b.rightDropHandle&&b.rightDropHandle.hide();b.right.hide()}},_addDropHandle:function(){var b=this,c=this.options;if(b.left&&c.allowLeftResize){b.leftDropHandle=a("<div class='l-layout-drophandle-left'></div>");b.layout.append(b.leftDropHandle);b.leftDropHandle&&b.leftDropHandle.show();b.leftDropHandle.mousedown(function(d){b._start("leftresize",d)})}if(b.right&&c.allowRightResize){b.rightDropHandle=a("<div class='l-layout-drophandle-right'></div>");b.layout.append(b.rightDropHandle);b.rightDropHandle&&b.rightDropHandle.show();b.rightDropHandle.mousedown(function(d){b._start("rightresize",d)})}if(b.top&&c.allowTopResize){b.topDropHandle=a("<div class='l-layout-drophandle-top'></div>");b.layout.append(b.topDropHandle);b.topDropHandle.show();b.topDropHandle.mousedown(function(d){b._start("topresize",d)})}if(b.bottom&&c.allowBottomResize){b.bottomDropHandle=a("<div class='l-layout-drophandle-bottom'></div>");b.layout.append(b.bottomDropHandle);b.bottomDropHandle.show();b.bottomDropHandle.mousedown(function(d){b._start("bottomresize",d)})}if(b.centerBottom&&c.allowCenterBottomResize){b.centerBottomDropHandle=a("<div class='l-layout-drophandle-centerbottom'></div>");b.layout.append(b.centerBottomDropHandle);b.centerBottomDropHandle.show();b.centerBottomDropHandle.mousedown(function(d){b._start("centerbottomresize",d)})}b.draggingxline=a("<div class='l-layout-dragging-xline'></div>");b.draggingyline=a("<div class='l-layout-dragging-yline'></div>");b.mask=a("<div class='l-dragging-mask'></div>");b.layout.append(b.draggingxline).append(b.draggingyline).append(b.mask)},_setDropHandlePosition:function(){var b=this,c=this.options;if(b.leftDropHandle){b.leftDropHandle.css({left:b.left.width()+parseInt(b.left.css("left")),height:b.middleHeight,top:b.middleTop})}if(b.rightDropHandle){b.rightDropHandle.css({left:parseInt(b.right.css("left"))-c.space,height:b.middleHeight,top:b.middleTop})}if(b.topDropHandle){b.topDropHandle.css({top:b.top.height()+parseInt(b.top.css("top")),width:b.top.width()})}if(b.bottomDropHandle){b.bottomDropHandle.css({top:parseInt(b.bottom.css("top"))-c.space,width:b.bottom.width()})}if(b.centerBottomDropHandle){b.centerBottomDropHandle.css({top:parseInt(b.centerBottom.css("top"))-c.space,left:parseInt(b.center.css("left")),width:b.center.width()})}},_onResize:function(){var j=this,k=this.options;var b=j.layout.height();var e=0;var m=a(window).height();var d=null;if(typeof(k.height)=="string"&&k.height.indexOf("%")>0){var c=j.layout.parent();if(k.inWindow||c[0].tagName.toLowerCase()=="body"){d=m;d-=parseInt(a("body").css("paddingTop"));d-=parseInt(a("body").css("paddingBottom"))}else{d=c.height()}e=d*parseFloat(k.height)*0.01;if(k.inWindow||c[0].tagName.toLowerCase()=="body"){e-=(j.layout.offset().top-parseInt(a("body").css("paddingTop")))}}else{e=parseInt(k.height)}e+=k.heightDiff;j.layout.height(e);j.layoutHeight=j.layout.height();j.middleWidth=j.layout.width();j.middleHeight=j.layout.height();if(j.top){j.middleHeight-=j.top.height();j.middleHeight-=parseInt(j.top.css("borderTopWidth"));j.middleHeight-=parseInt(j.top.css("borderBottomWidth"));j.middleHeight-=k.space}if(j.bottom){j.middleHeight-=j.bottom.height();j.middleHeight-=parseInt(j.bottom.css("borderTopWidth"));j.middleHeight-=parseInt(j.bottom.css("borderBottomWidth"));j.middleHeight-=k.space}j.middleHeight-=2;if(j.hasBind("heightChanged")&&j.layoutHeight!=b){j.trigger("heightChanged",[{layoutHeight:j.layoutHeight,diff:j.layoutHeight-b,middleHeight:j.middleHeight}])}if(j.center){j.centerWidth=j.middleWidth;if(j.left){if(j.isLeftCollapse){j.centerWidth-=j.leftCollapse.width();j.centerWidth-=parseInt(j.leftCollapse.css("borderLeftWidth"));j.centerWidth-=parseInt(j.leftCollapse.css("borderRightWidth"));j.centerWidth-=parseInt(j.leftCollapse.css("left"));j.centerWidth-=k.space}else{j.centerWidth-=j.leftWidth;j.centerWidth-=parseInt(j.left.css("borderLeftWidth"));j.centerWidth-=parseInt(j.left.css("borderRightWidth"));j.centerWidth-=parseInt(j.left.css("left"));j.centerWidth-=k.space}}if(j.right){if(j.isRightCollapse){j.centerWidth-=j.rightCollapse.width();j.centerWidth-=parseInt(j.rightCollapse.css("borderLeftWidth"));j.centerWidth-=parseInt(j.rightCollapse.css("borderRightWidth"));j.centerWidth-=parseInt(j.rightCollapse.css("right"));j.centerWidth-=k.space}else{j.centerWidth-=j.rightWidth;j.centerWidth-=parseInt(j.right.css("borderLeftWidth"));j.centerWidth-=parseInt(j.right.css("borderRightWidth"));j.centerWidth-=k.space}}j.centerLeft=0;if(j.left){if(j.isLeftCollapse){j.centerLeft+=j.leftCollapse.width();j.centerLeft+=parseInt(j.leftCollapse.css("borderLeftWidth"));j.centerLeft+=parseInt(j.leftCollapse.css("borderRightWidth"));j.centerLeft+=parseInt(j.leftCollapse.css("left"));j.centerLeft+=k.space}else{j.centerLeft+=j.left.width();j.centerLeft+=parseInt(j.left.css("borderLeftWidth"));j.centerLeft+=parseInt(j.left.css("borderRightWidth"));j.centerLeft+=k.space}}j.center.css({left:j.centerLeft});j.centerWidth>=0&&j.center.width(j.centerWidth);j.middleHeight>=0&&j.center.height(j.middleHeight);var f=j.middleHeight;if(j.center.header){f-=j.center.header.height()}f>=0&&j.center.content.height(f);j._updateCenterBottom(true)}if(j.left){j.leftCollapse.height(j.middleHeight);j.left.height(j.middleHeight)}if(j.right){j.rightCollapse.height(j.middleHeight);j.right.height(j.middleHeight);j.rightLeft=0;if(j.left){if(j.isLeftCollapse){j.rightLeft+=j.leftCollapse.width();j.rightLeft+=parseInt(j.leftCollapse.css("borderLeftWidth"));j.rightLeft+=parseInt(j.leftCollapse.css("borderRightWidth"));j.rightLeft+=k.space}else{j.rightLeft+=j.left.width();j.rightLeft+=parseInt(j.left.css("borderLeftWidth"));j.rightLeft+=parseInt(j.left.css("borderRightWidth"));j.rightLeft+=parseInt(j.left.css("left"));j.rightLeft+=k.space}}if(j.center){j.rightLeft+=j.center.width();j.rightLeft+=parseInt(j.center.css("borderLeftWidth"));j.rightLeft+=parseInt(j.center.css("borderRightWidth"));j.rightLeft+=k.space}j.right.css({left:j.rightLeft})}if(j.bottom){j.bottomTop=j.layoutHeight-j.bottom.height()-2;j.bottom.css({top:j.bottomTop})}j._setDropHandlePosition()},_updateCenterBottom:function(c){var e=this,j=this.options;if(e.centerBottom){if(c){var b=e.centerBottomHeight||j.centerBottomHeight;e.centerBottom.css({left:e.centerLeft});e.centerWidth>=0&&e.centerBottom.width(e.centerWidth);var d=e.center.height(),f=parseInt(e.center.css("top"));e.centerBottom.height(b);e.centerBottom.css({top:f+d-b+2});e.center.height(d-b-2)}var h=parseInt(e.center.css("left"));e.centerBottom.width(e.center.width()).css({left:h})}},_start:function(f,d){var b=this,c=this.options;b.dragtype=f;if(f=="leftresize"||f=="rightresize"){b.xresize={startX:d.pageX};b.draggingyline.css({left:d.pageX-b.layout.offset().left,height:b.middleHeight,top:b.middleTop}).show();a("body").css("cursor","col-resize");b.mask.height(b.layout.height()).removeClass("l-layout-ymask").addClass("l-layout-xmask").show()}else{if(f=="topresize"||f=="bottomresize"){b.yresize={startY:d.pageY};b.draggingxline.css({top:d.pageY-b.layout.offset().top,width:b.layout.width()}).show();a("body").css("cursor","row-resize");b.mask.height(b.layout.height()).removeClass("l-layout-xmask").addClass("l-layout-ymask").show()}else{if(f=="centerbottomresize"){b.yresize={startY:d.pageY};b.draggingxline.css({top:d.pageY-b.layout.offset().top,width:b.layout.width()}).show();a("body").css("cursor","row-resize");b.mask.height(b.layout.height()).removeClass("l-layout-xmask").addClass("l-layout-ymask").show()}else{return}}}b.layout.lock.width(b.layout.width());b.layout.lock.height(b.layout.height());b.layout.lock.show();if(a.browser.msie||a.browser.safari){a("body").bind("selectstart",function(){return false})}a(document).bind("mouseup",function(){b._stop.apply(b,arguments)});a(document).bind("mousemove",function(){b._drag.apply(b,arguments)})},_drag:function(d){var b=this,c=this.options;if(b.xresize){b.xresize.diff=d.pageX-b.xresize.startX;b.draggingyline.css({left:d.pageX-b.layout.offset().left});a("body").css("cursor","col-resize")}else{if(b.yresize){b.yresize.diff=d.pageY-b.yresize.startY;b.draggingxline.css({top:d.pageY-b.layout.offset().top});a("body").css("cursor","row-resize")}}},_stop:function(h){var b=this,f=this.options;var d;if(b.xresize&&b.xresize.diff!=undefined){d=b.xresize.diff;if(b.dragtype=="leftresize"){if(f.minLeftWidth){if(b.leftWidth+b.xresize.diff<f.minLeftWidth){return}}b.leftWidth+=b.xresize.diff;b.left.width(b.leftWidth);if(b.center){b.center.width(b.center.width()-b.xresize.diff).css({left:parseInt(b.center.css("left"))+b.xresize.diff})}else{if(b.right){b.right.width(b.left.width()-b.xresize.diff).css({left:parseInt(b.right.css("left"))+b.xresize.diff})}}}else{if(b.dragtype=="rightresize"){if(f.minRightWidth){if(b.rightWidth-b.xresize.diff<f.minRightWidth){return}}b.rightWidth-=b.xresize.diff;b.right.width(b.rightWidth).css({left:parseInt(b.right.css("left"))+b.xresize.diff});if(b.center){b.center.width(b.center.width()+b.xresize.diff)}else{if(b.left){b.left.width(b.left.width()+b.xresize.diff)}}}}b._updateCenterBottom()}else{if(b.yresize&&b.yresize.diff!=undefined){d=b.yresize.diff;if(b.dragtype=="topresize"){b.top.height(b.top.height()+b.yresize.diff);b.middleTop+=b.yresize.diff;b.middleHeight-=b.yresize.diff;if(b.left){b.left.css({top:b.middleTop}).height(b.middleHeight);b.leftCollapse.css({top:b.middleTop}).height(b.middleHeight)}if(b.center){b.center.css({top:b.middleTop}).height(b.middleHeight)}if(b.right){b.right.css({top:b.middleTop}).height(b.middleHeight);b.rightCollapse.css({top:b.middleTop}).height(b.middleHeight)}b._updateCenterBottom(true)}else{if(b.dragtype=="bottomresize"){b.bottom.height(b.bottom.height()-b.yresize.diff);b.middleHeight+=b.yresize.diff;b.bottomTop+=b.yresize.diff;b.bottom.css({top:b.bottomTop});if(b.left){b.left.height(b.middleHeight);b.leftCollapse.height(b.middleHeight)}if(b.center){b.center.height(b.middleHeight)}if(b.right){b.right.height(b.middleHeight);b.rightCollapse.height(b.middleHeight)}b._updateCenterBottom(true)}else{if(b.dragtype=="centerbottomresize"){b.centerBottomHeight=b.centerBottomHeight||f.centerBottomHeight;b.centerBottomHeight-=b.yresize.diff;var c=parseInt(b.centerBottom.css("top"));b.centerBottom.css("top",c+b.yresize.diff);b.centerBottom.height(b.centerBottom.height()-b.yresize.diff);b.center.height(b.center.height()+b.yresize.diff)}}}}}b.trigger("endResize",[{direction:b.dragtype?b.dragtype.replace(/resize/,""):"",diff:d},h]);b._setDropHandlePosition();b.draggingxline.hide();b.draggingyline.hide();b.mask.hide();b.xresize=b.yresize=b.dragtype=false;b.layout.lock.hide();if(a.browser.msie||a.browser.safari){a("body").unbind("selectstart")}a(document).unbind("mousemove",b._drag);a(document).unbind("mouseup",b._stop);a("body").css("cursor","")}})})(jQuery);(function(a){a.fn.ligerListBox=function(b){return a.ligerui.run.call(this,"ligerListBox",arguments)};a.ligerDefaults.ListBox={isMultiSelect:false,isShowCheckBox:false,columns:null,width:150,height:100,onSelect:false,onSelected:null,valueField:"id",textField:"text",valueFieldID:null,split:";",data:null,parms:null,url:null,urlParms:null,ajaxContentType:null,ajaxType:"post",onSuccess:null,onError:null,render:null,css:null,value:null,valueFieldCssClass:null};a.ligerMethos.ListBox=a.ligerMethos.ListBox||{};a.ligerui.controls.ListBox=function(c,b){a.ligerui.controls.ListBox.base.constructor.call(this,c,b)};a.ligerui.controls.ListBox.ligerExtend(a.ligerui.controls.Input,{__getType:function(){return"ListBox"},_extendMethods:function(){return a.ligerMethos.ListBox},_init:function(){a.ligerui.controls.ListBox.base._init.call(this)},_render:function(){var b=this,c=this.options;b.data=c.data;b.valueField=null;if(a(this.element).is(":hidden")||a(this.element).is(":text")){b.valueField=a(this.element);if(a(this.element).is(":text")){b.valueField.hide()}}else{if(c.valueFieldID){b.valueField=a("#"+c.valueFieldID+":input,[name="+c.valueFieldID+"]:input");if(b.valueField.length==0){b.valueField=a('<input type="hidden"/>')}b.valueField[0].id=b.valueField[0].name=c.valueFieldID}else{b.valueField=a('<input type="hidden"/>');b.valueField[0].id=b.valueField[0].name=b.id+"_val"}}if(b.valueField[0].name==null){b.valueField[0].name=b.valueField[0].id}if(c.valueFieldCssClass){b.valueField.addClass(c.valueFieldCssClass)}b.valueField.attr("data-ligerid",b.id);if(a(this.element).is(":hidden")||a(this.element).is(":text")){b.selectBox=a("<div></div>").insertBefore(this.element)}else{b.selectBox=a(this.element)}b.selectBox.html('<div class="l-listbox-inner"><table cellpadding="0" cellspacing="0" border="0" class="l-listbox-table"></table></div>').addClass("l-listbox").append(b.valueField);b.selectBox.table=a("table:first",b.selectBox);b.set(c);b._addClickEven()},destroy:function(){if(this.selectBox){this.selectBox.remove()}this.options=null;a.ligerui.remove(this)},clear:function(){this._changeValue("");this.trigger("clear")},_setIsShowCheckBox:function(b){if(b){a("table",this.selectBox).addClass("l-table-checkbox")}else{a("table",this.selectBox).addClass("l-table-nocheckbox")}},_setCss:function(b){if(b){this.selectBox.addClass(b)}},_setDisabled:function(b){if(b){this.selectBox.addClass("l-text-disabled")}else{this.selectBox.removeClass("l-text-disabled")}},_setWidth:function(b){this.selectBox.width(b)},_setHeight:function(b){this.selectBox.height(b)},getText:function(){var b=this.getValue();return this.findTextByValue(b)},findTextByValue:function(e){var b=this,f=this.options;if(e==null||e==""){return""}var d=[];var c=function(j){var g=e.toString().split(f.split);for(var h=0;h<g.length;h++){if(g[h]==j){return true}}return false};a(b.data).each(function(h,j){var k=j[f.valueField];var g=j[f.textField];if(c(k)){d.push(g)}});return d.join(f.split)},getDataByValue:function(e){var d=this,f=this.options;for(var c=0,b=d.data.length;c<b;c++){if(d.data[c][f.valueField]==e){return d.data[c]}}return null},indexOf:function(f){var e=this,h=this.options;if(!e.data){return -1}var c=typeof(f)=="object";for(var d=0,b=e.data.length;d<b;d++){if(c){if(e.data[d]==f){return d}}else{if(e.data[d][h.valueField]&&e.data[d][h.valueField].toString()==f.toString()){return d}}}return -1},removeItems:function(b){var c=this;if(!c.data){return}a(b).each(function(e,f){var d=c.indexOf(f);if(d==-1){return}c.data.splice(d,1)});c.refresh()},removeItem:function(c){if(!this.data){return}var b=this.indexOf(c);if(b==-1){return}this.data.splice(b,1);this.refresh()},insertItem:function(d,b){var c=this;if(!c.data){c.data=[]}c.data.splice(b,0,d);c.refresh()},addItems:function(b){var c=this;if(!c.data){c.data=[]}a(b).each(function(d,e){c.data.push(e)});c.refresh()},addItem:function(c){var b=this;if(!b.data){b.data=[]}b.data.push(c);b.refresh()},getSelectedItems:function(){var c=this,e=this.options;if(!c.data){return null}var d=c.getValue();if(!d){return null}var b=[];a(d.split(e.split)).each(function(){var f=c.indexOf(this.toString());if(f!=-1){b.push(c.data[f])}});return b},_setValue:function(c){var b=this,d=this.options;d.value=c;this._dataInit()},setValue:function(b){this._setValue(b)},_setUrl:function(c){if(!c){return}var e=this,h=this.options;var f=a.isFunction(h.urlParms)?h.urlParms.call(e):h.urlParms;if(f){for(name in f){c+=c.indexOf("?")==-1?"?":"&";c+=name+"="+f[name]}}var d=a.isFunction(h.parms)?h.parms():h.parms;if(h.ajaxContentType=="application/json"&&typeof(d)!="string"){d=liger.toJSON(d)}var b={type:h.ajaxType||"post",url:c,data:d,cache:false,dataType:"json",success:function(g){e.setData(g);e.trigger("success",[g])},error:function(g,j){e.trigger("error",[g,j])}};if(h.ajaxContentType){b.contentType=h.ajaxContentType}a.ajax(b)},reload:function(){this.set("url",this.options.url)},setUrl:function(b){return this._setUrl(b)},setParm:function(b,e){if(!b){return}var d=this;var c=d.get("parms");if(!c){c={}}c[b]=e;d.set("parms",c)},clearContent:function(){var b=this,c=this.options;a("table",b.selectBox).html("")},_setColumns:function(b){var c=this,d=this.options;d.columns=b;c.refresh()},_setData:function(b){this.setData(b)},setData:function(c){var b=this,d=this.options;if(!c||!c.length){return}b.data=c;b.refresh();b.updateStyle()},refresh:function(){var o=this,b=this.options,m=this.data;this.clearContent();if(!m){return}if(b.columns){o.selectBox.table.headrow=a("<tr class='l-table-headerow'><td width='18px' class='l-checkboxrow'></td></tr>");o.selectBox.table.append(o.selectBox.table.headrow);o.selectBox.table.addClass("l-listbox-grid");for(var e=0;e<b.columns.length;e++){var r=a("<td columnindex='"+e+"' columnname='"+b.columns[e].name+"'>"+b.columns[e].header+"</td>");if(b.columns[e].width){r.width(b.columns[e].width)}o.selectBox.table.headrow.append(r)}}var f=[];for(var n=0;n<m.length;n++){var c=m[n][b.valueField];var k=m[n][b.textField];var h=" value='"+c+"' index='"+n+"'";if(!b.columns){f.push("<tr "+h+">");f.push("<td style='width:18px;' class='l-checkboxrow'><input type='checkbox'"+h+"/></td>");var d=k;if(b.render){d=b.render({data:m[n],value:c,text:k})}f.push("<td align='left'>"+d+"</td></tr>")}else{f.push("<tr "+h+"><td style='width:18px;' class='l-checkboxrow'><input type='checkbox' "+h+"/></td>");for(var e=0;e<b.columns.length;e++){var q=b.columns[e].name;f.push("<td>"+m[n][q]+"</td>")}f.push("</tr>")}}o.selectBox.table.append(f.join(""))},_getValue:function(){return a(this.valueField).val()},getValue:function(){return this._getValue()},updateStyle:function(){this._dataInit()},selectAll:function(){var c=this,d=this.options;var b=[];a("tr",c.selectBox).each(function(){var e=a(this);b.push(e.attr("value"))});a("tr",c.selectBox).addClass("l-selected").find(":checkbox").each(function(){this.checked=true});c.valueField.val(b.join(d.split))},_dataInit:function(){var c=this,e=this.options;var d=e.value;if(d!=null){c._changeValue(d)}else{if(c.valueField.val()!=""){e.value=c.valueField.val()}}var b=(d||"").toString().split(e.split);a("tr.l-selected",c.selectBox).removeClass("l-selected").find(":checkbox").each(function(){this.checked=false});a(b).each(function(f,g){a("tr[value='"+g+"']",c.selectBox).addClass("l-selected").find(":checkbox").each(function(){this.checked=true})})},_changeValue:function(d){var b=this,c=this.options;b.valueField.val(d);b.selectedValue=d},_updateValue:function(){var c=this,d=this.options;var b=[];a("tr",c.selectBox).each(function(){var e=a(this);if(e.hasClass("l-selected")){b.push(e.attr("value"))}});c._changeValue(b.join(d.split))},_addClickEven:function(){var b=this,c=this.options;b.selectBox.click(function(h){var g=(h.target||h.srcElement);var k=a(g).parents("tr:first");if(!k.length){return}var f=k.attr("value");var j=b.findTextByValue(f),d=b.getDataByValue(f);if(b.hasBind("select")){if(b.trigger("select",[f,j,d])==false){return false}}if(!c.isMultiSelect){a("tr.l-selected",b.selectBox).not(k).removeClass("l-selected").find(":checkbox").each(function(){this.checked=false})}if(k.hasClass("l-selected")){k.removeClass("l-selected")}else{k.addClass("l-selected")}k.find(":checkbox").each(function(){this.checked=k.hasClass("l-selected")});b._updateValue();b.trigger("selected",[f,j,d])})}})})(jQuery);(function(a){a.ligerMenu=function(b){return a.ligerui.run.call(null,"ligerMenu",arguments)};a.ligerDefaults.Menu={width:120,top:0,left:0,cls:null,items:null,shadow:true};a.ligerMethos.Menu={};a.ligerui.controls.Menu=function(b){a.ligerui.controls.Menu.base.constructor.call(this,null,b)};a.ligerui.controls.Menu.ligerExtend(a.ligerui.core.UIComponent,{__getType:function(){return"Menu"},__idPrev:function(){return"Menu"},_extendMethods:function(){return a.ligerMethos.Menu},_render:function(){var b=this,c=this.options;b.menuItemCount=0;b.menus={};b.menu=b.createMenu();b.element=b.menu[0];b.menu.css({top:c.top,left:c.left,width:c.width});c.cls&&b.menu.addClass(c.cls);c.items&&a(c.items).each(function(d,e){b.addItem(e)});a(document).bind("click.menu",function(){for(var d in b.menus){var e=b.menus[d];if(!e){return}e.hide();if(e.shadow){e.shadow.hide()}}});b.set(c)},show:function(b,e){var c=this,d=this.options;if(e==undefined){e=c.menu}if(b&&b.left!=undefined){e.css({left:b.left})}if(b&&b.top!=undefined){e.css({top:b.top})}e.show();c.updateShadow(e)},updateShadow:function(d){var b=this,c=this.options;if(!c.shadow){return}d.shadow.css({left:d.css("left"),top:d.css("top"),width:d.outerWidth(),height:d.outerHeight()});if(d.is(":visible")){d.shadow.show()}else{d.shadow.hide()}},hide:function(d){var b=this,c=this.options;if(d==undefined){d=b.menu}b.hideAllSubMenu(d);d.hide();b.updateShadow(d)},toggle:function(){var b=this,c=this.options;b.menu.toggle();b.updateShadow(b.menu)},removeItem:function(c){var b=this,d=this.options;a("> .l-menu-item[menuitemid="+c+"]",b.menu.items).remove()},setEnabled:function(c){var b=this,d=this.options;a("> .l-menu-item[menuitemid="+c+"]",b.menu.items).removeClass("l-menu-item-disable")},setMenuText:function(c,e){var b=this,d=this.options;a("> .l-menu-item[menuitemid="+c+"] >.l-menu-item-text:first",b.menu.items).html(e)},setDisabled:function(c){var b=this,d=this.options;a("> .l-menu-item[menuitemid="+c+"]",b.menu.items).addClass("l-menu-item-disable")},isEnable:function(c){var b=this,d=this.options;return !a("> .l-menu-item[menuitemid="+c+"]",b.menu.items).hasClass("l-menu-item-disable")},getItemCount:function(){var b=this,c=this.options;return a("> .l-menu-item",b.menu.items).length},addItem:function(e,h){var d=this,f=this.options;if(!e){return}if(h==undefined){h=d.menu}if(e.line){h.items.append('<div class="l-menu-item-line"></div>');return}var b=a('<div class="l-menu-item"><div class="l-menu-item-text"></div> </div>');var c=a("> .l-menu-item",h.items).length;h.items.append(b);b.attr("ligeruimenutemid",++d.menuItemCount);e.id&&b.attr("menuitemid",e.id);e.text&&a(">.l-menu-item-text:first",b).html(e.text);e.icon&&b.prepend('<div class="l-menu-item-icon l-icon-'+e.icon+'"></div>');e.img&&b.prepend('<div class="l-menu-item-icon"><img style="width:16px;height:16px;margin:2px;" src="'+e.img+'" /></div>');if(e.disable||e.disabled){b.addClass("l-menu-item-disable")}if(e.children){b.append('<div class="l-menu-item-arrow"></div>');var k=d.createMenu(b.attr("ligeruimenutemid"));d.menus[b.attr("ligeruimenutemid")]=k;k.width(f.width);k.hover(null,function(){if(!k.showedSubMenu){d.hide(k)}});a(e.children).each(function(){d.addItem(this,k)})}e.click&&b.click(function(){if(a(this).hasClass("l-menu-item-disable")){return}e.click(e,c)});e.dblclick&&b.dblclick(function(){if(a(this).hasClass("l-menu-item-disable")){return}e.dblclick(e,c)});var j=a("> .l-menu-over:first",h);b.hover(function(){if(a(this).hasClass("l-menu-item-disable")){return}var m=a(this).offset().top;var n=m-h.offset().top;j.css({top:n});d.hideAllSubMenu(h);if(e.children){var g=a(this).attr("ligeruimenutemid");if(!g){return}if(d.menus[g]){d.show({top:m,left:a(this).offset().left+a(this).width()-5},d.menus[g]);h.showedSubMenu=true}}},function(){if(a(this).hasClass("l-menu-item-disable")){return}var g=a(this).attr("ligeruimenutemid");if(e.children){var g=a(this).attr("ligeruimenutemid");if(!g){return}}})},hideAllSubMenu:function(d){var b=this,c=this.options;if(d==undefined){d=b.menu}a("> .l-menu-item",d.items).each(function(){if(a("> .l-menu-item-arrow",this).length>0){var e=a(this).attr("ligeruimenutemid");if(!e){return}b.menus[e]&&b.hide(b.menus[e])}});d.showedSubMenu=false},createMenu:function(c){var b=this,d=this.options;var e=a('<div class="l-menu" style="display:none"><div class="l-menu-yline"></div><div class="l-menu-over"><div class="l-menu-over-l"></div> <div class="l-menu-over-r"></div></div><div class="l-menu-inner"></div></div>');c&&e.attr("ligeruiparentmenuitemid",c);e.items=a("> .l-menu-inner:first",e);e.appendTo("body");if(d.shadow){e.shadow=a('<div class="l-menu-shadow"></div>').insertAfter(e);b.updateShadow(e)}e.hover(null,function(){if(!e.showedSubMenu){a("> .l-menu-over:first",e).css({top:-24})}});if(c){b.menus[c]=e}else{b.menus[0]=e}return e}});a.ligerui.controls.Menu.prototype.setEnable=a.ligerui.controls.Menu.prototype.setEnabled;a.ligerui.controls.Menu.prototype.setDisable=a.ligerui.controls.Menu.prototype.setDisabled})(jQuery);(function(a){a.fn.ligerMenuBar=function(b){return a.ligerui.run.call(this,"ligerMenuBar",arguments)};a.fn.ligerGetMenuBarManager=function(){return a.ligerui.run.call(this,"ligerGetMenuBarManager",arguments)};a.ligerDefaults.MenuBar={};a.ligerMethos.MenuBar={};a.ligerui.controls.MenuBar=function(c,b){a.ligerui.controls.MenuBar.base.constructor.call(this,c,b)};a.ligerui.controls.MenuBar.ligerExtend(a.ligerui.core.UIComponent,{__getType:function(){return"MenuBar"},__idPrev:function(){return"MenuBar"},_extendMethods:function(){return a.ligerMethos.MenuBar},_render:function(){var b=this,c=this.options;b.menubar=a(this.element);if(!b.menubar.hasClass("l-menubar")){b.menubar.addClass("l-menubar")}if(c&&c.items){a(c.items).each(function(d,e){b.addItem(e)})}a(document).click(function(){a(".l-panel-btn-selected",b.menubar).removeClass("l-panel-btn-selected")});b.set(c)},addItem:function(d){var c=this,e=this.options;var b=a('<div class="l-menubar-item l-panel-btn"><span></span><div class="l-panel-btn-l"></div><div class="l-panel-btn-r"></div><div class="l-menubar-item-down"></div></div>');c.menubar.append(b);d.id&&b.attr("menubarid",d.id);d.text&&a("span:first",b).html(d.text);d.disable&&b.addClass("l-menubar-item-disable");d.click&&b.click(function(){d.click(d)});if(d.menu){var f=a.ligerMenu(d.menu);b.hover(function(){c.actionMenu&&c.actionMenu.hide();var h=a(this).offset().left;var g=a(this).offset().top+a(this).height();f.show({top:g,left:h});c.actionMenu=f;a(this).addClass("l-panel-btn-over l-panel-btn-selected").siblings(".l-menubar-item").removeClass("l-panel-btn-selected")},function(){a(this).removeClass("l-panel-btn-over")})}else{b.hover(function(){a(this).addClass("l-panel-btn-over")},function(){a(this).removeClass("l-panel-btn-over")});a(".l-menubar-item-down",b).remove()}}})})(jQuery);(function(a){a.ligerMessageBox=function(b){return a.ligerui.run.call(null,"ligerMessageBox",arguments,{isStatic:true})};a.ligerDefaults.MessageBox={isDrag:true};a.ligerMethos.MessageBox={};a.ligerui.controls.MessageBox=function(b){a.ligerui.controls.MessageBox.base.constructor.call(this,null,b)};a.ligerui.controls.MessageBox.ligerExtend(a.ligerui.core.UIComponent,{__getType:function(){return"MessageBox"},__idPrev:function(){return"MessageBox"},_extendMethods:function(){return a.ligerMethos.MessageBox},_render:function(){var e=this,k=this.options;var f="";f+='<div class="l-messagebox">';f+='        <div class="l-messagebox-lt"></div><div class="l-messagebox-rt"></div>';f+='        <div class="l-messagebox-l"></div><div class="l-messagebox-r"></div> ';f+='        <div class="l-messagebox-image"></div>';f+='        <div class="l-messagebox-title">';f+='            <div class="l-messagebox-title-inner"></div>';f+='            <div class="l-messagebox-close"></div>';f+="        </div>";f+='        <div class="l-messagebox-content">';f+="        </div>";f+='        <div class="l-messagebox-buttons"><div class="l-messagebox-buttons-inner">';f+="        </div></div>";f+="    </div>";e.messageBox=a(f);a("body").append(e.messageBox);e.messageBox.close=function(){e._removeWindowMask();e.messageBox.remove()};k.width&&e.messageBox.width(k.width);k.title&&a(".l-messagebox-title-inner",e.messageBox).html(k.title);k.content&&a(".l-messagebox-content",e.messageBox).html(k.content);if(k.buttons){a(k.buttons).each(function(m,n){var g=a('<div class="l-messagebox-btn"><div class="l-messagebox-btn-l"></div><div class="l-messagebox-btn-r"></div><div class="l-messagebox-btn-inner"></div></div>');a(".l-messagebox-btn-inner",g).html(n.text);a(".l-messagebox-buttons-inner",e.messageBox).append(g);n.width&&g.width(n.width);n.onclick&&g.click(function(){n.onclick(n,m,e.messageBox)})});a(".l-messagebox-buttons-inner",e.messageBox).append("<div class='l-clear'></div>")}var d=e.messageBox.width();var c=0;a(".l-messagebox-buttons-inner .l-messagebox-btn",e.messageBox).each(function(){c+=a(this).width()});a(".l-messagebox-buttons-inner",e.messageBox).css({marginLeft:parseInt((d-c)*0.5)});e._applyWindowMask();e._applyDrag();e._setImage();var j=0;var h=0;var b=k.width||e.messageBox.width();if(k.left!=null){j=k.left}else{k.left=j=0.5*(a(window).width()-b)}if(k.top!=null){h=k.top}else{k.top=h=0.5*(a(window).height()-e.messageBox.height())+a(window).scrollTop()-10}if(j<0){k.left=j=0}if(h<0){k.top=h=0}e.messageBox.css({left:j,top:h});a(".l-messagebox-btn",e.messageBox).hover(function(){a(this).addClass("l-messagebox-btn-over")},function(){a(this).removeClass("l-messagebox-btn-over")});a(".l-messagebox-close",e.messageBox).hover(function(){a(this).addClass("l-messagebox-close-over")},function(){a(this).removeClass("l-messagebox-close-over")}).click(function(){e.messageBox.close()});e.set(k)},close:function(){var b=this,c=this.options;this.g._removeWindowMask();this.messageBox.remove()},_applyWindowMask:function(){var b=this,c=this.options;a(".l-window-mask").remove();a("<div class='l-window-mask' style='display: block;'></div>").appendTo(a("body"))},_removeWindowMask:function(){var b=this,c=this.options;a(".l-window-mask").remove()},_applyDrag:function(){var b=this,c=this.options;if(c.isDrag&&a.fn.ligerDrag){b.messageBox.ligerDrag({handler:".l-messagebox-title-inner",animate:false})}},_setImage:function(){var b=this,c=this.options;if(c.type){if(c.type=="success"||c.type=="donne"){a(".l-messagebox-image",b.messageBox).addClass("l-messagebox-image-donne").show();a(".l-messagebox-content",b.messageBox).css({paddingLeft:64,paddingBottom:30})}else{if(c.type=="error"){a(".l-messagebox-image",b.messageBox).addClass("l-messagebox-image-error").show();a(".l-messagebox-content",b.messageBox).css({paddingLeft:64,paddingBottom:30})}else{if(c.type=="warn"){a(".l-messagebox-image",b.messageBox).addClass("l-messagebox-image-warn").show();a(".l-messagebox-content",b.messageBox).css({paddingLeft:64,paddingBottom:30})}else{if(c.type=="question"){a(".l-messagebox-image",b.messageBox).addClass("l-messagebox-image-question").show();a(".l-messagebox-content",b.messageBox).css({paddingLeft:64,paddingBottom:40})}}}}}}});a.ligerMessageBox.show=function(b){return a.ligerMessageBox(b)};a.ligerMessageBox.alert=function(f,e,d,c){f=f||"";e=e||f;var b=function(h,g,j){j.close();if(c){c(h,g,j)}};p={title:f,content:e,buttons:[{text:"确定",onclick:b}]};if(d){p.type=d}return a.ligerMessageBox(p)};a.ligerMessageBox.confirm=function(d,c,e){var b=function(g,f,h){h.close();if(e){e(f==0)}};p={type:"question",title:d,content:c,buttons:[{text:"是",onclick:b},{text:"否",onclick:b}]};return a.ligerMessageBox(p)};a.ligerMessageBox.success=function(d,c,b){return a.ligerMessageBox.alert(d,c,"success",b)};a.ligerMessageBox.error=function(d,c,b){return a.ligerMessageBox.alert(d,c,"error",b)};a.ligerMessageBox.warn=function(d,c,b){return a.ligerMessageBox.alert(d,c,"warn",b)};a.ligerMessageBox.question=function(c,b){return a.ligerMessageBox.alert(c,b,"question")}})(jQuery);(function(a){a.fn.ligerPanel=function(b){return a.ligerui.run.call(this,"ligerPanel",arguments)};a.ligerDefaults.Panel={width:400,height:300,title:"Panel",content:null,url:null,urlParms:null,frameName:null,data:null,showClose:false,showToggle:true,showRefresh:false,icon:null,onClose:null,onClosed:null,onLoaded:null};a.ligerDefaults.PanelString={refreshMessage:"刷新",closeMessage:"关闭",expandMessage:"展开",collapseMessage:"收起"};a.ligerMethos.Panel={};a.ligerui.controls.Panel=function(c,b){a.ligerui.controls.Panel.base.constructor.call(this,c,b)};a.ligerui.controls.Panel.ligerExtend(a.ligerui.core.UIComponent,{__getType:function(){return"Panel"},__idPrev:function(){return"Panel"},_extendMethods:function(){return a.ligerMethos.Panel},_init:function(){var b=this,c=this.options;a.ligerui.controls.Panel.base._init.call(this);c.content=c.content||a(b.element).html()},_render:function(){var b=this,c=this.options;b.panel=a(b.element).addClass("l-panel").html("");b.panel.append('<div class="l-panel-header"><span></span><div class="icons"></div></div><div class="l-panel-content"></div>');b.set(c);b.panel.find(".l-panel-header").hover(function(){a(this).addClass("l-panel-header-hover")},function(){a(this).removeClass("l-panel-header-hover")});b.panel.bind("click.panel",function(f){var d=(f.target||f.srcElement),g=a(d);if(g.hasClass("l-panel-header-toggle")){b.toggle()}else{if(g.hasClass("l-panel-header-close")){b.close()}else{if(g.hasClass("l-panel-header-refresh")){b.refresh()}}}})},_setChildren:function(d){var k=this,b=this.options;var q={input:["textbox","combobox","select"]};var m={grid:"ligerGrid",toolbar:"ligerToolBar",tree:"ligerTree",form:"ligerForm",menu:"ligerMenu",menubar:"ligerMenuBar",portal:"ligerPortal",combobox:"ligerComboBox",textbox:"ligerTextBox",spinner:"ligerSpinner",listbox:"ligerListBox",checkbox:"ligerCheckBox",radio:"ligerRadio",checkboxlist:"ligerCheckBoxList",radiolist:"ligerRadioList",popupedit:"ligerPopupEdit",button:"ligerButton",dateeditor:"ligerDateEditor",dialog:"ligerDialog",panel:"ligerPanel",layout:"ligerLayout",accordion:"ligerAccordion",tab:"ligerTab"};if(!d||!d.length){return}for(var h=0;h<d.length;h++){var c=d[h],n=c.type;var e=q[n]||"div";var j=m[n];if(!j){continue}var f=document.createElement(e);k.panel.find(".l-panel-content").append(f);var o=a.extend({},c);o.type=null;a(f)[j](o)}},collapse:function(){var c=this,d=this.options;var b=c.panel.find(".l-panel-header .l-panel-header-toggle:first");if(b.hasClass("l-panel-header-toggle-hide")){return}c.toggle()},expand:function(){var c=this,d=this.options;var b=c.panel.find(".l-panel-header .l-panel-header-toggle:first");if(!b.hasClass("l-panel-header-toggle-hide")){return}c.toggle()},toggle:function(){var c=this,d=this.options;var b=c.panel.find(".l-panel-header .l-panel-header-toggle:first");if(b.hasClass("l-panel-header-toggle-hide")){b.removeClass("l-panel-header-toggle-hide");b.attr("title",d.collapseMessage)}else{b.addClass("l-panel-header-toggle-hide");b.attr("title",d.expandMessage)}c.panel.find(".l-panel-content:first").toggle("normal")},refresh:function(){var b=this,c=this.options;b.set("url",c.url)},_setShowToggle:function(c){var d=this,e=this.options;var f=d.panel.find(".l-panel-header:first");if(c){var b=a("<a class='l-panel-icon l-panel-header-toggle'></a>");b.appendTo(f.find(".icons"));b.attr("title",e.collapseMessage)}else{f.find(".l-panel-header-toggle").remove()}},_setContent:function(b){var d=this,e=this.options;var c=d.panel.find(".l-panel-content:first");if(b){c.html(b)}},_setUrl:function(b){var e=this,h=this.options;var d=e.panel.find(".l-panel-content:first");if(b){var f=a.isFunction(h.urlParms)?h.urlParms.call(e):h.urlParms;if(f){for(name in f){b+=b.indexOf("?")==-1?"?":"&";b+=name+"="+f[name]}}if(!e.jiframe){e.jiframe=a("<iframe frameborder='0'></iframe>");var c=h.frameName?h.frameName:"ligerpanel"+new Date().getTime();e.jiframe.attr("name",c);e.jiframe.attr("id",c);d.prepend(e.jiframe);e.jiframe[0].panel=e;e.frame=window.frames[e.jiframe.attr("name")]}setTimeout(function(){if(d.find(".l-panel-loading:first").length==0){d.append("<div class='l-panel-loading' style='display:block;'></div>")}var g=a(".l-panel-loading:first",d);e.jiframe.attr("src",b).bind("load.panel",function(){g.hide();e.trigger("loaded")})},0)}},_setShowClose:function(b){var d=this,e=this.options;var f=d.panel.find(".l-panel-header:first");if(b){var c=a("<a class='l-panel-icon l-panel-header-close'></a>");c.appendTo(f.find(".icons"));c.attr("title",e.closeMessage)}else{f.find(".l-panel-header-close").remove()}},_setShowRefresh:function(b){var d=this,e=this.options;var f=d.panel.find(".l-panel-header:first");if(b){var c=a("<a class='l-panel-icon l-panel-header-refresh'></a>");c.appendTo(f.find(".icons"));c.attr("title",e.refreshMessage)}else{f.find(".l-panel-header-refresh").remove()}},close:function(){var b=this,c=this.options;if(b.trigger("close")==false){return}b.panel.remove();b.trigger("closed")},show:function(){this.panel.show()},_setIcon:function(b){var c=this;if(!b){c.panel.removeClass("l-panel-hasicon");c.panel.find("img").remove()}else{c.panel.addClass("l-panel-hasicon");c.panel.append('<img src="'+b+'" />')}},_setWidth:function(b){if(typeof(b)=="string"){if(b.indexOf("%")>-1){this.panel.width(b)}else{this.panel.width(parseInt(b))}}else{this.panel.width(b)}},_setHeight:function(c){var b=this,d=this.options;var e=b.panel.find(".l-panel-header:first");this.panel.find(".l-panel-content:first").height(c-e.height())},_setTitle:function(b){this.panel.find(".l-panel-header span:first").text(b)}})})(jQuery);(function(a){a.fn.ligerPopupEdit=function(b){return a.ligerui.run.call(this,"ligerPopupEdit",arguments)};a.fn.ligerGetPopupEditManager=function(){return a.ligerui.run.call(this,"ligerGetPopupEditManager",arguments)};a.ligerDefaults.PopupEdit={valueFieldID:null,css:null,onButtonClick:null,nullText:null,disabled:false,cancelable:true,width:200,heigth:null,render:null,split:";",grid:null,condition:null,valueField:"id",textField:"text",parms:null,onSelect:null,onSelected:null,onChangeValue:null,valueFieldCssClass:null,autocomplete:false,popup:true};a.ligerMethos.PopupEdit=a.ligerMethos.PopupEdit||{};a.ligerui.controls.PopupEdit=function(c,b){a.ligerui.controls.PopupEdit.base.constructor.call(this,c,b)};a.ligerui.controls.PopupEdit.ligerExtend(a.ligerui.controls.Input,{__getType:function(){return"PopupEdit"},_extendMethods:function(){return a.ligerMethos.PopupEdit},_render:function(){a.ligerui.controls.PopupEdit.base._render.call(this);var c=this,d=this.options;c.inputText=null;if(this.element.tagName.toLowerCase()=="input"){this.element.readOnly=true;c.inputText=a(this.element);c.textFieldID=this.element.id}if(c.inputText[0].name==undefined||c.inputText[0].name=="undefined"){c.inputText[0].name=c.textFieldID}c.valueField=null;if(d.valueFieldID){c.valueField=a("#"+d.valueFieldID+":input");if(c.valueField.length==0){c.valueField=a('<input type="hidden"/>')}c.valueField[0].id=c.valueField[0].name=d.valueFieldID}else{c.valueField=a('<input type="hidden"/>');c.valueField[0].id=c.valueField[0].name=c.textFieldID+"_val"}if(c.valueField[0].name==undefined){c.valueField[0].name=c.valueField[0].id}if(d.valueFieldCssClass){c.valueField.addClass(d.valueFieldCssClass)}c.link=a('<div class="l-trigger"><div class="l-trigger-icon"></div></div>');c.wrapper=c.inputText.wrap('<div class="l-text l-text-popup"></div>').parent();c.wrapper.append('<div class="l-text-l"></div><div class="l-text-r"></div>');c.wrapper.append(c.link);c.wrapper.append(c.valueField);c.valueField.attr("data-ligerid",c.id);c.inputText.addClass("l-text-field");c.link.hover(function(){if(d.disabled||!d.popup){return}this.className="l-trigger-hover"},function(){if(d.disabled||!d.popup){return}this.className="l-trigger"}).mousedown(function(){if(d.disabled){return}this.className="l-trigger-pressed"}).mouseup(function(){if(d.disabled){return}this.className="l-trigger-hover"}).click(function(){if(d.disabled){return}if(c.trigger("buttonClick")==false){return false}});c.inputText.click(function(){if(d.disabled){return}}).change(function(){if(d.disabled){return}c.trigger("changeValue",[c.getText()]);c.setValue("")}).blur(function(){if(d.disabled){return}c.wrapper.removeClass("l-text-focus")}).focus(function(){if(d.disabled){return}c.wrapper.addClass("l-text-focus")}).keyup(function(g){if(g.keyCode==40&&!c.autoShown){if(d.disabled||d.readonly){return}if(c.trigger("buttonClick")==false){return false}c.inputText.blur()}});if(d.autocomplete){c._initAutoComplete();var f=null,e="";function b(h,g){if(f){clearTimeout(f)}f=setTimeout(h,g)}c.inputText.keypress(function(h){if(d.disabled||d.readonly){return}var j=String.fromCharCode(h.charCode),g=this;if(/[a-zA-Z]/.test(j)){b(function(){c._autoCompleteQuery(e=g.value)},600)}}).keyup(function(j){if(d.disabled||d.readonly){return}var h=j.keyCode,g=this;if(h>40&&h<65||h>90||(h<37&&h!=33&&h!=34&&h!=13&&h!=27&&h!=9&&h!=18&&h!=17&&h!=16)||(e!=g.value&&h==16)){b(function(){b(function(){c._autoCompleteQuery(e=g.value)},600)},1)}if(c.autoShown&&h==13){c._commitSelected();j.preventDefault()}}).keydown(function(k){if(d.disabled||d.readonly){return}var j=k.keyCode,g=this;if(k.ctrlKey&&(j==86||j==90||j==89)){b(function(){b(function(){c._autoCompleteQuery(e=g.value)},600)},1)}if(c.autoShown&&(j==40||j==38||j==9)){var h=c.selectedIndex;if(j==38){c._selectItem(h==null?-1:h-1,true)}else{if(j==40){c._selectItem(h==null?0:h+1,true)}else{c._hideAutoComplete()}}}}).change(function(){clearTimeout(f);var g=a.trim(this.value);if(a.isEmpty(g)){c.clear();return}var h=c.options;if(c.selectedIndex==null){c._autoCompleteQuery(g,function(j){if(j.rows.length==1){c.selectedIndex=0;c._commitSelected()}else{c.clear()}})}})}c.wrapper.hover(function(){if(d.disabled){return}c.wrapper.addClass("l-text-over")},function(){if(d.disabled){return}c.wrapper.removeClass("l-text-over")});c.set(d)},destroy:function(){if(this.autoView){this.autoView.remove()}if(this.wrapper){this.wrapper.remove()}a.ligerui.remove(this)},clear:function(){var c=this,d=this.options;var b=c.inputText.val();c.inputText.val("");c.valueField.val("");if(!a.isEmpty(b)){c.trigger("changeValue",["",""])}},_setCss:function(b){if(b){this.wrapper.addClass(b)}},_setCancelable:function(c){var b=this,d=this.options;if(!c&&b.unselect){b.unselect.remove();b.unselect=null;b.wrapper.unbind("mouseenter mouseleave")}if(!c&&!b.unselect){return}b.unselect=a('<div class="l-trigger l-trigger-cancel"><div class="l-trigger-icon"></div></div>').hide();b.wrapper.hover(function(){b.unselect.show()},function(){b.unselect.hide()});if(!d.disabled&&d.cancelable){b.wrapper.append(b.unselect)}b.unselect.hover(function(){this.className="l-trigger-hover l-trigger-cancel"},function(){this.className="l-trigger l-trigger-cancel"}).click(function(){b.clear()})},_setDisabled:function(b){var c=this.options;if(b){this.inputText.attr("readonly","readonly");this.wrapper.addClass("l-text-disabled");this._setCancelable(false)}else{if(c.autocomplete){this.inputText.removeAttr("readonly")}if(c.cancelable){this._setCancelable(true)}this.wrapper.removeClass("l-text-disabled")}},_setWidth:function(c){var b=this,d=b.options;if(c>20){b.wrapper.css({width:c});b.inputText.css({width:c-(d.popup?20:0)})}},_setHeight:function(c){var b=this;if(c>10){b.wrapper.height(c);b.inputText.height(c-2)}},getData:function(){var e=this,j=this.options;var h=[];var c=a(e.valueField).val(),d=a(e.inputText).val();var b=c?c.split(j.split):null,f=d?d.split(j.split):null;a(b).each(function(g){var k={};k[j.textField]=f[g];k[j.valueField]=b[g];h.push(k)});return h},_getText:function(){return a(this.inputText).val()},_getValue:function(){return a(this.valueField).val()},getValue:function(){return this._getValue()},getText:function(){return this._getText()},setValue:function(c,f,e){var b=this,d=this.options;if(arguments.length>=2){b.setValue(c);b.setText(f);return}b.valueField.val(c)},setText:function(d){var b=this,c=this.options;if(c.render){b.inputText.val(c.render(d))}else{b.inputText.val(d)}},addValue:function(k,n){var j=this,c=this.options;if(!k){return}var m=j.getValue(),o=j.getText();if(!m){j.setValue(k);j.setText(n)}else{var b=[],d=[],e=m.split(c.split),k=k.split(c.split),n=n.split(c.split);for(var h=0,f=k.length;h<f;h++){if(a.inArray(k[h],e)==-1){b.push(k[h]);d.push(n[h])}}if(b.length){j.setValue(m+c.split+b.join(c.split));j.setText(o+c.split+d.join(c.split))}}},removeValue:function(j,m){var f=this,c=this.options;if(!j){return}var k=f.getValue(),n=f.getText();if(!k){return}var o=k.split(c.split),b=n.split(c.split),j=j.split(c.split);for(var e=0,h=-1,d=j.length;e<d;e++){if((h=a.inArray(j[e],o))!=-1){o.splice(h,1);b.splice(h,1)}}f.setValue(o.join(c.split));f.setText(b.join(c.split))},_setGrid:function(c){if(!c){return}var b=this,e=this.options;var d=a.extend({parms:e.parms},e.grid);this.bind("buttonClick",function(){function g(){try{return b.getData()}catch(h){return null}}if(true){var f={grid:d,condition:e.condition,valueField:e.valueField,title:e.title,width:d.width,height:d.height,textField:e.textField,onLoadData:e.onLoadData,split:e.split,lastSelected:g(),onClosed:function(){b.inputText.focus()},onSelect:function(h){if(b.trigger("select",h)==false){return}if(e.grid.checkbox){b.addValue(h.value,h.text);b.removeValue(h.remvoeValue,h.remvoeText)}else{b.setValue(h.value);b.setText(h.text)}b.trigger("selected",h)},selectInit:function(j){var h=b.getValue();if(!h){return false}if(!e.valueField||!j[e.valueField]){return false}return a.inArray(j[e.valueField].toString(),h.split(e.split))!=-1}};b.popupFn=a.ligerui.getPopupFn(f)}b.popupFn()})}});a.ligerui.getPopupFn=function(h){h=a.extend({title:"select",width:700,height:320,top:null,left:null,split:";",valueField:null,textField:null,grid:null,condition:null,onSelect:function(k){},selectInit:function(k){return false}},h);if(!h.grid){return}var g,c,j,f=h.lastSelected||[];return function(){b();return false};function b(){function o(t){t=t||h.height;t-=r.height();return t}if(g){c._showData();g.show();c.refreshSize();f=c.selected.concat();return}var n=a("<div></div>");var r=a("<form></form>");var q=a("<div></div>");n.append(r).append(q);var s=a.extend({columnWidth:120,alternatingRow:false,frozen:true,rownumbers:true,pageSizeBtn:false,refreshBtn:false,selectByKey:true},h.grid,{width:"99%",height:o(),isChecked:h.selectInit,isSelected:h.selectInit,onLoadData:h.onLoadData,inWindow:false});c=q.ligerGrid(s);c.bind("dblClickRow",function(t){c.select(t);d();g.close()});c.bind("enterdown",function(){d();g.close()});g=a.ligerDialog.open({title:h.title,isHidden:false,width:h.width,height:"auto",top:h.top,left:h.left,target:n,isResize:true,cls:"l-popup",onContentHeightChange:function(t){c.set("height",o(t));return false},onStopResize:function(){c.refreshSize()},closeWhenEsc:true,onClosed:h.onClosed,buttons:[{text:$l("sys.hand.btn.ok"),attr:{id:"pop_ok"},onclick:function(u,t){d();t.close()}},{text:$l("sys.hand.btn.cancel"),attr:{id:"pop_cancel"},onclick:function(u,t){t.close()}}]});if(h.condition){var m=a.extend({labelWidth:90,space:20},h.condition);j=r.ligerForm(m)}else{r.remove()}if(h.condition){var k=a('<li style="margin-right:9px"><div></div></li>');a("ul:first",r).append(k).after('<div class="l-clear"></div>');a("div",k).ligerButton({text:$l("sys.hand.btn.search"),click:function(){var t={},w=false;if(j){t=j.getData();for(var v in t){if(!t[v]){delete t[v]}else{w=true}}}if(h.grid.needQueryParam&&w==false){var u=a.ligerDialog.open({cls:"alert",type:"alert",content:"请输入查询条件!",allowClose:false});setTimeout(function(){u.close()},1000);return}c.set("parms",a.extend(t,h.grid.parms));c.loadData(1)}})}c.refreshSize();c.element.focus()}function e(o,n){for(var k=0;n&&n[k];k++){var m=n[k];if(m[h.valueField]==o){return true}}return false}function d(){var n=c.selected||[];var q=[],s=[],o=[];a(n).each(function(u,w){h.valueField&&q.push(w[h.valueField]);h.textField&&s.push(w[h.textField]);var v=a.extend(true,{},this);c.formatRecord(v,true);o.push(v)});var m=[];a(f).each(function(u,v){if(!e(v[h.valueField],n)&&e(v[h.valueField],c.rows)){m.push(v)}});var r=[],k=[],t=[];a(m).each(function(u,w){h.valueField&&r.push(w[h.valueField]);h.textField&&k.push(w[h.textField]);var v=a.extend(true,{},this);c.formatRecord(v,true);t.push(v)});h.onSelect({value:q.join(h.split),text:s.join(h.split),data:o,remvoeValue:r.join(h.split),remvoeText:k.join(h.split),removeData:t})}}})(jQuery);(function(a){a.fn.ligerPortal=function(b){return a.ligerui.run.call(this,"ligerPortal",arguments)};a.ligerDefaults.Portal={width:null,rows:null,columns:null,url:null,method:"get",parms:null,draggable:false,onLoaded:null};a.ligerDefaults.Portal_rows={width:null,height:null};a.ligerDefaults.Portal_columns={width:null,height:null};a.ligerMethos.Portal={};a.ligerui.controls.Portal=function(c,b){a.ligerui.controls.Portal.base.constructor.call(this,c,b)};a.ligerui.controls.Portal.ligerExtend(a.ligerui.core.UIComponent,{__getType:function(){return"Portal"},__idPrev:function(){return"Portal"},_extendMethods:function(){return a.ligerMethos.Portal},_init:function(){var b=this,c=this.options;a.ligerui.controls.Portal.base._init.call(this);if(a(">div",b.element).length){c.columns=[];a(">div",b.element).each(function(d,e){c.columns[d]={panels:[]}});b.tempInitPanels=a("<div></div>");a(">div",b.element).appendTo(b.tempInitPanels)}if(!c.rows&&c.columns){c.rows=[{columns:c.columns}]}},_render:function(){var b=this,c=this.options;b.portal=a(b.element).addClass("l-portal").html("");b.set(c)},_setRows:function(d){var c=this,e=this.options;c.rows=[];if(d&&d.length){for(var b=0;b<d.length;b++){var f=d[b];var h=a('<div class="l-row"></div>').appendTo(c.portal);c.rows[b]=c._renderRow({row:f,rowIndex:b,jrow:h});h.append('<div class="l-clear"></div>')}}},_renderRow:function(j){var o=j.row,k=j.rowIndex,d=j.jrow;var h=this,b=this.options;var m={element:d[0]};if(o.width){if(typeof(o.width)=="string"){if(o.width.indexOf("%")>-1){d.width(o.width)}else{d.width(parseInt(o.width))}}else{d.width(o.width)}}if(o.height){d.height(o.height)}if(o.columns){m.columns=[]}if(o.columns&&o.columns.length){for(var f=0;f<o.columns.length;f++){var c=o.columns[f];var n=a('<div class="l-column"></div>').appendTo(d);m.columns[f]=h._renderColumn({column:c,columnIndex:f,jcolumn:n,rowIndex:k})}}return m},remove:function(j){var f=this,h=this.options;var k=j.rowIndex,d=j.columnIndex,c=j.index;if(c==null){c=-1}if(c>=0&&f.rows[k]&&f.rows[k].columns&&f.rows[k].columns[d]&&f.rows[k].columns[d].panels){var b=f.rows[k].columns[d].panels[c];b&&b.close();f._updatePortal()}},add:function(m){var h=this,c=this.options;var o=m.rowIndex,n=m.columnIndex,k=m.index,b=m.panel;if(k==null){k=-1}if(!(h.rows[o]&&h.rows[o].columns&&h.rows[o].columns[n])){return}var f=h.rows[o].columns[n],d=c.rows[o].columns[n],r,q=a(f.element);d.panels=d.panels||[];f.panels=f.panels||[];d.panels.splice(k,0,b);if(k<0){var j=a("<div></div>").insertBefore(f.jplace);r=j.ligerPanel(b)}else{if(f.panels[k]){var j=a("<div></div>").insertBefore(f.panels[k].panel);r=j.ligerPanel(b)}}if(r){r.bind("closed",h._createPanelClosed());h.setPanelEvent({panel:r});f.panels.splice(k,0,r)}h._updatePortal()},_createPanelClosed:function(){var b=this,c=this.options;return function(){var d=this;var f=b.getPanels();var h,g,e;a(f).each(function(){if(this.panel==d){h=this.rowIndex;g=this.columnIndex;e=this.index}});c.rows[h].columns[g].panels.splice(e,1);b.rows[h].columns[g].panels.splice(e,1)}},_renderColumn:function(n){var f=n.column,o=n.columnIndex,s=n.jcolumn;var q=n.rowIndex;var k=this,c=this.options;var r={element:s[0]};if(f.width){s.width(f.width)}if(f.height){s.height(f.height)}if(f.panels){r.panels=[]}if(f.panels&&f.panels.length){for(var j=0;j<f.panels.length;j++){var b=f.panels[j];var m=a("<div></div>").appendTo(s);r.panels[j]=m.ligerPanel(b);r.panels[j].bind("closed",k._createPanelClosed());k.setPanelEvent({panel:r.panels[j]})}}else{if(k.tempInitPanels){var d=k.tempInitPanels.find(">div:eq("+o+")");if(d.length){r.panels=[];var t={};var h=d.clone();if(liger.inject&&liger.inject.getOptions){t=liger.inject.getOptions({jelement:h,defaults:a.ligerDefaults.Panel,config:liger.inject.config.Panel})}r.panels[0]=h.appendTo(s).ligerPanel(t);r.panels[0].bind("closed",k._createPanelClosed());k.setPanelEvent({panel:r.panels[0]})}}}r.jplace=a('<div class="l-column-place"></div>').appendTo(s);return r},setPanelEvent:function(h){var b=h.panel,d=b.panel;var c=this,f=this.options;if(a.fn.ligerDrag&&f.draggable){d.addClass("l-panel-draggable").ligerDrag({proxy:false,revert:true,handler:".l-panel-header span:first",onRendered:function(){},onStartDrag:function(j,g){c.portal.find(">.l-row").addClass("l-row-dragging");this.jplace=a('<div class="l-panel-place"></div>');this.jplace.height(d.height());d.width(d.width());d.addClass("l-panel-dragging");d.css("position","absolute");d.after(this.jplace);c._updatePortal()},onDrag:function(u,v){var r=v.pageX||v.screenX,n=v.pageY||v.screenY;var w=d.height(),j=d.width(),o=d.offset();var q=o.left+j/2,m=o.top+10;var t=c.getPanels(),k=c.getEmptyColumns();var x=g(t,k,q,m);if(x){if(this.placeStatus){if(this.placeStatus.panel&&x.panel){if(this.placeStatus.panel.rowIndex==x.panel.rowIndex&&this.placeStatus.panel.columnIndex==x.panel.columnIndex&&this.placeStatus.panel.index==x.panel.index&&this.placeStatus.position==x.position){return}}if(this.placeStatus.column&&x.column){if(this.placeStatus.column.rowIndex==x.column.rowIndex&&this.placeStatus.column.columnIndex==x.column.columnIndex&&this.placeStatus.position==x.position){return}}}if(x.position=="top"){this.jplace.insertBefore(x.panel?x.panel.jpanel:x.column.jplace);this.savedPosition=x.panel?x.panel:x.column;this.savedPosition.inTop=true}else{if(x.position=="bottom"){this.jplace.insertAfter(x.panel.jpanel);this.savedPosition=x.panel;this.savedPosition.inTop=false}}this.placeStatus=x}else{this.placeStatus=null}function g(z,A,e,E){for(i=0,l=z.length;i<l;i++){var D=z[i];if(D.panel==b){continue}var C=s(D,null,e,E);if(C){return C}}for(i=0,l=A.length;i<l;i++){var B=A[i];var C=s(null,B,e,E);if(C){return C}}return null}function s(e,B,F,E){var C=e?e.jpanel:B.jplace;if(!C){return null}var H=C.height(),z=C.width();var A=C.offset().left,D=C.offset().top;var G=3;if(F>A-G&&F<A+z+G){if(E>D-G&&E<D+H/2+G){return{panel:e,column:B,position:"top"}}if(E>D+H/2-G&&E<D+H+G){return{panel:e,column:B,position:e?"bottom":"top"}}}return null}},onStopDrag:function(o,n){c.portal.find(">.l-row").removeClass("l-row-dragging");b.set("width",b.get("width"));d.removeClass("l-panel-dragging");if(this.jplace){d.css({position:"relative",left:null,top:null});d.insertAfter(this.jplace);c.portal.find(">.l-row > .l-column >.l-panel-place").remove();if(this.savedPosition){var j=c.getPanels();var r,k,g;a(j).each(function(){if(this.panel==b){r=this.rowIndex;k=this.columnIndex;g=this.index}});var q=f.rows[r].columns[k].panels[g];var m=c.rows[r].columns[k].panels[g];f.rows[r].columns[k].panels.splice(g,1);c.rows[r].columns[k].panels.splice(g,1);if(this.savedPosition.panel){f.rows[this.savedPosition.rowIndex].columns[this.savedPosition.columnIndex].panels.splice(this.savedPosition.index+this.savedPosition.inTop?-1:0,0,q);c.rows[this.savedPosition.rowIndex].columns[this.savedPosition.columnIndex].panels.splice(this.savedPosition.index+this.savedPosition.inTop?-1:0,0,m)}else{f.rows[this.savedPosition.rowIndex].columns[this.savedPosition.columnIndex].panels=[q];c.rows[this.savedPosition.rowIndex].columns[this.savedPosition.columnIndex].panels=[m]}}}c._updatePortal();return false}})}},_updatePortal:function(){var b=this,c=this.options;a(b.rows).each(function(d){a(this.columns).each(function(e){if(this.panels&&this.panels.length){a(this.element).removeClass("l-column-empty")}else{a(this.element).addClass("l-column-empty")}})})},getPanels:function(){var c=this,d=this.options;var b=[];a(c.rows).each(function(e){a(this.columns).each(function(f){a(this.panels).each(function(g){b.push({rowIndex:e,columnIndex:f,index:g,panel:this,jpanel:this.panel})})})});return b},getPanel:function(f){var c=this,d=this.options;f=a.extend({rowIndex:0,columnIndex:0,index:0},f);var b=null;a(c.rows).each(function(e){a(this.columns).each(function(g){a(this.panels).each(function(h){if(b){return}if(e==f.rowIndex&&g==f.columnIndex&&h==f.index){b=this}})})});return b},getEmptyColumns:function(){var c=this,d=this.options;var b=[];a(c.rows).each(function(e){a(this.columns).each(function(f){if(!this.panels||!this.panels.length){b.push({rowIndex:e,columnIndex:f,jplace:this.jplace})}})});return b},_setUrl:function(b){var c=this,d=this.options;if(!b){return}a.ajax({url:b,data:d.parms,type:d.method,dataType:"json",success:function(e){c.set("rows",e)}})},_setWidth:function(b){b&&this.portal.width(b)},collapseAll:function(){var c=this,d=this.options;var b=c.getPanels();a(b).each(function(f,g){var e=g.panel;e.collapse()})},expandAll:function(){var c=this,d=this.options;var b=c.getPanels();a(b).each(function(f,g){var e=g.panel;e.expand()})}})})(jQuery);(function(a){a.fn.ligerRadio=function(){return a.ligerui.run.call(this,"ligerRadio",arguments)};a.fn.ligerGetRadioManager=function(){return a.ligerui.run.call(this,"ligerGetRadioManager",arguments)};a.ligerDefaults.Radio={disabled:false};a.ligerMethos.Radio={};a.ligerui.controls.Radio=function(c,b){a.ligerui.controls.Radio.base.constructor.call(this,c,b)};a.ligerui.controls.Radio.ligerExtend(a.ligerui.controls.Input,{__getType:function(){return"Radio"},__idPrev:function(){return"Radio"},_extendMethods:function(){return a.ligerMethos.Radio},_render:function(){var b=this,c=this.options;b.input=a(this.element);b.link=a('<a href="javascript:void(0)" class="l-radio"></a>');b.wrapper=b.input.addClass("l-hidden").wrap('<div class="l-radio-wrapper"></div>').parent();b.wrapper.prepend(b.link);b.input.change(function(){if(this.checked){b.link.addClass("l-radio-checked")}else{b.link.removeClass("l-radio-checked")}return true});b.link.click(function(){b._doclick()});b.wrapper.hover(function(){if(!c.disabled){a(this).addClass("l-over")}},function(){a(this).removeClass("l-over")});this.element.checked&&b.link.addClass("l-radio-checked");if(this.element.id){a("label[for="+this.element.id+"]").click(function(){b._doclick()})}b.set(c)},setValue:function(c){var b=this,d=this.options;if(!c){b.input[0].checked=false;b.link.removeClass("l-radio-checked")}else{b.input[0].checked=true;b.link.addClass("l-radio-checked")}},getValue:function(){return this.input[0].checked},setEnabled:function(){this.input.attr("disabled",false);this.wrapper.removeClass("l-disabled");this.options.disabled=false},setDisabled:function(){this.input.attr("disabled",true);this.wrapper.addClass("l-disabled");this.options.disabled=true},updateStyle:function(){if(this.input.attr("disabled")){this.wrapper.addClass("l-disabled");this.options.disabled=true}if(this.input[0].checked){this.link.addClass("l-checkbox-checked")}else{this.link.removeClass("l-checkbox-checked")}},_doclick:function(){var c=this,d=this.options;if(c.input.attr("disabled")){return false}c.input.trigger("click").trigger("change");var b;if(c.input[0].form){b=c.input[0].form}else{b=document}a("input:radio[name="+c.input[0].name+"]",b).not(c.input).trigger("change");return false}})})(jQuery);(function(a){a.fn.ligerRadioList=function(b){return a.ligerui.run.call(this,"ligerRadioList",arguments)};a.ligerDefaults.RadioList={rowSize:3,valueField:"id",textField:"text",valueFieldID:null,name:null,data:null,parms:null,ajaxContentType:null,ajaxType:"post",url:null,onSuccess:null,onError:null,onSelect:null,css:null,value:null,valueFieldCssClass:null};a.ligerMethos.RadioList=a.ligerMethos.RadioList||{};a.ligerui.controls.RadioList=function(c,b){a.ligerui.controls.RadioList.base.constructor.call(this,c,b)};a.ligerui.controls.RadioList.ligerExtend(a.ligerui.controls.Input,{__getType:function(){return"RadioList"},_extendMethods:function(){return a.ligerMethos.RadioList},_init:function(){a.ligerui.controls.RadioList.base._init.call(this)},_render:function(){var b=this,c=this.options;b.data=c.data;b.valueField=null;if(a(this.element).is(":hidden")||a(this.element).is(":text")){b.valueField=a(this.element);if(a(this.element).is(":text")){b.valueField.hide()}}else{if(c.valueFieldID){b.valueField=a("#"+c.valueFieldID+":input,[name="+c.valueFieldID+"]:input");if(b.valueField.length==0){b.valueField=a('<input type="hidden"/>')}b.valueField[0].id=b.valueField[0].name=c.valueFieldID}else{b.valueField=a('<input type="hidden"/>');b.valueField[0].id=b.valueField[0].name=b.id+"_val"}}if(b.valueField[0].name==null){b.valueField[0].name=b.valueField[0].id}if(c.valueFieldCssClass){b.valueField.addClass(c.valueFieldCssClass)}b.valueField.attr("data-ligerid",b.id);if(a(this.element).is(":hidden")||a(this.element).is(":text")){b.radioList=a("<div></div>").insertBefore(this.element)}else{b.radioList=a(this.element)}b.radioList.html('<div class="l-radiolist-inner"><table cellpadding="0" cellspacing="0" border="0" class="l-radiolist-table"></table></div>').addClass("l-radiolist").append(b.valueField);b.radioList.table=a("table:first",b.radioList);c.value=b.valueField.val()||c.value;b.set(c);b._addClickEven()},destroy:function(){if(this.radioList){this.radioList.remove()}this.options=null;a.ligerui.remove(this)},clear:function(){this._changeValue("");this.trigger("clear")},_setCss:function(b){if(b){this.radioList.addClass(b)}},_setDisabled:function(b){if(b){this.radioList.addClass("l-radiolist-disabled");a("input:radio",this.radioList).attr("disabled",true)}else{this.radioList.removeClass("l-radiolist-disabled");a("input:radio",this.radioList).removeAttr("disabled")}},_setWidth:function(b){this.radioList.width(b)},_setHeight:function(b){this.radioList.height(b)},indexOf:function(e){var d=this,f=this.options;if(!d.data){return -1}for(var c=0,b=d.data.length;c<b;c++){if(typeof(e)=="object"){if(d.data[c]==e){return c}}else{if(d.data[c][f.valueField].toString()==e.toString()){return c}}}return -1},removeItems:function(b){var c=this;if(!c.data){return}a(b).each(function(e,f){var d=c.indexOf(f);if(d==-1){return}c.data.splice(d,1)});c.refresh()},removeItem:function(c){if(!this.data){return}var b=this.indexOf(c);if(b==-1){return}this.data.splice(b,1);this.refresh()},insertItem:function(d,b){var c=this;if(!c.data){c.data=[]}c.data.splice(b,0,d);c.refresh()},addItems:function(b){var c=this;if(!c.data){c.data=[]}a(b).each(function(d,e){c.data.push(e)});c.refresh()},addItem:function(c){var b=this;if(!b.data){b.data=[]}b.data.push(c);b.refresh()},_setValue:function(c){var b=this,d=this.options;b.valueField.val(c);d.value=c;this._dataInit()},setValue:function(b){this._setValue(b)},_setUrl:function(c){if(!c){return}var d=this,e=this.options;var b={type:e.ajaxType||"post",url:c,data:e.parms,cache:false,dataType:"json",success:function(f){d.setData(f);d.trigger("success",[f])},error:function(f,g){d.trigger("error",[f,g])}};if(e.ajaxContentType){b.contentType=e.ajaxContentType}a.ajax(b)},setUrl:function(b){return this._setUrl(b)},setParm:function(b,e){if(!b){return}var d=this;var c=d.get("parms");if(!c){c={}}c[b]=e;d.set("parms",c)},clearContent:function(){var b=this,c=this.options;a("table",b.radioList).html("")},_setData:function(b){this.setData(b)},setData:function(c){var b=this,d=this.options;if(!c||!c.length){return}b.data=c;b.refresh();b.updateStyle()},refresh:function(){var m=this,d=this.options,j=this.data;this.clearContent();if(!j){return}var f=[],o=d.rowSize,n=false,b=d.name||m.id;for(var k=0;k<j.length;k++){var e=j[k][d.valueField],h=j[k][d.textField],c=m.id+"-"+k;var q=k%o==0;if(q){if(n){f.push("</tr>")}f.push("<tr>");n=true}f.push("<td><input type='radio' name='"+b+"' value='"+e+"' id='"+c+"'/><label for='"+c+"'>"+h+"</label></td>")}if(n){f.push("</tr>")}m.radioList.table.append(f.join(""))},_getValue:function(){var c=this,d=this.options,b=d.name||c.id;return a('input:radio[name="'+b+'"]:checked').val()},getValue:function(){return this._getValue()},updateStyle:function(){var b=this,c=this.options;b._dataInit();a(":radio",b.element).change(function(){var d=b.getValue();b.trigger("select",[{value:d}])})},_dataInit:function(){var b=this,d=this.options;var c=b.valueField.val()||b._getValue()||d.value;b._changeValue(c)},_changeValue:function(e){var c=this,d=this.options,b=d.name||c.id;a("input:radio[name='"+b+"']",c.radioList).each(function(){this.checked=this.value==e});c.valueField.val(e);c.selectedValue=e},_addClickEven:function(){var b=this,c=this.options;b.radioList.click(function(f){var d=b.getValue();if(d){b.valueField.val(d)}})}})})(jQuery);(function(a){a.fn.ligerResizable=function(b){return a.ligerui.run.call(this,"ligerResizable",arguments,{idAttrName:"ligeruiresizableid",hasElement:false,propertyToElemnt:"target"})};a.fn.ligerGetResizableManager=function(){return a.ligerui.run.call(this,"ligerGetResizableManager",arguments,{idAttrName:"ligeruiresizableid",hasElement:false,propertyToElemnt:"target"})};a.ligerDefaults.Resizable={handles:"n, e, s, w, ne, se, sw, nw",maxWidth:2000,maxHeight:2000,minWidth:20,minHeight:20,scope:3,animate:false,onStartResize:function(b){},onResize:function(b){},onStopResize:function(b){},onEndResize:null};a.ligerui.controls.Resizable=function(b){a.ligerui.controls.Resizable.base.constructor.call(this,null,b)};a.ligerui.controls.Resizable.ligerExtend(a.ligerui.core.UIComponent,{__getType:function(){return"Resizable"},__idPrev:function(){return"Resizable"},_render:function(){var b=this,c=this.options;b.target=a(c.target);b.set(c);b.target.mousemove(function(f){if(c.disabled){return}b.dir=b._getDir(f);if(b.dir){b.target.css("cursor",b.dir+"-resize")}else{if(b.target.css("cursor").indexOf("-resize")>0){b.target.css("cursor","default")}}if(c.target.ligeruidragid){var d=a.ligerui.get(c.target.ligeruidragid);if(d&&b.dir){d.set("disabled",true)}else{if(d){d.set("disabled",false)}}}}).mousedown(function(d){if(c.disabled){return}if(b.dir){b._start(d)}})},_rendered:function(){this.options.target.ligeruiresizableid=this.id},_getDir:function(k){var j=this,b=this.options;var d="";var o=j.target.offset();var c=j.target.width();var m=j.target.height();var n=b.scope;var h=k.pageX||k.screenX;var f=k.pageY||k.screenY;if(f>=o.top&&f<o.top+n){d+="n"}else{if(f<=o.top+m&&f>o.top+m-n){d+="s"}}if(h>=o.left&&h<o.left+n){d+="w"}else{if(h<=o.left+c&&h>o.left+c-n){d+="e"}}if(b.handles=="all"||d==""){return d}if(a.inArray(d,j.handles)!=-1){return d}return""},_setHandles:function(b){if(!b){return}this.handles=b.replace(/(\s*)/g,"").split(",")},_createProxy:function(){var b=this;b.proxy=a('<div class="l-resizable"></div>');b.proxy.width(b.target.width()).height(b.target.height());b.proxy.attr("resizableid",b.id).appendTo("body")},_removeProxy:function(){var b=this;if(b.proxy){b.proxy.remove();b.proxy=null}},_start:function(d){var b=this,c=this.options;b._createProxy();b.proxy.css({left:b.target.offset().left,top:b.target.offset().top,position:"absolute"});b.current={dir:b.dir,left:b.target.offset().left,top:b.target.offset().top,startX:d.pageX||d.screenX,startY:d.pageY||d.clientY,width:b.target.width(),height:b.target.height()};a(document).bind("selectstart.resizable",function(){return false});a(document).bind("mouseup.resizable",function(){b._stop.apply(b,arguments)});a(document).bind("mousemove.resizable",function(){b._drag.apply(b,arguments)});b.proxy.show();b.trigger("startResize",[b.current,d])},changeBy:{t:["n","ne","nw"],l:["w","sw","nw"],w:["w","sw","nw","e","ne","se"],h:["n","ne","nw","s","se","sw"]},_drag:function(h){var d=this,f=this.options;if(!d.current){return}if(!d.proxy){return}d.proxy.css("cursor",d.current.dir==""?"default":d.current.dir+"-resize");var c=h.pageX||h.screenX;var b=h.pageY||h.screenY;d.current.diffX=c-d.current.startX;d.current.diffY=b-d.current.startY;d._applyResize(d.proxy);d.trigger("resize",[d.current,h])},_stop:function(d){var b=this,c=this.options;if(b.hasBind("stopResize")){if(b.trigger("stopResize",[b.current,d])!=false){b._applyResize()}}else{b._applyResize()}b._removeProxy();b.trigger("endResize",[b.current,d]);a(document).unbind("selectstart.resizable");a(document).unbind("mousemove.resizable");a(document).unbind("mouseup.resizable")},_applyResize:function(b){var c=this,d=this.options;var e={left:c.current.left,top:c.current.top,width:c.current.width,height:c.current.height};var f=false;if(!b){b=c.target;f=true;if(!isNaN(parseInt(c.target.css("top")))){e.top=parseInt(c.target.css("top"))}else{e.top=0}if(!isNaN(parseInt(c.target.css("left")))){e.left=parseInt(c.target.css("left"))}else{e.left=0}}if(a.inArray(c.current.dir,c.changeBy.l)>-1){e.left+=c.current.diffX;c.current.diffLeft=c.current.diffX}else{if(f){delete e.left}}if(a.inArray(c.current.dir,c.changeBy.t)>-1){e.top+=c.current.diffY;c.current.diffTop=c.current.diffY}else{if(f){delete e.top}}if(a.inArray(c.current.dir,c.changeBy.w)>-1){e.width+=(c.current.dir.indexOf("w")==-1?1:-1)*c.current.diffX;c.current.newWidth=e.width}else{if(f){delete e.width}}if(a.inArray(c.current.dir,c.changeBy.h)>-1){e.height+=(c.current.dir.indexOf("n")==-1?1:-1)*c.current.diffY;c.current.newHeight=e.height}else{if(f){delete e.height}}if(f&&d.animate){b.animate(e)}else{b.css(e)}}})})(jQuery);(function(a){a.fn.ligerSpinner=function(){return a.ligerui.run.call(this,"ligerSpinner",arguments)};a.fn.ligerGetSpinnerManager=function(){return a.ligerui.run.call(this,"ligerGetSpinnerManager",arguments)};a.ligerDefaults.Spinner={type:"float",isNegative:true,decimalplace:2,step:0.1,interval:50,value:null,onChangeValue:false,onEnterDown:null,minValue:null,maxValue:null,disabled:false,readonly:false};a.ligerMethos.Spinner={};a.ligerui.controls.Spinner=function(c,b){a.ligerui.controls.Spinner.base.constructor.call(this,c,b)};a.ligerui.controls.Spinner.ligerExtend(a.ligerui.controls.Input,{__getType:function(){return"Spinner"},__idPrev:function(){return"Spinner"},_extendMethods:function(){return a.ligerMethos.Spinner},_init:function(){a.ligerui.controls.Spinner.base._init.call(this);var b=this.options;if(b.type=="float"){b.step=0.1;b.interval=50}else{if(b.type=="int"){b.step=1;b.interval=100}else{if(b.type=="time"){b.step=1;b.interval=100}else{b.type="int";b.step=1;b.interval=100}}}},_render:function(){a.ligerui.controls.Spinner.base._render.call(this);var b=this,c=this.options;b.interval=null;b.inputText=null;b.value=null;b.textFieldID="";if(this.element.tagName.toLowerCase()=="input"&&this.element.type&&this.element.type=="text"){b.inputText=a(this.element);if(this.element.id){b.textFieldID=this.element.id}}else{b.inputText=a('<input type="text"/>');b.inputText.appendTo(a(this.element))}if(b.textFieldID==""&&c.textFieldID){b.textFieldID=c.textFieldID}b.link=a('<div class="l-trigger"><div class="l-spinner-up"><div class="l-spinner-icon"></div></div><div class="l-spinner-split"></div><div class="l-spinner-down"><div class="l-spinner-icon"></div></div></div>');b.wrapper=b.inputText.wrap('<div class="l-text"></div>').parent();b.wrapper.append('<div class="l-text-l"></div><div class="l-text-r"></div>');b.wrapper.append(b.link).after(b.selectBox).after(b.valueField);b.link.up=a(".l-spinner-up",b.link);b.link.down=a(".l-spinner-down",b.link);b.inputText.addClass("l-text-field");if(c.disabled){b.wrapper.addClass("l-text-disabled")}if(!b._isVerify(b.inputText.val())){b.value=b._getDefaultValue();b._showValue(b.value)}b.link.up.hover(function(){if(!c.disabled){a(this).addClass("l-spinner-up-over")}},function(){clearInterval(b.interval);a(document).unbind("selectstart.spinner");a(this).removeClass("l-spinner-up-over")}).mousedown(function(){if(!c.disabled){b._uping.call(b);b.interval=setInterval(function(){b._uping.call(b)},c.interval);a(document).bind("selectstart.spinner",function(){return false})}}).mouseup(function(){clearInterval(b.interval);b.inputText.trigger("change").focus();a(document).unbind("selectstart.spinner")});b.link.down.hover(function(){if(!c.disabled){a(this).addClass("l-spinner-down-over")}},function(){clearInterval(b.interval);a(document).unbind("selectstart.spinner");a(this).removeClass("l-spinner-down-over")}).mousedown(function(){if(!c.disabled){b.interval=setInterval(function(){b._downing.call(b)},c.interval);a(document).bind("selectstart.spinner",function(){return false})}}).mouseup(function(){clearInterval(b.interval);b.inputText.trigger("change").focus();a(document).unbind("selectstart.spinner")});b.inputText.change(function(){var d=b.inputText.val();b.value=b._getVerifyValue(d);b.trigger("changeValue",[b.value]);b._showValue(b.value)}).blur(function(){b.wrapper.removeClass("l-text-focus")}).focus(function(){b.wrapper.addClass("l-text-focus")}).keydown(function(d){if(d.keyCode==13){b.trigger("enterdown");if(b.options&&b.options.host_form){b.options.host_form.trigger("enterdown")}}});b.wrapper.hover(function(){if(!c.disabled){b.wrapper.addClass("l-text-over")}},function(){b.wrapper.removeClass("l-text-over")});b.set(c)},_setValue:function(b){if(b!=null){this.inputText.val(b)}},_setWidth:function(c){var b=this;if(c>20){b.wrapper.css({width:c});b.inputText.css({width:c-20})}},_setHeight:function(c){var b=this;if(c>10){b.wrapper.height(c);b.inputText.height(c-2);b.link.height(c-4)}},_setDisabled:function(b){if(b){this.wrapper.addClass("l-text-disabled")}else{this.wrapper.removeClass("l-text-disabled")}},_showValue:function(c){var b=this,d=this.options;if(!c||c=="NaN"){c=0}if(d.type=="float"){c=parseFloat(c).toFixed(d.decimalplace)}this.inputText.val(c)},_setValue:function(b){this._showValue(b)},setValue:function(b){this._showValue(b)},getValue:function(){return this.inputText.val()},_round:function(b,h){var d=this,f=this.options;var c=1;for(;h>0;c*=10,h--){}for(;h<0;c/=10,h++){}return Math.round(b*c)/c},_isInt:function(e){var b=this,c=this.options;var d=c.isNegative?/^-?\d+$/:/^\d+$/;if(!d.test(e)){return false}if(parseFloat(e)!=e){return false}return true},_isFloat:function(e){var b=this,c=this.options;var d=c.isNegative?/^-?\d+(\.\d+)?$/:/^\d+(\.\d+)?$/;if(!d.test(e)){return false}if(parseFloat(e)!=e){return false}return true},_isTime:function(e){var c=this,d=this.options;var b=e.match(/^(\d{1,2}):(\d{1,2})$/);if(b==null){return false}if(b[1]>24||b[2]>60){return false}return true},_isVerify:function(e){var b=this,d=this.options;if(d.type=="float"){if(!b._isFloat(e)){return false}var c=parseFloat(e);if(d.minValue!=undefined&&d.minValue>c){return false}if(d.maxValue!=undefined&&d.maxValue<c){return false}return true}else{if(d.type=="int"){if(!b._isInt(e)){return false}var c=parseInt(e);if(d.minValue!=undefined&&d.minValue>c){return false}if(d.maxValue!=undefined&&d.maxValue<c){return false}return true}else{if(d.type=="time"){return b._isTime(e)}}}return false},_getVerifyValue:function(d){var c=this,e=this.options;var b=null;if(e.type=="float"){b=c._round(d,e.decimalplace)}else{if(e.type=="int"){b=parseInt(d)}else{if(e.type=="time"){b=d}}}if(!c._isVerify(b)){return c.value}else{return b}},_isOverValue:function(c){var b=this,d=this.options;if(d.minValue!=null&&d.minValue>c){return true}if(d.maxValue!=null&&d.maxValue<c){return true}return false},_getDefaultValue:function(){var b=this,c=this.options;if(c.type=="float"||c.type=="int"){return 0}else{if(c.type=="time"){return"00:00"}}},_addValue:function(b){var c=this,e=this.options;var d=c.inputText.val();d=parseFloat(d)+b;if(c._isOverValue(d)){return}c._showValue(d);c.inputText.trigger("change")},_addTime:function(f){var c=this,e=this.options;var d=c.inputText.val();var b=d.match(/^(\d{1,2}):(\d{1,2})$/);newminute=parseInt(b[2])+f;if(newminute<10){newminute="0"+newminute}d=b[1]+":"+newminute;if(c._isOverValue(d)){return}c._showValue(d);c.inputText.trigger("change")},_uping:function(){var b=this,c=this.options;if(c.type=="float"||c.type=="int"){b._addValue(c.step)}else{if(c.type=="time"){b._addTime(c.step)}}},_downing:function(){var b=this,c=this.options;if(c.type=="float"||c.type=="int"){b._addValue(-1*c.step)}else{if(c.type=="time"){b._addTime(-1*c.step)}}},_isDateTime:function(b){var e=this,f=this.options;var c=b.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(c==null){return false}var h=new Date(c[1],c[3]-1,c[4]);if(h=="NaN"){return false}return(h.getFullYear()==c[1]&&(h.getMonth()+1)==c[3]&&h.getDate()==c[4])},_isLongDateTime:function(b){var f=this,h=this.options;var c=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2})$/;var e=b.match(c);if(e==null){return false}var j=new Date(e[1],e[3]-1,e[4],e[5],e[6]);if(j=="NaN"){return false}return(j.getFullYear()==e[1]&&(j.getMonth()+1)==e[3]&&j.getDate()==e[4]&&j.getHours()==e[5]&&j.getMinutes()==e[6])}})})(jQuery);(function(a){a.fn.ligerTab=function(b){return a.ligerui.run.call(this,"ligerTab",arguments)};a.fn.ligerGetTabManager=function(){return a.ligerui.run.call(this,"ligerGetTabManager",arguments)};a.ligerDefaults.Tab={height:null,heightDiff:0,changeHeightOnResize:false,contextmenu:true,dblClickToClose:false,dragToMove:false,showSwitch:false,showSwitchInTab:false,data:null,onBeforeOverrideTabItem:null,onAfterOverrideTabItem:null,onBeforeRemoveTabItem:null,onAfterRemoveTabItem:null,onBeforeAddTabItem:null,onAfterAddTabItem:null,onBeforeSelectTabItem:null,onAfterSelectTabItem:null,onCloseOther:null,onCloseAll:null,onClose:null,onReload:null,onSwitchRender:null};a.ligerDefaults.TabString={closeMessage:$l("sys.hand.btn.close"),closeOtherMessage:$l("sys.hand.tab.close_others"),closeAllMessage:$l("sys.hand.tab.close_all"),reloadMessage:$l("sys.hand.btn.refresh")};a.ligerMethos.Tab={};a.ligerui.controls.Tab=function(c,b){a.ligerui.controls.Tab.base.constructor.call(this,c,b)};a.ligerui.controls.Tab.ligerExtend(a.ligerui.core.UIComponent,{__getType:function(){return"Tab"},__idPrev:function(){return"Tab"},_extendMethods:function(){return a.ligerMethos.Tab},_render:function(){var c=this,e=this.options;if(e.height){c.makeFullHeight=true}c.tab=a(this.element);c.tab.addClass("l-tab");if(e.contextmenu&&a.ligerMenu){c.tab.menu=a.ligerMenu({width:130,items:[{text:e.closeMessage,id:"close",click:function(){c._menuItemClick.apply(c,arguments)}},{text:e.closeOtherMessage,id:"closeother",click:function(){c._menuItemClick.apply(c,arguments)}},{text:e.closeAllMessage,id:"closeall",click:function(){c._menuItemClick.apply(c,arguments)}},{text:e.reloadMessage,id:"reload",click:function(){c._menuItemClick.apply(c,arguments)}}]})}c.tab.content=a('<div class="l-tab-content"></div>');a("> div",c.tab).appendTo(c.tab.content);c.tab.content.appendTo(c.tab);c.tab.links=a('<div class="l-tab-links"><ul style="left: 0px; "></ul><div class="l-tab-switch"></div></div>');c.tab.links.prependTo(c.tab);c.tab.links.ul=a("ul",c.tab.links);var b=a("> div[lselected=true]",c.tab.content);var d=b.length>0;c.selectedTabId=b.attr("tabid");a("> div",c.tab.content).each(function(k,n){var g=a('<li class=""><a></a><div class="l-tab-links-item-left"></div><div class="l-tab-links-item-right"></div></li>');var j=a(this);if(j.attr("title")){a("> a",g).html(j.attr("title"));j.attr("title","")}var h=j.attr("tabid");if(h==undefined){h=c.getNewTabid();j.attr("tabid",h);if(j.attr("lselected")){c.selectedTabId=h}}g.attr("tabid",h);if(!d&&k==0){c.selectedTabId=h}var q=j.attr("showClose");if(q){g.append("<div class='l-tab-links-item-close'></div>")}a("> ul",c.tab.links).append(g);if(!j.hasClass("l-tab-content-item")){j.addClass("l-tab-content-item")}if(j.find("iframe").length>0){var m=a("iframe:first",j);if(m[0].readyState!="complete"){if(j.find(".l-tab-loading:first").length==0){j.prepend("<div class='l-tab-loading' style='display:block;'></div>")}var o=a(".l-tab-loading:first",j);m.bind("load.tab",function(){o.hide()})}}});c.selectTabItem(c.selectedTabId);if(e.height){if(typeof(e.height)=="string"&&e.height.indexOf("%")>0){c.onResize();if(e.changeHeightOnResize){a(window).resize(function(){c.onResize.call(c)})}}else{c.setHeight(e.height)}}if(c.makeFullHeight){c.setContentHeight()}a("li",c.tab.links).each(function(){c._addTabItemEvent(a(this))});c.tab.bind("dblclick.tab",function(m){if(!e.dblClickToClose){return}c.dblclicking=true;var k=(m.target||m.srcElement);var j=k.tagName.toLowerCase();if(j=="a"){var h=a(k).parent().attr("tabid");var g=a(k).parent().find("div.l-tab-links-item-close").length?true:false;if(g){c.removeTabItem(h)}}c.dblclicking=false});c.set(e);setTimeout(f,100);a(window).resize(function(){f.call(c)});function f(){var g=c.tab.width()-parseInt(c.tab.links.css("marginLeft"),10)-parseInt(c.tab.links.css("marginRight"),10);c.tab.links.width(g)}},_setShowSwitch:function(c){var b=this,d=this.options;if(c){if(!a(".l-tab-switch",b.tab.links).length){a("<div class='l-tab-switch'></div>").appendTo(b.tab.links)}a(b.tab).addClass("l-tab-switchable");a(".l-tab-switch",b.tab).click(function(){b.toggleSwitch(this)})}else{a(b.tab).removeClass("l-tab-switchable");a("body > .l-tab-windowsswitch").remove()}},_setShowSwitchInTab:function(d){var c=this,e=this.options;if(e.showSwitch&&d){a(c.tab).removeClass("l-tab-switchable");a(".l-tab-switch",c.tab).remove();var b=a("<li class='l-tab-itemswitch'><a></a><div class='l-tab-links-item-left'></div><div class='l-tab-links-item-right'></div></li>");b.appendTo(c.tab.links.ul);b.click(function(){c.toggleSwitch(this)})}else{a(".l-tab-itemswitch",c.tab.ul).remove()}},toggleSwitch:function(b){var c=this,f=this.options;if(a("body > .l-tab-windowsswitch").length){a("body > .l-tab-windowsswitch").remove();return}if(b==null){return}var e=a("<div class='l-tab-windowsswitch'></div>").appendTo("body");var h=c.tab.links.ul.find(">li");var d=c.getSelectedTabItemID();h.each(function(k,m){var j=a("<a href='javascript:void(0)'></a>");j.text(a(m).find("a").text());var g=a(m).attr("tabid");if(g==null){return}if(g==d){j.addClass("selected")}j.attr("tabid",g);e.append(j)});e.css({top:a(b).offset().top+a(b).height(),left:a(b).offset().left-e.width()});e.find("a").bind("click",function(j){var g=a(this).attr("tabid");if(g==undefined){return}c.selectTabItem(g);c.moveToTabItem(g);a("body > .l-tab-windowsswitch").remove()});c.trigger("switchRender",[e])},_applyDrag:function(d){var c=this,e=this.options;c.droptip=c.droptip||a("<div class='l-tab-drag-droptip' style='display:none'><div class='l-drop-move-up'></div><div class='l-drop-move-down'></div></div>").appendTo("body");var b=a(d).ligerDrag({revert:true,animate:false,proxy:function(){var f=a(this).find("a").html();c.dragproxy=a("<div class='l-tab-drag-proxy' style='display:none'><div class='l-drop-icon l-drop-no'></div></div>").appendTo("body");c.dragproxy.append(f);return c.dragproxy},onRendered:function(){this.set("cursor","pointer")},onStartDrag:function(h,g){if(!a(d).hasClass("l-selected")){return false}if(g.button==2){return false}var f=g.srcElement||g.target;if(a(f).hasClass("l-tab-links-item-close")){return false}},onDrag:function(h,g){if(c.dropIn==null){c.dropIn=-1}var j=c.tab.links.ul.find(">li");var f=j.index(h.target);j.each(function(o,r){if(f==o){return}var k=o>f;if(c.dropIn!=-1&&c.dropIn!=o){return}var s=a(this).offset();var m={top:s.top,bottom:s.top+a(this).height(),left:s.left-10,right:s.left+10};if(k){m.left+=a(this).width();m.right+=a(this).width()}var q=g.pageX||g.screenX;var n=g.pageY||g.screenY;if(q>m.left&&q<m.right&&n>m.top&&n<m.bottom){c.droptip.css({left:m.left+5,top:m.top-9}).show();c.dropIn=o;c.dragproxy.find(".l-drop-icon").removeClass("l-drop-no").addClass("l-drop-yes")}else{c.dropIn=-1;c.droptip.hide();c.dragproxy.find(".l-drop-icon").removeClass("l-drop-yes").addClass("l-drop-no")}})},onStopDrag:function(g,f){if(c.dropIn>-1){var j=c.tab.links.ul.find(">li:eq("+c.dropIn+")").attr("tabid");var h=a(g.target).attr("tabid");setTimeout(function(){c.moveTabItem(h,j)},0);c.dropIn=-1;c.dragproxy.remove()}c.droptip.hide();this.set("cursor","default")}});return b},_setDragToMove:function(c){if(!a.fn.ligerDrag){return}var b=this,d=this.options;if(c){if(b.drags){return}b.drags=b.drags||[];b.tab.links.ul.find(">li").each(function(){b.drags.push(b._applyDrag(this))})}},moveTabItem:function(j,c){var b=this;var h=b.tab.links.ul.find(">li[tabid="+j+"]");var f=b.tab.links.ul.find(">li[tabid="+c+"]");var e=b.tab.links.ul.find(">li").index(h);var d=b.tab.links.ul.find(">li").index(f);if(e<d){f.after(h)}else{f.before(h)}},setTabButton:function(){var c=this,d=this.options;var e=0;a("li",c.tab.links.ul).each(function(){e+=a(this).width()+2});var b=c.tab.width();if(e>b){if(!a(".l-tab-links-left",c.tab).length){c.tab.links.append('<div class="l-tab-links-left"><span></span></div><div class="l-tab-links-right"><span></span></div>');c.setTabButtonEven()}return true}else{c.tab.links.ul.animate({left:0});a(".l-tab-links-left,.l-tab-links-right",c.tab.links).remove();return false}},setTabButtonEven:function(){var b=this,c=this.options;a(".l-tab-links-left",b.tab.links).hover(function(){a(this).addClass("l-tab-links-left-over")},function(){a(this).removeClass("l-tab-links-left-over")}).click(function(){b.moveToPrevTabItem()});a(".l-tab-links-right",b.tab.links).hover(function(){a(this).addClass("l-tab-links-right-over")},function(){a(this).removeClass("l-tab-links-right-over")}).click(function(){b.moveToNextTabItem()})},moveToPrevTabItem:function(v){var u=this,o=this.options;var m=a("> li",u.tab.links.ul),s=a(".l-tab-links-right",u.tab),h=a(".l-tab-links-left",u.tab);if(!s.length||!h.length){return false}var n=s.offset(),w=h.offset();var b=null,j=0;var k=w.left+h.outerWidth();for(var t=0,r=m.length;t<r;t++){var q=a(m[t]);var f=q.offset();var e=f.left,c=f.left+q.outerWidth();if(v!=null){if(e<k&&q.attr("tabid")==v){b=q;break}}else{if(e<k&&c>=k){b=q;break}}j+=q.outerWidth()+parseInt(q.css("marginLeft"))+parseInt(q.css("marginRight"))}if(b==null){return false}var d=j-h.outerWidth();u.tab.links.ul.animate({left:-1*d});return true},moveToNextTabItem:function(b){var t=this,e=this.options;var k=a("> li",t.tab.links.ul),c=a(".l-tab-links-right",t.tab),n=a(".l-tab-links-left",t.tab);if(!c.length||!n.length){return false}var r=c.offset(),u=n.offset();var v=null,h=0;for(var s=0,m=k.length;s<m;s++){var f=a(k[s]);h+=f.outerWidth()+parseInt(f.css("marginLeft"))+parseInt(f.css("marginRight"));var q=f.offset();var d=q.left,o=q.left+f.outerWidth();if(b!=null){if(o>r.left&&f.attr("tabid")==b){v=f;break}}else{if(d<=r.left&&o>r.left){v=f;break}}}if(v==null){return false}var j=h-(r.left-u.left)+parseInt(v.css("marginLeft"))+parseInt(v.css("marginRight"));t.tab.links.ul.animate({left:-1*j});return true},moveToTabItem:function(b){var c=this,d=this.options;if(!c.moveToPrevTabItem(b)){c.moveToNextTabItem(b)}},getTabItemCount:function(){var b=this,c=this.options;return a("li",b.tab.links.ul).length},getSelectedTabItemID:function(){var b=this,c=this.options;return a("li.l-selected",b.tab.links.ul).attr("tabid")},removeSelectedTabItem:function(){var b=this,c=this.options;b.removeTabItem(b.getSelectedTabItemID())},overrideSelectedTabItem:function(b){var c=this,d=this.options;c.overrideTabItem(c.getSelectedTabItemID(),b)},overrideTabItem:function(n,r){var f=this,d=this.options;if(f.trigger("beforeOverrideTabItem",[n])==false){return false}var b=r.tabid;if(b==undefined){b=f.getNewTabid()}var c=r.url;var j=r.content;var h=r.target;var q=r.text;var k=r.showClose;var o=r.height;if(f.isTabItemExist(b)){return}var e=a("li[tabid="+n+"]",f.tab.links.ul);var m=a(".l-tab-content-item[tabid="+n+"]",f.tab.content);if(!e||!m){return}e.attr("tabid",b);m.attr("tabid",b);if(a("iframe",m).length==0&&c){m.html("<iframe frameborder='0'></iframe>")}else{if(j){m.html(j)}}a("iframe",m).attr("name",b);if(k==undefined){k=true}if(k==false){a(".l-tab-links-item-close",e).remove()}else{if(a(".l-tab-links-item-close",e).length==0){e.append("<div class='l-tab-links-item-close'></div>")}}if(q==undefined){q=b}if(o){m.height(o)}a("a",e).text(q);a("iframe",m).attr("src",c);f.trigger("afterOverrideTabItem",[n])},setHeader:function(b,c){a("li[tabid="+b+"] a",this.tab.links.ul).text(c)},selectTabItem:function(b){var c=this,d=this.options;if(c.trigger("beforeSelectTabItem",[b])==false){return false}c.selectedTabId=b;a("> .l-tab-content-item[tabid="+b+"]",c.tab.content).removeClass("l-tab-hide").siblings().addClass("l-tab-hide");a("li[tabid="+b+"]",c.tab.links.ul).addClass("l-selected").siblings().removeClass("l-selected");c.trigger("afterSelectTabItem",[b])},moveToLastTabItem:function(){var d=this,e=this.options;var f=0;a("li",d.tab.links.ul).each(function(){f+=a(this).width()+2});var c=d.tab.width();if(f>c){var b=a(".l-tab-links-right",d.tab.links).width();d.tab.links.ul.animate({left:-1*(f-c+b+2)})}},getTabItemTitle:function(b){var c=this,d=this.options;return a("li[tabid="+b+"] a",c.tab.links.ul).text()},setTabItemTitle:function(b,e){var c=this,d=this.options;a("li[tabid="+b+"] a",c.tab.links.ul).text(e)},getTabItemSrc:function(b){var c=this,d=this.options;return a(".l-tab-content-item[tabid="+b+"] iframe",c.tab.content).attr("src")},setTabItemSrc:function(b,d){var f=this,j=this.options;var c=a(".l-tab-content-item[tabid="+b+"]",f.tab.content);var h=a(".l-tab-loading:first",c);var e=a(".l-tab-content-item[tabid="+b+"] iframe",f.tab.content);h.show();e.attr("src",d).unbind("load.tab").bind("load.tab",function(){h.hide()})},isTabItemExist:function(b){var c=this,d=this.options;return a("li[tabid="+b+"] a",c.tab.links.ul).length>0},addTabItem:function(s){var h=this,d=this.options;if(h.trigger("beforeAddTabItem",[s])==false){return false}var b=s.tabid;if(b==undefined){b=h.getNewTabid()}var c=s.url,j=s.content,r=s.text,k=s.showClose,q=s.height;if(h.isTabItemExist(b)){h.selectTabItem(b);return}var e=a("<li><a></a><div class='l-tab-links-item-left'></div><div class='l-tab-links-item-right'></div><div class='l-tab-links-item-close'></div></li>");var n=a("<div class='l-tab-content-item'><div class='l-tab-loading' style='display:block;'></div><iframe frameborder='0'></iframe></div>");var o=a("div:first",n);var f=a("iframe:first",n);if(h.makeFullHeight){var m=h.tab.height()-h.tab.links.height();n.height(m)}e.attr("tabid",b);n.attr("tabid",b);if(c){f[0].tab=h;if(s.data){f[0].openerData=s.data}f.attr("name",b).attr("id",b).attr("src",c).bind("load.tab",function(){o.hide();if(s.callback){s.callback()}})}else{f.remove();o.remove()}if(j){n.html(j);if(s.callback){s.callback()}}else{if(s.target){n.append(s.target);if(s.callback){s.callback()}}}if(k==undefined){k=true}if(k==false){a(".l-tab-links-item-close",e).remove()}if(r==undefined){r=b}if(q){n.height(q)}a("a",e).text(r);if(a(".l-tab-itemswitch",h.tab.links.ul).length){e.insertBefore(a(".l-tab-itemswitch",h.tab.links.ul))}else{h.tab.links.ul.append(e)}h.tab.content.append(n);h.selectTabItem(b);if(h.setTabButton()){h.moveToTabItem(b)}h._addTabItemEvent(e);if(d.dragToMove&&a.fn.ligerDrag){h.drags=h.drags||[];e.each(function(){h.drags.push(h._applyDrag(this))})}h.toggleSwitch();h.trigger("afterAddTabItem",[s])},_addTabItemEvent:function(b){var c=this,d=this.options;b.click(function(){var e=a(this).attr("tabid");c.selectTabItem(e)});c.tab.menu&&c._addTabItemContextMenuEven(b);a(".l-tab-links-item-close",b).hover(function(){a(this).addClass("l-tab-links-item-close-over")},function(){a(this).removeClass("l-tab-links-item-close-over")}).click(function(){var e=a(this).parent().attr("tabid");c.removeTabItem(e)})},removeTabItem:function(c){var h=this,k=this.options;if(h.trigger("beforeRemoveTabItem",[c])==false){return false}var f=a("li[tabid="+c+"]",h.tab.links.ul).hasClass("l-selected");if(f){a(".l-tab-content-item[tabid="+c+"]",h.tab.content).prev().removeClass("l-tab-hide");a("li[tabid="+c+"]",h.tab.links.ul).prev().addClass("l-selected").siblings().removeClass("l-selected")}var b=a(".l-tab-content-item[tabid="+c+"]",h.tab.content);var d=a("iframe",b);if(d.length){var m=d[0];m.src="about:blank";try{m.contentWindow.document.write("")}catch(j){}a.browser.msie&&CollectGarbage();d.remove()}b.remove();a("li[tabid="+c+"]",h.tab.links.ul).remove();h.setTabButton();h.trigger("afterRemoveTabItem",[c])},hideTabItem:function(b){var d=this,e=this.options;var c=a("li[tabid="+b+"]",d.tab.links.ul).hasClass("l-selected");if(c){a(".l-tab-content-item[tabid="+b+"]",d.tab.content).prev().removeClass("l-tab-hide");a("li[tabid="+b+"]",d.tab.links.ul).prev().addClass("l-selected").siblings().removeClass("l-selected")}a("li[tabid="+b+"]",d.tab.links.ul).hide();a(".l-tab-content-item[tabid="+b+"]",d.tab.content).hide()},showTabItem:function(b){var c=this,d=this.options;a("li[tabid="+b+"]",c.tab.links.ul).show()},addHeight:function(e){var c=this,d=this.options;var b=c.tab.height()+e;c.setHeight(b)},setHeight:function(b){var c=this,d=this.options;c.tab.height(b);c.setContentHeight()},setContentHeight:function(){var c=this,d=this.options;var b=c.tab.height()-c.tab.links.height();c.tab.content.height(b);a("> .l-tab-content-item",c.tab.content).height(b)},getNewTabid:function(){var b=this,c=this.options;b.getnewidcount=b.getnewidcount||0;return"tabitem"+(++b.getnewidcount)},getTabidList:function(c,b){var e=this,f=this.options;var d=[];a("> li",e.tab.links.ul).each(function(){if(a(this).attr("tabid")&&a(this).attr("tabid")!=c&&(!b||a(".l-tab-links-item-close",this).length>0)){d.push(a(this).attr("tabid"))}});return d},removeOther:function(b,f){var d=this,e=this.options;var c=d.getTabidList(b,true);a(c).each(function(){d.removeTabItem(this)})},reload:function(b){var f=this,j=this.options;var d=a(".l-tab-content-item[tabid="+b+"]");var h=a(".l-tab-loading:first",d);var e=a("iframe:first",d);var c=a(e).attr("src");h.show();e.attr("src",c).unbind("load.tab").bind("load.tab",function(){h.hide()})},removeAll:function(e){var c=this,d=this.options;var b=c.getTabidList(null,true);a(b).each(function(){c.removeTabItem(this)})},onResize:function(){var b=this,c=this.options;if(!c.height||typeof(c.height)!="string"||c.height.indexOf("%")==-1){return false}if(b.tab.parent()[0].tagName.toLowerCase()=="body"){var d=a(window).height();d-=parseInt(b.tab.parent().css("paddingTop"));d-=parseInt(b.tab.parent().css("paddingBottom"));b.height=c.heightDiff+d*parseFloat(c.height)*0.01}else{b.height=c.heightDiff+(b.tab.parent().height()*parseFloat(c.height)*0.01)}b.tab.height(b.height);b.setContentHeight()},_menuItemClick:function(c){var b=this,d=this.options;if(!c.id||!b.actionTabid){return}switch(c.id){case"close":if(b.trigger("close")==false){return}b.removeTabItem(b.actionTabid);b.actionTabid=null;break;case"closeother":if(b.trigger("closeother")==false){return}b.removeOther(b.actionTabid);break;case"closeall":if(b.trigger("closeall")==false){return}b.removeAll();b.actionTabid=null;break;case"reload":if(b.trigger("reload",[{tabid:b.actionTabid}])==false){return}b.selectTabItem(b.actionTabid);b.reload(b.actionTabid);break}},_addTabItemContextMenuEven:function(b){var c=this,d=this.options;b.bind("contextmenu",function(f){if(!c.tab.menu){return}c.actionTabid=b.attr("tabid");c.tab.menu.show({top:f.pageY,left:f.pageX});if(a(".l-tab-links-item-close",this).length==0){c.tab.menu.setDisabled("close")}else{c.tab.menu.setEnabled("close")}return false})}})})(jQuery);(function(a){a.fn.ligerTextBox=function(){return a.ligerui.run.call(this,"ligerTextBox",arguments)};a.fn.ligerGetTextBoxManager=function(){return a.ligerui.run.call(this,"ligerGetTextBoxManager",arguments)};a.ligerDefaults.TextBox={onChangeValue:null,onMouseOver:null,onMouseOut:null,onBlur:null,onFocus:null,onEnterDown:null,width:null,disabled:false,initSelect:false,value:null,precision:2,sign:true,nullText:null,digits:false,number:false,currency:false,readonly:false};a.ligerui.controls.TextBox=function(d,c){a.ligerui.controls.TextBox.base.constructor.call(this,d,c)};a.ligerui.controls.TextBox.ligerExtend(a.ligerui.controls.Input,{__getType:function(){return"TextBox"},__idPrev:function(){return"TextBox"},_init:function(){a.ligerui.controls.TextBox.base._init.call(this);var c=this,d=this.options;if(!d.width){d.width=a(c.element).width()}if(a(this.element).attr("readonly")){d.readonly=true}else{if(d.readonly){a(this.element).attr("readonly",true)}}},_render:function(){a.ligerui.controls.TextBox.base._render.call(this);var c=this,d=this.options;c.inputText=a(this.element);c.wrapper=c.inputText.wrap('<div class="l-text"></div>').parent();c.wrapper.append('<div class="l-text-l"></div><div class="l-text-r"></div>');if(!c.inputText.hasClass("l-text-field")){c.inputText.addClass("l-text-field")}this._setEvent();if(d.digits||d.number||d.currency){c.inputText.addClass("l-text-field-number")}c.set(d);c.formatValue()},destroy:function(){var c=this;if(c.wrapper){c.wrapper.remove()}c.options=null;liger.remove(this)},_getValue:function(){var e=this,f=this.options;if(e.inputText.hasClass("l-text-field-null")){return""}if(f.digits||f.number||f.currency){return e.parseNumber()}var c=e.inputText.val(),d=e.typeCase;if(d){if(d=="uppercase"){c=c.toUpperCase()}else{if(d=="lowercase"){c=c.toLowerCase()}}}return c},_setNullText:function(){this.checkNotNull()},formatValue:function(){var d=this,f=this.options;var c=d.inputText.val()||"";if(c==""){return""}d.inputText.val(c=a.trim(c));if(f.currency){d.inputText.val(b(c,f.precision,f.sign))}else{if(f.number&&f.precision&&c){var e=parseFloat(d.inputText.val()).toFixed(f.precision);d.inputText.val(f.sign?e:e.replace("-",""))}}},checkNotNull:function(){var c=this,d=this.options;if(d.nullText&&d.nullText!="null"&&!d.disabled&&!d.readonly){if(!c.inputText.val()){c.inputText.addClass("l-text-field-null").val(d.nullText);return}}c.inputText.removeClass("l-text-field-null")},_setEvent:function(){var d=this,e=this.options;function f(){var h=d.inputText.val();if(!h||h=="-"){return true}var g=(e.digits?/^-?\d+$/:/^(-?\d+)(\.)?(\d+)?$/).test(h);return g}function c(){if(!f()){d.inputText.val(d.parseNumber())}}if(e.digits||e.number||e.currency){d.inputText.keyup(c).bind("paste",c)}d.inputText.bind("blur.textBox",function(){d.trigger("blur");d.checkNotNull();d.formatValue();d.wrapper.removeClass("l-text-focus")}).bind("focus.textBox",function(){if(e.readonly){return}d.trigger("focus");if(e.nullText){if(a(this).hasClass("l-text-field-null")){a(this).removeClass("l-text-field-null").val("")}}d.wrapper.addClass("l-text-focus");if(e.digits||e.number||e.currency){a(this).val(d.parseNumber());if(e.initSelect){setTimeout(function(){d.inputText.select()},150)}}}).keydown(function(g){if(g.keyCode==13){d.trigger("enterdown");if(d.options&&d.options.host_form){d.options.host_form.trigger("enterdown")}}}).change(function(){d.trigger("changeValue",[this.value])});d.wrapper.hover(function(){d.trigger("mouseOver");d.wrapper.addClass("l-text-over")},function(){d.trigger("mouseOut");d.wrapper.removeClass("l-text-over")})},parseNumber:function(e){var d=this,h=this.options;var f=h.digits?true:false;e=e||d.inputText.val();if(e==null||e==""){return""}if(!(h.digits||h.number||h.currency)){return e}if(typeof(e)!="string"){e=(e||"").toString()}var c=/^\-/.test(e);if(f){if(e=="0"){return e}e=e.replace(/\D+|^[0]+/g,"")}else{e=e.replace(/[^0-9.]/g,"");if(/^[0]+[1-9]+/.test(e)){e=e.replace(/^[0]+/,"")}}if(!f&&h.precision){e=parseFloat(e).toFixed(h.precision);if(e=="NaN"){return"0"}}if(c&&h.sign){e="-"+e}return e},_setDisabled:function(d){var c=this,e=this.options;if(d){this.inputText.attr("readonly","readonly");this.wrapper.addClass("l-text-disabled")}else{if(!e.readonly){this.inputText.removeAttr("readonly");this.wrapper.removeClass("l-text-disabled")}}},_setWidth:function(c){if(c>20){this.wrapper.css({width:c});this.inputText.css({width:c-4})}},_setHeight:function(c){if(c>10){this.wrapper.height(c);this.inputText.height(c-2)}},_setValue:function(c){if(c!=null){this.inputText.val(c)}this.checkNotNull()},_setLabel:function(e){var d=this,f=this.options;if(!d.labelwrapper){d.labelwrapper=d.wrapper.wrap('<div class="l-labeltext"></div>').parent();var c=a('<div class="l-text-label" style="float:left;">'+e+":&nbsp</div>");d.labelwrapper.prepend(c);d.wrapper.css("float","left");if(!f.labelWidth){f.labelWidth=c.width()}else{d._setLabelWidth(f.labelWidth)}c.height(d.wrapper.height());if(f.labelAlign){d._setLabelAlign(f.labelAlign)}d.labelwrapper.append('<br style="clear:both;" />');d.labelwrapper.width(f.labelWidth+f.width+2)}else{d.labelwrapper.find(".l-text-label").html(e+":&nbsp")}},_setLabelWidth:function(d){var c=this,e=this.options;if(!c.labelwrapper){return}c.labelwrapper.find(".l-text-label").width(d)},_setLabelAlign:function(d){var c=this,e=this.options;if(!c.labelwrapper){return}c.labelwrapper.find(".l-text-label").css("text-align",d)},updateStyle:function(){var c=this,d=this.options;if(c.inputText.attr("readonly")){c.wrapper.addClass("l-text-readonly");d.disabled=true}else{c.wrapper.removeClass("l-text-readonly");d.disabled=false}if(c.inputText.attr("disabled")){c.wrapper.addClass("l-text-disabled");d.disabled=true}else{c.wrapper.removeClass("l-text-disabled");d.disabled=false}if(c.inputText.hasClass("l-text-field-null")&&c.inputText.val()!=d.nullText){c.inputText.removeClass("l-text-field-null")}c.formatValue()},setValue:function(c,d){this._setValue(c);if(!d){this.trigger("changeValue",[c])}},_setTypeCase:function(c){this.typeCase=c;this.inputText.css({"text-transform":c||""})}});function b(g,e,f){var c,d;if(!g){g=0}g=g.toString().replace(/\$|\,/g,"").replace(/[a-zA-Z]+/g,"");if(g.indexOf(".")>-1){g=g.replace(/[0]+$/g,"")}if(isNaN(g)){g=0}d=!f?true:(g==(g=Math.abs(g)));if(e==null){g=g.toString();c=g.indexOf(".")!=-1?g.substr(g.indexOf(".")+1):"";if(c){g=Math.floor(g*1);g=g.toString()}}else{e=parseInt(e);var j=Math.pow(10,e);g=Math.floor(g*j+0.50000000001);c=g%100;g=Math.floor(g/j).toString();while(c.toString().length<e){c="0"+c}}for(var h=0;h<Math.floor((g.length-(1+h))/3);h++){g=g.substring(0,g.length-(4*h+3))+","+g.substring(g.length-(4*h+3))}var k=""+(((d)?"":"-")+""+g);if(c){k+=("."+c)}return k}})(jQuery);(function(a){a.fn.ligerTextArea=function(){return a.ligerui.run.call(this,"ligerTextArea",arguments)};a.ligerDefaults.TextArea={onChangeValue:null,onMouseOver:null,onMouseOut:null,onBlur:null,onFocus:null,onEnterDown:null,width:null,height:100,disabled:false,value:null,nullText:null,readonly:false};a.ligerui.controls.TextArea=function(c,b){a.ligerui.controls.TextArea.base.constructor.call(this,c,b)};a.ligerui.controls.TextArea.ligerExtend(a.ligerui.controls.Input,{__getType:function(){return"TextArea"},__idPrev:function(){return"TextArea"},_init:function(){a.ligerui.controls.TextArea.base._init.call(this);var b=this,c=this.options;if(!c.width){c.width=a(b.element).width()}if(a(this.element).attr("readonly")){c.readonly=true}else{if(c.readonly){a(this.element).attr("readonly",true)}}},_render:function(){a.ligerui.controls.TextArea.base._render.call(this);var b=this,c=this.options;b.inputText=a(this.element);b.wrapper=b.inputText.wrap('<div class="l-text"></div>').parent();b.wrapper.append('<div class="l-text-l"></div><div class="l-text-r"></div>');if(!b.inputText.hasClass("l-text-field")){b.inputText.addClass("l-text-field")}this._setEvent();b.set(c)},destroy:function(){var b=this;if(b.wrapper){b.wrapper.remove()}b.options=null;liger.remove(this)},_getValue:function(){var d=this,e=this.options;if(d.inputText.hasClass("l-text-field-null")){return""}var b=d.inputText.val(),c=d.typeCase;if(c){if(c=="uppercase"){b=b.toUpperCase()}else{if(c=="lowercase"){b=b.toLowerCase()}}}return b},_setNullText:function(){this.checkNotNull()},checkNotNull:function(){var b=this,c=this.options;if(c.nullText&&c.nullText!="null"&&!c.disabled&&!c.readonly){if(!b.inputText.val()){b.inputText.addClass("l-text-field-null").val(c.nullText);return}}b.inputText.removeClass("l-text-field-null")},_setEvent:function(){var b=this,c=this.options;b.inputText.bind("blur.textArea",function(){b.trigger("blur");b.checkNotNull();b.wrapper.removeClass("l-text-focus")}).bind("focus.textArea",function(){if(c.readonly){return}b.trigger("focus");if(c.nullText){if(a(this).hasClass("l-text-field-null")){a(this).removeClass("l-text-field-null").val("")}}b.wrapper.addClass("l-text-focus");if(c.digits||c.number||c.currency){a(this).val(b.parseNumber());if(c.initSelect){setTimeout(function(){b.inputText.select()},150)}}}).keydown(function(d){if(d.keyCode==13){b.trigger("enterdown");if(b.options&&b.options.host_form){b.options.host_form.trigger("enterdown")}}}).change(function(){b.trigger("changeValue",[this.value])});b.wrapper.hover(function(){b.trigger("mouseOver");b.wrapper.addClass("l-text-over")},function(){b.trigger("mouseOut");b.wrapper.removeClass("l-text-over")})},_setDisabled:function(c){var b=this,d=this.options;if(c){this.inputText[0].readOnly=true;this.wrapper.addClass("l-text-disabled")}else{if(!d.readonly){this.inputText.removeAttr("readonly");this.wrapper.removeClass("l-text-disabled")}}},_setWidth:function(b){if(b>20){this.wrapper.css({width:b});this.inputText.css({width:b-4})}},_setHeight:function(b){if(b>10){this.wrapper.height(b);this.inputText.height(b-2)}},_setValue:function(b){if(b!=null){this.inputText.val(b)}this.checkNotNull()},_setLabel:function(d){var c=this,e=this.options;if(!c.labelwrapper){c.labelwrapper=c.wrapper.wrap('<div class="l-labeltext"></div>').parent();var b=a('<div class="l-text-label" style="float:left;">'+d+":&nbsp</div>");c.labelwrapper.prepend(b);c.wrapper.css("float","left");if(!e.labelWidth){e.labelWidth=b.width()}else{c._setLabelWidth(e.labelWidth)}b.height(c.wrapper.height());if(e.labelAlign){c._setLabelAlign(e.labelAlign)}c.labelwrapper.append('<br style="clear:both;" />');c.labelwrapper.width(e.labelWidth+e.width+2)}else{c.labelwrapper.find(".l-text-label").html(d+":&nbsp")}},_setLabelWidth:function(c){var b=this,d=this.options;if(!b.labelwrapper){return}b.labelwrapper.find(".l-text-label").width(c)},_setLabelAlign:function(c){var b=this,d=this.options;if(!b.labelwrapper){return}b.labelwrapper.find(".l-text-label").css("text-align",c)},updateStyle:function(){var b=this,c=this.options;if(b.inputText.attr("readonly")){b.wrapper.addClass("l-text-readonly");c.disabled=true}else{b.wrapper.removeClass("l-text-readonly");c.disabled=false}if(b.inputText.attr("disabled")){b.wrapper.addClass("l-text-disabled");c.disabled=true}else{b.wrapper.removeClass("l-text-disabled");c.disabled=false}if(b.inputText.hasClass("l-text-field-null")&&b.inputText.val()!=c.nullText){b.inputText.removeClass("l-text-field-null")}b.formatValue()},setValue:function(b,c){this._setValue(b);if(!c){this.trigger("changeValue",[b])}},_setTypeCase:function(b){this.typeCase=b;this.inputText.css({"text-transform":b||""})}})})(jQuery);(function(a){a.ligerTip=function(b){return a.ligerui.run.call(null,"ligerTip",arguments)};a.fn.ligerTip=function(b){this.each(function(){var c=a.extend({},a.ligerDefaults.ElementTip,b||{});c.target=c.target||this;if(c.auto||b==undefined){if(!c.content){c.content=this.title;if(c.removeTitle){a(this).removeAttr("title")}}c.content=c.content||this.title;a(this).bind("mouseover.tip",function(){c.x=a(this).offset().left+a(this).width()+(c.distanceX||0);c.y=a(this).offset().top+(c.distanceY||0);var d=a.ligerui.managers[this.ligeruitipid];d.tip.css({left:c.x,top:c.y}).show()}).bind("mouseout.tip",function(){var d=a.ligerui.managers[this.ligeruitipid];d.tip.hide()})}else{if(c.target.ligeruitipid){return}c.x=a(this).offset().left+a(this).width()+(c.distanceX||0);c.y=a(this).offset().top+(c.distanceY||0);c.x=c.x||0;c.y=c.y||0}a.ligerTip(c)});return a.ligerui.get(this,"ligeruitipid")};a.fn.ligerHideTip=function(b){return this.each(function(){var f=b||{};if(f.isLabel==undefined){f.isLabel=this.tagName.toLowerCase()=="label"&&a(this).attr("for")!=null}var e=this;if(f.isLabel){var c=a("#"+a(this).attr("for"));if(c.length==0){return}e=c[0]}var d=a.ligerui.managers[e.ligeruitipid];if(d){d.remove()}}).unbind("mouseover.tip").unbind("mouseout.tip")};a.fn.ligerGetTipManager=function(){return a.ligerui.get(this)};a.ligerDefaults=a.ligerDefaults||{};a.ligerDefaults.HideTip={};a.ligerDefaults.Tip={content:null,callback:null,width:150,height:null,x:0,y:0,appendIdTo:null,target:null,auto:null,removeTitle:true};a.ligerDefaults.ElementTip={distanceX:1,distanceY:-3,auto:null,removeTitle:true};a.ligerMethos.Tip={};a.ligerui.controls.Tip=function(b){a.ligerui.controls.Tip.base.constructor.call(this,null,b)};a.ligerui.controls.Tip.ligerExtend(a.ligerui.core.UIComponent,{__getType:function(){return"Tip"},__idPrev:function(){return"Tip"},_extendMethods:function(){return a.ligerMethos.Tip},_render:function(){var b=this,d=this.options;var c=a('<div class="l-verify-tip"><div class="l-verify-tip-corner"></div><div class="l-verify-tip-content"></div></div>');b.tip=c;b.tip.attr("id",b.id);if(d.content){a("> .l-verify-tip-content:first",c).html(d.content);c.appendTo("body")}else{return}if(d.x||d.y){c.css({left:d.x,top:d.y})}else{c.hide()}d.width&&a("> .l-verify-tip-content:first",c).width(d.width-8);d.height&&a("> .l-verify-tip-content:first",c).width(d.height);if(d.appendIdTo){d.appendIdTo.attr("ligerTipId",b.id)}if(d.target){a(d.target).attr("ligerTipId",b.id);d.target.ligeruitipid=b.id}d.callback&&d.callback(c);b.set(d)},_setContent:function(b){a("> .l-verify-tip-content:first",this.tip).html(b)},remove:function(){if(this.options.appendIdTo){this.options.appendIdTo.removeAttr("ligerTipId")}if(this.options.target){a(this.options.target).removeAttr("ligerTipId");this.options.target.ligeruitipid=null}this.tip.remove()}})})(jQuery);(function(a){a.fn.ligerToolBar=function(b){return a.ligerui.run.call(this,"ligerToolBar",arguments)};a.fn.ligerGetToolBarManager=function(){return a.ligerui.run.call(this,"ligerGetToolBarManager",arguments)};a.ligerDefaults.ToolBar={};a.ligerMethos.ToolBar={};a.ligerui.controls.ToolBar=function(c,b){a.ligerui.controls.ToolBar.base.constructor.call(this,c,b)};a.ligerui.controls.ToolBar.ligerExtend(a.ligerui.core.UIComponent,{__getType:function(){return"ToolBar"},__idPrev:function(){return"ToolBar"},_extendMethods:function(){return a.ligerMethos.ToolBar},_render:function(){var b=this,c=this.options;b.toolbarItemCount=0;b.toolBar=a(this.element);b.toolBar.addClass("l-toolbar");b.set(c)},_setItems:function(b){var c=this;c.toolBar.html("");a(b).each(function(d,e){c.addItem(e)})},removeItem:function(c){var b=this,d=this.options;a("> .l-toolbar-item[toolbarid="+c+"]",b.toolBar).remove()},setEnabled:function(c){var b=this,d=this.options;a("> .l-toolbar-item[toolbarid="+c+"]",b.toolBar).removeClass("l-toolbar-item-disable")},setDisabled:function(c){var b=this,d=this.options;a("> .l-toolbar-item[toolbarid="+c+"]",b.toolBar).addClass("l-toolbar-item-disable")},isEnable:function(c){var b=this,d=this.options;return !a("> .l-toolbar-item[toolbarid="+c+"]",b.toolBar).hasClass("l-toolbar-item-disable")},addItem:function(d){var c=this,e=this.options;if(d.line||d.type=="line"){c.toolBar.append('<div class="l-bar-separator"></div>');return}if(d.type=="text"){c.toolBar.append('<div class="l-toolbar-item l-toolbar-text"><span>'+d.text||"</span></div>");return}var b=a('<div class="l-toolbar-item l-panel-btn" tabIndex="0"><span></span><div class="l-panel-btn-l"></div><div class="l-panel-btn-r"></div></div>');c.toolBar.append(b);if(!d.id){d.id="item-"+(++c.toolbarItemCount)}b.attr("toolbarid",d.id);if(d.img){b.append("<img src='"+d.img+"' />");b.addClass("l-toolbar-item-hasicon")}else{if(d.icon){b.append("<div class='l-icon l-icon-"+d.icon+"'></div>");b.addClass("l-toolbar-item-hasicon")}else{if(d.color){b.append("<div class='l-toolbar-item-color' style='background:"+d.color+"'></div>");b.addClass("l-toolbar-item-hasicon")}}}b.keyup(function(f){if(f.which==13||f.which==32){if(!d.click||a(this).hasClass("l-toolbar-item-disable")){return}d.click(d)}}).focus(function(){a(this).addClass("l-button-focus")}).blur(function(){a(this).removeClass("l-button-focus")});d.text&&a("span:first",b).html(d.text);d.disable&&b.addClass("l-toolbar-item-disable");d.click&&b.click(function(){if(a(this).hasClass("l-toolbar-item-disable")){return}d.click(d)});if(d.menu){d.menu=a.ligerMenu(d.menu);b.hover(function(){if(a(this).hasClass("l-toolbar-item-disable")){return}c.actionMenu&&c.actionMenu.hide();var g=a(this).offset().left;var f=a(this).offset().top+a(this).height();d.menu.show({top:f,left:g},d.menu.options.menu);c.actionMenu=d.menu;a(this).addClass("l-panel-btn-over")},function(){if(a(this).hasClass("l-toolbar-item-disable")){return}a(this).removeClass("l-panel-btn-over")})}else{b.hover(function(){if(a(this).hasClass("l-toolbar-item-disable")){return}a(this).addClass("l-panel-btn-over")},function(){if(a(this).hasClass("l-toolbar-item-disable")){return}a(this).removeClass("l-panel-btn-over")})}}});a.ligerui.controls.ToolBar.prototype.setEnable=a.ligerui.controls.ToolBar.prototype.setEnabled;a.ligerui.controls.ToolBar.prototype.setDisable=a.ligerui.controls.ToolBar.prototype.setDisabled})(jQuery);(function(b){b.fn.ligerTree=function(c){return b.ligerui.run.call(this,"ligerTree",arguments)};b.fn.ligerGetTreeManager=function(){return b.ligerui.run.call(this,"ligerGetTreeManager",arguments)};b.ligerDefaults.Tree={url:null,urlParms:null,data:null,checkbox:true,autoCheckboxEven:true,enabledCompleteCheckbox:true,parentIcon:"folder",childIcon:"leaf",textFieldName:"text",attribute:["id","url"],treeLine:true,nodeWidth:90,statusName:"__status",isLeaf:null,single:false,needCancel:true,onBeforeExpand:function(){},onContextmenu:function(){},onExpand:function(){},onBeforeCollapse:function(){},onCollapse:function(){},onBeforeSelect:function(){},onSelect:function(){},onBeforeCancelSelect:function(){},onCancelselect:function(){},onCheck:function(){},onSuccess:function(){},onError:function(){},onClick:function(){},idFieldName:"id",parentIDFieldName:null,topParentIDValue:0,onBeforeAppend:function(){},onAppend:function(){},onAfterAppend:function(){},slide:true,iconFieldName:"icon",iconType:"image",nodeDraggable:false,nodeDraggingRender:null,btnClickToToggleOnly:true,ajaxType:"post",ajaxContentType:null,render:null,selectable:null,isExpand:null,delay:null,idField:null,parentIDField:null};b.ligerui.controls.Tree=function(d,c){b.ligerui.controls.Tree.base.constructor.call(this,d,c)};b.ligerui.controls.Tree.ligerExtend(b.ligerui.core.UIComponent,{_init:function(){b.ligerui.controls.Tree.base._init.call(this);var c=this,d=this.options;if(d.single){d.autoCheckboxEven=false}},_render:function(){var c=this,d=this.options;c.set(d,true);c.tree=b(c.element);c.tree.addClass("l-tree");c.toggleNodeCallbacks=[];c.sysAttribute=["isexpand","ischecked","href","style","delay"];c.loading=b("<div class='l-tree-loading'></div>");c.tree.after(c.loading);c.data=[];c.maxOutlineLevel=1;c.treedataindex=0;c._applyTree();c._setTreeEven();c.set(d,false)},_setTreeLine:function(c){if(c){this.tree.removeClass("l-tree-noline")}else{this.tree.addClass("l-tree-noline")}},_setParms:function(){var c=this,d=this.options;if(b.isFunction(d.parms)){d.parms=d.parms()}},reload:function(e){var c=this,d=this.options;c.clear();c.loadData(null,d.url,null,{success:e})},reloadNode:function(d,e,h){var c=this,f=this.options;c.clear(d);if(typeof(e)=="string"){c.loadData(d,e,null,{success:h})}else{if(!e){return}if(f.idField&&f.parentIDField){e=c.arrayToTree(e,f.idField,f.parentIDField)}c.append(d,e)}},_setUrl:function(c){var d=this,e=this.options;if(c){d.clear();d.loadData(null,c)}},_setData:function(c){if(c){this.clear();this.append(null,c)}},setData:function(c){this.set("data",c)},getData:function(){return this.data},hasChildren:function(c){if(this.options.isLeaf){return !this.options.isLeaf(c)}return c.children?true:false},getParent:function(h,f){var e=this;h=e.getNodeDom(h);var d=e.getParentTreeItem(h,f);if(!d){return null}var c=b(d).attr("treedataindex");return e._getDataNodeByTreeDataIndex(c)},getParentTreeItem:function(k,j){var e=this;k=e.getNodeDom(k);var h=b(k);if(h.parent().hasClass("l-tree")){return null}if(j==undefined){if(h.parent().parent("li").length==0){return null}return h.parent().parent("li")[0]}var f=parseInt(h.attr("outlinelevel"));var d=h;for(var c=f-1;c>=j;c--){d=d.parent().parent("li")}return d[0]},getChecked:function(){var d=this,e=this.options;if(!this.options.checkbox){return null}var c=[];b(".l-checkbox-checked",d.tree).parent().parent("li").each(function(){var f=parseInt(b(this).attr("treedataindex"));c.push({target:this,data:d._getDataNodeByTreeDataIndex(d.data,f)})});return c},getCheckedData:function(){var d=this,e=this.options;if(!this.options.checkbox){return null}var c=[];b(".l-checkbox-checked",d.tree).parent().parent("li").each(function(){var f=parseInt(b(this).attr("treedataindex"));c.push(d._getDataNodeByTreeDataIndex(d.data,f))});return c},refreshTree:function(){var c=this,d=this.options;b.each(this.getChecked(),function(f,e){c._setParentCheckboxStatus(b(e.target))})},getSelected:function(){var d=this,f=this.options;var c={};c.target=b(".l-selected",d.tree).parent("li")[0];if(c.target){var e=parseInt(b(c.target).attr("treedataindex"));c.data=d._getDataNodeByTreeDataIndex(d.data,e);return c}return null},upgrade:function(d){var c=this,e=this.options;b(".l-note",d).each(function(){b(this).removeClass("l-note").addClass("l-expandable-open")});b(".l-note-last",d).each(function(){b(this).removeClass("l-note-last").addClass("l-expandable-open")});b("."+c._getChildNodeClassName(),d).each(function(){b(this).removeClass(c._getChildNodeClassName()).addClass(c._getParentNodeClassName(true))})},demotion:function(d){var c=this,e=this.options;if(!d&&d[0].tagName.toLowerCase()!="li"){return}var f=b(d).hasClass("l-last");b(".l-expandable-open",d).each(function(){b(this).removeClass("l-expandable-open").addClass(f?"l-note-last":"l-note")});b(".l-expandable-close",d).each(function(){b(this).removeClass("l-expandable-close").addClass(f?"l-note-last":"l-note")});b("."+c._getParentNodeClassName(true),d).each(function(){b(this).removeClass(c._getParentNodeClassName(true)).addClass(c._getChildNodeClassName())})},collapseAll:function(){var c=this,d=this.options;b(".l-expandable-open",c.tree).click()},expandAll:function(){var c=this,d=this.options;b(".l-expandable-close",c.tree).click()},arrayToTree:function(m,c,q){var r=this,d=this.options;var e="children";if(!m||!m.length){return[]}var u=[];var h={};var s=m.length;for(var k=0;k<s;k++){var f=m[k];var v=n(f[c]);h[v]=f}for(var k=0;k<s;k++){var j=m[k];var v=n(j[q]);var t=h[v];if(!t){u.push(j);continue}t[e]=t[e]||[];t[e].push(j)}return u;function n(g){if(typeof(g)=="string"){g=g.replace(/[.]/g,"").toLowerCase()}return g}},loadData:function(h,c,f,m){var j=this,d=this.options;m=b.extend({showLoading:function(){j.loading.show()},success:function(){},error:function(){},hideLoading:function(){j.loading.hide()}},m||{});var o=d.ajaxType;f=b.extend((b.isFunction(d.parms)?d.parms():d.parms),f);if(d.ajaxContentType=="application/json"&&typeof(f)!="string"){f=liger.toJSON(f)}var k=b.isFunction(d.urlParms)?d.urlParms.call(j):d.urlParms;if(k){for(name in k){c+=c.indexOf("?")==-1?"?":"&";c+=name+"="+k[name]}}var n={type:o,url:c,data:f,dataType:"json",beforeSend:function(){m.showLoading()},success:function(e){if(!e){return}if(d.idField&&d.parentIDField){e=j.arrayToTree(e,d.idField,d.parentIDField)}m.hideLoading();j.append(h,e);j.trigger("success",[e]);m.success(e)},error:function(g,s,r){try{q.hideLoading();j.trigger("error",[g,s,r]);q.error(g,s,r)}catch(q){}}};if(d.ajaxContentType){n.contentType=d.ajaxContentType}b.ajax(n)},clear:function(e){var d=this,h=this.options;if(!e){d.toggleNodeCallbacks=[];d.data=null;d.data=[];d.nodes=null;d.tree.html("")}else{var f=d.getNodeDom(e);var c=d._getDataNodeByTreeDataIndex(d.data,b(f).attr("treedataindex"));b(f).find("ul.l-children").remove();if(c){c.children=[]}}},getNodeDom:function(d){var c=this,e=this.options;if(d==null){return d}if(typeof(d)=="string"||typeof(d)=="number"){return b("li[treedataindex="+d+"]",c.tree).get(0)}else{if(typeof(d)=="object"&&"treedataindex" in d){return c.getNodeDom(d.treedataindex)}else{if(d.target&&d.data){return d.target}}}return d},hide:function(d){var c=this,e=this.options;d=c.getNodeDom(d);if(d){b(d).hide()}},show:function(d){var c=this,e=this.options;d=c.getNodeDom(d);if(d){b(d).show()}},remove:function(h){var d=this,j=this.options;h=d.getNodeDom(h);var f=parseInt(b(h).attr("treedataindex"));var e=d._getDataNodeByTreeDataIndex(d.data,f);if(e){d._setTreeDataStatus([e],"delete")}var c=d.getParentTreeItem(h);if(j.checkbox){d._setParentCheckboxStatus(b(h))}b(h).remove();d._updateStyle(c?b("ul:first",c):d.tree)},_updateStyle:function(c){var d=this,f=this.options;var h=b(" > li",c);var e=h.length;if(!e){return}h.each(function(g,j){if(g==0&&!b(this).hasClass("l-first")){b(this).addClass("l-first")}if(g==e-1&&!b(this).hasClass("l-last")){b(this).addClass("l-last")}if(g==0&&g==e-1){b(this).addClass("l-onlychild")}b("> div .l-note,> div .l-note-last",this).removeClass("l-note l-note-last").addClass(g==e-1?"l-note-last":"l-note");d._setTreeItem(this,{isLast:g==e-1})})},update:function(j,d){var e=this,h=this.options;j=e.getNodeDom(j);var f=parseInt(b(j).attr("treedataindex"));nodedata=e._getDataNodeByTreeDataIndex(e.data,f);for(var c in d){nodedata[c]=d[c];if(c==h.textFieldName){b("> .l-body > span",j).text(d[c])}}},append:function(k,q,n,s){var m=this,d=this.options;k=m.getNodeDom(k);if(m.trigger("beforeAppend",[k,q])==false){return false}if(!q||!q.length){return false}if(d.idFieldName&&d.parentIDFieldName){q=m.arrayToTree(q,d.idFieldName,d.parentIDFieldName)}m._addTreeDataIndexToData(q);m._setTreeDataStatus(q,"add");if(n!=null){n=m.getNodeDom(n)}m.trigger("append",[k,q]);m._appendData(k,q);if(k==null){var e=m._getTreeHTMLByData(q,1,[],true);e[e.length-1]=e[0]="";if(n!=null){b(n)[s?"after":"before"](e.join(""));m._updateStyle(k?b("ul:first",k):m.tree)}else{if(b("> li:last",m.tree).length>0){m._setTreeItem(b("> li:last",m.tree)[0],{isLast:false})}m.tree.append(e.join(""))}b(".l-body",m.tree).hover(function(){b(this).addClass("l-over")},function(){b(this).removeClass("l-over")});m._upadteTreeWidth();m.trigger("afterAppend",[k,q]);return}var c=b(k);var r=parseInt(c.attr("outlinelevel"));var j=b("> ul",c).length>0;if(!j){c.append("<ul class='l-children'></ul>");m.upgrade(k)}var h=[];for(var f=1;f<=r-1;f++){var o=b(m.getParentTreeItem(k,f));h.push(o.hasClass("l-last"))}h.push(c.hasClass("l-last"));var e=m._getTreeHTMLByData(q,r+1,h,true);e[e.length-1]=e[0]="";if(n!=null){b(n)[s?"after":"before"](e.join(""));m._updateStyle(k?b("ul:first",k):m.tree)}else{if(b("> .l-children > li:last",c).length>0){m._setTreeItem(b("> .l-children > li:last",c)[0],{isLast:false})}b(">.l-children",k).append(e.join(""))}m._upadteTreeWidth();b(">.l-children .l-body",k).hover(function(){b(this).addClass("l-over")},function(){b(this).removeClass("l-over")});m.trigger("afterAppend",[k,q])},cancelSelect:function(f,n){var k=this,e=this.options;var h=k.getNodeDom(f);var d=b(h);var j=parseInt(d.attr("treedataindex"));var m=k._getDataNodeByTreeDataIndex(k.data,j);var c=b(">div:first",d);if(e.checkbox){b(".l-checkbox",c).removeClass("l-checkbox-checked").addClass("l-checkbox-unchecked")}else{c.removeClass("l-selected")}if(n!=false){k.trigger("cancelSelect",[{data:m,target:d[0]}])}},selectNode:function(f,n){var j=this,e=this.options;var k=null;if(typeof(f)=="function"){k=f}else{if(typeof(f)=="object"){var d=b(f);var h=parseInt(d.attr("treedataindex"));var m=j._getDataNodeByTreeDataIndex(j.data,h);var c=b(">div:first",d);if(!c.length){c=b("li[treedataindex="+h+"] >div:first",j.tree)}if(e.checkbox){b(".l-checkbox",c).removeClass("l-checkbox-unchecked").addClass("l-checkbox-checked")}else{b("div.l-selected",j.tree).removeClass("l-selected");c.addClass("l-selected")}if(n!=false){j.trigger("select",[{data:m,target:c.parent().get(0)}])}return}else{k=function(g){if(!g[e.idFieldName]&&g[e.idFieldName]!=0){return false}return a(g[e.idFieldName].toString())==a(f.toString())}}}b("li",j.tree).each(function(){var q=b(this);var o=parseInt(q.attr("treedataindex"));var g=j._getDataNodeByTreeDataIndex(j.data,o);if(k(g,o)){j.selectNode(this,n)}else{if(!j.options.checkbox){j.cancelSelect(this,n)}}})},getTextByID:function(f){var c=this,e=this.options;var d=c.getDataByID(f);if(!d){return null}return d[e.textFieldName]},getDataByID:function(h){var c=this,e=this.options;var d=null;if(c.data&&c.data.length){return f(c.data)}function f(g){for(var k=0;k<g.length;k++){var j=g[k];if(j[e.idFieldName]==h){return j}if(j.children&&j.children.length){return f(j.children)}}return null}b("li",c.tree).each(function(){if(d){return}var k=b(this);var j=parseInt(k.attr("treedataindex"));var g=c._getDataNodeByTreeDataIndex(c.data,j);if(g[e.idFieldName].toString()==h.toString()){d=g}});return d},arrayToTree:function(g,c,j){if(!g||!g.length){return[]}var n=[];var e={};var k=g.length;for(var h=0;h<k;h++){var d=g[h];e[d[c]]=d}for(var h=0;h<k;h++){var f=g[h];var m=e[f[j]];if(!m){n.push(f);continue}m.children=m.children||[];m.children.push(f)}return n},_getDataNodeByTreeDataIndex:function(f,e){var d=this,h=this.options;for(var c=0;c<f.length;c++){if(f[c].treedataindex==e){return f[c]}if(f[c].children){var j=d._getDataNodeByTreeDataIndex(f[c].children,e);if(j){return j}}}return null},_setTreeDataStatus:function(e,c){var d=this,f=this.options;b(e).each(function(){this[f.statusName]=c;if(this.children){d._setTreeDataStatus(this.children,c)}})},_addTreeDataIndexToData:function(d){var c=this,e=this.options;b(d).each(function(){if(this.treedataindex!=undefined){return}this.treedataindex=c.treedataindex++;if(this.children){c._addTreeDataIndexToData(this.children)}})},_addToNodes:function(d){var c=this,e=this.options;c.nodes=c.nodes||[];c.nodes.push(d);if(!d.children){return}b(d.children).each(function(f,g){c._addToNodes(g)})},_appendData:function(h,f){var c=this,j=this.options;var e=parseInt(b(h).attr("treedataindex"));var d=c._getDataNodeByTreeDataIndex(c.data,e);if(c.treedataindex==undefined){c.treedataindex=0}if(d&&d.children==undefined){d.children=[]}b(f).each(function(g,k){if(d){d.children[d.children.length]=k}else{c.data[c.data.length]=k}c._addToNodes(k)})},_setTreeItem:function(h,d){var e=this,j=this.options;if(!d){return}h=e.getNodeDom(h);var f=b(h);var c=parseInt(f.attr("outlinelevel"));if(d.isLast!=undefined){if(d.isLast==true){f.removeClass("l-last").addClass("l-last");b("> div .l-note",f).removeClass("l-note").addClass("l-note-last");b(".l-children li",f).find(".l-box:eq("+(c-1)+")").removeClass("l-line")}else{if(d.isLast==false){f.removeClass("l-last");b("> div .l-note-last",f).removeClass("l-note-last").addClass("l-note");b(".l-children li",f).find(".l-box:eq("+(c-1)+")").removeClass("l-line").addClass("l-line")}}}},_upadteTreeWidth:function(){var c=this,d=this.options;var e=c.maxOutlineLevel*22;if(d.checkbox){e+=22}if(d.parentIcon||d.childIcon){e+=22}e+=d.nodeWidth;c.tree.width(e)},_getChildNodeClassName:function(){var c=this,d=this.options;return"l-tree-icon-"+d.childIcon},_getParentNodeClassName:function(d){var e=this,f=this.options;var c="l-tree-icon-"+f.parentIcon;if(d){c+="-open"}return c},_isExpand:function(f,h){var d=this,e=this.options;var c=f.isExpand!=null?f.isExpand:(f.isexpand!=null?f.isexpand:e.isExpand);if(c==null){return true}if(typeof(c)=="function"){c=e.isExpand({data:f,level:h})}if(typeof(c)=="boolean"){return c}if(typeof(c)=="string"){return c=="true"}if(typeof(c)=="number"){return c>h}return true},_getDelay:function(f,h){var d=this,e=this.options;var c=f.delay!=null?f.delay:e.delay;if(c==null){return false}if(typeof(c)=="function"){c=c({data:f,level:h})}if(typeof(c)=="boolean"){return c}if(typeof(c)=="string"){return{url:c}}if(typeof(c)=="number"){c=[c]}if(b.isArray(c)){return b.inArray(h,c)!=-1}if(typeof(c)=="object"&&c.url){return c}return false},_getTreeHTMLByData:function(r,x,s,u){var v=this,d=this.options;if(v.maxOutlineLevel<x){v.maxOutlineLevel=x}s=s||[];x=x||1;var y=[];if(!u){y.push('<ul class="l-children" style="display:none">')}else{y.push("<ul class='l-children'>")}for(var t=0;t<r.length;t++){var e=r[t];var n=t==0;var h=t==r.length-1;var q=v._getDelay(e,x);var w=q?false:v._isExpand(e,x);y.push("<li ");if(e.treedataindex!=undefined){y.push('treedataindex="'+e.treedataindex+'" ')}if(w){y.push("isexpand="+e.isexpand+" ")}y.push("outlinelevel="+x+" ");for(var m=0;m<v.sysAttribute.length;m++){if(b(this).attr(v.sysAttribute[m])){r[dataindex][v.sysAttribute[m]]=b(this).attr(v.sysAttribute[m])}}for(var m=0;m<d.attribute.length;m++){if(e[d.attribute[m]]){y.push(d.attribute[m]+'="'+e[d.attribute[m]]+'" ')}}y.push('class="');n&&y.push("l-first ");h&&y.push("l-last ");n&&h&&y.push("l-onlychild ");y.push('"');y.push(">");y.push('<div class="l-body');if(d.selectable&&d.selectable(e)==false){y.push(" l-unselectable")}y.push('">');for(var f=0;f<=x-2;f++){if(s[f]){y.push('<div class="l-box"></div>')}else{y.push('<div class="l-box l-line"></div>')}}if(v.hasChildren(e)){if(w){y.push('<div class="l-box l-expandable-open"></div>')}else{y.push('<div class="l-box l-expandable-close"></div>')}if(d.checkbox){if(e.ischecked){y.push('<div class="l-box l-checkbox l-checkbox-checked"></div>')}else{y.push('<div class="l-box l-checkbox l-checkbox-unchecked"></div>')}}if(d.parentIcon){y.push('<div class="l-box l-tree-icon ');y.push(v._getParentNodeClassName(w?true:false)+" ");if(d.iconFieldName&&e[d.iconFieldName]){y.push("l-tree-icon-none")}y.push('">');if(d.iconFieldName&&e[d.iconFieldName]){if(d.iconType=="image"){y.push('<img src="'+e[d.iconFieldName]+'" />')}else{y.push('<span class="'+e[d.iconFieldName]+'" />')}}y.push("</div>")}}else{if(h){y.push('<div class="l-box l-note-last"></div>')}else{y.push('<div class="l-box l-note"></div>')}if(d.checkbox){if(e.ischecked){y.push('<div class="l-box l-checkbox l-checkbox-checked"></div>')}else{y.push('<div class="l-box l-checkbox l-checkbox-unchecked"></div>')}}if(d.childIcon){y.push('<div class="l-box l-tree-icon ');y.push(v._getChildNodeClassName()+" ");if(d.iconFieldName&&e[d.iconFieldName]){y.push("l-tree-icon-none")}y.push('">');if(d.iconFieldName&&e[d.iconFieldName]){if(d.iconType=="image"){y.push('<img src="'+e[d.iconFieldName]+'" />')}else{y.push('<span class="'+e[d.iconFieldName]+'" />')}}y.push("</div>")}}if(d.render){y.push("<span>"+d.render(e,e[d.textFieldName],x)+"</span>")}else{y.push("<span>"+e[d.textFieldName]+"</span>")}y.push("</div>");if(v.hasChildren(e)){var c=[];for(var f=0;f<s.length;f++){c.push(s[f])}c.push(h);if(q){if(q==true){v.toggleNodeCallbacks.push({data:e,callback:function(k,j){var g=v._getTreeHTMLByData(j.children,x+1,c,w).join("");b(k).append(g);b(">.l-children .l-body",k).hover(function(){b(this).addClass("l-over")},function(){b(this).removeClass("l-over")});v._removeToggleNodeCallback(j)}})}else{if(q.url){(function(k,g,j){v.toggleNodeCallbacks.push({data:k,callback:function(A,z){v.loadData(A,g,j,{showLoading:function(){b("div.l-expandable-close:first",A).addClass("l-box-loading")},hideLoading:function(){b("div.l-box-loading:first",A).removeClass("l-box-loading")}});v._removeToggleNodeCallback(z)}})})(e,q.url,q.parms)}}}else{y.push(v._getTreeHTMLByData(e.children,x+1,c,w).join(""))}}y.push("</li>")}y.push("</ul>");return y},_removeToggleNodeCallback:function(c){var e=this,f=this.options;for(var d=0;d<=e.toggleNodeCallbacks.length;d++){if(e.toggleNodeCallbacks[d]&&e.toggleNodeCallbacks[d].data==c){e.toggleNodeCallbacks.splice(d,1);break}}},_getDataByTreeHTML:function(e){var c=this,f=this.options;var d=[];b("> li",e).each(function(h,k){var m=d.length;d[m]={treedataindex:c.treedataindex++};d[m][f.textFieldName]=b("> span,> a",this).html();for(var g=0;g<c.sysAttribute.length;g++){if(b(this).attr(c.sysAttribute[g])){d[m][c.sysAttribute[g]]=b(this).attr(c.sysAttribute[g])}}for(var g=0;g<f.attribute.length;g++){if(b(this).attr(f.attribute[g])){d[m][f.attribute[g]]=b(this).attr(f.attribute[g])}}if(b("> ul",this).length>0){d[m].children=c._getDataByTreeHTML(b("> ul",this))}});return d},_applyTree:function(){var d=this,e=this.options;d.data=d._getDataByTreeHTML(d.tree);var c=d._getTreeHTMLByData(d.data,1,[],true);c[c.length-1]=c[0]="";d.tree.html(c.join(""));d._upadteTreeWidth();b(".l-body",d.tree).hover(function(){b(this).addClass("l-over")},function(){b(this).removeClass("l-over")})},_getSrcElementByEvent:function(n){var h=this;var m=(n.target||n.srcElement);var c=m.tagName.toLowerCase();var k=b(m).parents().add(m);var d=function(g){for(var e=k.length-1;e>=0;e--){if(b(k[e]).hasClass(g)){return k[e]}}return null};if(k.index(this.element)==-1){return{out:true}}var f={tree:d("l-tree"),node:d("l-body"),checkbox:d("l-checkbox"),icon:d("l-tree-icon"),text:c=="span"};if(f.node){var j=parseInt(b(f.node).parent().attr("treedataindex"));f.data=h._getDataNodeByTreeDataIndex(h.data,j)}return f},_setTreeEven:function(){var c=this,d=this.options;if(c.hasBind("contextmenu")){c.tree.bind("contextmenu",function(j){var h=(j.target||j.srcElement);var k=null;if(h.tagName.toLowerCase()=="a"||h.tagName.toLowerCase()=="span"||b(h).hasClass("l-box")){k=b(h).parent().parent()}else{if(b(h).hasClass("l-body")){k=b(h).parent()}else{if(h.tagName.toLowerCase()=="li"){k=b(h)}}}if(!k){return}var g=parseInt(k.attr("treedataindex"));var f=c._getDataNodeByTreeDataIndex(c.data,g);return c.trigger("contextmenu",[{data:f,target:k[0]},j])})}c.tree.click(function(m){var k=(m.target||m.srcElement);var o=null;if(k.tagName.toLowerCase()=="a"||k.tagName.toLowerCase()=="span"||b(k).hasClass("l-box")){o=b(k).parent().parent()}else{if(b(k).hasClass("l-body")){o=b(k).parent()}else{o=b(k)}}if(!o){return}var j=parseInt(o.attr("treedataindex"));var h=c._getDataNodeByTreeDataIndex(c.data,j);var g=b("div.l-body:first",o).find("div.l-expandable-open:first,div.l-expandable-close:first");var f=b(k).hasClass("l-expandable-open")||b(k).hasClass("l-expandable-close");if(!b(k).hasClass("l-checkbox")&&!f){if(!o.hasClass("l-unselectable")){if(b(">div:first",o).hasClass("l-selected")&&d.needCancel){if(c.trigger("beforeCancelSelect",[{data:h,target:o[0]}])==false){return false}b(">div:first",o).removeClass("l-selected");c.trigger("cancelSelect",[{data:h,target:o[0]}])}else{if(c.trigger("beforeSelect",[{data:h,target:o[0]}])==false){return false}b(".l-body",c.tree).removeClass("l-selected");b(">div:first",o).addClass("l-selected");c.trigger("select",[{data:h,target:o[0]}])}}}if(b(k).hasClass("l-checkbox")){if(d.autoCheckboxEven){if(b(k).hasClass("l-checkbox-unchecked")){b(k).removeClass("l-checkbox-unchecked").addClass("l-checkbox-checked");b(".l-children .l-checkbox",o).removeClass("l-checkbox-incomplete l-checkbox-unchecked").addClass("l-checkbox-checked");c.trigger("check",[{data:h,target:o[0]},true])}else{if(b(k).hasClass("l-checkbox-checked")){b(k).removeClass("l-checkbox-checked").addClass("l-checkbox-unchecked");b(".l-children .l-checkbox",o).removeClass("l-checkbox-incomplete l-checkbox-checked").addClass("l-checkbox-unchecked");c.trigger("check",[{data:h,target:o[0]},false])}else{if(b(k).hasClass("l-checkbox-incomplete")){b(k).removeClass("l-checkbox-incomplete").addClass("l-checkbox-checked");b(".l-children .l-checkbox",o).removeClass("l-checkbox-incomplete l-checkbox-unchecked").addClass("l-checkbox-checked");c.trigger("check",[{data:h,target:o[0]},true])}}}c._setParentCheckboxStatus(o)}else{if(b(k).hasClass("l-checkbox-unchecked")){b(k).removeClass("l-checkbox-unchecked").addClass("l-checkbox-checked");if(d.single){b(".l-checkbox",c.tree).not(k).removeClass("l-checkbox-checked").addClass("l-checkbox-unchecked")}c.trigger("check",[{data:h,target:o[0]},true])}else{if(b(k).hasClass("l-checkbox-checked")){b(k).removeClass("l-checkbox-checked").addClass("l-checkbox-unchecked");c.trigger("check",[{data:h,target:o[0]},false])}}}}else{if(g.hasClass("l-expandable-open")&&(!d.btnClickToToggleOnly||f)){if(c.trigger("beforeCollapse",[{data:h,target:o[0]}])==false){return false}g.removeClass("l-expandable-open").addClass("l-expandable-close");if(d.slide){b("> .l-children",o).slideToggle("fast")}else{b("> .l-children",o).hide()}b("> div ."+c._getParentNodeClassName(true),o).removeClass(c._getParentNodeClassName(true)).addClass(c._getParentNodeClassName());c.trigger("collapse",[{data:h,target:o[0]}])}else{if(g.hasClass("l-expandable-close")&&(!d.btnClickToToggleOnly||f)){if(c.trigger("beforeExpand",[{data:h,target:o[0]}])==false){return false}b(c.toggleNodeCallbacks).each(function(){if(this.data==h){this.callback(o[0],h)}});g.removeClass("l-expandable-close").addClass("l-expandable-open");var n=function(){c.trigger("expand",[{data:h,target:o[0]}])};if(d.slide){b("> .l-children",o).slideToggle("fast",n)}else{b("> .l-children",o).show();n()}b("> div ."+c._getParentNodeClassName(),o).removeClass(c._getParentNodeClassName()).addClass(c._getParentNodeClassName(true))}}}c.trigger("click",[{data:h,target:o[0]}])});if(b.fn.ligerDrag&&d.nodeDraggable){c.nodeDroptip=b("<div class='l-drag-nodedroptip' style='display:none'></div>").appendTo("body");c.tree.ligerDrag({revert:true,animate:false,proxyX:20,proxyY:20,proxy:function(f,n){var o=c._getSrcElementByEvent(n);if(o.node){var m="dragging";if(d.nodeDraggingRender){m=d.nodeDraggingRender(f.draggingNodes,f,c)}else{m="";var j=false;for(var h in f.draggingNodes){var k=f.draggingNodes[h];if(j){m+=","}m+=k.text;j=true}}var g=b("<div class='l-drag-proxy' style='display:none'><div class='l-drop-icon l-drop-no'></div>"+m+"</div>").appendTo("body");return g}},onRevert:function(){return false},onRendered:function(){this.set("cursor","default");c.children[this.id]=this},onStartDrag:function(j,h){if(h.button==2){return false}this.set("cursor","default");var k=c._getSrcElementByEvent(h);if(k.checkbox){return false}if(d.checkbox){var g=c.getChecked();this.draggingNodes=[];for(var f in g){this.draggingNodes.push(g[f].data)}if(!this.draggingNodes||!this.draggingNodes.length){return false}}else{this.draggingNodes=[k.data]}this.draggingNode=k.data;this.set("cursor","move");c.nodedragging=true;this.validRange={top:c.tree.offset().top,bottom:c.tree.offset().top+c.tree.height(),left:c.tree.offset().left,right:c.tree.offset().left+c.tree.width()}},onDrag:function(s,t){var v=this.draggingNode;if(!v){return false}var g=this.draggingNodes?this.draggingNodes:[v];if(c.nodeDropIn==null){c.nodeDropIn=-1}var n=t.pageX;var j=t.pageY;var w=false;var x=this.validRange;if(n<x.left||n>x.right||j>x.bottom||j<x.top){c.nodeDropIn=-1;c.nodeDroptip.hide();this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes l-drop-add").addClass("l-drop-no");return}for(var o=0,h=c.nodes.length;o<h;o++){var m=c.nodes[o];var r=m.treedataindex;if(v.treedataindex==r){w=true}if(b.inArray(m,g)!=-1){continue}var y=w?true:false;if(c.nodeDropIn!=-1&&c.nodeDropIn!=r){continue}var f=b("li[treedataindex="+r+"] div:first",c.tree);var k=f.offset();var q={top:k.top,bottom:k.top+f.height(),left:c.tree.offset().left,right:c.tree.offset().left+c.tree.width()};if(n>q.left&&n<q.right&&j>q.top&&j<q.bottom){var u=k.top;if(y){u+=f.height()}c.nodeDroptip.css({left:q.left,top:u,width:q.right-q.left}).show();c.nodeDropIn=r;c.nodeDropDir=y?"bottom":"top";if(j>q.top+7&&j<q.bottom-7){this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no l-drop-yes").addClass("l-drop-add");c.nodeDroptip.hide();c.nodeDropInParent=true}else{this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no l-drop-add").addClass("l-drop-yes");c.nodeDroptip.show();c.nodeDropInParent=false}break}else{if(c.nodeDropIn!=-1){c.nodeDropIn=-1;c.nodeDropInParent=false;c.nodeDroptip.hide();this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes  l-drop-add").addClass("l-drop-no")}}}},onStopDrag:function(m,k){var f=this.draggingNodes;c.nodedragging=false;if(c.nodeDropIn!=-1){for(var h=0;h<f.length;h++){var g=f[h].children;if(g){f=b.grep(f,function(n,e){var o=b.inArray(n,g)==-1;return o})}}for(var h in f){var j=f[h];if(c.nodeDropInParent){c.remove(j);c.append(c.nodeDropIn,[j])}else{c.remove(j);c.append(c.getParent(c.nodeDropIn),[j],c.nodeDropIn,c.nodeDropDir=="bottom")}}c.nodeDropIn=-1}c.nodeDroptip.hide();this.set("cursor","default")}})}},_setParentCheckboxStatus:function(h){var e=this,f=this.options;var c=b(".l-checkbox-unchecked",h.parent()).length==0;var d=b(".l-checkbox-checked",h.parent()).length==0;if(d){h.parent().prev().find("> .l-checkbox").removeClass("l-checkbox-checked l-checkbox-incomplete").addClass("l-checkbox-unchecked")}else{if(c||!f.enabledCompleteCheckbox){h.parent().prev().find(".l-checkbox").removeClass("l-checkbox-unchecked l-checkbox-incomplete").addClass("l-checkbox-checked")}else{h.parent().prev().find("> .l-checkbox").removeClass("l-checkbox-unchecked l-checkbox-checked").addClass("l-checkbox-incomplete")}}if(h.parent().parent("li").length>0){e._setParentCheckboxStatus(h.parent().parent("li"))}}});function a(c){if(!c){return c}return c.replace(/(^\s*)|(\s*$)/g,"")}})(jQuery);(function(b){var a=b.ligerui;a.windowCount=0;b.ligerWindow=function(c){return a.run.call(null,"ligerWindow",arguments,{isStatic:true})};b.ligerWindow.show=function(c){return b.ligerWindow(c)};b.ligerDefaults.Window={showClose:true,showMax:true,showToggle:true,showMin:true,title:"window",load:false,onLoaded:null,onClose:null,onRegain:null,onMax:null,modal:false};b.ligerMethos.Window={};a.controls.Window=function(c){a.controls.Window.base.constructor.call(this,null,c)};a.controls.Window.ligerExtend(a.core.Win,{__getType:function(){return"Window"},__idPrev:function(){return"Window"},_extendMethods:function(){return b.ligerMethos.Window},_render:function(){var f=this,k=this.options;f.window=b('<div class="l-window"><div class="l-window-header"><div class="l-window-header-buttons"><div class="l-window-toggle"></div><div class="l-window-max"></div><div class="l-window-close"></div><div class="l-clear"></div></div><div class="l-window-header-inner"></div></div><div class="l-window-content"></div></div>');f.element=f.window[0];f.window.content=b(".l-window-content",f.window);f.window.header=b(".l-window-header",f.window);f.window.buttons=b(".l-window-header-buttons:first",f.window);if(k.url){if(k.load){f.window.content.load(k.url,function(){f.trigger("loaded")});f.window.content.addClass("l-window-content-scroll")}else{var d=b("<iframe frameborder='0' src='"+k.url+"'></iframe>");var c="ligeruiwindow"+a.windowCount++;if(k.name){c=k.name}d.attr("name",c).attr("id",c);k.framename=c;d.appendTo(f.window.content);f.iframe=d}}else{if(k.content){var e=b("<div>"+k.content+"</div>");e.appendTo(f.window.content)}else{if(k.target){f.window.content.append(k.target);k.target.show()}}}this.mask();f.active();b("body").append(f.window);f.set({width:k.width,height:k.height});var j=0;var h=0;if(k.left!=null){j=k.left}else{k.left=j=0.5*(b(window).width()-f.window.width())}if(k.top!=null){h=k.top}else{k.top=h=0.5*(b(window).height()-f.window.height())+b(window).scrollTop()-10}if(j<0){k.left=j=0}if(h<0){k.top=h=0}f.set(k);k.framename&&b(">iframe",f.window.content).attr("name",k.framename);if(!k.showToggle){b(".l-window-toggle",f.window).remove()}if(!k.showMax){b(".l-window-max",f.window).remove()}if(!k.showClose){b(".l-window-close",f.window).remove()}f._saveStatus();if(b.fn.ligerDrag){f.draggable=f.window.drag=f.window.ligerDrag({handler:".l-window-header-inner",onStartDrag:function(){f.active()},onStopDrag:function(){f._saveStatus()},animate:false})}if(b.fn.ligerResizable){f.resizeable=f.window.resizable=f.window.ligerResizable({onStartResize:function(){f.active();b(".l-window-max",f.window).removeClass("l-window-regain")},onStopResize:function(o,n){var m=0;var g=0;if(!isNaN(parseInt(f.window.css("top")))){m=parseInt(f.window.css("top"))}if(!isNaN(parseInt(f.window.css("left")))){g=parseInt(f.window.css("left"))}if(o.diffTop){f.window.css({top:m+o.diffTop})}if(o.diffLeft){f.window.css({left:g+o.diffLeft})}if(o.newWidth){f.window.width(o.newWidth)}if(o.newHeight){f.window.content.height(o.newHeight-28)}f._saveStatus();return false}});f.window.append("<div class='l-btn-nw-drop'></div>")}b(".l-window-toggle",f.window).click(function(){if(b(this).hasClass("l-window-toggle-close")){f.collapsed=false;b(this).removeClass("l-window-toggle-close")}else{f.collapsed=true;b(this).addClass("l-window-toggle-close")}f.window.content.slideToggle()}).hover(function(){if(f.window.drag){f.window.drag.set("disabled",true)}},function(){if(f.window.drag){f.window.drag.set("disabled",false)}});b(".l-window-close",f.window).click(function(){if(f.trigger("close")==false){return false}f.window.hide();a.win.removeTask(f)}).hover(function(){if(f.window.drag){f.window.drag.set("disabled",true)}},function(){if(f.window.drag){f.window.drag.set("disabled",false)}});b(".l-window-max",f.window).click(function(){if(b(this).hasClass("l-window-regain")){if(f.trigger("regain")==false){return false}f.window.width(f._width).css({left:f._left,top:f._top});f.window.content.height(f._height-28);b(this).removeClass("l-window-regain")}else{if(f.trigger("max")==false){return false}f.window.width(b(window).width()-2).css({left:0,top:0});f.window.content.height(b(window).height()-28).show();b(this).addClass("l-window-regain")}})},_saveStatus:function(){var c=this;c._width=c.window.width();c._height=c.window.height();var e=0;var d=0;if(!isNaN(parseInt(c.window.css("top")))){e=parseInt(c.window.css("top"))}if(!isNaN(parseInt(c.window.css("left")))){d=parseInt(c.window.css("left"))}c._top=e;c._left=d},min:function(){this.window.hide();this.minimize=true;this.actived=false},_setShowMin:function(d){var c=this,e=this.options;if(d){if(!c.winmin){c.winmin=b('<div class="l-window-min"></div>').prependTo(c.window.buttons).click(function(){c.min()});a.win.addTask(c)}}else{if(c.winmin){c.winmin.remove();c.winmin=null}}},_setLeft:function(c){if(c!=null){this.window.css({left:c})}},_setTop:function(c){if(c!=null){this.window.css({top:c})}},_setWidth:function(c){if(c>0){this.window.width(c)}},_setHeight:function(c){if(c>28){this.window.content.height(c-28)}},_setTitle:function(c){if(c){b(".l-window-header-inner",this.window.header).html(c)}},_setUrl:function(c){var d=this,e=this.options;e.url=c;if(e.load){d.window.content.html("").load(e.url,function(){if(d.trigger("loaded")==false){return false}})}else{if(d.jiframe){d.jiframe.attr("src",e.url)}}},hide:function(){var c=this,d=this.options;a.win.remove(this);this.unmask();this.window.hide()},show:function(){var c=this,d=this.options;a.win.add(this);this.mask();this.window.show()},remove:function(){var c=this,d=this.options;a.win.remove(this);this.unmask();this.window.remove()},active:function(){var e=this,j=this.options;if(e.minimize){var d=e._width,c=e._height,h=e._left,f=e._top;if(e.maximum){d=b(window).width();c=b(window).height();h=f=0;if(a.win.taskbar){c-=a.win.taskbar.outerHeight();if(a.win.top){f+=a.win.taskbar.outerHeight()}}}e.set({width:d,height:c,left:h,top:f})}e.actived=true;e.minimize=false;a.win.setFront(e);e.show();a.win.setFront(this)},setUrl:function(c){return _setUrl(c)}})})(jQuery);