jQuery.validator.addMethod("trxDateLessSysDate",function(f,d,g){var a;var c;var e=new Date();var b=new Date(f.replace("T"," ")).getTime();if(e<b){a=false}else{a=true}return a},$l("msg.warning.inventory.trx_date_must_less_than_now_date"));function Map(){var f=function(i,j){this.key=i;this.value=j};var h=function(k,l){for(var j=0;j<this.arr.length;j++){if(this.arr[j].key===k){this.arr[j].value=l;return}}this.arr[this.arr.length]=new f(k,l)};var c=function(k){for(var j=0;j<this.arr.length;j++){if(this.arr[j].key===k){return this.arr[j].value}}return null};var b=function(l){var j;for(var k=0;k<this.arr.length;k++){j=this.arr.pop();if(j.key===l){continue}this.arr.unshift(j)}};var d=function(){return this.arr.length};var g=function(){return this.arr.length<=0};var e=function(){return this.arr};var a=function(){this.arr=[]};this.arr=new Array();this.get=c;this.put=h;this.remove=b;this.size=d;this.isEmpty=g;this.iterator=e;this.clear=a}var cacheRepackTrx=function(g,f,d,e){g.endEdit();var c=g.rows;if(d!=null&&c&&c.length>0){var a=new Array();for(var b=0;b<c.length;b++){a.push(reRepackTrxDetail(c[b],c[b].itemPackageComponents))}f.put(d.itemId+"",a);if(e){g.endEdit();deleteRows(g,c)}}else{if(d!=null){f.put(d.itemId+"",null)}}};var deleteRows=function(c,b){if(b&&b.length>0){for(var a=0;a<b.length;a++){c.deleteRow(b[a])}}};var addRows=function(e,b,c){if(b==null||b.length<=0||e==null){return}for(var a=0;a<b.length;a++){var d=reRepackTrxDetail(b[a],c.itemId);e.addRow(d)}repackTrxStatusNoChanged(e)};var ajaxTrx=function(a){$.ajax({url:a.url||" ",async:a.async==false?false:true,type:a.type||"POST",data:a.data||null,dataType:a.dataType||"json",contentType:a.contentType||"application/x-www-form-urlencoded;charset=UTF-8",success:function(b){if(a.success){a.success(b)}},error:function(){if(a.error){a.error()}}})};var valiAttr=function(b){for(var a in b){if(!b[a]||b[a]==""){delete b[a]}}};var ajaxRepackTrx=function(c){var b=new Array();var e=c.map.iterator();for(var a=0;a<e.length;a++){Array.prototype.push.apply(b,e[a].value)}c.repackTrx.repackTrxDetails=b;var d=new Array();d.push(c.repackTrx);valiAttr(c.repackTrx);Hap.ajax({url:c.url,data:d,callback:function(f){if(c.callback&&f){c.callback(f)}},success:function(f){if(c.success&&f){c.success(f)}}})};var loadToMap=function(a,b){a.clear();$.each(b,function(d,c){if(a.get(c.itemPackageComponents+"")==null){a.put(c.itemPackageComponents+"",new Array(c))}else{var e=a.get(c.itemPackageComponents+"");e.push(c)}})};var reRenderData=function(g,f,d,c){var b=$.isArray(f)?f:[],a=null;if(b.length>0){if(b[0].repackTrxDetails&&b[0].repackTrxDetails.length>0){g.clear();$.each(b[0].repackTrxDetails,function(j,h){if(g.get(h.itemPackageComponents+"")==null){g.put(h.itemPackageComponents+"",new Array(h))}else{var k=g.get(h.itemPackageComponents+"");k.push(h)}})}}if(c==null){return}deleteRows(d,d.rows);var e=g.get(c.itemId+"");if(e!=null&&e.length>0){$.each(e,function(j,h){if(h){h=$.extend(h,{__status:"nochanged"});d.addRow(h)}});d.reRender()}};var valiDataMap=function(c,g,e){var d=$.isArray(c.rows)?c.rows:[];for(var f=0;f<d.length;f++){var b=g.get(d[f].itemId+"");if(b!=null&&b.length>0){var a=vali(d[f],b,e);if(a!="true"){return a}}}return"true"};var vali=function(d,a,b){var e=0;if(a!=null&&a.length>0){for(var c=0;c<a.length;c++){if(b=="COMPS"){if((!(a[c].allocateQty&&a[c].quantity))||a[c].allocateQty==""||a[c].allocateQty<=0){return"allocateQty_or_quantity_empty_error"}}else{if(a[c].allocateQty<=0||a[c].allocateQty==""){return"allocateQty_or_quantity_empty_error"}}if(parseInt(a[c].quantity)<parseInt(a[c].allocateQty)&&b=="COMPS"){return"lotnumber_not_allowed_out_of_stock"}e+=parseInt(a[c].allocateQty)}if(d.allocateQty!=e){return"must_equal_with_sum_qty"}}return"true"};var refreshItems=function(d,a){var c=a.rows;for(var b=0;b<c.length;b++){c[b].allocateQty=a.getData()[b].quantity*d;a.reRender({rowdata:c[b]});if(itemDetail!=null&&(itemDetail.__id==c[b].__id)){itemDetail.allocateQty=c[b].allocateQty}}};function reload(c,b,a,d,f,e){if(c==null){return}ajaxTrx({url:$("#contextPath").val()+"/im/repackTrx/loadById",data:{trxId:c},success:function(g){if(g&&g.status=="success"){b.setData(g.repackTrx);Hap.gridQuery({form:b,grid:a,});if(g.onhandQuantity&&g.onhandQuantity!=null){$.ligerui.get("quantity").set("value",g.onhandQuantity.quantity)}else{$.ligerui.get("quantity").set("value",0)}$("input[ligeruiid='packageItemId']").val(g.repackTrx.itemNumber);loadToMap(d,g.repackTrx.repackTrxDetails);if(g.repackTrx.status=="COMP"){f()}if(e){e(g.repackTrx)}}}})}var addCountItemProperties=function(a,e){var d=a.rows;if(d==null||d.length<=0){return}for(var c=0;c<d.length;c++){var b=e.get(d[c].itemId+"");if(b!=null&&b.length>0){$.each(b,function(f,g){g.countItemId=d[c].invCountItemId})}}};function reRepackTrxDetail(b,c){var a={itemPackageComponents:c,lotNumber:b.lotNumber,expiryDate:b.expiryDate,quantity:b.quantity,allocateQty:b.allocateQty,remark:b.remark};a=$.extend(a,b,{__status:"nochanged"});return a}function repackTrxStatusNoChanged(b){var a=$.isArray(b.rows)?b.rows:[];if(a.length>0){$.each(a,function(c,e){if(e.__status=="delete"){return true}var d=b.records[e.__id];if(d&&d.trxId){d=$.extend(d,e,{__status:"nochanged"})}})}b.deletedRows=[];b.reRender()};