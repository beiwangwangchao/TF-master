<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lkkhpg.dsis.common.bonus.mapper.BonusFinalMapper" >
  <resultMap id="BaseResultMap" type="com.lkkhpg.dsis.common.bonus.dto.BonusFinal" >
    <id column="BONUS_ID" property="bonusId" jdbcType="DECIMAL" />
    <result column="PERIOD_ID" property="periodId" jdbcType="DECIMAL" />
    <result column="MEMBER_ID" property="memberId" jdbcType="DECIMAL" />
    <result column="CURRENCY_CODE" property="currencyCode" jdbcType="VARCHAR" />
    <result column="PRE_TAX_AMT_ADJUST" property="preTaxAmtAdjust" jdbcType="DECIMAL" />
    <result column="PRE_TAX_AMT" property="preTaxAmt" jdbcType="DECIMAL" />
    <result column="TAX_CODE_01" property="taxCode01" jdbcType="VARCHAR" />
    <result column="TAX_AMT_01" property="taxAmt01" jdbcType="DECIMAL" />
    <result column="TAX_CODE_02" property="taxCode02" jdbcType="VARCHAR" />
    <result column="TAX_AMT_02" property="taxAmt02" jdbcType="DECIMAL" />
    <result column="AFTER_TAX_AMT" property="afterTaxAmt" jdbcType="DECIMAL" />
    <result column="DELIVER_AMT" property="deliverAmt" jdbcType="DECIMAL" />
    <result column="CLEAR_TAX_CODE_03" property="clearTaxCode03" jdbcType="VARCHAR" />
    <result column="CLEAR_TAX_AMT_03" property="clearTaxAmt03" jdbcType="DECIMAL" />
    <result column="DELIVER_BANK_CODE" property="deliverBankCode" jdbcType="VARCHAR" />
    <result column="DELIVER_BANK_FEE" property="deliverBankFee" jdbcType="DECIMAL" />
    <result column="REMIT_NET_AMT" property="remitNetAmt" jdbcType="DECIMAL" />
    <result column="REMIT_BANK_CODE" property="remitBankCode" jdbcType="VARCHAR" />
    <result column="REMIT_BANK_NAME" property="remitBankName" jdbcType="VARCHAR" />
    <result column="REMIT_BANK_ACCOUNT" property="remitBankAccount" jdbcType="VARCHAR" />
    <result column="REMIT_FLAG" property="remitFlag" jdbcType="VARCHAR" />
    <result column="REMIT_DATE" property="remitDate" jdbcType="TIMESTAMP" />
    <result column="REMIT_MEMO" property="remitMemo" jdbcType="VARCHAR" />
    <result column="COMMENTS" property="comments" jdbcType="VARCHAR" />
    <result column="MARKET_ID" property="marketId" jdbcType="DECIMAL" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="OBJECT_VERSION_NUMBER" property="objectVersionNumber" jdbcType="DECIMAL" />
    <result column="REQUEST_ID" property="requestId" jdbcType="DECIMAL" />
    <result column="PROGRAM_ID" property="programId" jdbcType="DECIMAL" />
    <result column="CREATION_DATE" property="creationDate" jdbcType="TIMESTAMP" />
    <result column="CREATED_BY" property="createdBy" jdbcType="DECIMAL" />
    <result column="LAST_UPDATED_BY" property="lastUpdatedBy" jdbcType="DECIMAL" />
    <result column="LAST_UPDATE_DATE" property="lastUpdateDate" jdbcType="TIMESTAMP" />
    <result column="LAST_UPDATE_LOGIN" property="lastUpdateLogin" jdbcType="DECIMAL" />
    <result column="ATTRIBUTE_CATEGORY" property="attributeCategory" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE1" property="attribute1" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE2" property="attribute2" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE3" property="attribute3" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE4" property="attribute4" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE5" property="attribute5" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE6" property="attribute6" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE7" property="attribute7" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE8" property="attribute8" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE9" property="attribute9" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE10" property="attribute10" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE11" property="attribute11" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE12" property="attribute12" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE13" property="attribute13" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE14" property="attribute14" jdbcType="VARCHAR" />
    <result column="ATTRIBUTE15" property="attribute15" jdbcType="VARCHAR" />
    <result column="WITHHOLDING_TAX_AMT" property="withholdingTaxAmt" jdbcType="DECIMAL" />
    <result column="REMIT_MODE" property="remitMode" jdbcType="VARCHAR" />
    <result column="ID_NUMBER" property="idNumber" jdbcType="VARCHAR" />
    <result column="BONUS_CODE" property="bonusCode" jdbcType="VARCHAR" />
    <result column="BONUS_TYPE" property="bonusType" jdbcType="VARCHAR" />
    <result column="REMIT_BANK_ACCOUNT_NAME" property="remitBankAccountName" jdbcType="VARCHAR" />
    <result column="MEMBER_CODE" property="memberCode" jdbcType="VARCHAR"/>
    <result column="MEMBER_NAME" property="memberName" jdbcType="VARCHAR"/>
    <result column="MARKET_NAME" property="marketName" jdbcType="VARCHAR"/>
    <result column="COMPANY_NAME" property="companyName" jdbcType="VARCHAR"/>
    <result column="PERIOD_NAME" property="periodName" jdbcType="VARCHAR"/>
    <result column="BANK_BRANCH_CODE" property="bankBranchCode" jdbcType="VARCHAR"/>
    <result column="LOCK_FLAG" property="lockFlag" jdbcType="VARCHAR"/>
    <result column="AUTO_FAILED_FLAG" property="autoFaliledFlag" jdbcType="VARCHAR"/>
    <result column="PROCESS_MODE" property="processMode" jdbcType="VARCHAR"/>
  </resultMap>
  <sql id="Base_Column_List" >
    BONUS_ID, PERIOD_ID, MEMBER_ID, CURRENCY_CODE, 
    PRE_TAX_AMT_ADJUST, PRE_TAX_AMT, TAX_CODE_01, 
    TAX_AMT_01, TAX_CODE_02, TAX_AMT_02, AFTER_TAX_AMT, DELIVER_AMT, 
    CLEAR_TAX_CODE_03, CLEAR_TAX_AMT_03, DELIVER_BANK_CODE, DELIVER_BANK_FEE, 
    REMIT_NET_AMT, REMIT_BANK_CODE, REMIT_BANK_NAME, REMIT_BANK_ACCOUNT, REMIT_FLAG, 
    REMIT_DATE, REMIT_MEMO, COMMENTS, MARKET_ID, STATUS, OBJECT_VERSION_NUMBER, 
    REQUEST_ID, PROGRAM_ID, CREATION_DATE, CREATED_BY, LAST_UPDATED_BY, LAST_UPDATE_DATE, 
    LAST_UPDATE_LOGIN, ATTRIBUTE_CATEGORY, ATTRIBUTE1, ATTRIBUTE2, ATTRIBUTE3, ATTRIBUTE4, 
    ATTRIBUTE5, ATTRIBUTE6, ATTRIBUTE7, ATTRIBUTE8, ATTRIBUTE9, ATTRIBUTE10, ATTRIBUTE11, 
    ATTRIBUTE12, ATTRIBUTE13, ATTRIBUTE14, ATTRIBUTE15, WITHHOLDING_TAX_AMT, REMIT_MODE, 
    ID_NUMBER, BONUS_CODE, BONUS_TYPE, REMIT_BANK_ACCOUNT_NAME,BANK_BRANCH_CODE,LOCK_FLAG,
    AUTO_FAILED_FLAG,PROCESS_MODE
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    select 
    <include refid="Base_Column_List" />
    from BM_BONUS_FINAL
    where BONUS_ID = #{bonusId,jdbcType=DECIMAL}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    delete from BM_BONUS_FINAL
    where BONUS_ID = #{bonusId,jdbcType=DECIMAL}
  </delete>
  <insert id="insert" parameterType="com.lkkhpg.dsis.common.bonus.dto.BonusFinal" >
    <selectKey resultType="java.lang.Long" keyProperty="bonusId" order="BEFORE" >
      select UNIX_TIMESTAMP()*1000+floor(rand()*1000) from dual
    </selectKey>
    insert into BM_BONUS_FINAL (BONUS_ID, PERIOD_ID, 
      MEMBER_ID, CURRENCY_CODE, 
      PRE_TAX_AMT_ADJUST, PRE_TAX_AMT, TAX_CODE_01, 
      TAX_AMT_01, TAX_CODE_02, TAX_AMT_02, 
      AFTER_TAX_AMT, DELIVER_AMT, 
      CLEAR_TAX_CODE_03, CLEAR_TAX_AMT_03, 
      DELIVER_BANK_CODE, DELIVER_BANK_FEE, REMIT_NET_AMT, 
      REMIT_BANK_CODE, REMIT_BANK_NAME, REMIT_BANK_ACCOUNT, 
      REMIT_FLAG, REMIT_DATE, REMIT_MEMO, 
      COMMENTS, MARKET_ID, 
      STATUS, OBJECT_VERSION_NUMBER, REQUEST_ID, 
      PROGRAM_ID, CREATION_DATE, CREATED_BY, 
      LAST_UPDATED_BY, LAST_UPDATE_DATE, LAST_UPDATE_LOGIN, 
      ATTRIBUTE_CATEGORY, ATTRIBUTE1, ATTRIBUTE2, 
      ATTRIBUTE3, ATTRIBUTE4, ATTRIBUTE5, 
      ATTRIBUTE6, ATTRIBUTE7, ATTRIBUTE8, 
      ATTRIBUTE9, ATTRIBUTE10, ATTRIBUTE11, 
      ATTRIBUTE12, ATTRIBUTE13, ATTRIBUTE14, 
      ATTRIBUTE15, WITHHOLDING_TAX_AMT, REMIT_MODE, 
      ID_NUMBER, BONUS_CODE, 
      BONUS_TYPE, REMIT_BANK_ACCOUNT_NAME,BANK_BRANCH_CODE,LOCK_FLAG,
      AUTO_FAILED_FLAG,PROCESS_MODE)
    values (#{bonusId,jdbcType=DECIMAL}, #{periodId,jdbcType=DECIMAL}, 
      #{memberId,jdbcType=DECIMAL}, #{currencyCode,jdbcType=VARCHAR}, 
      #{preTaxAmtAdjust,jdbcType=DECIMAL}, #{preTaxAmt,jdbcType=DECIMAL}, #{taxCode01,jdbcType=VARCHAR}, 
      #{taxAmt01,jdbcType=DECIMAL}, #{taxCode02,jdbcType=VARCHAR}, #{taxAmt02,jdbcType=DECIMAL}, 
      #{afterTaxAmt,jdbcType=DECIMAL}, #{deliverAmt,jdbcType=DECIMAL}, 
      #{clearTaxCode03,jdbcType=VARCHAR}, #{clearTaxAmt03,jdbcType=DECIMAL}, 
      #{deliverBankCode,jdbcType=VARCHAR}, #{deliverBankFee,jdbcType=DECIMAL}, #{remitNetAmt,jdbcType=DECIMAL}, 
      #{remitBankCode,jdbcType=VARCHAR}, #{remitBankName,jdbcType=VARCHAR}, #{remitBankAccount,jdbcType=VARCHAR}, 
      #{remitFlag,jdbcType=VARCHAR}, #{remitDate,jdbcType=TIMESTAMP}, #{remitMemo,jdbcType=VARCHAR}, 
      #{comments,jdbcType=VARCHAR}, #{marketId,jdbcType=DECIMAL}, 
      #{status,jdbcType=VARCHAR}, 1, #{requestId,jdbcType=DECIMAL}, 
      #{programId,jdbcType=DECIMAL}, CURRENT_TIMESTAMP, #{createdBy,jdbcType=DECIMAL}, 
      #{lastUpdatedBy,jdbcType=DECIMAL}, CURRENT_TIMESTAMP, #{lastUpdateLogin,jdbcType=DECIMAL}, 
      #{attributeCategory,jdbcType=VARCHAR}, #{attribute1,jdbcType=VARCHAR}, #{attribute2,jdbcType=VARCHAR}, 
      #{attribute3,jdbcType=VARCHAR}, #{attribute4,jdbcType=VARCHAR}, #{attribute5,jdbcType=VARCHAR}, 
      #{attribute6,jdbcType=VARCHAR}, #{attribute7,jdbcType=VARCHAR}, #{attribute8,jdbcType=VARCHAR}, 
      #{attribute9,jdbcType=VARCHAR}, #{attribute10,jdbcType=VARCHAR}, #{attribute11,jdbcType=VARCHAR}, 
      #{attribute12,jdbcType=VARCHAR}, #{attribute13,jdbcType=VARCHAR}, #{attribute14,jdbcType=VARCHAR}, 
      #{attribute15,jdbcType=VARCHAR}, #{withholdingTaxAmt,jdbcType=DECIMAL}, #{remitMode,jdbcType=VARCHAR}, 
      #{idNumber,jdbcType=VARCHAR}, #{bonusCode,jdbcType=VARCHAR}, 
      #{bonusType,jdbcType=VARCHAR}, #{remitBankAccountName,jdbcType=VARCHAR},#{bankBranchCode,jdbcType=VARCHAR},
      #{lockFlag,jdbcType=VARCHAR},#{autoFaliledFlag,jdbcType=VARCHAR},#{processMode,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.lkkhpg.dsis.common.bonus.dto.BonusFinal" >
    <selectKey resultType="java.lang.Long" keyProperty="bonusId" order="BEFORE" >
      select UNIX_TIMESTAMP()*1000+floor(rand()*1000) from dual
    </selectKey>
    insert into BM_BONUS_FINAL
    <trim prefix="(" suffix=")" suffixOverrides="," >
      BONUS_ID,
      <if test="periodId != null" >
        PERIOD_ID,
      </if>
      <if test="memberId != null" >
        MEMBER_ID,
      </if>
      <if test="currencyCode != null" >
        CURRENCY_CODE,
      </if>
      <if test="preTaxAmtAdjust != null" >
        PRE_TAX_AMT_ADJUST,
      </if>
      <if test="preTaxAmt != null" >
        PRE_TAX_AMT,
      </if>
      <if test="taxCode01 != null" >
        TAX_CODE_01,
      </if>
      <if test="taxAmt01 != null" >
        TAX_AMT_01,
      </if>
      <if test="taxCode02 != null" >
        TAX_CODE_02,
      </if>
      <if test="taxAmt02 != null" >
        TAX_AMT_02,
      </if>
      <if test="afterTaxAmt != null" >
        AFTER_TAX_AMT,
      </if>
      <if test="deliverAmt != null" >
        DELIVER_AMT,
      </if>
      <if test="clearTaxCode03 != null" >
        CLEAR_TAX_CODE_03,
      </if>
      <if test="clearTaxAmt03 != null" >
        CLEAR_TAX_AMT_03,
      </if>
      <if test="deliverBankCode != null" >
        DELIVER_BANK_CODE,
      </if>
      <if test="deliverBankFee != null" >
        DELIVER_BANK_FEE,
      </if>
      <if test="remitNetAmt != null" >
        REMIT_NET_AMT,
      </if>
      <if test="remitBankCode != null" >
        REMIT_BANK_CODE,
      </if>
      <if test="remitBankName != null" >
        REMIT_BANK_NAME,
      </if>
      <if test="remitBankAccount != null" >
        REMIT_BANK_ACCOUNT,
      </if>
      <if test="remitFlag != null" >
        REMIT_FLAG,
      </if>
      <if test="remitDate != null" >
        REMIT_DATE,
      </if>
      <if test="remitMemo != null" >
        REMIT_MEMO,
      </if>
      <if test="comments != null" >
        COMMENTS,
      </if>
      <if test="marketId != null" >
        MARKET_ID,
      </if>
      <if test="status != null" >
        STATUS,
      </if>
        OBJECT_VERSION_NUMBER,
      <if test="requestId != null" >
        REQUEST_ID,
      </if>
      <if test="programId != null" >
        PROGRAM_ID,
      </if>
        CREATION_DATE,
      <if test="createdBy != null" >
        CREATED_BY,
      </if>
      <if test="lastUpdatedBy != null" >
        LAST_UPDATED_BY,
      </if>
        LAST_UPDATE_DATE,
      <if test="lastUpdateLogin != null" >
        LAST_UPDATE_LOGIN,
      </if>
      <if test="attributeCategory != null" >
        ATTRIBUTE_CATEGORY,
      </if>
      <if test="attribute1 != null" >
        ATTRIBUTE1,
      </if>
      <if test="attribute2 != null" >
        ATTRIBUTE2,
      </if>
      <if test="attribute3 != null" >
        ATTRIBUTE3,
      </if>
      <if test="attribute4 != null" >
        ATTRIBUTE4,
      </if>
      <if test="attribute5 != null" >
        ATTRIBUTE5,
      </if>
      <if test="attribute6 != null" >
        ATTRIBUTE6,
      </if>
      <if test="attribute7 != null" >
        ATTRIBUTE7,
      </if>
      <if test="attribute8 != null" >
        ATTRIBUTE8,
      </if>
      <if test="attribute9 != null" >
        ATTRIBUTE9,
      </if>
      <if test="attribute10 != null" >
        ATTRIBUTE10,
      </if>
      <if test="attribute11 != null" >
        ATTRIBUTE11,
      </if>
      <if test="attribute12 != null" >
        ATTRIBUTE12,
      </if>
      <if test="attribute13 != null" >
        ATTRIBUTE13,
      </if>
      <if test="attribute14 != null" >
        ATTRIBUTE14,
      </if>
      <if test="attribute15 != null" >
        ATTRIBUTE15,
      </if>
      <if test="withholdingTaxAmt != null" >
        WITHHOLDING_TAX_AMT,
      </if>
      <if test="remitMode != null" >
        REMIT_MODE,
      </if>
      <if test="idNumber != null" >
        ID_NUMBER,
      </if>
      <if test="bonusCode != null" >
        BONUS_CODE,
      </if>
      <if test="bonusType != null" >
        BONUS_TYPE,
      </if>
      <if test="remitBankAccountName != null" >
        REMIT_BANK_ACCOUNT_NAME,
      </if>
      <if test="bankBranchCode != null" >
        BANK_BRANCH_CODE,
      </if>
      <if test="lockFlag != null" >
        LOCK_FLAG,
      </if>
      <if test="autoFaliledFlag != null" >
        AUTO_FAILED_FLAG,
      </if>
      <if test="processMode != null" >
        PROCESS_MODE,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      #{bonusId,jdbcType=DECIMAL},
      <if test="periodId != null" >
        #{periodId,jdbcType=DECIMAL},
      </if>
      <if test="memberId != null" >
        #{memberId,jdbcType=DECIMAL},
      </if>
      <if test="currencyCode != null" >
        #{currencyCode,jdbcType=VARCHAR},
      </if>
      <if test="preTaxAmtAdjust != null" >
        #{preTaxAmtAdjust,jdbcType=DECIMAL},
      </if>
      <if test="preTaxAmt != null" >
        #{preTaxAmt,jdbcType=DECIMAL},
      </if>
      <if test="taxCode01 != null" >
        #{taxCode01,jdbcType=VARCHAR},
      </if>
      <if test="taxAmt01 != null" >
        #{taxAmt01,jdbcType=DECIMAL},
      </if>
      <if test="taxCode02 != null" >
        #{taxCode02,jdbcType=VARCHAR},
      </if>
      <if test="taxAmt02 != null" >
        #{taxAmt02,jdbcType=DECIMAL},
      </if>
      <if test="afterTaxAmt != null" >
        #{afterTaxAmt,jdbcType=DECIMAL},
      </if>
      <if test="deliverAmt != null" >
        #{deliverAmt,jdbcType=DECIMAL},
      </if>
      <if test="clearTaxCode03 != null" >
        #{clearTaxCode03,jdbcType=VARCHAR},
      </if>
      <if test="clearTaxAmt03 != null" >
        #{clearTaxAmt03,jdbcType=DECIMAL},
      </if>
      <if test="deliverBankCode != null" >
        #{deliverBankCode,jdbcType=VARCHAR},
      </if>
      <if test="deliverBankFee != null" >
        #{deliverBankFee,jdbcType=DECIMAL},
      </if>
      <if test="remitNetAmt != null" >
        #{remitNetAmt,jdbcType=DECIMAL},
      </if>
      <if test="remitBankCode != null" >
        #{remitBankCode,jdbcType=VARCHAR},
      </if>
      <if test="remitBankName != null" >
        #{remitBankName,jdbcType=VARCHAR},
      </if>
      <if test="remitBankAccount != null" >
        #{remitBankAccount,jdbcType=VARCHAR},
      </if>
      <if test="remitFlag != null" >
        #{remitFlag,jdbcType=VARCHAR},
      </if>
      <if test="remitDate != null" >
        #{remitDate,jdbcType=TIMESTAMP},
      </if>
      <if test="remitMemo != null" >
        #{remitMemo,jdbcType=VARCHAR},
      </if>
      <if test="comments != null" >
        #{comments,jdbcType=VARCHAR},
      </if>
      <if test="marketId != null" >
        #{marketId,jdbcType=DECIMAL},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
        1,
      <if test="requestId != null" >
        #{requestId,jdbcType=DECIMAL},
      </if>
      <if test="programId != null" >
        #{programId,jdbcType=DECIMAL},
      </if>
        CURRENT_TIMESTAMP,
      <if test="createdBy != null" >
        #{createdBy,jdbcType=DECIMAL},
      </if>
      <if test="lastUpdatedBy != null" >
        #{lastUpdatedBy,jdbcType=DECIMAL},
      </if>
        CURRENT_TIMESTAMP,
      <if test="lastUpdateLogin != null" >
        #{lastUpdateLogin,jdbcType=DECIMAL},
      </if>
      <if test="attributeCategory != null" >
        #{attributeCategory,jdbcType=VARCHAR},
      </if>
      <if test="attribute1 != null" >
        #{attribute1,jdbcType=VARCHAR},
      </if>
      <if test="attribute2 != null" >
        #{attribute2,jdbcType=VARCHAR},
      </if>
      <if test="attribute3 != null" >
        #{attribute3,jdbcType=VARCHAR},
      </if>
      <if test="attribute4 != null" >
        #{attribute4,jdbcType=VARCHAR},
      </if>
      <if test="attribute5 != null" >
        #{attribute5,jdbcType=VARCHAR},
      </if>
      <if test="attribute6 != null" >
        #{attribute6,jdbcType=VARCHAR},
      </if>
      <if test="attribute7 != null" >
        #{attribute7,jdbcType=VARCHAR},
      </if>
      <if test="attribute8 != null" >
        #{attribute8,jdbcType=VARCHAR},
      </if>
      <if test="attribute9 != null" >
        #{attribute9,jdbcType=VARCHAR},
      </if>
      <if test="attribute10 != null" >
        #{attribute10,jdbcType=VARCHAR},
      </if>
      <if test="attribute11 != null" >
        #{attribute11,jdbcType=VARCHAR},
      </if>
      <if test="attribute12 != null" >
        #{attribute12,jdbcType=VARCHAR},
      </if>
      <if test="attribute13 != null" >
        #{attribute13,jdbcType=VARCHAR},
      </if>
      <if test="attribute14 != null" >
        #{attribute14,jdbcType=VARCHAR},
      </if>
      <if test="attribute15 != null" >
        #{attribute15,jdbcType=VARCHAR},
      </if>
      <if test="withholdingTaxAmt != null" >
        #{withholdingTaxAmt,jdbcType=DECIMAL},
      </if>
      <if test="remitMode != null" >
        #{remitMode,jdbcType=VARCHAR},
      </if>
      <if test="idNumber != null" >
        #{idNumber,jdbcType=VARCHAR},
      </if>
      <if test="bonusCode != null" >
        #{bonusCode,jdbcType=VARCHAR},
      </if>
      <if test="bonusType != null" >
        #{bonusType,jdbcType=VARCHAR},
      </if>
      <if test="remitBankAccountName != null" >
        #{remitBankAccountName,jdbcType=VARCHAR},
      </if>
      <if test="bankBranchCode != null" >
        #{bankBranchCode,jdbcType=VARCHAR},
      </if>
      <if test="lockFlag != null" >
        #{lockFlag,jdbcType=VARCHAR},
      </if>
      <if test="autoFaliledFlag != null" >
        #{autoFaliledFlag,jdbcType=VARCHAR},
      </if>
      <if test="processMode != null" >
        #{processMode,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.lkkhpg.dsis.common.bonus.dto.BonusFinal" >
    update BM_BONUS_FINAL
    <set >
      <if test="periodId != null" >
        PERIOD_ID = #{periodId,jdbcType=DECIMAL},
      </if>
      <if test="memberId != null" >
        MEMBER_ID = #{memberId,jdbcType=DECIMAL},
      </if>
      <if test="currencyCode != null" >
        CURRENCY_CODE = #{currencyCode,jdbcType=VARCHAR},
      </if>
      <if test="preTaxAmtAdjust != null" >
        PRE_TAX_AMT_ADJUST = #{preTaxAmtAdjust,jdbcType=DECIMAL},
      </if>
      <if test="preTaxAmt != null" >
        PRE_TAX_AMT = #{preTaxAmt,jdbcType=DECIMAL},
      </if>
      <if test="taxCode01 != null" >
        TAX_CODE_01 = #{taxCode01,jdbcType=VARCHAR},
      </if>
      <if test="taxAmt01 != null" >
        TAX_AMT_01 = #{taxAmt01,jdbcType=DECIMAL},
      </if>
      <if test="taxCode02 != null" >
        TAX_CODE_02 = #{taxCode02,jdbcType=VARCHAR},
      </if>
      <if test="taxAmt02 != null" >
        TAX_AMT_02 = #{taxAmt02,jdbcType=DECIMAL},
      </if>
      <if test="afterTaxAmt != null" >
        AFTER_TAX_AMT = #{afterTaxAmt,jdbcType=DECIMAL},
      </if>
      <if test="deliverAmt != null" >
        DELIVER_AMT = #{deliverAmt,jdbcType=DECIMAL},
      </if>
      <if test="clearTaxCode03 != null" >
        CLEAR_TAX_CODE_03 = #{clearTaxCode03,jdbcType=VARCHAR},
      </if>
      <if test="clearTaxAmt03 != null" >
        CLEAR_TAX_AMT_03 = #{clearTaxAmt03,jdbcType=DECIMAL},
      </if>
      <if test="deliverBankCode != null" >
        DELIVER_BANK_CODE = #{deliverBankCode,jdbcType=VARCHAR},
      </if>
      <if test="deliverBankFee != null" >
        DELIVER_BANK_FEE = #{deliverBankFee,jdbcType=DECIMAL},
      </if>
      <if test="remitNetAmt != null" >
        REMIT_NET_AMT = #{remitNetAmt,jdbcType=DECIMAL},
      </if>
      <if test="remitBankCode != null" >
        REMIT_BANK_CODE = #{remitBankCode,jdbcType=VARCHAR},
      </if>
      <if test="remitBankName != null" >
        REMIT_BANK_NAME = #{remitBankName,jdbcType=VARCHAR},
      </if>
      <if test="remitBankAccount != null" >
        REMIT_BANK_ACCOUNT = #{remitBankAccount,jdbcType=VARCHAR},
      </if>
      <if test="remitFlag != null" >
        REMIT_FLAG = #{remitFlag,jdbcType=VARCHAR},
      </if>
      <if test="remitDate != null" >
        REMIT_DATE = #{remitDate,jdbcType=TIMESTAMP},
      </if>
      <if test="remitMemo != null" >
        REMIT_MEMO = #{remitMemo,jdbcType=VARCHAR},
      </if>
      <if test="comments != null" >
        COMMENTS = #{comments,jdbcType=VARCHAR},
      </if>
      <if test="marketId != null" >
        MARKET_ID = #{marketId,jdbcType=DECIMAL},
      </if>
      <if test="status != null" >
        STATUS = #{status,jdbcType=VARCHAR},
      </if>
        OBJECT_VERSION_NUMBER = OBJECT_VERSION_NUMBER + 1,
      <if test="requestId != null" >
        REQUEST_ID = #{requestId,jdbcType=DECIMAL},
      </if>
      <if test="programId != null" >
        PROGRAM_ID = #{programId,jdbcType=DECIMAL},
      </if>
      <if test="creationDate != null" >
        CREATION_DATE = #{creationDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createdBy != null" >
        CREATED_BY = #{createdBy,jdbcType=DECIMAL},
      </if>
      <if test="lastUpdatedBy != null" >
        LAST_UPDATED_BY = #{lastUpdatedBy,jdbcType=DECIMAL},
      </if>
        LAST_UPDATE_DATE = CURRENT_TIMESTAMP,
      <if test="lastUpdateLogin != null" >
        LAST_UPDATE_LOGIN = #{lastUpdateLogin,jdbcType=DECIMAL},
      </if>
      <if test="attributeCategory != null" >
        ATTRIBUTE_CATEGORY = #{attributeCategory,jdbcType=VARCHAR},
      </if>
      <if test="attribute1 != null" >
        ATTRIBUTE1 = #{attribute1,jdbcType=VARCHAR},
      </if>
      <if test="attribute2 != null" >
        ATTRIBUTE2 = #{attribute2,jdbcType=VARCHAR},
      </if>
      <if test="attribute3 != null" >
        ATTRIBUTE3 = #{attribute3,jdbcType=VARCHAR},
      </if>
      <if test="attribute4 != null" >
        ATTRIBUTE4 = #{attribute4,jdbcType=VARCHAR},
      </if>
      <if test="attribute5 != null" >
        ATTRIBUTE5 = #{attribute5,jdbcType=VARCHAR},
      </if>
      <if test="attribute6 != null" >
        ATTRIBUTE6 = #{attribute6,jdbcType=VARCHAR},
      </if>
      <if test="attribute7 != null" >
        ATTRIBUTE7 = #{attribute7,jdbcType=VARCHAR},
      </if>
      <if test="attribute8 != null" >
        ATTRIBUTE8 = #{attribute8,jdbcType=VARCHAR},
      </if>
      <if test="attribute9 != null" >
        ATTRIBUTE9 = #{attribute9,jdbcType=VARCHAR},
      </if>
      <if test="attribute10 != null" >
        ATTRIBUTE10 = #{attribute10,jdbcType=VARCHAR},
      </if>
      <if test="attribute11 != null" >
        ATTRIBUTE11 = #{attribute11,jdbcType=VARCHAR},
      </if>
      <if test="attribute12 != null" >
        ATTRIBUTE12 = #{attribute12,jdbcType=VARCHAR},
      </if>
      <if test="attribute13 != null" >
        ATTRIBUTE13 = #{attribute13,jdbcType=VARCHAR},
      </if>
      <if test="attribute14 != null" >
        ATTRIBUTE14 = #{attribute14,jdbcType=VARCHAR},
      </if>
      <if test="attribute15 != null" >
        ATTRIBUTE15 = #{attribute15,jdbcType=VARCHAR},
      </if>
      <if test="withholdingTaxAmt != null" >
        WITHHOLDING_TAX_AMT = #{withholdingTaxAmt,jdbcType=DECIMAL},
      </if>
      <if test="remitMode != null" >
        REMIT_MODE = #{remitMode,jdbcType=VARCHAR},
      </if>
      <if test="idNumber != null" >
        ID_NUMBER = #{idNumber,jdbcType=VARCHAR},
      </if>
      <if test="bonusCode != null" >
        BONUS_CODE = #{bonusCode,jdbcType=VARCHAR},
      </if>
      <if test="bonusType != null" >
        BONUS_TYPE = #{bonusType,jdbcType=VARCHAR},
      </if>
      <if test="remitBankAccountName != null" >
        REMIT_BANK_ACCOUNT_NAME = #{remitBankAccountName,jdbcType=VARCHAR},
      </if>
      <if test="bankBranchCode != null" >
        BANK_BRANCH_CODE = #{bankBranchCode,jdbcType=VARCHAR},
      </if>
      <if test="lockFlag != null" >
        LOCK_FLAG = #{lockFlag,jdbcType=VARCHAR},
      </if>
      <if test="autoFaliledFlag != null" >
        AUTO_FAILED_FLAG = #{autoFaliledFlag,jdbcType=VARCHAR},
      </if>
      <if test="processMode != null" >
        PROCESS_MODE = #{processMode,jdbcType=VARCHAR},
      </if>
    </set>
    where BONUS_ID = #{bonusId,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.lkkhpg.dsis.common.bonus.dto.BonusFinal" >
    update BM_BONUS_FINAL
    set PERIOD_ID = #{periodId,jdbcType=DECIMAL},
      MEMBER_ID = #{memberId,jdbcType=DECIMAL},
      CURRENCY_CODE = #{currencyCode,jdbcType=VARCHAR},
      PRE_TAX_AMT_ADJUST = #{preTaxAmtAdjust,jdbcType=DECIMAL},
      PRE_TAX_AMT = #{preTaxAmt,jdbcType=DECIMAL},
      TAX_CODE_01 = #{taxCode01,jdbcType=VARCHAR},
      TAX_AMT_01 = #{taxAmt01,jdbcType=DECIMAL},
      TAX_CODE_02 = #{taxCode02,jdbcType=VARCHAR},
      TAX_AMT_02 = #{taxAmt02,jdbcType=DECIMAL},
      AFTER_TAX_AMT = #{afterTaxAmt,jdbcType=DECIMAL},
      DELIVER_AMT = #{deliverAmt,jdbcType=DECIMAL},
      CLEAR_TAX_CODE_03 = #{clearTaxCode03,jdbcType=VARCHAR},
      CLEAR_TAX_AMT_03 = #{clearTaxAmt03,jdbcType=DECIMAL},
      DELIVER_BANK_CODE = #{deliverBankCode,jdbcType=VARCHAR},
      DELIVER_BANK_FEE = #{deliverBankFee,jdbcType=DECIMAL},
      REMIT_NET_AMT = #{remitNetAmt,jdbcType=DECIMAL},
      REMIT_BANK_CODE = #{remitBankCode,jdbcType=VARCHAR},
      REMIT_BANK_NAME = #{remitBankName,jdbcType=VARCHAR},
      REMIT_BANK_ACCOUNT = #{remitBankAccount,jdbcType=VARCHAR},
      REMIT_FLAG = #{remitFlag,jdbcType=VARCHAR},
      REMIT_DATE = #{remitDate,jdbcType=TIMESTAMP},
      REMIT_MEMO = #{remitMemo,jdbcType=VARCHAR},
      COMMENTS = #{comments,jdbcType=VARCHAR},
      MARKET_ID = #{marketId,jdbcType=DECIMAL},
      STATUS = #{status,jdbcType=VARCHAR},
      OBJECT_VERSION_NUMBER = OBJECT_VERSION_NUMBER + 1,
      REQUEST_ID = #{requestId,jdbcType=DECIMAL},
      PROGRAM_ID = #{programId,jdbcType=DECIMAL},
      CREATION_DATE = #{creationDate,jdbcType=TIMESTAMP},
      CREATED_BY = #{createdBy,jdbcType=DECIMAL},
      LAST_UPDATED_BY = #{lastUpdatedBy,jdbcType=DECIMAL},
      LAST_UPDATE_DATE = CURRENT_TIMESTAMP,
      LAST_UPDATE_LOGIN = #{lastUpdateLogin,jdbcType=DECIMAL},
      ATTRIBUTE_CATEGORY = #{attributeCategory,jdbcType=VARCHAR},
      ATTRIBUTE1 = #{attribute1,jdbcType=VARCHAR},
      ATTRIBUTE2 = #{attribute2,jdbcType=VARCHAR},
      ATTRIBUTE3 = #{attribute3,jdbcType=VARCHAR},
      ATTRIBUTE4 = #{attribute4,jdbcType=VARCHAR},
      ATTRIBUTE5 = #{attribute5,jdbcType=VARCHAR},
      ATTRIBUTE6 = #{attribute6,jdbcType=VARCHAR},
      ATTRIBUTE7 = #{attribute7,jdbcType=VARCHAR},
      ATTRIBUTE8 = #{attribute8,jdbcType=VARCHAR},
      ATTRIBUTE9 = #{attribute9,jdbcType=VARCHAR},
      ATTRIBUTE10 = #{attribute10,jdbcType=VARCHAR},
      ATTRIBUTE11 = #{attribute11,jdbcType=VARCHAR},
      ATTRIBUTE12 = #{attribute12,jdbcType=VARCHAR},
      ATTRIBUTE13 = #{attribute13,jdbcType=VARCHAR},
      ATTRIBUTE14 = #{attribute14,jdbcType=VARCHAR},
      ATTRIBUTE15 = #{attribute15,jdbcType=VARCHAR},
      WITHHOLDING_TAX_AMT = #{withholdingTaxAmt,jdbcType=DECIMAL},
      REMIT_MODE = #{remitMode,jdbcType=VARCHAR},
      ID_NUMBER = #{idNumber,jdbcType=VARCHAR},
      BONUS_CODE = #{bonusCode,jdbcType=VARCHAR},
      BONUS_TYPE = #{bonusType,jdbcType=VARCHAR},
      REMIT_BANK_ACCOUNT_NAME = #{remitBankAccountName,jdbcType=VARCHAR},
      BANK_BRANCH_CODE = #{bankBranchCode,jdbcType=VARCHAR},
      LOCK_FLAG = #{lockFlag,jdbcType=VARCHAR},
      AUTO_FAILED_FLAG = #{autoFaliledFlag,jdbcType=VARCHAR},
      PROCESS_MODE = #{processMode,jdbcType=VARCHAR}
    where BONUS_ID = #{bonusId,jdbcType=DECIMAL}
  </update>
  
  <select id="queryDetailsByBonusFinal" resultMap="BaseResultMap" parameterType="com.lkkhpg.dsis.common.bonus.dto.BonusFinal">
    select BBF.BONUS_ID,
       BBF.PERIOD_ID,
       BBF.MEMBER_ID,
       BBF.CURRENCY_CODE,
       BBF.PRE_TAX_AMT_ADJUST,
       BBF.PRE_TAX_AMT,
       BBF.TAX_CODE_01,
       BBF.TAX_AMT_01,
       BBF.TAX_CODE_02,
       BBF.TAX_AMT_02,
       BBF.AFTER_TAX_AMT,
       BBF.DELIVER_AMT,
       BBF.CLEAR_TAX_CODE_03,
       BBF.CLEAR_TAX_AMT_03,
       BBF.DELIVER_BANK_CODE,
       BBF.DELIVER_BANK_FEE,
       BBF.REMIT_NET_AMT,
       BBF.REMIT_BANK_CODE,
       BBF.REMIT_BANK_NAME,
       BBF.REMIT_BANK_ACCOUNT,
       BBF.REMIT_FLAG,
       BBF.REMIT_DATE,
       BBF.REMIT_MEMO,
       BBF.COMMENTS,
       BBF.MARKET_ID,
       BBF.STATUS,
       BBF.OBJECT_VERSION_NUMBER,
       BBF.REQUEST_ID,
       BBF.PROGRAM_ID,
       BBF.CREATION_DATE,
       BBF.CREATED_BY,
       BBF.LAST_UPDATED_BY,
       BBF.LAST_UPDATE_DATE,
       BBF.LAST_UPDATE_LOGIN,
       BBF.ATTRIBUTE_CATEGORY,
       BBF.WITHHOLDING_TAX_AMT,
       BBF.REMIT_MODE,
       BBF.ID_NUMBER,
       BBF.BONUS_CODE,
       BBF.BONUS_TYPE,
       BBF.PROCESS_MODE,
       BBF.REMIT_BANK_ACCOUNT_NAME,
       BBF.LOCK_FLAG,
       BBF.AUTO_FAILED_FLAG,
       SCT.NAME AS COMPANY_NAME,
       MM.MEMBER_CODE,
       (CASE MM.MEMBER_TYPE  WHEN  'COMP' THEN COALESCE(CASE
                WHEN MM.REF_COMPANY IS NULL THEN
                MM.REF_COMPANY_EN
                ELSE
                MM.REF_COMPANY
                END ,'')
            ELSE
       CONCAT(CASE
                WHEN MM.ENGLISH_NAME IS NULL THEN
                 ''
                WHEN MM.CHINESE_NAME IS NULL THEN
                 MM.ENGLISH_NAME
                ELSE
                 CONCAT(MM.ENGLISH_NAME, '/')
              END,
              MM.CHINESE_NAME)  END )AS MEMBER_NAME,
       SMT.NAME AS MARKET_NAME,
       SP.PERIOD_NAME,
       BBF.BANK_BRANCH_CODE
  from BM_BONUS_FINAL BBF,
       MM_MEMBER_V           MM,
       SPM_PERIOD          SP,
       SPM_COMPANY_B       SCB
  LEFT OUTER JOIN SPM_COMPANY_TL SCT
    ON (SCB.COMPANY_ID = SCT.COMPANY_ID AND SCT.LANG =#{request.locale,jdbcType=VARCHAR}), SPM_MARKET_B SMB
  LEFT OUTER JOIN SPM_MARKET_TL SMT
    ON (SMB.MARKET_ID = SMT.MARKET_ID AND SMT.LANG =#{request.locale,jdbcType=VARCHAR})
  WHERE MM.MEMBER_ID = BBF.MEMBER_ID
    AND MM.COMPANY_ID = SCB.COMPANY_ID
    AND SMB.MARKET_ID = BBF.MARKET_ID
    AND SP.PERIOD_ID = BBF.PERIOD_ID
    <if test="marketId != null">
        AND BBF.MARKET_ID = #{marketId,jdbcType=DECIMAL}
    </if>
    <if test="marketId == null">
        AND BBF.MARKET_ID = #{request.marketId,jdbcType=DECIMAL}
    </if>
    <if test="memberId != null" >
        AND BBF.MEMBER_ID = #{memberId,jdbcType=DECIMAL}
    </if>
    <if test="bonusType != null" >
        AND BBF.BONUS_TYPE = #{bonusType,jdbcType=VARCHAR}
    </if>
    <if test="periodId != null" >
        AND BBF.PERIOD_ID = #{periodId,jdbcType=DECIMAL}
    </if>
    <if test="remitFlag != null" >
        AND BBF.REMIT_FLAG = #{remitFlag,jdbcType=VARCHAR}
    </if>
    <if test="bonusId != null" >
        AND BBF.BONUS_ID = #{bonusId,jdbcType=VARCHAR}
    </if>
	<if test="remitMode != null" >
        AND BBF.REMIT_MODE = #{remitMode,jdbcType=VARCHAR}
    </if>
    <if test="processMode != null" >
        AND BBF.PROCESS_MODE = #{processMode,jdbcType=VARCHAR}
    </if> 
    <if test="memberCode != null">
        AND MM.member_code like concat('%',concat(#{memberCode,jdbcType=VARCHAR},'%'))
    </if>   
  </select>
  
  <select id="createFinalBonus" statementType="CALLABLE" parameterType="java.util.Map">
    <![CDATA[{ call
        dsis_bonus_generate_final(#{periodId,mode=IN,jdbcType=DECIMAL} ,
                                  #{marketId,mode=IN,jdbcType=DECIMAL} ,
                                  #{bonusType,mode=IN,jdbcType=VARCHAR} ,
                                  #{remitDate,mode=IN,jdbcType=DATE},
                                  #{createBy,mode=IN,jdbcType=DECIMAL},
                                  #{requestId,mode=IN,jdbcType=DECIMAL},
                                  #{programId,mode=IN,jdbcType=DECIMAL},
                                  #{currencyCode,mode=IN,jdbcType=VARCHAR}, 
                                  #{retransfers,mode=IN,jdbcType=VARCHAR},
                                  #{withdraws,mode=IN,jdbcType=VARCHAR}) 
    }]]>
  </select>
  
  <resultMap id="CreateFileMap" type="com.lkkhpg.dsis.common.bonus.dto.BonusFinal" >
    <result column="AMOUNT" property="amount" jdbcType="DECIMAL"/>
    <result column="TOTALBONUS" property="totalBonus" jdbcType="DECIMAL"/>
  </resultMap>
  
  <select id="queryCreateFile" resultMap="CreateFileMap" parameterType="com.lkkhpg.dsis.common.bonus.dto.BonusFinal">
  select 
       count(1) AMOUNT,
       SUM(BBF.REMIT_NET_AMT) TOTALBONUS
       from BM_BONUS_FINAL BBF
       where 1=1
           and BBF.REMIT_NET_AMT &gt; 0
       <if test="marketId != null">
           and BBF.MARKET_ID = #{marketId,jdbcType=DECIMAL}
       </if>
       <if test="periodId != null">
           and BBF.PERIOD_ID = #{periodId,jdbcType=DECIMAL}
       </if>
       <if test="bonusType != null">
           and BBF.BONUS_TYPE = #{bonusType,jdbcType=VARCHAR}
       </if>
       <if test="remitMode != null" >
           AND BBF.REMIT_MODE = #{remitMode,jdbcType=VARCHAR}
       </if>
       <if test="remitFlag != null" >
           AND BBF.REMIT_FLAG = #{remitFlag,jdbcType=VARCHAR}
       </if>
       <if test="processMode != null" >
           AND BBF.PROCESS_MODE = #{processMode,jdbcType=VARCHAR}
       </if>
  </select>
  
  <select id="queryBonusFinal" resultMap="BaseResultMap" parameterType="com.lkkhpg.dsis.common.bonus.dto.BonusReleaseCombine">
    SELECT     bbr.member_id,
           bbr.currency_code,
           bbr.pre_tax_amt_adjust,
           bbr.pre_tax_amt,
           bbr.tax_code_01,
           bbr.tax_amt_01,
           bbr.tax_code_02,
           bbr.tax_amt_02,
           bbr.after_tax_amt,
           bbr.deliver_amt,
           bbr.clear_tax_code_03,
           bbr.clear_tax_amt_03,
           (select sbb1.bank_number from SPM_BANK_B sbb1 where sbb1.bank_id = mma.bank_id) remit_bank_code,
           mma.account_number remit_bank_account,
           bbr.comments,
           bbr.market_id,
           bbr.status,
           bbr.request_id,
           bbr.program_id,
           bbr.creation_date,
           bbr.created_by,
           bbr.last_updated_by,
           bbr.last_update_date,
           bbr.last_update_login,
           bbr.withholding_tax_amt,
           mma.id_number id_number,
           bbr.bonus_type,
           mma.account_holder remit_bank_account_name,
           (select sbb2.bank_number from SPM_BANK_B sbb2 where sbb2.bank_id = mma.BANK_BRANCH_ID) bank_branch_code
      FROM bm_bonus_release bbr,
           mm_mem_account mma
     WHERE bbr.member_id = mma.member_id(+)
        <if test="periodId != null">
            AND BBR.PERIOD_ID = #{periodId ,jdbcType=DECIMAL}
        </if>
        <if test="bonusType != null">
            AND BBR.BONUS_TYPE = #{bonusType ,jdbcType=VARCHAR}
        </if>
        <if test="marketId != null">
            AND BBR.MARKET_ID = #{marketId,jdbcType=DECIMAL}
        </if>
        
  </select>
  
  <select id="autoFailBonusFinal" resultMap="BaseResultMap" parameterType="com.lkkhpg.dsis.common.bonus.dto.BonusFinal">
    SELECT 
    <include refid="Base_Column_List" />
    FROM bm_bonus_final bbf
    WHERE 1 = 1
    and bbf.period_id=#{periodId,jdbcType=DECIMAL}
    and bbf.market_id=#{marketId,jdbcType=DECIMAL}
    and bbf.bonus_type=#{bonusType ,jdbcType=VARCHAR}
    AND (EXISTS (SELECT 1
                 FROM mm_member mm
                 WHERE mm.member_id = bbf.member_id
                 AND (mm.status IN ('NEW','PEND','RJECT') OR mm.accept_bonus = 'N')) 
    OR ((bbf.REMIT_BANK_CODE is NULL OR BBF.REMIT_BANK_ACCOUNT is NULL OR BBF.ID_NUMBER is NULL
                OR BBF.REMIT_BANK_ACCOUNT_NAME is NULL) AND bbf.remit_mode = 'BANK')
                 <if test="deliverAmt != null">
                    OR (bbf.DELIVER_AMT &lt;(#{deliverAmt,jdbcType=DECIMAL}))
                 </if>
                 )
  </select>
  
  <update id="updateLockFlag">
  update BM_BONUS_FINAL
  <set >
      <if test="lockFlag != null" >
        LOCK_FLAG = #{lockFlag,jdbcType=VARCHAR},
      </if>
      <if test="autoFlag != null" >
        AUTO_FAILED_FLAG = #{autoFlag,jdbcType=VARCHAR},
      </if>
      <if test="processMode != null" >
        PROCESS_MODE = #{processMode,jdbcType=VARCHAR},
      </if>
      	REMIT_DATE = #{remitDate,jdbcType=TIMESTAMP},
  </set>
  where BONUS_ID in
  <foreach collection="bonusFinals" open="(" separator="," close=")" item="bonusFinal" index="index">
                    #{bonusFinal.bonusId,jdbcType=VARCHAR}
  </foreach>
  </update>
  <!-- RPT-00172报表所用(台湾市场下的数据) -->
    <select id="queryDetails" resultMap="BaseResultMap" parameterType="com.lkkhpg.dsis.common.bonus.dto.BonusFinal">
    select 
       BBR.PERIOD_ID,
       BBR.MEMBER_ID,
       ABS(BBR.PRE_TAX_AMT) PRE_TAX_AMT,
       ABS(BBR.CLEAR_TAX_AMT_03) CLEAR_TAX_AMT_03,
       SP.PERIOD_NAME,
       BBF.ID_NUMBER,
       MM.MEMBER_CODE,
       (CASE MM.MEMBER_TYPE  WHEN  'COMP' THEN COALESCE(CASE
                WHEN MM.REF_COMPANY IS NULL THEN
                MM.REF_COMPANY_EN
                ELSE
                MM.REF_COMPANY
                END ,'')
            ELSE
       CONCAT(CASE
                WHEN MM.ENGLISH_NAME IS NULL THEN
                 ''
                WHEN MM.CHINESE_NAME IS NULL THEN
                 MM.ENGLISH_NAME
                ELSE
                 CONCAT(MM.ENGLISH_NAME, '/')
              END,
              MM.CHINESE_NAME)  END )AS MEMBER_NAME,
       BBF.REMIT_DATE,
       coalesce(bbr.ATTRIBUTE1,'I') ATTRIBUTE1
  from BM_BONUS_RELEASE BBR,
       BM_BONUS_FINAL BBF,
       (
WITH temp AS
 (SELECT bbf1.bonus_id,
         bbf1.period_id
    FROM bm_bonus_final bbf1
    LEFT OUTER JOIN spm_period sp1
      ON sp1.period_id = bbf1.period_id
    LEFT OUTER JOIN spm_market_b smb
      ON bbf1.market_id = smb.market_id
   WHERE ((sp1.period_name &gt;=
         to_char(add_months(to_date(#{dateFrom,jdbcType=VARCHAR}, 'yyyyMM'), -1), 'yyyyMM') AND
         sp1.period_name &lt;=
         to_char(add_months(to_date(#{dateTo,jdbcType=VARCHAR}, 'yyyyMM'), -2), 'yyyyMM') AND
         bbf1.bonus_type = 'LOCAL') OR
         (sp1.period_name &gt;=
         to_char(add_months(to_date(#{dateFrom,jdbcType=VARCHAR}, 'yyyyMM'), -2), 'yyyyMM') AND
         sp1.period_name &lt;=
         to_char(add_months(to_date(#{dateTo,jdbcType=VARCHAR}, 'yyyyMM'), -3), 'yyyyMM') AND
         bbf1.bonus_type = 'INTER'))
     AND smb.code = 'TW'
     AND bbf1.remit_flag = 'Y')
SELECT bbr1.bonus_id, temp.bonus_id final_id
  FROM bm_bonus_release bbr1, temp
 WHERE bbr1.clear_tax_amt_03 &lt;&gt; 0 AND bbr1.final_bonus_id = temp.bonus_id 

UNION

SELECT bbr1.bonus_id,retransfer_temp.bonus_id final_id
  FROM bm_bonus_release bbr1,
       (SELECT t.child_bonus_id,
               temp.bonus_id
          FROM bm_bonus_final bbf,
               (SELECT connect_by_root(bonus_id) child_bonus_id,
                       connect_by_root(final_bonus_id) parent_bonus_id,
                       bbr.final_bonus_id root_bonus_id,
                       LEVEL
                  FROM bm_bonus_retransfer bbr
                CONNECT BY PRIOR bbr.final_bonus_id = bbr.bonus_id) t,
               temp
         WHERE bbf.bonus_id = t.root_bonus_id
           AND bbf.bonus_id = temp.bonus_id) retransfer_temp
           
 WHERE bbr1.clear_tax_amt_03 &lt;&gt; 0
   AND bbr1.final_bonus_id = retransfer_temp.child_bonus_id
) releaseTemp,
       MM_MEMBER_V           MM,
       SPM_PERIOD          SP
  WHERE MM.MEMBER_ID = BBR.MEMBER_ID
    AND SP.PERIOD_ID = BBR.PERIOD_ID
    AND BBR.BONUS_ID = releaseTemp.BONUS_ID
    and releaseTemp.final_id = bbf.BONUS_ID
    AND (BBR.CLEAR_TAX_AMT_03 IS NOT NULL AND BBR.CLEAR_TAX_AMT_03 &lt;&gt; 0)
    and BBR.MARKET_ID = #{request.marketId,jdbcType=DECIMAL}
    <if test="memberCodeForm != null">
        AND MM.MEMBER_CODE <![CDATA[>= #{memberCodeForm,jdbcType=VARCHAR}]]>
    </if>
    <if test="memberCodeTo != null">
        AND MM.MEMBER_CODE <![CDATA[<= #{memberCodeTo,jdbcType=VARCHAR}]]>
    </if>
    
    
  </select>
  
  <select id="queryLastRecordByMarket" resultMap="BaseResultMap">
  SELECT * from 
  (
  SELECT * from BM_BONUS_FINAL bbf 
  WHERE bbf.MARKET_ID = #{marketId,jdbcType=DECIMAL}
  order by bbf.CREATION_DATE DESC
  )  where rownum = 1
  </select>

<select id="queryDetailsForBankFile" resultMap="BaseResultMap">
  select BBF.BONUS_ID,
       BBF.PERIOD_ID,
       BBF.MEMBER_ID,
       BBF.CURRENCY_CODE,
       BBF.PRE_TAX_AMT_ADJUST,
       BBF.PRE_TAX_AMT,
       BBF.TAX_CODE_01,
       BBF.TAX_AMT_01,
       BBF.TAX_CODE_02,
       BBF.TAX_AMT_02,
       BBF.AFTER_TAX_AMT,
       BBF.DELIVER_AMT,
       BBF.CLEAR_TAX_CODE_03,
       BBF.CLEAR_TAX_AMT_03,
       BBF.DELIVER_BANK_CODE,
       BBF.DELIVER_BANK_FEE,
       BBF.REMIT_NET_AMT,
       BBF.REMIT_BANK_CODE,
       BBF.REMIT_BANK_NAME,
       BBF.REMIT_BANK_ACCOUNT,
       BBF.REMIT_FLAG,
       BBF.REMIT_DATE,
       BBF.REMIT_MEMO,
       BBF.COMMENTS,
       BBF.MARKET_ID,
       BBF.STATUS,
       BBF.OBJECT_VERSION_NUMBER,
       BBF.REQUEST_ID,
       BBF.PROGRAM_ID,
       BBF.CREATION_DATE,
       BBF.CREATED_BY,
       BBF.LAST_UPDATED_BY,
       BBF.LAST_UPDATE_DATE,
       BBF.LAST_UPDATE_LOGIN,
       BBF.ATTRIBUTE_CATEGORY,
       BBF.WITHHOLDING_TAX_AMT,
       BBF.REMIT_MODE,
       BBF.ID_NUMBER,
       BBF.BONUS_CODE,
       BBF.BONUS_TYPE,
       BBF.REMIT_BANK_ACCOUNT_NAME,
       BBF.LOCK_FLAG,
       BBF.AUTO_FAILED_FLAG,
       SCT.NAME AS COMPANY_NAME,
       MM.MEMBER_CODE,
       (CASE MM.MEMBER_TYPE  WHEN  'COMP' THEN COALESCE(CASE
                WHEN MM.REF_COMPANY IS NULL THEN
                MM.REF_COMPANY_EN
                ELSE
                MM.REF_COMPANY
                END ,'')
            ELSE
       CONCAT(CASE
                WHEN MM.ENGLISH_NAME IS NULL THEN
                 ''
                WHEN MM.CHINESE_NAME IS NULL THEN
                 MM.ENGLISH_NAME
                ELSE
                 CONCAT(MM.ENGLISH_NAME, '/')
              END,
              MM.CHINESE_NAME)  END )AS MEMBER_NAME,
       SMT.NAME AS MARKET_NAME,
       SP.PERIOD_NAME,
       BBF.BANK_BRANCH_CODE
  from BM_BONUS_FINAL BBF,
       MM_MEMBER_V           MM,
       SPM_PERIOD          SP,
       SPM_COMPANY_B       SCB
  LEFT OUTER JOIN SPM_COMPANY_TL SCT
    ON (SCB.COMPANY_ID = SCT.COMPANY_ID AND SCT.LANG =#{request.locale,jdbcType=VARCHAR}), SPM_MARKET_B SMB
  LEFT OUTER JOIN SPM_MARKET_TL SMT
    ON (SMB.MARKET_ID = SMT.MARKET_ID AND SMT.LANG =#{request.locale,jdbcType=VARCHAR})
  WHERE MM.MEMBER_ID = BBF.MEMBER_ID
    AND MM.COMPANY_ID = SCB.COMPANY_ID
    AND SMB.MARKET_ID = BBF.MARKET_ID
    AND SP.PERIOD_ID = BBF.PERIOD_ID
    and BBF.REMIT_NET_AMT &gt; 0
    <if test="bonus.marketId != null">
        AND BBF.MARKET_ID = #{bonus.marketId,jdbcType=DECIMAL}
    </if>
    <if test="bonus.marketId == null">
        AND BBF.MARKET_ID = #{request.marketId,jdbcType=DECIMAL}
    </if>
    <if test="bonus.memberId != null" >
        AND BBF.MEMBER_ID = #{bonus.memberId,jdbcType=DECIMAL}
    </if>
    <if test="bonus.bonusType != null" >
        AND BBF.BONUS_TYPE = #{bonus.bonusType,jdbcType=VARCHAR}
    </if>
    <if test="bonus.periodId != null" >
        AND BBF.PERIOD_ID = #{bonus.periodId,jdbcType=DECIMAL}
    </if>
    <if test="bonus.remitFlag != null" >
        AND BBF.REMIT_FLAG = #{bonus.remitFlag,jdbcType=VARCHAR}
    </if>
    <if test="bonus.bonusId != null" >
        AND BBF.BONUS_ID = #{bonus.bonusId,jdbcType=VARCHAR}
    </if>
	<if test="bonus.remitMode != null" >
        AND BBF.REMIT_MODE = #{bonus.remitMode,jdbcType=VARCHAR}
    </if>
    <if test="bonus.memberCode != null">
        AND MM.member_code like concat('%',concat(#{bonus.memberCode,jdbcType=VARCHAR},'%'))
    </if>
    <if test="bonus.processMode != null" >
        AND BBF.PROCESS_MODE = #{bonus.processMode,jdbcType=VARCHAR}
    </if>
    <if test="marketCode == 'HK' || marketCode == 'MY'">
        order by MM.MEMBER_CODE ASC
    </if>
    <if test="marketCode == 'TW'">
        order by MM.MEMBER_CODE ASC 
    </if>
    <if test="marketCode == 'SG'">
        order by MM.MEMBER_CODE ASC 
    </if>
  </select>

  <select id="queryCount"  resultMap="CreateFileMap" parameterType="com.lkkhpg.dsis.common.bonus.dto.BonusFinal">
  select 
       count(1) AMOUNT,
       SUM(BBF.REMIT_NET_AMT) TOTALBONUS
       from BM_BONUS_FINAL BBF
       where 1=1
       <if test="marketId != null">
           and BBF.MARKET_ID = #{marketId,jdbcType=DECIMAL}
       </if>
       <if test="periodId != null">
           and BBF.PERIOD_ID = #{periodId,jdbcType=DECIMAL}
       </if>
       <if test="bonusType != null">
           and BBF.BONUS_TYPE = #{bonusType,jdbcType=VARCHAR}
       </if>
       <if test="remitMode != null" >
           AND BBF.REMIT_MODE = #{remitMode,jdbcType=VARCHAR}
       </if>
       <if test="remitFlag != null" >
           AND BBF.REMIT_FLAG = #{remitFlag,jdbcType=VARCHAR}
       </if>
       <if test="processMode != null" >
           AND BBF.PROCESS_MODE = #{processMode,jdbcType=VARCHAR}
       </if>
       <if test="autoFaliledFlag != null" >
           AND BBF.AUTO_FAILED_FLAG = #{autoFaliledFlag,jdbcType=VARCHAR}
       </if>
       <if test="lockFlag != null" >
           AND BBF.LOCK_FLAG = #{lockFlag,jdbcType=VARCHAR}
       </if>
  </select>





</mapper>